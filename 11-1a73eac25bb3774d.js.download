"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[11],{17936:(e,t,n)=>{n.d(t,{W:()=>c});var a=n(54568),r=n(10158),s=n(1761),i=n(27261),o=n.n(i),l=n(62971);let u=()=>{let e=(0,r.fZ)(),{websiteBaseUrl:t}=(0,r._r)();return e?(0,a.jsx)(l.A,{defaultMessage:"Or consider <link>upgrading to Claude Pro</link>.",id:"j0jOXOpUyS",values:{link:e=>(0,a.jsx)("a",{href:"/upgrade/pro",className:"font-bold underline",rel:"noreferrer",children:e})}}):(0,a.jsx)(l.A,{defaultMessage:"Or <link>contact sales</link> if you would be interested in upgrading to a paid version of Claude.",id:"3hk4yMCf5v",values:{link:e=>(0,a.jsx)(o(),{href:"".concat(t,"/contact-sales"),className:"font-bold underline",children:e})}})};function c(){let e=(0,s.UC)(),t=(0,s.r$)();return e&&!t?(0,a.jsx)(u,{}):null}},18483:(e,t,n)=>{n.d(t,{SC:()=>c,UW:()=>o,Xn:()=>i,ey:()=>l,lK:()=>u});var a=n(29098),r=n.n(a),s=n(40459);r().join(s.cwd(),"public/i18n"),r().join(s.cwd(),"public/i18n/secret");let i="en-US",o={"xx-LS":{name:"Long stringsSSSSSSSS"},"xx-AC":{name:"ALL CAPS"},"xx-HA":{name:"[javascript] prefixed strings"},"en-XA":{name:"Ȧȧƈƈḗḗƞŧḗḗḓ Ḗḗƞɠŀīīşħ"},"en-XB":{name:"ɥsıʅƃuƎ ıpıԐ"}};function l(e){return"".concat("secret",":").concat(e)}function u(e){return"".concat("statsig",":").concat(e)}Object.keys(o);let c=["en-US","de-DE","fr-FR","ko-KR","ja-JP","es-419","es-ES","it-IT","hi-IN","pt-BR","id-ID"]},19303:(e,t,n)=>{n.d(t,{G:()=>c});var a=n(7726),r=n(1761),s=n(71473),i=n(87606),o=n(7620),l=n(57067),u=n(80079);let c=()=>{let e=(0,i.useQueryClient)(),{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,c=(0,o.useRef)(void 0),d=(0,u.$)(),h=(0,o.useCallback)(async(t,a)=>{let r=[s.fC,{orgUUID:n},{uuid:t}],i=e.getQueryData(r);if(!i)throw Error("Conversation tree must be provided for append");c.current=a(i),await e.cancelQueries({queryKey:r}),e.setQueryData(r,c.current)},[e,n]),m=(0,o.useCallback)((t,a)=>{0!==a.length&&e.setQueryData([s.fC,{orgUUID:n},{uuid:t}],()=>{let e=c.current;if(!e)throw Error("Conversation tree must be provided for incremental completion");if(!e.current_leaf_message_uuid)throw Error("Couldn't figure out where to put completion");let t=e.messageByUuid.get(e.current_leaf_message_uuid);if(!t)throw Error("New assistant message not found");return t.content=a,{...e,created_at:new Date().toISOString()}})},[e,n]);return{onStartAppend:h,onStreamCompleted:(0,o.useCallback)((t,r)=>{e.invalidateQueries({queryKey:[s.fC,{orgUUID:n}]}),e.invalidateQueries({queryKey:["FEATURE_LIMITS",n]});let i=c.current,o=(null==i?void 0:i.chat_messages)&&i.chat_messages.length<=2;i&&o&&(e.setQueriesData({queryKey:[s.DC,{orgUUID:n}],predicate:e=>{let{queryKey:t}=e,n=t[2];return!(null==n?void 0:n.starred)}},e=>e?[{uuid:t,name:i.name,summary:i.summary,updated_at:i.updated_at,created_at:i.created_at,project_uuid:i.project_uuid,model:i.model,settings:i.settings,is_starred:!1},...e].slice(0,a.sk):e),e.setQueryData([s.Ad,{orgUUID:n}],e=>{var t;return{is_first_conversation:!1,count:(null!=(t=null==e?void 0:e.count)?t:0)+1}})),r&&n&&d(r,n,t)},[e,d,n]),onIncrementalCompletion:m,changeDisplayedConversationPath:(0,o.useCallback)((t,a,r,i)=>{e.setQueryData([s.fC,{orgUUID:n},{uuid:t}],e=>{if(!e)throw Error("Conversation tree must be provided for changeDisplayedConversationPath");let t=(0,l.gX)(e,a,r);return t.current_leaf_message_uuid&&i&&i(t.current_leaf_message_uuid),t})},[e,n])}}},31198:(e,t,n)=>{n.d(t,{v:()=>s,x:()=>i});var a=n(7620);let r="customSystemPrompt",s=()=>{let[e,t]=(0,a.useState)(()=>"undefined"==typeof localStorage?"":localStorage.getItem(r)||"");return(0,a.useEffect)(()=>{localStorage.setItem(r,e)},[e]),{customSystemPrompt:e,setCustomSystemPrompt:t}},i=()=>"undefined"==typeof localStorage?"":localStorage.getItem(r)},55428:(e,t,n)=>{n.d(t,{O0:()=>s,yz:()=>a}),n(40459);let a=()=>!1,r=()=>!1,s=()=>r()||a()},70011:(e,t,n)=>{n.d(t,{c7:()=>U,Z3:()=>K,x:()=>$,Gw:()=>Y,SL:()=>H});var a=n(54568),r=n(7726),s=n(17936),i=n(98518),o=n(10158),l=n(1761),u=n(51121),c=n(18483),d=n(29585),h=n(46612),m=n(55428),p=n(71473),_=n(27062),g=n(75632),f=n(70825),k=n(21036),v=n(87606),x=n(67933),y=n(68864),b=n(27261),w=n.n(b),C=n(62942),S=n(7620),j=n(62971),E=n(46760),L=n(75006),O=n(8035),M=n(72034);let I=(e,t)=>t.reduce((t,n)=>t+e.blockSize(n),0),D=(e,t,n)=>{let{blockSize:a,sliceBlock:r}=e,s=[];if(n<=0)return[];let i=0;for(let e of t){if(i+a(e)>=n){s.push(r(e,n-i));break}s.push(e),i+=a(e)}return s},N=1e3/60;class A{_get_smoothed_completion(){var e,t,n;if(0===this.start)return[];let a=(Date.now()-this.start)/1e3,r=this.arrivals[this.arrivals.length-1][1]+100*!!this.model_done,s=.9*a-(null!=(n=null==(e=(t=this.blockOperations).getBlockDeadlineOffset)?void 0:e.call(t))?n:.3),i=this.arrivals.filter(e=>e[0]<s).map(e=>e[1]),o=i[i.length-1],l=function(e,t,n){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:.01;if(t===n)return t;let r=e(t),s=e(n);if(t>=n)throw Error("Lower x is greater than upper x");if(r>a)throw Error("Lower f is greater than zero");if(s<-a)throw Error("Upper f is less than zero");for(;r<-a;){let a=(t+n)/2,i=e(a);i<=0?(t=a,r=i):(n=a,s=i)}return t}(e=>{let t=(e-this.x)/(a-this.t),n=1/(a-this.t);return 2*this.gamma*n*(t-this.v)-1/(e-o)+1/(r-e)},o,r),u=(l-this.x)/(a-this.t);return this.v=this.alpha*this.v+(1-this.alpha)*u,this.smoothed_completion_is_unchanged=this.x>=this.totalCompletionLength,this.x=Math.max(l,this.x),this.t=a,this.stats.push({t:a,x:l,v:u,min_chars:o,max_chars:r}),D(this.blockOperations,this.blocksList,this.x)}get smootherDone(){return this.force_smoother_done||this.model_done&&this.x>=this.totalCompletionLength}addBlock(e,t){this.blocksList.push(t)}updateBlock(e,t){this.blocksList[e]=t}getBlocks(){return this.blocksList}onMessage(e){switch(e.type){case"content_block_start":{let t=this.blockOperations.createBlockFromStartEvent(e);null!==t&&this.addBlock(e.index,t);break}case"content_block_delta":{let t=this.blocksList[e.index];if(!t)break;let n=this.blockOperations.applyDeltaEvent(e,t);this.updateBlock(e.index,n);break}case"content_block_stop":{let t=this.blocksList[e.index];if(!t)break;let n=this.blockOperations.stopBlockEvent(e,t);this.updateBlock(e.index,n);break}case"message_stop":this.model_done=!0}0===this.start&&(this.start=Date.now());let t=I(this.blockOperations,this.blocksList);if(this.totalCompletionLength=t,this.arrivals.push([(Date.now()-this.start)/1e3,t]),this.dont_smooth&&this.on_completion){let e=structuredClone(this.blocksList);this.on_completion(e)}}async task(e,t){for(;!this.smootherDone&&!t.aborted;){if(this.blocksList.length>0){let t=this._get_smoothed_completion();this.smoothed_completion_is_unchanged||e(t)}await new Promise(e=>setTimeout(e,N))}}constructor(e){this.alpha=.99,this.gamma=1e-5,this.v=100,this.x=0,this.t=0,this.arrivals=[[-9999,0]],this.start=0,this.totalCompletionLength=0,this.smoothed_completion_is_unchanged=!1,this.dont_smooth=!1,this.model_done=!1,this.force_smoother_done=!1,this.stats=[],this.blocksList=[],this.blockOperations=e}}var P=function(e){return e[e.APPEND_MESSAGE_WITH_COMPLETION=1]="APPEND_MESSAGE_WITH_COMPLETION",e[e.RETRY_MESSAGE_WITH_COMPLETION=2]="RETRY_MESSAGE_WITH_COMPLETION",e}({});let T=["close_file","create_file","delete_file","file_search","open_file","repl","str_replace","update_file"];async function R(e){let t,n,{applicationType:a,endpoint:r,orgUuid:s,conversationUuid:i,body:o,onCompletion:l,onInvokeTool:u,abortController:c,completion:h,getTools:m,smoothingEnabled:p=!0}=e,_=(t={},n=!1,new A({blockSize:e=>{if("text"===e.type)return e.text.length;if("thinking"===e.type)return e.thinking.length;if("tool_use"===e.type){var t;return(null==(t=e.partial_json)?void 0:t.length)||0}return e.type,0},sliceBlock:(e,t)=>{if("tool_result"===e.type)return e;if("text"===e.type)return{...e,text:e.text.slice(0,t)};if("tool_use"===e.type){var n;return{...e,partial_json:null==(n=e.partial_json)?void 0:n.slice(0,t)}}return"thinking"===e.type?{...e,thinking:e.thinking.slice(0,t)}:e},createBlockFromStartEvent:e=>("thinking"===e.content_block.type&&(e.content_block.start_timestamp=new Date().toISOString()),e.content_block),applyDeltaEvent:(e,a)=>{var r,s;switch(a.type){case"text":switch(n=!1,e.delta.type){case"text_delta":return{...a,text:a.text+e.delta.text};case"citation_start_delta":{let n=e.delta.citation;return t={...t,[n.uuid]:{...n,start_index:a.text.length}},a}case"citation_end_delta":{let n=e.delta.citation_uuid;return{...a,citations:(null!=(r=a.citations)?r:[]).concat({...t[n],end_index:a.text.length})}}default:return a}case"thinking":switch(n=!0,e.delta.type){case"thinking_delta":return{...a,thinking:a.thinking+e.delta.thinking};case"thinking_summary_delta":return{...a,summaries:[...a.summaries||[],e.delta.summary]};case"thinking_cut_off_delta":return{...a,cut_off:e.delta.cut_off};default:return a}case"tool_result":if(n=!1,"input_json_delta"===e.delta.type)return{...a,content:[{type:"text",text:e.delta.partial_json}]};return a;case"tool_use":if(n=!1,"input_json_delta"===e.delta.type)return{...a,partial_json:(null!=(s=a.partial_json)?s:"")+e.delta.partial_json};return a}},stopBlockEvent:(e,t)=>"thinking"===t.type?{...t,stop_timestamp:e.stop_timestamp}:t,getBlockDeadlineOffset(){if(n)return 3}}));_.dont_smooth=!p,_.on_completion=l;let g=p?_.task(l,c.signal):Promise.resolve(),k={"Content-Type":"application/json",Accept:"text/event-stream",...(0,O._)(a)},v=null,x=null,y=JSON.stringify({...h,...o,text:void 0,rendering_mode:"messages",organization_uuid:void 0,conversation_uuid:void 0}),b="",w="",C="",S=0,j=(0,M.y)(function(e,t,n){let a;if(void 0===t||void 0===n)throw Error("Missing org uuid or conversation uuid");switch(e){case 1:a="completion";break;case 2:a="retry_completion";break;default:throw Error("Invalid endpoint")}return"/api/organizations/".concat(t,"/chat_conversations/").concat(n,"/").concat(a)}(r,s,i),{method:"POST",credentials:"include",headers:k,body:y,openWhenHidden:!0,signal:c.signal,async onopen(e){var t;if(!e.ok||!(null==(t=e.headers.get("content-type"))?void 0:t.includes(M.o))){let t=await e.text(),n={};try{n=JSON.parse(t)}catch(e){}throw(0,d.a5)(e.status,n,"Failed to fetch",e.headers)}},onmessage:e=>{var t,n;switch(e.event){case"ping":default:return;case"error":throw(0,d.a5)(0,JSON.parse(e.data),"Streaming error: 22");case"completion":{let n=JSON.parse(e.data);if(void 0===n.completion)throw Error("Unexpected message received when streaming: ".concat(e.data));let a={type:"content_block_delta",index:0,delta:{type:"text_delta",text:n.completion}};v=n.stop_reason,x=null!=(t=n.messageLimit)?t:null,_.onMessage(a);break}case"content_block_start":{let t=JSON.parse(e.data);S=t.index,"tool_use"===t.content_block.type&&(w=t.content_block.name,C=t.content_block.id),_.onMessage(t);break}case"content_block_delta":{let t=JSON.parse(e.data);if(t.index!==S&&"thinking_summary_delta"!==t.delta.type)throw Error("Content block index did not match the expected index");(null==(n=t.delta)?void 0:n.type)==="input_json_delta"&&(T.includes(w)||m().some(e=>e.name===w||w.endsWith(":".concat(e.name))))&&(b+=t.delta.partial_json),_.onMessage(t);break}case"content_block_stop":{let t=JSON.parse(e.data);if(t.index!==S)throw Error("Content block index did not match the expected index");if(_.onMessage(t),!w)break;u(i,w,C,b),b="",w="",C="";break}case"message_limit":x=JSON.parse(e.data).message_limit;break;case"message_delta":case"message_start":case"message_stop":{let t=JSON.parse(e.data);"message_stop"===t.type&&(v="message_stop"),_.onMessage(t)}}},onclose(){_.model_done=!0},onerror(e){throw e instanceof d.LG&&529===e.statusCode||(0,f.Cp)(e),_.model_done=!0,_.force_smoother_done=!0,e}});return await Promise.all([j,g]),{stopReason:v,messageLimitResult:x}}var z=n(57067),B=n(31198),W=n(80079),Q=n(19303);let G=(0,S.createContext)([null,null]);function U(e){let{children:t}=e,n=(0,S.useState)({});return(0,a.jsx)(G.Provider,{value:n,children:t})}function Y(e,t,n){let{onIncrementalCompletion:a,onStartAppend:r,onStreamCompleted:s}=(0,Q.G)(),i=V({conversationUUID:e,endpoint:P.APPEND_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:a,onStreamCompleted:s,onInvokeTool:t,getTools:n}),{runStream:o}=i,l=(0,S.useCallback)(async t=>{let{prompt:n,attachments:a,files:s,syncSources:i,rethrowErrors:l=!1,modelOverride:u,parent_message_uuid:c,personalized_style:d,compass_mode:h,org_type_override:m}=t;await r(e,e=>{if(!e)throw Error("Conversation tree must be provided for tree append");let t=(0,z.ZQ)(e),r=[{uuid:z.Rh,content:[{type:"text",text:n,citations:[]}],created_at:new Date().toISOString(),sender:"human",attachments:a,files:s,files_v2:s,sync_sources:i,index:t+1,parent_message_uuid:null!=c?c:z.gF},{uuid:z.gv,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],files_v2:[],sync_sources:[],index:t+2,parent_message_uuid:z.Rh,metadata:{compass_mode:h}}];return(0,z.xQ)(e,r)}),await o({prompt:n,attachments:a,files:s,syncSources:i,rethrowErrors:l,modelOverride:u,parent_message_uuid:c,personalized_style:d,org_type_override:m})},[o,r,e]);return{...i,runStream:l}}function H(e,t,n,a){let{onIncrementalCompletion:r,onStreamCompleted:s,onStartAppend:i}=(0,Q.G)(),o=V({conversationUUID:e,endpoint:P.RETRY_MESSAGE_WITH_COMPLETION,onIncrementalCompletion:r,onInvokeTool:t,onStreamCompleted:s,getTools:n}),{runStream:l}=o,u=(0,S.useCallback)(async(t,n,r)=>{await i(e,e=>{let n=[{uuid:z.gv,content:[],created_at:new Date().toISOString(),sender:"assistant",attachments:[],files:[],files_v2:[],sync_sources:[],parent_message_uuid:t,selectedOption:0,index:(0,z.ZQ)(e)+1}];return(0,z.xQ)(e,n)}),await l({prompt:"",attachments:[],files:[],syncSources:[],parent_message_uuid:t,personalized_style:a,paprika_mode:n,compass_mode:r,isRetry:!0})},[e,l,i,a]);return{...o,runStream:u}}let J="incomplete_stream",F=Error(J),q=L.z.object({model:L.z.string().nullable()}).nullable(),K=e=>{let t=X(e),n=(0,_.P0)("tepui_default_on_claude_free","model",null,_.Lu),a=(0,_.GZ)("console_default_model_override","model",null,q),r=(0,_.T9)("console_default_model","model",null,_.Lu);return t||n||(null==a?void 0:a.model)||r||"claude-2.1"},X=e=>{let t=(0,r.mz)(e||""),n=(0,C.useSearchParams)(),a=null==n?void 0:n.get("model");return(null==t?void 0:t.model)?null==t?void 0:t.model:a||void 0},Z={value:null},$=()=>{let e=(0,v.useQueryClient)();return{failedStreamRetryData:(0,x.useQuery)({queryKey:[p.xT],queryFn:()=>Z.value,initialData:null}).data||null,setFailedStreamRetryData:(0,S.useCallback)(t=>{Z.value=t,e.setQueryData([p.xT],t)},[e])}};function V(e){var t;let{conversationUUID:n,endpoint:p,getTools:v,onIncrementalCompletion:x,onInvokeTool:b,onStreamCompleted:L}=e,{applicationType:O}=(0,o._r)(),{activeOrganization:M}=(0,l.YL)(),{value:I}=(0,_.fS)("apps_no_smoothing"),D=null==M?void 0:M.uuid,{context:N,clearContext:A,setContext:P}=function(e){let[t,n]=(0,S.useContext)(G),[a,r]=(0,S.useState)(),s=(0,S.useCallback)(()=>{n?n(t=>{let n={...t};return delete n[e],n}):r(void 0)},[e,n]),i=(0,S.useCallback)(t=>{n?n(n=>({...n,[e]:t})):r(t)},[e,n]);return{context:t?t[e]:a,clearContext:s,setContext:i}}(n),T=(0,C.useSearchParams)(),z=null==T?void 0:T.get("t"),Q=null!=(t=X(n))?t:"",U=null==T?void 0:T.get("max_tokens"),Y=(0,W.$)(),{addError:H,clearToast:q}=(0,u.Y)(),K=(0,S.useMemo)(g.N,[]),Z=(0,r.bT)("push",K),{setFailedStreamRetryData:V}=$(),ee=(0,S.useCallback)(async e=>{await (null==L?void 0:L(n,e)),A()},[L,n,A]),et=(0,S.useCallback)((e,t,r)=>{if(e===J)return H((0,a.jsx)("p",{children:(0,a.jsx)(j.A,{defaultMessage:"Claude’s response was interrupted. This can be caused by network problems or exceeding the maximum conversation length. Please <link>contact support</link> if the issue persists.",id:"sHRMIfTKu4",values:{link:e=>(0,a.jsx)(w(),{href:"https://support.anthropic.com/en/articles/9015913-how-to-get-support",className:"underline",children:e})}})}));if(!(e instanceof d.LG))return H((0,a.jsx)(j.A,{defaultMessage:"We couldn’t connect to Claude. Please check your network connection and try again.",id:"KzO0j4cGtg"}));if("rate_limit_error"===e.type){if(e.message.includes("{")&&D)try{let t=JSON.parse(e.message);Y(t,D,n)}catch(e){}return H((0,a.jsxs)("p",{children:[(0,a.jsx)(j.A,{defaultMessage:"You’ve reached the limit for Claude messages at this time. Please wait before trying again.",id:"CBMEJMlMzs"}),"\xa0",(0,a.jsx)(s.W,{})]}))}if("not_found_error"===e.type)return H((0,a.jsx)(j.A,{defaultMessage:"Claude model version not found.",id:"kdrUaXpTqd"}));if("billing_error"===e.type)return H((0,a.jsx)("p",{children:(0,a.jsx)(j.A,{defaultMessage:"We had an unexpected billing error, please <link>contact support.</link>",id:"MBYn4HHrFu",values:{link:e=>(0,a.jsx)("a",{className:"underline",href:"https://support.anthropic.com/en/articles/9015913-how-can-i-contact-support",target:"_blank",rel:"noreferrer",children:e})}})}));if("overloaded_error"===e.type)return H((0,a.jsxs)("p",{children:[(0,a.jsx)(j.A,{defaultMessage:"Due to unexpected capacity constraints, Claude is unable to respond to your message. Please try again soon.",id:"TRpxX8Mu1L"}),"\xa0",(0,a.jsx)(s.W,{})]}));if("exceeded_max_uploads_per_message"===e.errorCode)return void H((0,a.jsx)(j.A,{defaultMessage:"Your message will exceed the maximum number of files allowed per message. Consider removing some of your files or adding files over several messages.",id:"/jNwaAHdg9"}));if("exceeded_max_image_limit_per_chat"===e.errorCode){let e=H((0,a.jsx)("p",{children:r>0?(0,a.jsx)(j.A,{defaultMessage:"Your message will exceed the <link>maximum image count</link> for this chat. Try uploading {count, plural, one {# document} other {# documents}} with fewer pages, removing images, <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"gltmHPfviz",values:{link:e=>(0,a.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:h.FP,children:e}),newChatLink:t=>(0,a.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),Z(),q(e)},children:t}),upgradeInstructions:()=>(0,a.jsx)(s.W,{}),count:r}}):(0,a.jsx)(j.A,{defaultMessage:"Your message will exceed the <link>maximum image count</link> for this chat. Try removing images <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"QmLhKBubcc",values:{link:e=>(0,a.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:h.FP,children:e}),newChatLink:t=>(0,a.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),Z(),q(e)},children:t}),upgradeInstructions:()=>(0,a.jsx)(s.W,{})}})}));return}if("invalid_request_error"===e.type&&413===e.statusCode){let e=H((0,a.jsx)("p",{children:t>0?(0,a.jsx)(j.A,{defaultMessage:"Your message will exceed the <link>length limit</link> for this chat. Try attaching fewer or smaller files <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"G1lejdsk5p",values:{link:e=>(0,a.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:h.q4,children:e}),newChatLink:t=>(0,a.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),Z(),q(e)},children:t}),upgradeInstructions:()=>(0,a.jsx)(s.W,{})}}):(0,a.jsx)(j.A,{defaultMessage:"Your message will exceed the <link>length limit</link> for this chat. Try shortening your message <newChatLink>or starting a new conversation.</newChatLink>{upgradeInstructions}",id:"EWtBrIlAAR",values:{link:e=>(0,a.jsx)("a",{className:"underline",target:"_blank",rel:"noreferrer",href:h.q4,children:e}),newChatLink:t=>(0,a.jsx)("a",{href:"#",className:"underline",onClick:t=>{t.preventDefault(),Z(),q(e)},children:t}),upgradeInstructions:()=>(0,a.jsx)(s.W,{})}})}));return}return"invalid_request_error"===e.type&&"read_only_mode"===e.extra.code?H((0,a.jsx)("p",{children:(0,a.jsx)(j.A,{defaultMessage:"Due to capacity constraints, chatting with Claude is currently not available. Please try again in a little while.",id:"W2dIBW8oIg"})})):H(e)},[H,D,Y,n,Z,q]),en=(0,i.st)(),ea=(0,k.useExperiment)("no_more_smoother"),er=(0,E.A)(),es=(0,S.useCallback)(async e=>{let{prompt:t,attachments:a,files:r,syncSources:s,rethrowErrors:i=!1,modelOverride:o,parent_message_uuid:l,personalized_style:u,paprika_mode:h,compass_mode:_,org_type_override:g}=e;if(N)return;if(!M)throw Error("Cannot stream without an organization");let k=new AbortController;P({controller:k}),V(null);let w={prompt:t,parent_message_uuid:l,timezone:y.c9.local().zoneName||void 0,personalized_styles:u?[u]:void 0,locale:c.SC.includes(er.locale)?er.locale:c.Xn},C=(0,B.x)();C&&(w.custom_system_prompt=C),Q&&"string"==typeof Q&&(w.model=Q),o&&(w.model=o),"string"==typeof z&&(w.temperature=parseInt(z)),U&&"string"==typeof U&&(w.max_tokens_to_sample=parseInt(U)),h&&(w.paprika_mode=h),_&&(w.compass_mode=_);let S=v();S.length&&(w.tools=S);let j=[],E=null,L=null,D=null;try{let e=ea.get("no_smoothing",!1);if(E=(D=await R({applicationType:O,endpoint:p,orgUuid:M.uuid,conversationUuid:n,body:{organization_uuid:M.uuid,conversation_uuid:n,text:t,attachments:a,files:r.map(e=>e.file_uuid),sync_sources:s.map(e=>e.uuid),..."string"==typeof g&&{org_type_override:g}},onCompletion:e=>{x(n,e),j=e},onInvokeTool:b,abortController:k,completion:w,getTools:v,smoothingEnabled:!I&&!e})).stopReason,L=D.messageLimitResult,D&&!E)throw F}catch(s){let e=s instanceof d.LG;if(V({prompt:t,attachments:a,files:r}),s===F?(x(n,j),et(J,a.length+r.length,r.filter(e=>"document"===e.file_kind).length),en.track({event_key:"sse_interrupted"}),(0,f.wd)("sse_interrupted"),await new Promise(e=>setTimeout(e,3e4))):(et(s,a.length+r.length,r.filter(e=>"document"===e.file_kind).length),e||console.error("Non-API stream error:",s)),(0,f.Cp)(s,{tags:{source:e?"stream-api":"stream-generic"}}),i||(0,m.yz)())throw s}finally{await ee(L)}return j},[N,M,P,V,Q,z,U,v,ea,O,p,n,b,I,x,et,ee,en,er]),ei=(0,S.useCallback)(()=>{N&&(N.controller.abort(),ee(null))},[N,ee]);return{runStream:es,isStreaming:!!N,abortStream:ei}}},80079:(e,t,n)=>{n.d(t,{$:()=>c,T:()=>d});var a=n(77186),r=n(1761),s=n(55554),i=n(71473),o=n(27062),l=n(87606),u=n(7620);let c=()=>{let e=(0,l.useQueryClient)();return(0,u.useCallback)((t,n,a)=>{"within_limit"!==t.type&&(t.conversationUUID=a),e.setQueryData([i.Rw],e=>e?{...e,messageLimits:{...e.messageLimits,[n]:t}}:e)},[e])},d=e=>{let{activeOrganization:t}=(0,r.YL)(),{selectedTier:n}=(0,s.t)(),{value:i}=(0,o.fS)("internal_tier_selector"),l=null==t?void 0:t.uuid,u=c(),d={type:"within_limit"};return(0,a.L2)(()=>"/api/organizations/".concat(l,"/reset_rate_limits"),"POST",{onSuccess:()=>{u(d,l,e||"")},meta:{noToast:!0},transformVariables:()=>i&&n?{org_type:n}:{}})}}}]);