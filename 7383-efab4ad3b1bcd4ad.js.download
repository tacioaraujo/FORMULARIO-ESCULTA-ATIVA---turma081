"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[7383],{1748:(e,t,n)=>{n.d(t,{FL:()=>d,JX:()=>u,Ni:()=>p,tE:()=>f});var a=n(69987),r=n(57190);let i="directories",o="projectUuid",l=null;async function s(){return l||new Promise((e,t)=>{let n=indexedDB.open("harmony",1);n.onerror=()=>t(n.error),n.onsuccess=()=>{(l=n.result).onerror=e=>{a.z("Database error:",e)},l.onclose=()=>{l=null},e(l)},n.onupgradeneeded=e=>{e.target.result.createObjectStore(i,{keyPath:"uuid"}).createIndex(o,"projectUuid",{unique:!1})}})}function c(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"readonly";if(!l)throw Error("Database not initialized");return l.transaction(i,e)}async function u(e){await s();let t=c("readonly").objectStore(i).index(o);return new Promise((n,a)=>{let i=t.getAll(e);i.onerror=()=>a(i.error),i.onsuccess=()=>{n(i.result.map(e=>({...e,uri:(0,r.Bj)(e)})))}})}async function d(e){await s();let t=c("readonly").objectStore(i);return new Promise((n,a)=>{let i=t.get(e);i.onerror=()=>a(i.error),i.onsuccess=()=>{if(i.result){let e=i.result;n({...e,uri:(0,r.Bj)(e)})}else n(null)}})}async function f(e){return await s(),new Promise((t,n)=>{let a=c("readwrite").objectStore(i).put(e);a.onerror=()=>n(a.error),a.onsuccess=()=>t()})}async function p(e){return await s(),new Promise((t,n)=>{let a=c("readwrite").objectStore(i).delete(e);a.onerror=()=>n(a.error),a.onsuccess=()=>t()})}},2188:(e,t,n)=>{n.d(t,{A:()=>_,w:()=>S});var a=n(54568),r=n(7620),i=n(89256),o=n.n(i);let l=(0,r.createContext)(null),s={openedFiles:[],projectDocs:[],files:[],setFiles:o(),projectUuid:"",syncedDirectories:[],setSyncedDirectories:o()};function c(e){let{children:t,onLoad:n}=e;return(0,r.useEffect)(n,[n]),(0,a.jsx)(l.Provider,{value:s,children:t})}var u=n(69987),d=n(342),f=n(92012),p=n.n(f),m=n(41932),y=n(1748),g=n(43245),h=n(57190);let v=[];function w(e){let{children:t,onLoad:n,projectUuid:i}=e,{isLoading:o,unfilteredData:s=v}=(0,m.MO)(i),[c,f]=(0,r.useState)([]),[w,b]=(0,r.useState)([]),_=(0,r.useMemo)(()=>[...(function(e,t){let n=new Map,a=t.filter(h.wd).map(e=>e.uri);if(!a.length)return n;for(let t of a){let a=new Set;for(let n of e){if(!(0,h.hh)(n.file_name))continue;let{projectUuid:e,directoryUuid:r}=(0,h.Q3)(n.file_name),i=(0,h.Q3)(t);e===i.projectUuid&&r===i.directoryUuid&&a.add(n.file_name)}n.set(t,a)}return n})(s,c).values()].flatMap(e=>[...e]),[s,c]);(0,r.useEffect)(()=>{(0,y.JX)(i).then(b).catch(e=>u.z("Harmony: Error initializing synced directories from IndexedDB",e))},[i]);let{mutateAsync:S}=(0,m.fh)(i),{mutateAsync:C}=(0,m.Om)(i),{mutateAsync:E}=(0,m.gG)(i),x=(0,r.useCallback)(()=>{(0,g.cg)(i,o,c,s,S,C,E).then(e=>{e&&(p()(c,e.updatedFiles)||(f(e.updatedFiles),u.Y("Harmony: Resynced ".concat(e.updatedFiles.filter(h.fo).length," files in ").concat(e.updatedFiles.filter(h.wd).length," directories")),n()))}).catch(e=>u.z("Harmony: Error during resync:",e))},[i,o,c,s,S,C,E,n]),A=(0,r.useRef)(!1);(0,r.useEffect)(()=>{!i||o||A.current||(A.current=!0,x())},[x,i,o]),(0,d.$)(x,3e4,{autoInvoke:!0});let U=(0,r.useMemo)(()=>({projectUuid:i,openedFiles:_,projectDocs:s,files:c,setFiles:f,syncedDirectories:w,setSyncedDirectories:b}),[i,_,s,c,w,b]);return(0,a.jsx)(l.Provider,{value:U,children:t})}var b=n(26553);function _(e){let{children:t,onLoad:n,projectUuid:r}=e,{userHasHarmony:i}=(0,b.r)(r);return i?(0,a.jsx)(w,{onLoad:n,projectUuid:r,children:t}):(0,a.jsx)(c,{onLoad:n,children:t})}function S(){let e=(0,r.useContext)(l);return e||s}},9896:(e,t,n)=>{n.d(t,{F:()=>s});var a=n(27062),r=n(67933),i=n(7620),o=n(70011),l=n(85644);let s=()=>{let e="sticky-model-selector",{value:t}=(0,a.fS)("sticky_model_selector"),{value:n}=(0,a.fS)("model_selector_enabled"),{activeModelOptions:s}=(0,l.A9)(),c=(0,o.Z3)(null),u=(0,r.useQuery)({queryKey:[e],queryFn:()=>{if(!t||!n)return null;let a=localStorage.getItem(e);return a===c?null:a&&s.find(e=>e.model===a)?a:null},initialData:null}),d=(0,i.useCallback)(t=>{t&&localStorage.setItem(e,t),u.refetch()},[u]);return{stickyModelPreference:u.data,setStickyModelPreference:d}}},17423:(e,t,n)=>{n.d(t,{M$:()=>u,O5:()=>l,f$:()=>s,lo:()=>c,n7:()=>d});var a=n(77186),r=n(1761),i=n(71473),o=n(87606);let l=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid;return(0,a.Sk)("/api/organizations/".concat(t,"/list_styles"),{queryKey:[i.ss,{orgUUID:t}]})},s=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid,n=(0,o.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(t,"/styles/create"),"POST",{onSuccess:()=>{n.invalidateQueries({queryKey:[i.ss,{orgUUID:t}]})}})},c=function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],{activeOrganization:n}=(0,r.YL)(),l=null==n?void 0:n.uuid,s=(0,o.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(l,"/styles/").concat(e,"/edit"),"PUT",{onSuccess:()=>{s.invalidateQueries({queryKey:[i.ss,{orgUUID:l}]})},enabled:!t})},u=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,l=(0,o.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(n,"/styles/").concat(e,"/delete"),"DELETE",{onSuccess:()=>{l.invalidateQueries({queryKey:[i.ss,{orgUUID:n}]})}})},d=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid;return(0,a.L2)("/api/organizations/".concat(t,"/styles/preview"),"POST")}},26553:(e,t,n)=>{n.d(t,{r:()=>s});var a=n(1761),r=n(27062),i=n(21036),o=n(33703),l=n(81527);let s=e=>{var t;let{account:n}=(0,a.YL)(),{value:s}=(0,r.fS)("force_harmony"),{data:c,isLoading:u}=(0,l.fo)(e),{data:d,isLoading:f}=(0,o.HP)(e||""),p=null!=(t=null==d?void 0:d.some(e=>e.account.uuid===(null==n?void 0:n.uuid)&&"user"===e.role))&&t,m="showDirectoryPicker"in window&&"FileSystemHandle"in window,y=(0,i.useDynamicConfig)("harmony");return{userHasHarmony:m&&((null==n?void 0:n.settings.preview_feature_uses_harmony)||s)&&y.get("harmonize",!1),projectHasHarmony:!u&&!f&&p&&!!(null==c?void 0:c.is_harmony_project),config:y}}},32442:(e,t,n)=>{function a(e){let t=e,n="",a=0;for(;t!==n&&a<10;)n=t,t=(t=(t=(t=t.normalize("NFKC")).replace(RegExp("[\\p{Cf}\\p{Co}\\p{Cn}]","gu"),"")).replace(RegExp("[\\p{Cc}]","gu"),e=>"\n"===e||"	"===e||"\r"===e?e:"")).replace(/[\u200B-\u200F]/g,"").replace(/[\u202A-\u202E]/g,"").replace(/[\u2066-\u2069]/g,"").replace(/[\uFEFF]/g,"").replace(/[\uE000-\uF8FF]/g,""),a++;if(a>=10)throw Error("Unicode sanitization reached maximum iterations (".concat(10,") for input: ").concat(e.slice(0,100)));return t}n.d(t,{M:()=>function e(t){if("string"==typeof t)return a(t);if(Array.isArray(t))return t.map(e);if(null!==t&&"object"==typeof t){let n={};for(let[a,r]of Object.entries(t))n[e(a)]=e(r);return n}return t},P:()=>a})},33200:(e,t,n)=>{n.d(t,{N:()=>i});var a=n(27062),r=n(21036);function i(e){let t=(0,r.useLayer)("frontend").get("analysis_tool_experiment_enabled",!1),{value:n}=(0,a.fS)("rely_on_analysis_flag"),{value:i}=(0,a.fS)("analysis_tool_launch_ga");if(n){var o;return{value:null!=(o=null==e?void 0:e.enabled_artifacts_attachments)?o:i,source:"flag"}}return{value:(null==e?void 0:e.enabled_artifacts_attachments)||t,source:"experiment"}}},33703:(e,t,n)=>{n.d(t,{CC:()=>u,Fo:()=>s,HP:()=>c});var a=n(77186),r=n(1761),i=n(71473),o=n(87606),l=n(81527);let s=(e,t)=>{let{account:n,activeOrganization:s}=(0,r.YL)(),c=t===(null==n?void 0:n.uuid),u=null==s?void 0:s.uuid,d=(0,o.useQueryClient)(),f=(0,l.Gz)();return(0,a.L2)(()=>"/api/organizations/".concat(u,"/projects/").concat(e,"/accounts/").concat(t),"PUT",{onSuccess:()=>{d.invalidateQueries({queryKey:[i.vE,{projectUuid:e}]}),c&&(f(e),d.invalidateQueries({queryKey:[i.A2,{orgUUID:u}]}),d.invalidateQueries({queryKey:[i.DC,{orgUUID:u}]}),d.invalidateQueries({queryKey:[i.Ad,{orgUUID:u}]}))}})},c=function(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,r.YL)(),o=null==n?void 0:n.uuid;return(0,a.Sk)("/api/organizations/".concat(o,"/projects/").concat(e,"/accounts"),{queryKey:[i.vE,{projectUuid:e}],enabled:!!(t&&n&&e),staleTime:0})},u=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,l=(0,o.useQueryClient)();return(0,a.L2)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/accounts/").concat(t.accountUuid),"PUT",{onSuccess:()=>{l.invalidateQueries({queryKey:[i.vE,{projectUuid:e}]})},transformVariables:e=>({role:e.role})})}},41932:(e,t,n)=>{n.d(t,{Aw:()=>p,KU:()=>y,MO:()=>c,Om:()=>m,Rn:()=>u,ab:()=>s,fh:()=>d,gG:()=>f,uE:()=>g});var a=n(77186),r=n(1761),i=n(29585),o=n(71473),l=n(87606);let s="[ANT ONLY] synced_resources.txt";function c(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,r.YL)(),i=null==n?void 0:n.uuid,{data:l,...c}=(0,a.Sk)("/api/organizations/".concat(i,"/projects/").concat(e,"/docs"),{queryKey:[o.cC,{orgUuid:i,projectUuid:e}],enabled:!!n&&!!e&&t});return{data:null==l?void 0:l.filter(e=>{let{file_name:t,content:n}=e;return t.length>0&&n.length>0}).filter(e=>{let{file_name:t}=e;return t!==s}),unfilteredData:l,...c}}let u=e=>{let{projectUuid:t,docUuid:n}=e,{activeOrganization:l}=(0,r.YL)(),s=null==l?void 0:l.uuid;return(0,a.Sk)("/api/organizations/".concat(s,"/projects/").concat(t,"/docs/").concat(n),{queryKey:[o.Db,{orgUuid:s,projectUuid:t,docUuid:n}],enabled:!!l,staleTime:0,meta:{noToast:e=>e instanceof i.LG&&404===e.statusCode}})};function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,r.YL)(),i=null==n?void 0:n.uuid,s=(0,l.useQueryClient)();return(0,a.L2)(()=>"/api/organizations/".concat(i,"/projects/").concat(e,"/docs"),"POST",{enabled:!!e,onSuccess:function(){for(var n,a=arguments.length,r=Array(a),l=0;l<a;l++)r[l]=arguments[l];s.invalidateQueries({queryKey:[o.cC,{orgUuid:i,projectUuid:e}]}),s.invalidateQueries({queryKey:[o.A2,{orgUUID:i}]}),s.invalidateQueries({queryKey:[o.qz,{orgUuid:i,projectUuid:e}]}),null==(n=t.onSuccess)||n.call(t,...r)},onError:function(){for(var e,n=arguments.length,a=Array(n),r=0;r<n;r++)a[r]=arguments[r];null==(e=t.onError)||e.call(t,...a)}})}function f(e){let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,i=(0,l.useQueryClient)();return(0,a.Qv)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/docs/").concat(t.docUuid),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e.docUuid):t,{queryKey:[o.cC,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:(t,a)=>{i.invalidateQueries({queryKey:[o.Db,{orgUuid:n,projectUuid:e,docUuid:a.docUuid}]}),i.invalidateQueries({queryKey:[o.A2,{orgUUID:n}]}),i.invalidateQueries({queryKey:[o.qz,{orgUuid:n,projectUuid:e}]})},onError:()=>{i.invalidateQueries({queryKey:[o.cC,{orgUuid:n,projectUuid:e}]})}})}let p=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,i=(0,l.useQueryClient)();return(0,a.Qv)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/docs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.doc_uuids.includes(t.uuid)):t,{queryKey:[o.cC,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:(t,a)=>{for(let t of a.doc_uuids)i.invalidateQueries({queryKey:[o.Db,{orgUuid:n,projectUuid:e,docUuid:t}]});i.invalidateQueries({queryKey:[o.cC,{orgUuid:n,projectUuid:e}]}),i.invalidateQueries({queryKey:[o.A2,{orgUUID:n}]}),i.invalidateQueries({queryKey:[o.qz,{orgUuid:n,projectUuid:e}]})}})};function m(e){let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,i=(0,l.useQueryClient)();return(0,a.Qv)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/docs/").concat(t.docUuid),"PUT",(e,t)=>t?t.map(t=>t.uuid===e.docUuid?{...t,...e}:t):t,{queryKey:[o.cC,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:(t,a)=>{i.invalidateQueries({queryKey:[o.Db,{orgUuid:n,projectUuid:e,docUuid:a.docUuid}]}),i.invalidateQueries({queryKey:[o.cC,{orgUuid:n,projectUuid:e}]}),i.invalidateQueries({queryKey:[o.A2,{orgUUID:n}]})}})}function y(e){let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,i=(0,l.useQueryClient)();return(0,a.Qv)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/files/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.file_uuids.includes(t.file_uuid)):t,{queryKey:[o.mw,{orgUuid:n,projectUuid:e}],enabled:!!e,onSuccess:()=>{i.invalidateQueries({queryKey:[o.A2,{orgUUID:n}]}),i.invalidateQueries({queryKey:[o.qz,{orgUuid:n,projectUuid:e}]})},onError:()=>{i.invalidateQueries({queryKey:[o.mw,{orgUuid:n,projectUuid:e}]})}})}function g(e){let t=!(arguments.length>1)||void 0===arguments[1]||arguments[1],{activeOrganization:n}=(0,r.YL)(),i=null==n?void 0:n.uuid;return(0,a.Sk)("/api/organizations/".concat(i,"/projects/").concat(e,"/files"),{queryKey:[o.mw,{orgUuid:i,projectUuid:e}],enabled:!!n&&!!e&&t})}},43245:(e,t,n)=>{n.d(t,{EW:()=>p,rU:()=>b,p6:()=>f,Tk:()=>_,Q4:()=>y,wZ:()=>w,cg:()=>S,Jo:()=>m});var a=n(69987),r=n(92012),i=n.n(r),o=n(41932),l=n(75710),s=n(91507),c=n(70358),u=n(1748),d=n(57190);async function f(e){let t=await (0,u.JX)(e);return await (0,d.CS)(t)}async function p(e,t){return(await (0,d.TA)(e,t)).text}async function m(e,t,n,r,i,o){let c=await (0,u.JX)(t),f=Array.from(new Set([...e])).map(async e=>{if((0,d.hh)(e))try{let t=o(e),u=t?(0,s.t_)(t):void 0,d=t?t.baseContent:void 0;if(void 0===d||void 0===u){let t=await p(c,e);if(!u){if(null===t)return void a.z(Error("File content not found for ".concat(e)));return await g(n,r,i,e,t,[])}return await g(n,r,i,e,u,(0,l.DI)(t||"",u))}let f=(0,l.DI)(d,u);return await g(n,r,i,e,u,f)}catch(t){a.z("Error processing file ".concat(e,":"),t)}});await Promise.all(f)}async function y(e,t,n,a,r){let i=await p(e,r);if(null===i)throw Error("File content not found for ".concat(r));if(new TextEncoder().encode(i).length>102400)throw Error("File ".concat(r," is too large and will degrade the experience. Pass a specific view_range when using the view tool for this file."));return await g(t,n,a,r,i)}async function g(e,t,n,a,r,i){let o=e.find(e=>e.file_name===a);if(o&&function(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=e.match(/<content>([\s\S]*)<\/content>/),a=n&&n[1]?n[1].trim():e;if(t){let t=e.match(/<changes>(.*?)<\/changes>/);if(t&&t[1]){let e=JSON.parse(t[1]);(0,l._s)(e),a=(0,l.k2)(a,e)}}return a}(o.content)===r)return o;let s=await h(r,i);return o?await n({docUuid:o.uuid,content:s}):await t({file_name:a,content:s})}async function h(e,t){let n=await (0,c.h)(e),a=void 0!==t&&!(0,l.q)(t);return"\n<metadata>\n<file_hash>".concat(n,"</file_hash>\n<file_state>\n  ").concat(a&&void 0!==t?"\n  <status>includes_unsaved_changes</status>\n  <message>This content includes modifications since it was last synchronized. You can and should continue to suggest changes using write or replace operations. Your suggestions will be applied to the latest version of the file. THIS IS THE MOST UP TO DATE VERSION OF THE FILE.</message>\n  <changes>".concat(JSON.stringify((0,l.In)(t)),"</changes>\n"):"<status>synced</status>","\n</file_state>\n</metadata>\n<content>").concat(e,"</content>\n").trim()}async function v(e,t,n,r,i){if(0===e.length){let e=t.find(e=>e.file_name===o.ab);e&&await i({docUuid:e.uuid});return}let l=JSON.stringify(e.map(e=>e.uri),null,2).split("\n"),s=l.slice(0,50).join("\n"),c=l.length-50,u="<synced_resources>\n".concat(s,"\n").concat(c>0?"\n... plus ".concat(c," additional files."):"","\n</synced_resources>"),d=t.filter(e=>e.file_name===o.ab);if(d.length>0){let[e,...n]=d;if(n.length>0&&a.Y("Harmony: Cleaning up ".concat(n.length," extra project docs")),await Promise.all(n.map(e=>w(t,e.file_name,i))),e.content===u)return void a.Y("Harmony: Project doc already up to date",e.uuid);await r({docUuid:e.uuid,content:u}),a.Y("Harmony: Updated project doc",e.uuid)}else{let e=await n({file_name:o.ab,content:u});a.Y("Harmony: Created project doc",e.uuid)}}async function w(e,t,n){let a=e.find(e=>e.file_name===t);a&&await n({docUuid:a.uuid})}async function b(e,t,n,a){let{projectUuid:r,directoryUuid:i}=(0,d.Q3)(a),o=(0,d.Cm)(e,r,i);for(let e of(await (0,u.Ni)(i),t.filter(e=>_(e,o))))await n({docUuid:e.uuid});return e.filter(e=>e!==o)}function _(e,t){if(!(0,d.hh)(e.file_name))return!1;let{projectUuid:n,directoryUuid:a}=(0,d.Q3)(t.uri),{projectUuid:r,directoryUuid:i}=(0,d.Q3)(e.file_name);return n===r&&a===i}async function S(e,t,n,a,r,o,l){if(!e||t)return;let s=await (0,u.JX)(e),c=await (0,d.CS)(s);if(!i()(n.map(e=>e.uri),c.map(e=>e.uri))){for(let e of s)e.root.descendants.some(t=>t.lastModified>e.lastUpdated)&&await (0,u.tE)({...e,lastUpdated:Date.now()});return await v(c,a,r,o,l),{updatedFiles:c}}}},45727:(e,t,n)=>{n.d(t,{p:()=>l});var a=n(19125),r=n(27062),i=n(17423);let o=(e,t)=>"default"===e.type&&e.key===t||"custom"===e.type&&e.uuid===t,l=()=>{let{value:e}=(0,r.fS)("concise_mode_enabled"),{data:t,isLoading:n}=(0,i.O5)(),l=(null==t?void 0:t.defaultStyles)||[],s=[...l,...((null==t?void 0:t.customStyles)||[]).map(e=>({...e,key:e.key||e.uuid}))],[c,u,d]=(0,a.V)("claude_personalized_style",null);if(n||!(null==s?void 0:s.length))return{personalizedStyleOptions:[],defaultStyle:null,storedStyle:null,setStoredStyle:u,clearStoredStyle:d,conciseModeEnabled:e};let f=l.length?l.find(e=>!0===e.isDefault)||l[0]:null;if(e&&(f=l.find(e=>"Concise"===e.key)||f),!c)return{personalizedStyleOptions:s,defaultStyle:f,storedStyle:c,setStoredStyle:u,clearStoredStyle:d,conciseModeEnabled:e};let p=s.find(e=>o(e,c.styleKey)),m=Date.now()-new Date(c.timestamp).getTime()>432e5;return{personalizedStyleOptions:s,storedStyle:p&&!m?p:null,defaultStyle:f,setStoredStyle:u,clearStoredStyle:d,conciseModeEnabled:e}}},52909:(e,t,n)=>{n.d(t,{CO:()=>f,M3:()=>c,bG:()=>u,ks:()=>m,pz:()=>s,z_:()=>d});var a=n(77186),r=n(1761),i=n(71473),o=n(87606),l=n(91768);let s=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,r.YL)(),i=null==n?void 0:n.uuid,o=p(),s=(0,l.eL)();return(0,a.L2)(()=>"/api/organizations/".concat(i,"/projects/").concat(e,"/syncs"),"POST",{enabled:!!(n&&e),...t,onSuccess:function(){for(var n,a=arguments.length,r=Array(a),i=0;i<a;i++)r[i]=arguments[i];o(e),null==(n=t.onSuccess)||n.call(t,...r)},onError:function(){for(var e,n=arguments.length,a=Array(n),r=0;r<n;r++)a[r]=arguments[r];null==(e=t.onError)||e.call(t,...a);let[i,o]=a;s(i,o)}})},c=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:n}=(0,r.YL)(),i=null==n?void 0:n.uuid,o=p();return(0,a.L2)(()=>"/api/organizations/".concat(i,"/projects/").concat(e,"/syncs"),"PUT",{enabled:!!(n&&e),...t,onSuccess:function(){for(var n,a=arguments.length,r=Array(a),i=0;i<a;i++)r[i]=arguments[i];o(e),null==(n=t.onSuccess)||n.call(t,...r)}})},u=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,o=p();return(0,a.Qv)(t=>"/api/organizations/".concat(n,"/projects/").concat(e,"/syncs/").concat(t),"DELETE",(e,t)=>t?t.filter(t=>t.uuid!==e):t,{queryKey:[i.LV,{orgUuid:n,projectUuid:e}],enabled:!!t,onSuccess:()=>{o(e)}})},d=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,o=p();return(0,a.Qv)(()=>"/api/organizations/".concat(n,"/projects/").concat(e,"/syncs/delete_many"),"POST",(e,t)=>t?t.filter(t=>!e.sync_source_uuids.includes(t.uuid)):t,{queryKey:[i.LV,{orgUuid:n,projectUuid:e}],enabled:!!t,onSuccess:()=>{o(e)}})},f=function(e,t){let n=!(arguments.length>2)||void 0===arguments[2]||arguments[2],{activeOrganization:s}=(0,r.YL)(),c=null==s?void 0:s.uuid,u=(0,o.useQueryClient)(),d=!!(s&&e&&n),{data:f,isLoading:p}=(0,a.Sk)("/api/organizations/".concat(c,"/projects/").concat(e,"/syncs?calculate_size=").concat(null!=t&&t),{queryKey:[i.LV,{orgUuid:c,projectUuid:e,calculateSize:t}],enabled:d,refetchInterval:e=>{var t;return(null==(t=e.state.data)?void 0:t.some(l.z3))?5e3:3e5},structuralSharing:(t,n)=>{let a=void 0!==t&&t.some(l.z3),r=void 0!==n&&n.some(l.z3);return a&&!r&&u.invalidateQueries({queryKey:[i.qz,{orgUuid:c,projectUuid:e}]}),n}});return{data:f,isLoading:!!d&&p}},p=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid,n=(0,o.useQueryClient)();return e=>{n.invalidateQueries({queryKey:[i.LV,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[i._G,{orgUuid:t,projectUuid:e}]}),n.invalidateQueries({queryKey:[i.qz,{orgUuid:t,projectUuid:e}]})}},m=e=>{let{data:t}=f(e);return!!(null==t?void 0:t.some(l.z3))}},56273:(e,t,n)=>{n.d(t,{u:()=>d,i:()=>f});var a=n(54568),r=n(89256),i=n.n(r),o=n(7620);function l(e,t){switch(t.type){case"OPEN_COMPASS_STATUS":return{...e,selectedItem:{type:"compass",data:t.data}};case"SELECT_ATTACHMENT":return{...e,selectedItem:{type:"attachment",attachment:t.attachment}};case"SELECT_ARTIFACT":return{...e,selectedItem:{type:"artifact",id:t.id,versionUUID:t.versionUUID}};case"SELECT_DOC":return{...e,selectedItem:{type:"doc",id:t.id}};case"SELECT_SYNCED_DIRECTORY":return{...e,selectedItem:{type:"syncedDirectory",id:t.id}};case"CLEAR_SELECTED":return{...e,selectedItem:null,activeMessageUUID:void 0};case"SET_ACTIVE_MESSAGE_UUID":return{...e,activeMessageUUID:t.uuid};case"UPDATE_ARTIFACTS":return{...e,artifacts:t.artifacts};case"UPDATE_ATTACHMENTS":return{...e,attachments:t.attachments};case"UPDATE_FILES":return{...e,files:t.files};case"UPDATE_SYNC_SOURCES":return{...e,syncSources:t.syncSources};case"UPDATE_DOC_UPDATES":return{...e,docUpdates:t.updates};case"UPDATE_FILE_EDITS":return{...e,fileEdits:t.edits};default:return e}}let s={selectedItem:null,artifacts:{},attachments:[],files:[],syncSources:[],docUpdates:[],fileEdits:new Map,activeMessageUUID:void 0,conversationUUID:void 0},c={chatResourceState:s,dispatchChatResource:i()},u=(0,o.createContext)(c);function d(e){let{children:t,conversationUUID:n}=e,[r,i]=(0,o.useReducer)(l,{...s,conversationUUID:n});return(0,a.jsx)(u.Provider,{value:{chatResourceState:r,dispatchChatResource:i},children:t})}function f(){return(0,o.useContext)(u)}},57190:(e,t,n)=>{n.d(t,{vm:()=>w,x3:()=>g,Ww:()=>h,Cm:()=>S,_t:()=>C,wd:()=>b,fo:()=>_,hh:()=>L,CS:()=>v,Q3:()=>P,TA:()=>f,Bj:()=>x,_h:()=>p});var a=n(61125),r=n(69987),i=n(47427);class o{static getInstance(){return o.instance||(o.instance=new o),o.instance}getCacheKey(e,t){return"".concat(e.name,"-").concat(t)}isPermissionExpired(e){return Date.now()-e>this.CACHE_DURATION}async checkPermission(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"read",n=this.getCacheKey(e,t),a=this.permissionCache.get(n);if(a&&!this.isPermissionExpired(a.timestamp))return"granted"===a.state;try{if("queryPermission"in e){let a=await e.queryPermission({mode:t});if("granted"===a)return this.permissionCache.set(n,{state:"granted",timestamp:Date.now(),mode:t}),!0}if("requestPermission"in e){let a=await e.requestPermission({mode:t});return"granted"===a&&this.permissionCache.set(n,{state:a,timestamp:Date.now(),mode:t}),"granted"===a}return this.permissionCache.set(n,{state:"granted",timestamp:Date.now(),mode:t}),!0}catch(e){return r.z("Permission check failed:",e),!1}}constructor(){this.permissionCache=new Map,this.CACHE_DURATION=36e5}}let l=o.getInstance();async function s(e,t){return l.checkPermission(e,t)}var c=n(50887).Buffer;let u="inode/directory";async function d(e,t){let n=await e.getFile();return{handle:e,path:"".concat(t,"/").concat(n.name),lastModified:n.lastModified}}async function f(e,t){let n,r,{directory:i,file:o}=C(e,t);if(!o)throw Error("File not found: ".concat(t));let l=await o.handle.getFile(),s=null;try{s=await (0,a.F9)(l),r=l.type||"text/plain"}catch(t){let e=await l.arrayBuffer();n=e.byteLength>1048576?"[File truncated due to size]":c.from(e).toString("base64"),r=l.type||"application/octet-stream"}return{uri:E(i,o),mimeType:r,text:s,blob:n}}async function p(e,t){if(!await s(e.handle,"readwrite"))throw Error("Permission denied");let n=await e.handle.getFile();try{await (0,a.F9)(n)}catch(e){throw Error("Cannot write to non-text files")}let i=await e.handle.createWritable();try{await i.write(t)}finally{await i.close()}r.Y("Harmony: Wrote file ".concat(e.path," to local file system")),e.lastModified=Date.now()}async function m(e,t){try{return await e.getDirectoryHandle(t,{create:!0})}catch(e){throw Error("Failed to create directory ".concat(t))}}async function y(e,t){let n=e;for(let e=0;e<t.length-1;e++)n=await m(n,t[e]);return n}async function g(e,t,n){let{pathComponents:a}=z(t);if(!await s(e.root.handle,"readwrite"))throw Error("Permission denied");let r=await y(e.root.handle,a),i=a[a.length-1];try{let t={handle:await r.getFileHandle(i,{create:!0}),path:"".concat(e.root.name,"/").concat(a.join("/")),lastModified:Date.now()};return await p(t,n),e.root.descendants.push(t),!0}catch(e){throw Error("Failed to create file ".concat(t," - ").concat(e))}}async function h(e,t){let{pathComponents:n}=z(t);if(!await s(e.root.handle,"readwrite"))throw Error("Permission denied to delete file in the directory");let a=await y(e.root.handle,n),r=n[n.length-1];try{return await a.removeEntry(r),e.root.descendants=e.root.descendants.filter(t=>t.path!=="".concat(e.root.name,"/").concat(n.join("/"))),!0}catch(e){throw Error("Failed to delete file ".concat(r))}}async function v(e){return(await Promise.all(e.map(w))).flat()}async function w(e){try{if(await s(e.root.handle,"read")){let t=await I(e);t&&(e.root=t.updatedDirectoryRoot)}}catch(t){r.z("Harmony: Could not resync ".concat(e.uuid),t)}let t=e.root.descendants.map(t=>({uri:E(e,t)}));return t.unshift({uri:x(e),mimeType:u}),t}function b(e){return e.mimeType===u}function _(e){return!b(e)}function S(e,t,n){let a=e.find(e=>e.projectUuid===t&&e.uuid===n);if(!a)throw Error("Resource not found: ".concat(t,"/").concat(n));return a}function C(e,t){let{projectUuid:n,directoryUuid:a,pathComponents:r}=P(t),i=S(e,n,a);try{let e=function(e,t){let n="".concat(e.root.name,"/").concat(t.join("/")),a=e.root.descendants.find(e=>e.path===n);if(!a)throw Error("File not found: ".concat(n));return a}(i,r);return{directory:i,file:e}}catch(e){return{directory:i,file:null}}}function E(e,t){let n=t.path.split("/").map(encodeURIComponent);return"file://".concat(e.projectUuid,"/").concat(e.uuid,"/")+n.join("/")}function x(e){return"file://".concat(e.projectUuid,"/").concat(e.uuid,"/").concat(encodeURIComponent(e.root.name),"/")}async function A(e,t,n,a){let r=n.flatMap(e=>{if(""===(e=e.trim())||e.startsWith("#"))return[];let t=e.startsWith("!");return t&&(e=e.slice(1)),(e=e.replace(/^\//,"")).endsWith("/")&&(e+="*"),t?["!".concat(e)]:[e]}),o=[],l=[[e,t]],s=e=>{let t=r.filter(e=>!e.startsWith("!")).some(t=>(0,i.xF)(e,t,{dot:!0,matchBase:!0})),n=r.filter(e=>e.startsWith("!")).some(t=>(0,i.xF)(e,t.slice(1),{dot:!0,matchBase:!0}));return t&&!n};for(;l.length>0;){let[e,n]=l.shift();for await(let r of e.values()){if(o.length>=a)throw Error("Maximum number of files (".concat(a,") exceeded"));if(r.name.startsWith(".")&&".gitignore"!==r.name)continue;let e="".concat(n,"/").concat(r.name);if(!s(e.slice(t.length+1)))if("file"===r.kind){let e=await d(r,n);o.push(e)}else l.push([r,e])}}return o}async function U(e){try{let t=await e.getFileHandle(".gitignore",{create:!1}),n=await t.getFile();return(await n.text()).split("\n").filter(e=>""!==e.trim()&&!e.startsWith("#"))}catch(e){return[]}}async function k(e,t){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2500;try{let a=[...await U(e),...t],r=await A(e,e.name,a,n);return{handle:e,name:e.name,descendants:r}}catch(e){if(e instanceof Error&&e.message.includes("Maximum number of files"))throw Error("The size of this directory may cause performance degradation. Please choose a smaller directory.");throw e}}async function I(e){let t,n=e.root;try{t=await k(e.root.handle,e.ignorePatterns)}catch(e){return null}let a=T(n.descendants),r=T(t.descendants),i=[];for(let[e,t]of a.entries()){let n=r.get(e);if(void 0===n){i.push({type:"removed",file:t});continue}n.lastModified!==t.lastModified&&i.push({type:"modified",file:n}),r.delete(e)}for(let e of r.values())i.push({type:"added",file:e});return{updatedDirectoryRoot:t,fileChanges:i}}function T(e){let t=new Map;for(let n of e)t.set(n.path,n);return t}let j=new Map,D=(e,t)=>{j.size>=1e3&&Array.from(j.keys()).slice(0,Math.floor(200)).forEach(e=>j.delete(e)),j.set(e,t)};function P(e){if(j.has(e))return j.get(e);if(!e||""===e.trim())throw Error("Invalid URI: URI is undefined or empty");if(!e.startsWith("file://"))throw Error('Invalid URI: Must start with "file://"');let t=new URL(e),n=t.host,[a,r,i,...o]=t.pathname.split("/").map(decodeURIComponent);if(!(n&&o.length))throw Error("Invalid URI: Missing required components");let l={projectUuid:n,directoryUuid:r,directoryName:i,pathComponents:o};return D(e,l),l}function L(e){try{return P(e),!0}catch(e){return!1}}function z(e){if(!e||""===e.trim())throw Error("Invalid URI: URI is undefined or empty");if(!e.startsWith("file://"))throw Error('Invalid URI: Must start with "file://"');try{let t=new URL(e),n=t.host,[a,r,i,...o]=t.pathname.split("/").map(decodeURIComponent);if(!n||!r||!i)throw Error("Invalid URI: Missing required components");return{projectUuid:n,directoryUuid:r,directoryName:i,pathComponents:o}}catch(e){throw Error("Invalid URI: ".concat(e.message))}}},57383:(e,t,n)=>{n.d(t,{_:()=>k,o:()=>U});var a=n(54568),r=n(66860),i=n(61125),o=n(74530),l=n(9896),s=n(77186),c=n(7620),u=n(67455),d=n(41932),f=n(52909),p=n(1761),m=n(51121),y=n(45727),g=n(89116),h=n(26553),v=n(2188),w=n(43245),b=n(19125),_=n(32442);let S={type:"doc",content:[{type:"paragraph",content:[]}]},C=e=>!!e&&("INPUT"===e.tagName||"TEXTAREA"===e.tagName||"true"===e.getAttribute("contenteditable")||"textbox"===e.getAttribute("role")),E=e=>{if(!e)return!1;let t=e.tagName;return"BUTTON"===t||"SUMMARY"===t||"SELECT"===t||("INPUT"===t?["button","submit","reset","checkbox","radio"].includes(e.type):["button","checkbox","radio","switch","menuitem","menuitemcheckbox","menuitemradio","option"].includes(e.getAttribute("role")||""))},x=e=>{let t=(0,c.useCallback)(t=>{if(e&&!C(document.activeElement)&&1===t.key.length&&!t.ctrlKey&&!t.altKey&&!t.metaKey){var n;if(!(" "===t.key&&E(document.activeElement)))t.preventDefault(),null==(n=e.getEditor())||n.chain().insertContent(t.key).focus().run()}},[e]);(0,c.useEffect)(()=>(document.addEventListener("keydown",t),()=>document.removeEventListener("keydown",t)),[t])},A=c.createContext({attachments:[],files:[],transitionFiles:[],syncSourceUuids:[],isAtMaxNumUploads:!1,model:"",prompt:"",tipTapEditorState:{},projectUuid:void 0,isChatSyncing:!1,personalizedStyle:void 0,isProjectSyncing:!1,isNewConversation:!1,isProjectLocked:!1,isSending:!1,setPrompt:()=>void 0,setTipTapEditorState:()=>void 0,setAttachments:()=>void 0,setFiles:()=>void 0,setSyncSourceUuids:()=>void 0,setModel:()=>Promise.resolve(),setProjectUuid:()=>void 0,sendMessage:()=>void 0,sendTransparentMessage:()=>void 0,stopSampling:()=>void 0,pendingConversationSettings:{},conversation:void 0,focusInput:()=>void 0,improvePrompt:()=>void 0,isImprovingPrompt:!1,isFocused:!1,setIsFocused:()=>void 0,promptInputRef:{current:null},willRedirectOnSubmit:!1,hasBlockingWarning:!1,setHasBlockingWarning:()=>void 0,setPersonalizedStyle:()=>void 0,isUploadingDriveSync:!1,isUploadingGithubSync:!1,setIsUploadingDriveSync:()=>void 0,setIsUploadingGithubSync:()=>void 0,includeProfilePreferences:!0,setIncludeProfilePreferences:()=>void 0,isUploadingFile:!1,setIsUploadingFile:()=>void 0,validateMaxUploadLimit:()=>!1,onDrop:()=>void 0,onPasteFiles:()=>Promise.resolve(),handleUpload:()=>Promise.resolve(),uploadInputProps:{type:"",accept:"",onChange:()=>void 0,multiple:!1,"aria-label":""},hasAttachments:!1,isModelSelectorOpen:!1,setIsModelSelectorOpen:()=>void 0,setPendingConversationSettings:()=>void 0,isPromptUnsafe:()=>!1,currentCompassTask:void 0,setCurrentCompassTask:()=>void 0}),U=()=>c.useContext(A),k=e=>{var t,n,C,E,U,k,I;let{onSend:T,willRedirectOnSubmit:j,onCreate:D,onStopSampling:P,customFileUploadHandler:L}=e,z=(0,c.useRef)(null),M="conversation"in e,{children:F,projectUuid:q,namespace:Q}=e,R=M?e.conversation:void 0,Y=(0,c.useCallback)(()=>{M&&P&&P()},[P,M]);x(z.current);let{tipTapEditorState:K,setTipTapEditorText:N,setTipTapEditorJSON:O,isTipTapEditorStateUnsafe:G,attachments:H,setAttachments:V,files:B,setFiles:J,syncSourceUuids:W,setSyncSourceUuids:X,clear:Z}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n=arguments.length>2?arguments[2]:void 0,a="".concat(n?"".concat(n,":"):"").concat(e),[r,i,l]=(0,b.V)("".concat(a,":attachment"),[]),[s,u,d]=(0,b.V)("".concat(a,":files"),[]),[f,p,m]=(0,b.V)("".concat(a,":syncSourceUuids"),[]),[y,g,h]=(0,b.V)("".concat(a,":textInput"),t?{type:"doc",content:[{type:"paragraph",content:[{type:"text",text:t}]}]}:S),v=(0,c.useCallback)(()=>!!y.__ant_unsafe,[y]),w=(0,c.useCallback)((e,t)=>{let n=(0,_.P)(e),a={type:"doc",content:[{type:"paragraph",content:[{type:"text",text:n}]}]};return n.length>0&&t&&(a.__ant_unsafe=!0),g(a),n},[g]);return{attachments:r,setAttachments:i,files:s,setFiles:u,syncSourceUuids:f,setSyncSourceUuids:p,tipTapEditorState:y,setTipTapEditorJSON:(0,c.useCallback)(e=>{let t=(0,o.h0)(e);return t.length>0&&v()&&(e.__ant_unsafe=!0),g(e),t},[g,v]),setTipTapEditorText:w,isTipTapEditorStateUnsafe:v,clear:(0,c.useCallback)(()=>{h(),l(),d(),m()},[l,h,d,m])}}(null!=(n=null==R?void 0:R.id)?n:void 0===q?"new-conversation":"".concat(q,":conversation"),"",Q),$=K?(0,o.h0)(K):"",[ee,et]=c.useState($),en=(0,c.useCallback)(e=>{et(O(e))},[O,et]),ea=(0,c.useCallback)(function(e){let{forceUpdateTiptap:t=!0,unsafe:n=!1}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=N(e,n);if(et(a),!0===t){var r;null==(r=z.current)||r.setContent(a)}},[N]),er=(0,u.NY)(W),ei=(0,u.qJ)(er),eo=(0,s.B7)(er),el=H.length+B.length+W.length>=r.Jn,[es,ec]=c.useState(!1),[eu,ed]=c.useState(),{stickyModelPreference:ef}=(0,l.F)(),ep=null!=(U=null!=(E=null!=(C=null==R?void 0:R.model)?C:eu)?E:ef)?U:void 0,[em,ey]=c.useState(),eg=(0,c.useCallback)(e=>{ey(t=>({...t,...e}))},[]),[eh,ev]=c.useState(q),ew=(0,f.ks)(eh),[eb,e_]=c.useState(!1),[eS,eC]=c.useState(),[eE,ex]=c.useState(!1),[eA,eU]=c.useState(!1),[ek,eI]=c.useState(!1),{storedStyle:eT,defaultStyle:ej}=(0,y.p)(),[eD,eP]=c.useState(),[eL,ez]=c.useState(!0),[eM,eF]=c.useState();(0,c.useEffect)(()=>{let e=null!=eT?eT:ej;!eD&&e&&eP(e)},[eT,ej,eD]),(0,c.useEffect)(()=>{q&&eh!==q&&ev(q)},[q,eh]);let eq="setPersonalizedStyleCallback"in e?e.setPersonalizedStyleCallback:null;(0,c.useEffect)(()=>{eC(void 0),e_(!1)},[null==R?void 0:R.id]),(0,c.useEffect)(()=>{null==eq||eq(eD)},[eD,eq]);let{projectHasHarmony:eQ}=(0,h.r)(eh),{openedFiles:eR,projectDocs:eY,projectUuid:eK}=(0,v.w)(),{getInstance:eN}=(0,g.e)(),{mutateAsync:eO}=(0,d.fh)(eK),{mutateAsync:eG}=(0,d.Om)(eK),eH=(0,c.useCallback)(async()=>{if(z.current&&(""!==ee.trim()||0!==H.length||0!==B.length||0!==W.length)){j&&eC([...B]),Z(),et(""),j?z.current.setEditable(!1):z.current.setContent(""),e_(!0),eQ&&await (null===w.Jo||void 0===w.Jo?void 0:(0,w.Jo)(eR,eK,eY,eO,eG,eN));try{M&&T?(await T({prompt:ee,attachments:H,files:B,syncSources:eo,personalized_style:eD}),e_(!1),eC(void 0)):await D({prompt:ee,attachments:H,files:B,syncSources:eo,model:ep,project_uuid:eh,personalized_style:eD,include_conversation_preferences:eL,...em})}catch(t){var e;ea(ee),null==(e=z.current)||e.setContent(ee),V(H),J(B),X(W),z.current.setEditable(!0),e_(!1),eC(void 0)}}},[em,H,Z,eO,B,eN,eK,eQ,eL,M,ep,D,T,eR,eD,eY,eh,ee,V,J,ea,X,W,eo,eG,j]),eV=(0,c.useCallback)(async e=>{if(void 0!==e&&""!==e.trim()&&M){e_(!0);try{T&&(await T({prompt:e,attachments:[],files:[],syncSources:[],personalized_style:eD}),e_(!1))}catch(e){e_(!1)}}},[M,T,eD]),{streamImprovement:eB,isStreaming:eJ}=function(){let{activeOrganization:e}=(0,p.YL)(),[t,n]=(0,c.useState)(!1),[a,r]=(0,c.useState)(null),i=(0,c.useRef)(null),{addError:o}=(0,m.Y)(),l=(0,c.useCallback)(async(t,a,l,s)=>{i.current&&i.current.abort();let c=new AbortController;i.current=c,n(!0),r(null);let u="/api/organizations/".concat(null==e?void 0:e.uuid,"/prompt/improve/stream");try{var d,f,p;let e=await fetch(u,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(t),credentials:"include",signal:c.signal});if(!e.ok)throw Error("HTTP error! status: ".concat(e.status));let n=null==(d=e.body)?void 0:d.getReader(),r=new TextDecoder;if(!n)throw Error("No response body");let i="",o="",s=!1;for(;!s;){let e=await n.read();if(e.done){s=!0;break}let t=e.value,c=(i+=r.decode(t,{stream:!0})).split("\n");for(let e of(i=c.pop()||"",c))if(e.startsWith("data: ")){let t=e.slice(6);if("[DONE]"===t)continue;try{let e=JSON.parse(t);switch(e.type){case"content_block_delta":(null==(f=e.delta)?void 0:f.text)&&(o+=e.delta.text,a(e.delta.text));break;case"message_stop":l(e.improved_prompt||o);break;case"error":throw Error((null==(p=e.error)?void 0:p.message)||"Unknown error occurred")}}catch(e){}}else e.startsWith("event: ")&&e.slice(7)}}catch(t){if(t instanceof Error&&"AbortError"===t.name)return;let e=t instanceof Error?t:Error(String(t));r(e),null==s||s(e),o("Failed to improve prompt: "+e.message)}finally{n(!1),i.current===c&&(i.current=null)}},[null==e?void 0:e.uuid,o]);return(0,c.useEffect)(()=>()=>{i.current&&i.current.abort()},[]),{streamImprovement:l,isStreaming:t,error:a}}(),eW=(0,c.useCallback)(async()=>{var e,t,n,a;if(!ee.trim())return;null==(e=z.current)||e.setEditable(!1);let r="",i=!1;try{await eB({conversation_uuid:(null==R?void 0:R.id)||"new-conversation",prompt:ee},e=>{var t,n,a;i||(i=!0,ea(""),null==(a=z.current)||a.setContent("")),r+=e,ea(r,{forceUpdateTiptap:!1}),null==(t=z.current)||t.setContent(r),null==(n=z.current)||n.scrollToEnd()},e=>{var t;ea(e),null==(t=z.current)||t.setContent(e)},e=>{var t;ea(ee),null==(t=z.current)||t.setContent(ee)})}catch(e){ea(ee),null==(t=z.current)||t.setContent(ee)}finally{null==(n=z.current)||n.setEditable(!0),null==(a=z.current)||a.focus()}},[ee,null==R?void 0:R.id,eB,ea]),eX=(0,c.useCallback)(async e=>{if(ed(e),M){e_(!0);try{var t;await D({prompt:ee,attachments:H,files:B,syncSources:eo,model:e,project_uuid:eh,create_mode:null==R||null==(t=R.conversationSettings)?void 0:t.create_mode,...em})}finally{e_(!1)}}},[em,H,B,M,eh,ee,D,eo,null==R||null==(t=R.conversationSettings)?void 0:t.create_mode]),eZ=(0,c.useCallback)(()=>{var e;return null==(e=z.current)?void 0:e.focus()},[z]),[e$,e0]=c.useState(!1),e1=(0,i.cV)(),[e2,e7,e5,e6,e3,e8,e4,e9]=(0,r.Si)({syncSourceCount:W.length,attachments:H,setAttachments:V,numExistingConversationAttachments:null!=(k=null==R?void 0:R.attachmentsSoFar)?k:0,files:B,setFiles:J,numExistingConversationFiles:null!=(I=null==R?void 0:R.files.length)?I:0,detectSameAttachment:()=>!1,selectedModel:ep,blobFileUploadsEnabled:e1,customFileUploadHandler:L}),te=H.length+B.length,tt=W.length,tn=e2||eA||ek,ta=te>0||tt>0||tn,tr=(0,c.useMemo)(()=>{var t;return{prompt:ee,tipTapEditorState:K,attachments:H,files:e.willRedirectOnSubmit&&eb?null!=eS?eS:[]:B,syncSourceUuids:W,isAtMaxNumUploads:el,isUploadingDriveSync:eA,isUploadingGithubSync:ek,model:ep,projectUuid:eh,isChatSyncing:ei,personalizedStyle:eD,isProjectSyncing:ew,isNewConversation:void 0===R||0===R.messagesSoFar,isProjectLocked:void 0!==q||void 0!==R,isSending:eb,setPrompt:ea,setTipTapEditorState:en,setAttachments:V,setFiles:J,setSyncSourceUuids:X,setModel:eX,setProjectUuid:ev,sendMessage:eH,sendTransparentMessage:eV,improvePrompt:eW,isImprovingPrompt:eJ,stopSampling:Y,conversation:R,focusInput:eZ,isFocused:eE,setIsFocused:ex,promptInputRef:z,willRedirectOnSubmit:null!=(t=e.willRedirectOnSubmit)&&t,hasBlockingWarning:e$,setHasBlockingWarning:e0,setPersonalizedStyle:eP,setIsUploadingDriveSync:eU,setIsUploadingGithubSync:eI,includeProfilePreferences:eL,setIncludeProfilePreferences:ez,pendingConversationSettings:em,setPendingConversationSettings:eg,isUploadingFile:e2,setIsUploadingFile:e7,validateMaxUploadLimit:e5,onDrop:e6,onPasteFiles:e3,handleUpload:e8,uploadInputProps:e9,hasAttachments:ta,isModelSelectorOpen:es,setIsModelSelectorOpen:ec,isPromptUnsafe:G,currentCompassTask:eM,setCurrentCompassTask:eF}},[H,R,B,eZ,q,e$,eL,el,ei,eE,ew,eb,eA,ek,ep,eD,eh,ee,e.willRedirectOnSubmit,eH,eV,eW,eJ,V,J,eX,em,eg,ea,X,en,Y,W,K,eS,e2,e7,e5,e6,e3,e8,e9,ta,es,ec,G,eM,eF]);return(0,a.jsx)(A.Provider,{value:tr,children:F})}},61125:(e,t,n)=>{n.d(t,{F9:()=>k,QC:()=>b,_F:()=>u,cV:()=>I,cb:()=>S,cm:()=>h,eT:()=>A,kd:()=>x});var a=n(1761),r=n(2341),i=n(27062),o=n(33200);let l=[".DS_Store"],s=["jpg","jpeg","png","gif","webp"],c=["image/jpeg","image/png","image/gif","image/webp"],u={"image/jpeg":"jpg","image/png":"png","image/gif":"gif","image/webp":"webp"},d=["bmp","ico","tiff","tif","psd","raw","cr2","nef","orf","sr2","mobi","jp2","jpx","jpm","mj2","svg","svgz","ai","eps","ps","indd","heic","mp4","mov","avi","mkv","wmv","flv","webm","mpeg","mpg","m4v","3gp","ogv","ogg","rm","rmvb","asf","amv","mpe","m1v","m2v","svi","3g2","roq","nsv","f4v","f4p","f4a","f4b","qt","hdmov","divx","div","m2ts","mts","vob","mp3","wav","wma","aac","flac","alac","aiff","ogg","opus","m4a","amr","awb","wmv","ra","rm","mid","midi","mka","ttf","otf","woff","woff2","eot","sfnt","ttc","suit","zip","doc","pptx"],f=["xls","xlsx","xlsb","xlm","xlsm","xlt","xltm","xltx","ods"],p=["txt","py","ipynb","js","jsx","html","css","java","cs","php","c","cc","cpp","cxx","cts","h","hh","hpp","rs","R","Rmd","swift","go","rb","kt","kts","ts","tsx","m","mm","mts","scala","rs","dart","lua","pl","pm","t","sh","bash","zsh","csv","log","ini","cfg","config","json","proto","yaml","yml","toml","lua","sql","bat","md","coffee","tex","latex","gd","gdshader","tres","tscn"],m=["docx","rtf","epub","odt","odp","pdf"],y=["application/vnd.openxmlformats-officedocument.wordprocessingml.document","application/rtf","application/epub+zip","application/vnd.oasis.opendocument.text","application/vnd.oasis.opendocument.presentation","application/pdf"],g=["csv"],h=e=>{let{imagesEnabled:t=!1,outOfContextFilesEnabled:n=!1,wiggleEnabled:a=!1}=e;return[...a?[".pptx",".doc",".docx",".zip"]:[],...m.map(e=>".".concat(e)),...w(),...t?v():[],...n?f.map(e=>".".concat(e)):[]]},v=()=>s.map(e=>".".concat(e)),w=()=>p.map(e=>".".concat(e)),b=e=>e.split(".").pop().toLowerCase(),_=(e,t)=>{let{imagesEnabled:n=!1,blobFileUploadsEnabled:a=!1}=t,r=b(e.name);return!!(!n&&(s.includes(r)||c.includes(e.type)))||(a?d.includes(r):[...d,...f].includes(r))},S=e=>{let t=b(e.name);return s.includes(t)||c.includes(e.type)},C=e=>[...g,...f].includes(b(e.name)),E=e=>!!l.includes(e.name),x=(e,t)=>{let{imagesEnabled:n=!1,blobFileUploadsEnabled:a=!1,rasterizePdfUploadsEnabled:r}=t,i=[],o=[],l=[],s=[],c=[],u=[];return e.filter(e=>!E(e)).forEach(e=>{let t=n&&S(e);_(e,{imagesEnabled:n,blobFileUploadsEnabled:a})?c.push(e):e.size>3e7?u.push(e):a&&C(e)?l.push(e):r&&("pdf"===b(e.name)||"application/pdf"===e.type)?s.push(e):A(e)?i.push(e):t?o.push(e):i.push(e)}),{attachmentUploads:i,imageUploads:o,rasterizedDocumentUploads:s,unsupportedUploads:c,tooLargeUploads:u,outOfContextFileUploads:l}},A=e=>{let t=b(e.name);return m.includes(t)||y.includes(e.type)},U=e=>{let t=new Uint8Array(e);if(t.length>=4){if(239===t[0]&&187===t[1]&&191===t[2])return"utf-8";if(254===t[0]&&255===t[1]||255===t[0]&&254===t[1])return"utf-16";if(0===t[0]&&0===t[1]&&254===t[2]&&255===t[3]||255===t[0]&&254===t[1]&&0===t[2]&&0===t[3])return"utf-32"}let n=!0,a=Math.min(t.length-1,1e3);for(let e=0;e<a;e+=2)if(0===t[e]&&0===t[e+1]||0!==t[e]&&0!==t[e+1]){n=!1;break}if(n)return"utf-16";let r=!0,i=!1;for(let e=0;e<t.length;e++){let n=t[e];if(n>127)if(i=!0,(224&n)==192){if(e+1>=t.length||(192&t[e+1])!=128){r=!1;break}e+=1}else if((240&n)==224){if(e+2>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128){r=!1;break}e+=2}else if((248&n)==240){if(e+3>=t.length||(192&t[e+1])!=128||(192&t[e+2])!=128||(192&t[e+3])!=128){r=!1;break}e+=3}else{r=!1;break}}if(r&&i)return"utf-8";let o=(e=>{let t={ascii:0,nonAscii:0,cyrillic:0,latin1:0,control:0,total:Math.min(e.length,4e3)};for(let n=0;n<t.total;n++){let a=e[n];a<32?t.control++:a<127?t.ascii++:a>127&&(t.nonAscii++,(a>=192&&a<=255||a>=168&&a<=183)&&t.cyrillic++,(a>=128&&a<=159||a>=160&&a<=255)&&t.latin1++)}return t})(t),l=o.cyrillic/o.total*100,s=o.latin1/o.total*100,c=o.ascii/o.total*100;if(o.nonAscii>0){if(l>.3)return"windows-1251";if(s>o.control/o.total*100)return"windows-1252"}return c>90&&o.control/o.total<.1?"ascii":"utf-8"},k=async e=>{let t=await e.arrayBuffer(),n=U(t);try{return new TextDecoder(n,{fatal:!0}).decode(t)}catch(e){if("utf-8"!==n)return new TextDecoder("utf-8",{fatal:!0}).decode(t)}throw Error("Failed to decode file as plain text")};function I(){var e;let{value:t}=(0,i.fS)("ooc_attachments"),{account:n}=(0,a.YL)(),l=(0,r.B)(),s=null!=(e=null!=l?l:null==n?void 0:n.settings)?e:{},{value:c}=(0,o.N)(s);return!!t&&c}},66860:(e,t,n)=>{n.d(t,{Jn:()=>k,Si:()=>P,fU:()=>q,i1:()=>O,pD:()=>j,vV:()=>R});var a=n(42977),r=n(54568),i=n(61125),o=n(70011),l=n(85644),s=n(98518),c=n(77186),u=n(1761),d=n(51121),f=n(90510),p=n(29242),m=n(29585),y=n(46612),g=n(71473),h=n(27062),v=n(69055),w=n(7033),b=n(70825),_=n(87606),S=n(7620),C=n(62971),E=n(46760),x=n(81133),A=n(17936);function U(){let e=(0,a._)(["\n  relative\n  grid\n  place-content-center\n  aspect-square\n  rounded-xl\n  cursor-pointer\n  transition\n  [fieldset:not(:disabled)_&]:hover:bg-bg-400\n  [fieldset:disabled_&]:opacity-50\n  [fieldset:disabled_&]:pointer-events-none\n  focus-within:ring\n  inline-flex\n  items-center\n  justify-center\n  relative\n  shrink-0\n  ring-offset-2\n  ring-offset-bg-300\n  ring-accent-main-100\n  focus-visible:outline-none\n  focus-visible:ring-1\n  disabled:pointer-events-none\n  disabled:opacity-50\n  disabled:shadow-none\n  disabled:drop-shadow-none\n  bg-[radial-gradient(ellipse,_var(--tw-gradient-stops))]\n  from-bg-500/10\n  from-50%\n  to-bg-500/30\n  border-0.5\n  border-border-400\n  font-medium\n  font-ui\n  text-text-100/90\n  transition-colors\n  active:bg-bg-500/50\n  hover:text-text-000\n  hover:bg-bg-500/60\n"]);return U=function(){return e},e}let k=20,I=e=>{let t=e.webkitRelativePath;return t&&t.length?t:e.name},T=e=>e.replace(/\0/g,""),j=e=>{e.extracted_content=T(e.extracted_content),e.file_name=T(e.file_name),e.file_type=T(e.file_type)},D=(e,t)=>({file_name:I(e),file_type:e.type,file_size:e.size,extracted_content:t});function P(e){let{syncSourceCount:t,files:n,setFiles:a,numExistingConversationFiles:s,attachments:c,setAttachments:u,numExistingConversationAttachments:f,detectSameAttachment:m,selectedModel:y,blobFileUploadsEnabled:g,customFileUploadHandler:b}=e,{addError:_}=(0,d.Y)(),x=(0,o.Z3)(null);return function(e){let{syncSourceCount:t,onUploadComplete:n,existingAttachments:a,existingFiles:o,numExistingConversationAttachments:s,numExistingConversationFiles:c,selectedModel:u,blobFileUploadsEnabled:d,customFileUploadHandler:f}=e,m=(0,E.A)(),{modelConfig:y}=(0,l.fC)(u),{value:g}=(0,h.fS)("trials_and_tribulations_of_high_school_football"),b=g&&!1,_=y.image_in,[x,A,U,I]=function(e){let{syncSourceCount:t,onUploadComplete:n,existingAttachments:a,existingFiles:o,numExistingConversationFiles:s,selectedModel:c,blobFileUploadsEnabled:u,customFileUploadHandler:d}=e,{modelConfig:f}=(0,l.fC)(c),p=f.image_in,m=O()&&f.pdf_in,{isUploading:y,setIsUploading:g,handleError:h,handleUpload:v}=R({imagesEnabled:p,blobFileUploadsEnabled:u,onUploadComplete:n,rasterizePdfUploadsEnabled:m,customFileUploadHandler:d}),w=(0,S.useCallback)(e=>{let{newUploads:n=[],numNewPotentialAttachments:l=0,showError:c=!0}=e,{attachmentUploads:d,imageUploads:f,rasterizedDocumentUploads:y,outOfContextFileUploads:g}=(0,i.kd)(n,{imagesEnabled:p,blobFileUploadsEnabled:u,rasterizePdfUploadsEnabled:m});return l+d.length+f.length+y.length+g.length+a.length+o.length+t>k?(c&&h((0,r.jsx)(C.A,{defaultMessage:"You can add at most {count, plural, one {# attachment} other {# attachments}} to a message. Please select fewer attachments.",id:"qxV00r12ob",values:{count:k}})),!1):!(f.length+y.length+o.length+s>100)||(c&&h((0,r.jsx)(C.A,{defaultMessage:"You can add at most {count, plural, one {# file} other {# files}} to a chat. {suggestion}",id:"QyrCxYs5Jy",values:{count:100,suggestion:s<100?(0,r.jsx)(C.A,{defaultMessage:"Please select fewer files.",id:"a6KVizNPLe"}):(0,r.jsx)(C.A,{defaultMessage:"Please consider starting a new chat.",id:"oN0R8lZNm6"})}})),!1)},[p,u,a,o,t,s,h,m]);return[y,g,w,(0,S.useCallback)(async e=>{w({newUploads:e})&&await v(e)},[v,w])]}({syncSourceCount:t,onUploadComplete:n,existingFiles:o,existingAttachments:a,numExistingConversationFiles:c,numExistingConversationAttachments:s,selectedModel:u,blobFileUploadsEnabled:d,customFileUploadHandler:f}),T=function(e){let{handleUpload:t}=e,n=(0,S.useRef)({ready:0,total:0}),a=(0,S.useCallback)(()=>{n.current={ready:0,total:0}},[]),r=(0,S.useCallback)(e=>{n.current.ready+=1,n.current.total===n.current.ready&&t(e)},[t]),i=(0,S.useCallback)((e,t)=>{let a=e.length;for(let o=0;o<a;o++){let a=e[o];a.isFile?(n.current.total+=1,a.file(e=>{t.push(e),r(t)})):a.isDirectory&&a.createReader().readEntries(e=>{i(e,t)})}},[r]);return(0,S.useCallback)(e=>{var t;e.preventDefault(),a();let n=null==(t=e.dataTransfer)?void 0:t.items;if(!n)return;let r=[];for(let e=0;e<(null==n?void 0:n.length);e++){let t=n[e].webkitGetAsEntry();t&&r.push(t)}i(r,[])},[i,a])}({handleUpload:I}),j=(0,S.useCallback)(async e=>{await I(Array.from(e))},[I]),D=(0,S.useCallback)(async e=>{let t=e.target.files;t&&await I(Array.from(t)),e.target.value=""},[I]),P=_?(0,r.jsx)(C.A,{defaultMessage:"Upload docs or images to Claude\\n(Max {maxUploads}, 30mb each)",id:"ialBpH0eLp",values:{maxUploads:k}}):(0,r.jsx)(C.A,{defaultMessage:"Add content ({maxUploads} max, 30mb each)\\nAccepts pdf, txt, csv, etc.",id:"70asB5brJP",values:{maxUploads:k}}),L=(0,S.useCallback)(e=>{D(e)},[D]),z=(0,S.useMemo)(()=>({type:"file",accept:(0,i.cm)({imagesEnabled:_,outOfContextFilesEnabled:d,wiggleEnabled:b}).join(","),onChange:L,multiple:!0,"aria-label":m.formatMessage({defaultMessage:"Upload files",id:"2jjdVzJX0c"})}),[_,d,b,L,m]);return[x,A,U,T,j,I,(0,r.jsx)(p.m,{className:"text-center",tooltipContent:P,children:(0,r.jsxs)(Y,{children:[(0,r.jsx)("input",{"data-testid":"file-upload",className:"absolute inset-0 -z-10 overflow-hidden rounded-xl opacity-0",...z}),x?(0,r.jsx)(v.N,{className:"animate-spin",size:18}):(0,r.jsx)(w.x,{size:18,weight:"light"})]})},"upload-tooltip"),z]}({syncSourceCount:t,onUploadComplete:(0,S.useCallback)(async(e,t)=>{m&&e.find(e=>m(e.extracted_content))&&_((0,r.jsx)(C.A,{defaultMessage:"The same attachment was already added earlier. Claude sees the full conversation when replying, so there’s no need to re-upload.",id:"Uo3qvhGn7z"})),u(t=>[...t,...e]),a(e=>[...e,...t])},[m,_,u,a]),existingAttachments:c,existingFiles:n,numExistingConversationAttachments:f,numExistingConversationFiles:s,selectedModel:null!=y?y:x,blobFileUploadsEnabled:g,customFileUploadHandler:b})}let L=async(e,t,n)=>{let a=new Image;if(a.src=URL.createObjectURL(e),await new Promise(e=>{a.onload=e,setTimeout(e,250)}),!a.width||!a.height||"image/png"!==e.type&&a.width<=t&&a.height<=n)return e;let r=a.width/a.height,i=a.width,o=a.height;a.width>t&&(o=(i=t)/r),o>n&&(i=(o=n)*r);let l=document.createElement("canvas");l.style.display="none",document.body.appendChild(l);let s=l.getContext("2d");if(!s||!s.imageSmoothingQuality)return document.body.removeChild(l),e;s.imageSmoothingQuality="high",l.width=i,l.height=o,s.drawImage(a,0,0,i,o);let c=await new Promise(e=>{l.toBlob(t=>e(t),"image/webp",.85)});return(document.body.removeChild(l),c)?new File([c],e.name,{type:"image/webp"}):e},z=()=>{let{value:e}=(0,h.fS)("use_canvas_resize");return(0,S.useCallback)(async t=>e?await L(t,2e3,2e3):t,[e])},M=()=>{let e=N(),t=q();return async(n,a,r)=>{try{return await t(n,a,r)}catch(t){e(t,(0,i.cb)(n)?"image":"file")}}},F=e=>{let t=N(),n=q(),a=(0,c.mn)();return async(r,i,o)=>{let l={};try{l.file=await n(r,i,o)}catch(n){n instanceof m.LG&&"document_too_many_pages"===n.errorCode?l.attachment=await K(a,r,i,e):t(n,"document")}return l}},q=()=>{let e=(0,c.mn)(),t=(0,_.useQueryClient)();return async(n,a,r)=>{let i=new FormData;i.append("file",n);let o=r?"/api/organizations/".concat(a,"/projects/").concat(r,"/upload"):"/api/".concat(a,"/upload"),l=await e(o,{method:"POST",body:i}),s=await l.json();if(l.ok)return r&&t.invalidateQueries({queryKey:[g.qz,{orgUuid:a,projectUuid:r}]}),s;throw(0,m.a5)(l.status,s,"File upload failed",l.headers)}},Q=async(e,t,n,a)=>{let i,o=new FormData;o.append("file",t);try{i=await e("/api/organizations/".concat(n,"/convert_document"),{method:"POST",body:o})}catch(e){return(0,b.Cp)(e),a((0,r.jsx)(C.A,{defaultMessage:"One or more file uploads have failed. Please try again.",id:"FIwcYDeyIC"}))}if(429===i.status)return a((0,r.jsx)(C.A,{defaultMessage:"Too many file upload attempts. Please wait and try again later.",id:"h/6cMHSn1V"}));if(413===i.status)return a((0,r.jsx)(C.A,{defaultMessage:"Uploaded file is too large. Try uploading a smaller part of the document, or copy/pasting an excerpt from the file.",id:"/mCoauj3Ws"}));if(!i.ok)return a((0,r.jsx)(C.A,{defaultMessage:"Text extraction failed for one of the uploaded files. Please try again.",id:"ngYPeW4aWf"}));let l=await i.json();return l&&0!==Object.keys(l).length&&l.extracted_content?(l.file_name=I(t),l):a((0,r.jsx)(C.A,{defaultMessage:"Text extraction failed for one of the uploaded files. Please try again.",id:"ngYPeW4aWf"}))},R=e=>{var t;let{imagesEnabled:n,blobFileUploadsEnabled:a,rasterizePdfUploadsEnabled:o,onUploadComplete:l,onError:f,projectUuid:p,customFileUploadHandler:m}=e,{activeOrganization:g}=(0,u.YL)(),h=null!=(t=null==g?void 0:g.uuid)?t:"",[v,w]=(0,S.useState)(!1),{addError:b}=(0,d.Y)(),_=(0,S.useCallback)(e=>{w(!1),b(e),f&&f()},[b,f,w]),E=z(),A=M(),U=F(_),k=(0,c.mn)(),I=(0,s.st)(),T=(0,S.useCallback)(async(e,t)=>{if(m){w(!0);try{let t=await m(e);t&&t.length>0&&await l([],t)}catch(e){_(e instanceof Error?e.message:"File upload failed")}finally{w(!1)}return}let{attachmentUploads:s,imageUploads:c,rasterizedDocumentUploads:u,unsupportedUploads:d,tooLargeUploads:f,outOfContextFileUploads:g}=(0,i.kd)(e,{imagesEnabled:n,blobFileUploadsEnabled:a,rasterizePdfUploadsEnabled:o}),v=d.map(e=>(0,i.QC)(e.name));if(v.length>0)return _((0,r.jsx)(C.A,{defaultMessage:"Files of the following {count, plural, one {format is} other {formats are}} not supported: {formats}",id:"9JcWWPAZoB",values:{count:v.length,formats:(0,r.jsx)(x.dT,{type:"conjunction",value:[...new Set(v)]})}}));if(f.length>0)return I.track({event_key:"file_upload_too_large",large_files:f.map(e=>({file_type:e.type,file_size:e.size}))}),_((0,r.jsx)(C.A,{defaultMessage:"You may not upload files larger than 30mb.",id:"Gr/GvEZTX1"}));w(!0);let b=[],S=0,T=(e,n)=>{if(void 0===t)return!0;let a=new Blob([n]).size/y.t2;return!((S+=a)>t)||(_((0,r.jsx)(C.A,{defaultMessage:"Failed to upload file {filename}. Project knowledge exceeds maximum. Remove files to continue.",id:"MbvF6K3PJd",values:{filename:e}})),!1)};for(let e of s){let t=await K(k,e,h,_);if(!(t&&T(e.name,t.extracted_content)))return;await l([t],[])}for(let e of c){let t=await E(e),n=await A(t,h,p);n&&b.push(n)}for(let e of u){let{file:t,attachment:n}=await U(e,h,p);if(t&&b.push(t),n)if(!T(e.name,n.extracted_content))return;else await l([n],[])}for(let e of g){let t=await A(e,h,p);t&&b.push(t)}await l([],b),w(!1)},[a,k,l,n,_,A,U,h,E,I,o,p,m]);return{isUploading:v,setIsUploading:w,handleError:_,handleUpload:T}},Y=f.J.label(U()),K=async(e,t,n,a)=>{if(!(0,i.eT)(t))try{let e=await (0,i.F9)(t);return D(t,e)}catch(e){}let r=await Q(e,t,n,a);if(r)return j(r),r},N=()=>{let{addError:e}=(0,d.Y)();return(0,S.useCallback)((t,n)=>{if(t instanceof m.LG){if("rate_limit_error"===t.type)return void e((0,r.jsxs)("p",{children:[(0,r.jsx)(C.A,{defaultMessage:"You’ve reached your limit for {resourceType} uploads. Please try again later.",id:"M88GeEDB7r",values:{resourceType:n}}),(0,r.jsx)(A.W,{})]}));if("document_password_protected"===t.errorCode)return void e((0,r.jsx)("p",{children:(0,r.jsx)(C.A,{defaultMessage:"The document you uploaded is password protected. Please remove the password and try again.",id:"DHwwKwuaCR"})}))}if(t instanceof m.LG&&"Image is too large"===t.message)return void e((0,r.jsx)("p",{children:(0,r.jsx)(C.A,{defaultMessage:"Image is too large. <link>Learn more</link>",id:"SFbt+MAvby",values:{link:e=>(0,r.jsx)("a",{href:"https://support.anthropic.com/en/articles/9002500-what-kinds-of-images-can-i-upload-to-claude-ai",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-accent-main-100",children:e})}})}));e((0,r.jsx)("p",{children:(0,r.jsx)(C.A,{defaultMessage:"Your {resourceType} upload failed. Please try again.",id:"ymWsV10Pz1",values:{resourceType:n}})}))},[e])},O=()=>{let{value:e}=(0,h.fS)("janus_claude-ai");return e}},67455:(e,t,n)=>{n.d(t,{EF:()=>y,NY:()=>f,Ql:()=>h,VA:()=>g,YO:()=>m,qJ:()=>p});var a=n(77186),r=n(1761),i=n(46612),o=n(71473),l=n(77101),s=n(87606),c=n(7620),u=n(91768),d=n(93049);let f=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,i=!!(t&&e.length>0),l=(0,c.useMemo)(()=>e.map(e=>"/api/organizations/".concat(n,"/sync/chat/").concat(e)),[n,e]),s=(0,c.useMemo)(()=>({queryKey:e.map(e=>[o.GC,{orgUuid:n,syncSourceUuid:e}]),enabled:i,refetchInterval:e=>!!(e.state.data&&(0,u.z3)(e.state.data))&&5e3,meta:{noToast:!0}}),[i,n,e]);return(0,a._i)(l,s)},p=e=>!!e.some(e=>e.isLoading)||e.some(e=>e.data&&(0,u.z3)(e.data)),m=e=>Math.ceil(f(e).reduce((e,t)=>{var n,a,r;return t.isLoading||!t.data?e:e+(null!=(r=null==(a=t.data)||null==(n=a.status)?void 0:n.current_size_bytes)?r:0)},0)/i.t2),y=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{account:t,activeOrganization:n}=(0,r.YL)(),i=null==t?void 0:t.uuid,c=null==n?void 0:n.uuid,f=(0,s.useQueryClient)(),p=(0,u.eL)();return(0,a.L2)(()=>"/api/organizations/".concat(c,"/sync/chat"),"POST",{enabled:!!n,...e,onSuccess:function(){for(var t,n,a,r,s,u=arguments.length,d=Array(u),p=0;p<u;p++)d[p]=arguments[p];let[m]=d;f.setQueryData([o.GC,{orgUuid:c,syncSourceUuid:m.uuid}],m),m.type===l.v8.GDRIVE&&m.config.uri&&(null==(t=m.status)?void 0:t.extra)&&(null==(n=m.status)?void 0:n.current_size_bytes)&&f.setQueryData([o.QB,{accountUUID:i,orgUUID:c,documentId:m.config.uri}],{uri:"drive:///".concat(m.config.uri),title:null==(r=m.status)?void 0:r.extra,size:null==(s=m.status)?void 0:s.current_size_bytes}),null==(a=e.onSuccess)||a.call(e,...d)},onError:function(){for(var t,n=arguments.length,a=Array(n),r=0;r<n;r++)a[r]=arguments[r];null==(t=e.onError)||t.call(e,...a);let[i,o]=a;p(i,o),o.sync_source_type===l.v8.GDRIVE&&(0,d.D8)(o.sync_source_config.uri)}})},g=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,i=(0,s.useQueryClient)();return(0,a.L2)(()=>"/api/organizations/".concat(n,"/sync/chat"),"PUT",{enabled:!!t,...e,onSuccess:function(){for(var t,a=arguments.length,r=Array(a),l=0;l<a;l++)r[l]=arguments[l];let[s]=r;i.setQueryData([o.GC,{orgUuid:n,syncSourceUuid:s.uuid}],s),null==(t=e.onSuccess)||t.call(e,...r)}})},h=()=>{let{activeOrganization:e}=(0,r.YL)(),t=null==e?void 0:e.uuid;return(0,a.L2)(e=>"/api/organizations/".concat(t,"/sync/chat/").concat(e),"DELETE",{enabled:!!e})}},69987:(e,t,n)=>{function a(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n]}function r(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n]}n.d(t,{Y:()=>a,z:()=>r})},70358:(e,t,n)=>{n.d(t,{h:()=>a});async function a(e){let{createHash:t}=await Promise.all([n.e(3473),n.e(9413)]).then(n.t.bind(n,97136,23));return t("sha256").update(e.trim()).digest("hex").slice(0,6)}},74530:(e,t,n)=>{function a(e){return"text"===e.type&&e.text?{...e,text:e.text.replace("​","")}:e.content?{...e,content:e.content.map(a)}:e}n.d(t,{DV:()=>a,h0:()=>r});let r=e=>{let t="",n=0,a=function(e){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,i=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if("doc"===e.type&&e.content)for(let t of e.content)a(t);else if("paragraph"===e.type){if(e.content)for(let t of e.content)a(t);t+="\n"}else if("text"===e.type){let n=e.text;if(e.marks)for(let t of e.marks)"bold"===t.type?n="**".concat(n,"**"):"italic"===t.type?n="*".concat(n,"*"):"underline"===t.type?n="__".concat(n,"__"):"strike"===t.type?n="~~".concat(n,"~~"):"code"===t.type&&(n="`".concat(n,"`"));t+=n}else if("codeBlock"===e.type){let n=e.attrs&&"string"==typeof e.attrs.language?e.attrs.language:"";if(t+="\n```".concat(n,"\n"),e.content)for(let t of e.content)a(t);t+="\n```\n\n"}else if("bulletList"===e.type&&e.content)for(let t of e.content)a(t);else if("orderedList"===e.type&&e.content)for(let t=0;t<e.content.length;t++)a(e.content[t],t+1,!0);else if("listItem"===e.type&&e.content){let o="   ".repeat(n);for(let l of(i?t+="".concat(o).concat(r,". "):t+="".concat(o,"* "),e.content))n+=1,a(l),n-=1}};return a(e),t.replace("​","").trim()}},75710:(e,t,n)=>{n.d(t,{DI:()=>i,In:()=>o,_s:()=>l,k2:()=>s,q:()=>c});var a=n(47510),r=n.n(a);function i(e,t){return r()(e,t)}function o(e){let t=[],n=0;for(let[a,r]of e)0!==a&&t.push({op:a,pos:n,text:r}),-1!==a&&(n+=r.length);return t}function l(e){if(!Array.isArray(e))throw Error("Input must be an array");e.forEach((e,t)=>{var n;if(!("object"==typeof(n=e)&&null!==n&&"op"in n&&"number"==typeof n.op))throw Error("Invalid change object at index ".concat(t));if(1!==e.op&&-1!==e.op)throw Error("Invalid 'op' value at index ".concat(t));if("number"!=typeof e.pos||!Number.isInteger(e.pos))throw Error("Invalid 'pos' value at index ".concat(t));if("string"!=typeof e.text)throw Error("Invalid 'text' value at index ".concat(t))})}function s(e,t){let n=t.map(e=>({op:-e.op,pos:e.pos,text:e.text})).reverse(),a=e,r=0;for(let e of n){let t=e.pos+r;1===e.op?(a=a.slice(0,t)+e.text+a.slice(t),r+=e.text.length):-1===e.op&&(a=a.slice(0,t)+a.slice(t+e.text.length),r-=e.text.length)}return a}function c(e){for(let[t]of e)if(0!==t)return!1;return!0}},77101:(e,t,n)=>{n.d(t,{I5:()=>i,sb:()=>r,v8:()=>a,xj:()=>o});var a=function(e){return e.GITHUB="github",e.GDRIVE="gdrive",e.OUTLINE="outlin",e.SALESFORCE="sfdc",e.GMAIL="gmail",e.GCAL="gcal",e.SLACK="slack",e.ASANA="asana",e.CANVAS="canvas",e.FIDDLEHEAD="fiddlehead",e}({});let r={github:"GitHub",gdrive:"Google Drive",outlin:"Outline",sfdc:"Salesforce",gmail:"Gmail",gcal:"Google Calendar",slack:"Slack",asana:"Asana",canvas:"Canvas",fiddlehead:"Fiddlehead"};var i=function(e){return e.CREATED="created",e.PENDING="pending",e.FAILED="failed",e.UPDATING="updating",e.UPDATE_FAILED="update_failed",e.READY="ready",e.UNAUTHENTICATED="unauthenticated",e.ACCESS_DENIED="access_denied",e.DISABLED="disabled",e}({});let o=["access_denied","failed","unauthenticated","update_failed"]},85644:(e,t,n)=>{n.d(t,{A9:()=>p,Wq:()=>m,fC:()=>u});var a=n(77186),r=n(1761),i=n(71473),o=n(27062),l=n(85544),s=n(75006);let c={image_in:!0,pdf_in:!1},u=e=>{let{activeOrganization:t}=(0,r.YL)(),n=null==t?void 0:t.uuid,{data:o,isLoading:l,isPlaceholderData:s}=(0,a.Sk)("/api/organizations/".concat(n,"/model_configs/").concat(e),{queryKey:[i.yV,n,e],enabled:!!n,staleTime:3e5,meta:{noToast:!0}});return{isLoading:l,modelConfig:!s&&o||c}},d=s.z.array(s.z.object({model:s.z.string(),name:s.z.string(),description:s.z.string().optional(),description_i18n_key:s.z.string().optional(),notice_text:s.z.string().optional(),notice_text_i18n_key:s.z.string().optional(),inactive:s.z.boolean().optional(),overflow:s.z.boolean().optional(),knowledgeCutoff:s.z.string().optional(),slow_kb_warning_threshold:s.z.number().optional(),paprika_modes:s.z.array(l.T4).optional(),capabilities:s.z.object({mm_pdf:s.z.boolean().optional(),mm_images:s.z.boolean().optional(),web_search:s.z.boolean().optional(),gsuite_tools:s.z.boolean().optional(),compass:s.z.boolean().optional()}).optional()})),f=[],p=()=>{let e=(0,o.T9)("claude_ai_models","models",f,d),t=e.filter(e=>!e.inactive),n=t.filter(e=>!e.overflow),a=t.filter(e=>e.overflow);return{allModelOptions:e,activeModelOptions:t,mainModels:n,overflowModels:a}},m=()=>{let{allModelOptions:e}=p();return(t,n)=>{let a=e.find(e=>e.model===t);if(!a)return!1;let r=null==a?void 0:a.capabilities;return!r||!1!==r[n]}}},89116:(e,t,n)=>{n.d(t,{e:()=>v,w:()=>h});var a=n(54568),r=n(98518),i=n(69987),o=n(737),l=n(55701),s=n.n(l),c=n(89256),u=n.n(c),d=n(7620),f=n(56273),p=n(2188);let m=(0,d.createContext)(null),y={getInstance:()=>void 0,setBaseContent:u(),flagForDeletion:u(),getCurrentContent:()=>void 0,hasUnsavedChanges:()=>!1,registerEditor:u(),unregisterEditor:u(),setMergeState:()=>u(),subscribeToMergeStateChanges:()=>u(),acceptAllChanges:u(),rejectAllChanges:u(),deactivateChangesMode:u(),activeEditors:[],changesMode:!1},g=(e,t)=>{var n,a;let r=null==(a=(0,o.JE)(e.state))||null==(n=a.chunks)?void 0:n[0];return!!r&&("accept"===t?o._X:o.dH)(e,r.fromB)};function h(e){let{children:t}=e,{track:n}=(0,r.st)(),{openedFiles:o}=(0,p.w)(),{dispatchChatResource:l}=(0,f.i)(),c=(0,d.useRef)(new Map),u=(0,d.useRef)(new Set),y=(0,d.useCallback)((e,t)=>{c.current.set(e,{view:t})},[]),h=(0,d.useCallback)(e=>{c.current.delete(e)},[]),v=(0,d.useCallback)((e,t)=>{let n=c.current.get(e);if(!n)return void i.z("Attempted to update unknown editor: ".concat(e));c.current.set(e,{...n,...t})},[]),w=(0,d.useCallback)((e,t)=>v(e,{baseContent:t}),[v]),b=(0,d.useCallback)(e=>v(e,{filePendingDeletion:!0}),[v]),_=(0,d.useCallback)((e,t)=>{v(e,{mergeState:t}),u.current.forEach(n=>n(e,t))},[v]),S=(0,d.useCallback)(e=>(u.current.add(e),()=>{u.current.delete(e)}),[]),C=(0,d.useCallback)(e=>c.current.get(e),[]),[E,x]=(0,d.useState)([]),[A,U]=(0,d.useState)(!1),k=(0,d.useCallback)(()=>{l({type:"UPDATE_FILE_EDITS",edits:new Map}),U(!1)},[l]);(0,d.useEffect)(()=>{E.length&&U(!0)},[E]),(0,d.useEffect)(()=>(x(o.filter(e=>{var t;let n=C(e);return!!n&&(null==(t=n.mergeState)?void 0:t.isActive)&&!!n.view})),S((e,t)=>{x(n=>{var a;let r=n.includes(e),i=t.isActive&&!!(null==(a=C(e))?void 0:a.view);return r===i?n:i?[...n,e]:n.filter(t=>t!==e)})})),[o,S,C,A]);let I=(0,d.useCallback)(()=>{E.forEach(e=>{var t;let n=null==(t=C(e))?void 0:t.view;if(n)for(;g(n,"accept"););}),n({event_key:"harmony.suggestion.accepted"})},[E,n,C]),T=(0,d.useCallback)(()=>{E.forEach(e=>{var t;let a=null==(t=C(e))?void 0:t.view;if(a){for(;g(a,"reject"););_(e,{isActive:!1}),n({event_key:"harmony.suggestion.rejected"})}})},[E,n,C,_]),j=(0,d.useCallback)(e=>{var t,n;return null==(n=C(e))||null==(t=n.view)?void 0:t.state.doc.toString()},[C]),D=(0,d.useCallback)(e=>{var t;let n=j(e);return s()(n)&&n!==(null==(t=C(e))?void 0:t.baseContent)},[j,C]),P=(0,d.useMemo)(()=>({getInstance:C,setBaseContent:w,flagForDeletion:b,getCurrentContent:j,hasUnsavedChanges:D,registerEditor:y,unregisterEditor:h,setMergeState:_,subscribeToMergeStateChanges:S,acceptAllChanges:I,rejectAllChanges:T,deactivateChangesMode:k,activeEditors:E,changesMode:A}),[C,w,b,j,D,y,h,_,S,I,T,k,E,A]);return(0,a.jsx)(m.Provider,{value:P,children:t})}function v(){let e=(0,d.useContext)(m);return e||y}},91507:(e,t,n)=>{function a(e){var t;return(null==(t=e.mergeState)?void 0:t.isActive)?e.mergeState.diffSource:e.view.state.doc.toString()}function r(e){return a(e)!==e.baseContent}n.d(t,{s5:()=>r,t_:()=>a}),n(75710)},91768:(e,t,n)=>{n.d(t,{Dd:()=>A,FZ:()=>S,LN:()=>v,X0:()=>z,XE:()=>T,Ys:()=>D,dH:()=>C,eL:()=>k,fe:()=>M,ob:()=>L,ph:()=>b,tS:()=>h,xc:()=>w,z3:()=>x});var a=n(68096),r=n(77186),i=n(1761),o=n(51121),l=n(29585),s=n(71473),c=n(27062),u=n(77101),d=n(90119),f=n(87606),p=n(62942),m=n(7620),y=n(46760),g=n(40459);let h=e=>e.type===u.v8.GITHUB?{sync_source_type:u.v8.GITHUB,sync_source_config:e.config}:e.type===u.v8.GDRIVE?{sync_source_type:u.v8.GDRIVE,sync_source_config:e.config}:null,v=()=>{let{activeOrganization:e}=(0,i.YL)(),t=null==e?void 0:e.uuid;return(0,r.Sk)("/api/organizations/".concat(t,"/sync/settings"),{queryKey:[s._V,{orgUUID:t}],enabled:!!e})},w=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=(0,f.useQueryClient)();return(0,r.Qv)("/api/organizations/".concat(n,"/sync/settings"),"PUT",(e,t)=>{let{type:n,enabled:a}=e;t||(t=[]);let r=t.map(e=>e.type===n?{...e,enabled:a}:e);return r.some(e=>e.type===n)?r:[...t,{type:n,enabled:a}]},{queryKey:[s._V,{orgUUID:n}],enabled:!!t,onSuccess:async function(){for(var t,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];await a.invalidateQueries({queryKey:[s._V,{orgUUID:n}]}),await (null==(t=e.onSuccess)?void 0:t.call(e,...i))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},b=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},{activeOrganization:t}=(0,i.YL)(),n=null==t?void 0:t.uuid,a=(0,f.useQueryClient)(),{value:o}=(0,c.fS)("kingfisher_enabled"),{value:l}=(0,c.fS)("apps_use_bananagrams");return(0,r.Qv)("/api/organizations/".concat(n,"/sync/settings/config"),"POST",(e,t)=>{let{type:n,config:a}=e;return t||(t=[]),t.map(e=>e.type===n?{...e,config:{...e.config,...a}}:e)},{queryKey:[s._V,{orgUUID:n}],enabled:!!(t&&o&&l),onSuccess:async function(){for(var t,r=arguments.length,i=Array(r),o=0;o<r;o++)i[o]=arguments[o];await a.invalidateQueries({queryKey:[s._V,{orgUUID:n}]}),await (null==(t=e.onSuccess)?void 0:t.call(e,...i))},meta:{errorMessage:"There was an error changing your settings. Please try again."},...e})},_=(e,t)=>{let n=new URLSearchParams(Array.from(t.entries()));n.delete(e);let a=n.toString()?"?".concat(n.toString()):"",r=window.location.pathname+a;window.history.replaceState({...window.history.state,as:r,url:r},"",r)},S=e=>{let{callerIdentifier:t,successParam:n,handleOpen:a}=e,r=(0,p.useSearchParams)(),i=(0,m.useRef)(!1);(0,m.useEffect)(()=>{!r.has(n)||i.current||t&&t!==r.get(n)||(i.current=!0,_(n,r),a())},[r,t,a,n])},C=e=>{let{pathname:t,searchParams:n,queryString:a,isClaudeApp:r}=e,i="".concat(t,"?").concat(a),o=n.get("origin");if(o)i=o;else if(r){let e=/^[0-9a-fA-F]{8}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{4}-[0-9a-fA-F]{12}$/i,n=t.startsWith("/project/")&&e.test(t.slice(9)),r=t.startsWith("/chat/")&&e.test(t.slice(6)),o=n||r||"/new"===t?t:"/new";i="claude://claude.ai".concat(o,"?").concat(a)}return i},E=e=>[u.I5.CREATED,u.I5.PENDING,u.I5.UPDATING].includes(e),x=e=>E(e.status.state),A=e=>[u.I5.FAILED,u.I5.UPDATE_FAILED].includes(e.status.state),U=e=>{if(e instanceof l.LG)return e instanceof l.LG&&"access_denied"===e.errorCode},k=()=>{let{addError:e}=(0,o.Y)(),t=(0,f.useQueryClient)();return(n,a)=>{U(n)&&(e("Please try again. You may need to reconnect with your ".concat(u.sb[a.sync_source_type]," account.")),s.ku.forEach(e=>{t.invalidateQueries({queryKey:[e]})}),t.invalidateQueries({queryKey:[s.GC]}))}},I={[u.v8.GCAL]:"enabled_foccacia",[u.v8.GMAIL]:"enabled_sourdough"},T=e=>{let t=e===u.v8.GCAL||e===u.v8.GMAIL?"pumpernickel_enabled":"cinnabon_enabled",{value:n}=(0,c.fS)(t);return!g.env.NEXT_PUBLIC_DISABLE_INTEGRATIONS&&n},j=e=>{let t=(0,i.mV)(),{data:n}=v(),a=!!(Array.isArray(n)&&n.find(t=>t.type===e&&t.enabled));return!t||a},D=e=>{let t=j(e);return!!(T(e)&&t)},P=e=>"sfdc"===e?"salesforce":e,L=function(e){let{callerIdentifier:t,handleAuthSuccess:n,returnToOrigin:a=!1,target:l,queryString:s}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{activeOrganization:c}=(0,i.YL)(),g=null==c?void 0:c.uuid,h=(0,p.usePathname)(),v=(0,p.useSearchParams)(),{addSuccess:w}=(0,o.Y)(),b=(0,y.A)(),_=D(e),E=(0,f.useQueryClient)(),x=(0,d.V)(),{data:A,isFetched:U}=(0,r.Sk)("/api/organizations/".concat(g,"/sync/").concat(P(e),"/auth"),{queryKey:["sync_".concat(e,"_auth_status"),{orgUUID:g}],enabled:!!(c&&_)}),k=(0,m.useRef)(!1),{mutate:I}=(0,r.L2)("/api/organizations/".concat(g,"/sync/").concat(P(e),"/auth/start"),"POST",{enabled:!!(c&&_),onSuccess:e=>{window.open(e.redirect_url,l)}});S({callerIdentifier:t,successParam:"".concat(e,"_success"),handleOpen:()=>{w(b.formatMessage({defaultMessage:"Successfully connected to {integrationName}",id:"T7cL93l/KQ"},{integrationName:u.sb[e]})),null==n||n(!0)}});let{mutate:T}=(0,r.L2)("/api/organizations/".concat(g,"/sync/").concat(P(e),"/auth"),"DELETE",{enabled:!!(c&&_),onSuccess:()=>{E.invalidateQueries({queryKey:["sync_".concat(e,"_auth_status"),{orgUUID:g}]})}});return{isAuthenticated:_&&!!(null==A?void 0:A.is_authenticated),startAuth:()=>{if(!k.current&&_){let n=C({pathname:a?h:"/new",searchParams:v,queryString:"".concat(e,"_success=").concat(t).concat(s?"&".concat(s):""),isClaudeApp:x});if(x){window.location.href="/settings/connectors?open_in_browser=1&auth_start=".concat(e,"&origin=").concat(n);return}"_blank"!==l&&(k.current=!0),I({pre_auth_state:{origin:n},redirect_uri:new URL("/connect/".concat(P(e),"/callback"),window.location.origin).toString()})}},disconnect:T,isFetched:U}},z=(e,t)=>{var n,a;let r=D(e),{account:o}=(0,i.YL)(),l=I[e];return l?r&&(t?!!(null==t||null==(n=t.conversationSettings)?void 0:n[l]):!!(null==o||null==(a=o.settings)?void 0:a[l])):r},M=()=>{let{account:e}=(0,i.YL)(),{mutate:t}=(0,a.Jy)();return{toggleIntegrationEnabled:(n,a)=>{if(!e)return;let r=I[n];r&&t({...e.settings,[r]:a})}}}},93049:(e,t,n)=>{n.d(t,{Ac:()=>i,D8:()=>l,bI:()=>o});let a="recentDriveDocs";function r(e){return"object"==typeof e&&null!==e&&"string"==typeof e.uri&&("string"==typeof e.title||void 0===e.title)}function i(e){localStorage.setItem(a,JSON.stringify(e))}function o(){let e=localStorage.getItem(a);if(e){let t=JSON.parse(e);if(t&&Array.isArray(t)&&t.every(r))return t}return[]}function l(e){let t=o();i(t=t.filter(t=>t.uri!==e))}}}]);