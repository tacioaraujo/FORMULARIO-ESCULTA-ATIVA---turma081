(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9916],{28137:(e,t,n)=>{"use strict";n.d(t,{F:()=>c});var a=n(98518),s=n(1761),i=n(27062),r=n(7620),l=n(34116);let o="payment-verification-reminder-dismissed";function c(){let{activeOrganization:e}=(0,s.YL)(),t=(0,a.st)(),[n,c]=(0,r.useState)(!1),{value:d}=(0,i.fS)("show_3ds_modal"),{data:u}=(0,l.PI)(d);return(0,r.useEffect)(()=>{var n;let a=localStorage.getItem(o);if(a){let e=new Date(a).getTime();if(new Date().getTime()-e<864e5)return void c(!1)}let s=d&&null!=(n=null==u?void 0:u.requires_3ds_verification)&&n;c(s),s&&t.track({event_key:"payment_modal_open",organization_id:null==e?void 0:e.uuid,modal_type:"3ds_verification_required"})},[d,u,t,e]),{shouldShowModal:n,dismissReminder:(0,r.useCallback)(()=>{let n=new Date().toISOString();localStorage.setItem(o,n),c(!1),t.track({event_key:"payment_modal_open",organization_id:null==e?void 0:e.uuid,action:"3ds_verification_dismissed",dismissed_at:n})},[t,e])}}},55947:(e,t,n)=>{"use strict";n.d(t,{T:()=>g});var a=n(54568),s=n(98518),i=n(1761),r=n(51121),l=n(78730),o=n(86030),c=n(37076),d=n(87606),u=n(7620),m=n(62971),f=n(34116),v=n(28137);function g(){let[e,t]=(0,u.useState)(!1),n=(0,s.st)(),{activeOrganization:g}=(0,i.YL)(),{addError:p,addSuccess:_}=(0,r.Y)(),h=(0,l.ib)(),x=(0,d.useQueryClient)(),{shouldShowModal:y,dismissReminder:j}=(0,v.F)(),k=(0,f.Si)({onSuccess:async e=>{try{let t=await h;if(!t)throw Error("Stripe failed to initialize");let s=await t.handleNextAction({clientSecret:e.clientSecret});if(s.error)throw Error(s.error.message||"PAYMENT_VERIFICATION_FAILED");await x.invalidateQueries({queryKey:["check-3ds-required",null==g?void 0:g.uuid]}),_((0,a.jsx)(m.A,{defaultMessage:"Payment method verified successfully",id:"vRXoCh/o7W"})),n.track({event_key:"payment_modal_open",organization_id:null==g?void 0:g.uuid,action:"verify_3ds_success"})}catch(e){p(e instanceof Error&&"PAYMENT_VERIFICATION_FAILED"===e.message?(0,a.jsx)(m.A,{defaultMessage:"Payment verification failed",id:"9RpX03Q2ky"}):e instanceof Error?e.message:(0,a.jsx)(m.A,{defaultMessage:"Payment verification failed. Please try again.",id:"0kXa3Rf5bZ"})),n.track({event_key:"payment_modal_open",organization_id:null==g?void 0:g.uuid,action:"verify_3ds_error",error_message:e instanceof Error?e.message:"Unknown error"})}finally{t(!1)}},onError:e=>{t(!1),p((0,a.jsx)(m.A,{defaultMessage:"Failed to start verification process. Please try again.",id:"3dT/r8rV5S"})),n.track({event_key:"payment_modal_open",organization_id:null==g?void 0:g.uuid,action:"verify_3ds_api_error",error_message:e.message})}}),w=()=>{j()};return y?(0,a.jsx)(c.aF,{isOpen:y,onClose:w,modalSize:"md",hasCloseButton:!0,title:(0,a.jsx)("div",{className:"flex items-center gap-2",children:(0,a.jsx)(o.E,{color:"secondary",size:"lg",children:(0,a.jsx)(m.A,{defaultMessage:"Action Required",id:"jWgFDt2Ifa"})})}),children:(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("h2",{className:"text-3xl font-medium text-text-100 mb-3",children:(0,a.jsx)(m.A,{defaultMessage:"Verify your payment method",id:"epYApo9bIj"})}),(0,a.jsx)("p",{className:"text-text-200 mb-6",children:(0,a.jsx)(m.A,{defaultMessage:"To comply with European security regulations, we need to verify your payment method using a quick one-time security process. This ensures your subscription remains active and secure.",id:"K0hDpiUx0B"})}),(0,a.jsxs)("div",{className:"flex flex-col gap-2 mt-6",children:[(0,a.jsx)(c.yl,{onClick:()=>{t(!0),n.track({event_key:"payment_modal_open",organization_id:null==g?void 0:g.uuid,action:"verify_3ds_start"});let e=window.location.href;k.mutate({return_url:e})},loading:e,className:"w-full",children:(0,a.jsx)(m.A,{defaultMessage:"Verify now",id:"t28SE7zKVA"})}),(0,a.jsx)(c.yl,{variant:"secondary",onClick:w,className:"w-full",children:(0,a.jsx)(m.A,{defaultMessage:"Remind me later",id:"c4hRLOnYpQ"})})]})]})}):null}},68708:(e,t,n)=>{Promise.resolve().then(n.bind(n,78055))},78055:(e,t,n)=>{"use strict";n.d(t,{ChatClientPage:()=>R});var a=n(54568),s=n(7726),i=n(91961),r=n(95675),l=n(56273),o=n(1761),c=n(53248);function d(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:500;if(e.length<=t)return e;let n=Math.ceil(t/2);return"".concat(e.substring(0,n),"\n\n  [...]\n\n  ").concat(e.substring(e.length-n))}var u=n(7620),m=n(46760),f=n(70011),v=n(19303),g=n(2341),p=n(62942),_=n(90119),h=n(92947),x=n(89116),y=n(26553),j=n(2188),k=n(80005),w=n(22126),S=n(98518),A=n(28871),C=n(8027),N=n(11515),b=n(41417),E=n(37076),M=n(98411),I=n(62971),O=n(94748),T=n(83133),F=n(67532);function z(e){let{isModalOpen:t,currentTool:n,currentToolInput:s,currentServer:i,handleDeny:r,handleAllow:l,handleAlwaysAllow:o}=e,{isExpanded:c,setIsExpanded:d,snappyTransition:u}=(0,F.a)(!1);if(n)return(0,a.jsxs)(E.aF,{isOpen:t,onClose:()=>r(),autoCloseOnFocusOut:!1,closeOnEscapeKeydown:!1,modalSize:"lg",title:(0,a.jsx)(I.A,{defaultMessage:"Claude would like to use this tool",id:"PwE/s/W1AC"}),children:[(0,a.jsx)("div",{className:"mt-4"}),(0,a.jsx)(O.sH,{isStreaming:!1,isExpanded:c,setIsExpanded:d,isFirstBlockOfMessage:!0,isLastBlockOfMessage:!0,text:(0,a.jsx)(M.fI,{className:"!py-0",children:(0,a.jsxs)("div",{className:"flex gap-4 items-center",children:[(0,a.jsx)(N.d,{url:null==i?void 0:i.url,fallbackSvg:(0,a.jsx)(C.B,{letter:n.serverName,size:40}),size:40}),(0,a.jsxs)("div",{className:"flex flex-col py-1",children:[(0,a.jsx)("div",{className:"text-sm text-text-400 font-mono",children:n.name}),(0,a.jsx)("span",{className:"font-medium text-[0.9rem] pt-1",children:n.serverName})]})]})}),className:"!h-auto",children:(0,a.jsx)(O.NG,{isExpanded:c,snappyTransition:u,isScrollable:!0,children:(0,a.jsx)(T.L,{input:s?JSON.parse(s):""})})}),(0,a.jsxs)("div",{className:"flex flex-col p-4 gap-4 bg-bg-300 my-4 rounded-lg border-0.5 border-border-300",children:[(0,a.jsx)("p",{className:"font-medium",children:(0,a.jsx)(I.A,{defaultMessage:"Review each action carefully before approving",id:"IaQzFuy2mt"})}),(0,a.jsx)("p",{children:(0,a.jsx)(I.A,{defaultMessage:"Claude cannot guarantee the security or privacy practices of third-party integrations.",id:"3gyayAmXQv"})})]}),(0,a.jsx)(E.vW,{className:"flex justify-between",children:(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:"flex gap-2",children:[o&&(0,a.jsx)(b.$,{onClick:o,children:(0,a.jsx)(I.A,{defaultMessage:"Allow always",id:"F8zkKBCp6U"})}),(0,a.jsx)(b.$,{onClick:l,autoFocus:!0,children:(0,a.jsx)(I.A,{defaultMessage:"Allow once",id:"O2tb5KUxpc"})})]}),(0,a.jsx)(b.$,{onClick:r,variant:"outline",children:(0,a.jsx)(I.A,{defaultMessage:"Decline",id:"pvtgR26QWY"})})]})})]})}function D(e){var t,n;let{conversation:i,conversationUUID:r,isLoadingHarmony:l,chatInputDefaultMessage:x}=e,{currentPath:y,data:j,isLoading:C,isPlaceholderData:N}=(0,s.Bq)(r,{suppressError:!0}),{changeDisplayedConversationPath:b}=(0,v.G)(),{onInvokeTool:E,isModalOpen:M,currentTool:I,currentToolInput:O,currentServer:T,handleAllow:F,handleDeny:D,handleAlwaysAllow:U}=function(e){let{conversationUUID:t}=e,{mcpTools:n,servers:a}=(0,h.gt)(),s=(0,w.M)(),{track:i}=(0,S.st)(),[r,l]=(0,u.useState)(!1),[o,c]=(0,u.useState)(null),[d,m]=(0,u.useState)(null),[f,v]=(0,u.useState)(null),[g,p]=(0,u.useState)(null),_=(0,h.Ib)(),{toggleMcpToolAlwaysApproved:x}=(0,h.es)(),{getApprovalSetting:y}=(0,h.BN)(),{alwaysAllowEnabled:j}=y(null==o?void 0:o.serverName,o),k=(0,u.useRef)(_);(0,u.useEffect)(()=>{k.current=_},[_]);let C=(0,u.useCallback)(async(e,t,i,r,o)=>{var d,u;let f=t.includes(":"),g=n.find(e=>(f?"".concat(e.serverName,":").concat(e.name):e.name)===t),_=(null==(d=a.find(e=>{let{name:t}=e;return t===(null==g?void 0:g.serverName)}))?void 0:d.uuid)||"local";if(!g||!_)return s(e,t,i,r,o);let{approvalSetting:x}=y(g.serverName,g);if("never"===x)return s(e,t,i,r,o);if("dolphin"===t){let n=(u=(0,A.p)(r))&&"object"==typeof u?"actions"in u&&Array.isArray(u.actions)?u.actions.map(e=>({type:e.action,state:"pending",coordinate:"coordinate"in e?e.coordinate:void 0,start_coordinate:"start_coordinate"in e?e.start_coordinate:void 0,text:"text"in e?e.text:void 0,scroll_direction:"scroll_direction"in e?e.scroll_direction:void 0,scroll_amount:"scroll_amount"in e?e.scroll_amount:void 0,duration:"duration"in e?e.duration:void 0})):"action"in u?[{type:u.action,state:"pending",coordinate:"coordinate"in u?u.coordinate:void 0,start_coordinate:"start_coordinate"in u?u.start_coordinate:void 0,text:"text"in u?u.text:void 0,scroll_direction:"scroll_direction"in u?u.scroll_direction:void 0,scroll_amount:"scroll_amount"in u?u.scroll_amount:void 0,duration:"duration"in u?u.duration:void 0}]:[]:[];if(1===n.length&&"screenshot"===n[0].type)return s(e,t,i,r,o);if(n.length>0)return new Promise(e=>{m(_),c(g),v(i),p(r),e()})}return k.current.includes((0,h.Hj)(_,g))?s(e,t,i,r,o):new Promise(e=>{m(_),c(g),v(i),p(r),l(!0),e()})},[a,s,n,y]),N=(0,u.useCallback)(()=>{l(!1),o&&null!==f&&null!==g&&s(t,"".concat(o.serverName,":").concat(o.name),f,g)},[t,o,f,g,s]),b=(0,u.useCallback)(()=>{if(l(!1),o&&null!==f&&null!==g){var e;s(t,"".concat(o.serverName,":").concat(o.name),f,g,{overriddenResult:{content:[{type:"text",text:"The user has chosen to disallow the tool call."}],is_error:!0}}),i({event_key:"mcp.tools.called",result:"disallowed",argument_count:Object.keys(null!=(e=(0,A.p)(g))?e:{}).length})}},[t,o,f,g,s,i]),E=(0,u.useCallback)(()=>{j&&(o&&d&&x(d,o,!0),l(!1),o&&null!==f&&null!==g&&s(t,"".concat(o.serverName,":").concat(o.name),f,g))},[d,t,o,f,g,s,x,j]);return{onInvokeTool:C,isModalOpen:r,currentTool:o,currentServer:a.find(e=>e.uuid===d),currentToolInput:g,handleAllow:N,handleDeny:b,handleAlwaysAllow:j?E:void 0}}({conversationUUID:r}),P=(0,w.n)(null==j?void 0:j.settings,null==i?void 0:i.project_uuid),[R,L]=(0,u.useState)(),B=(0,u.useCallback)(e=>{L(e)},[L]),q=(0,f.Gw)(r,E,P),Y=(0,f.SL)(r,E,P,R),{mutate:K}=(0,s.lj)(r),Q=q.isStreaming||Y.isStreaming,V=q.runStream;!function(e,t){let[n,a]=(0,u.useState)(!1),{activeOrganization:i}=(0,o.YL)(),r=(0,m.A)(),l=e?e.uuid:"",{mutate:f}=(0,s.HI)(l),{mutate:v,error:g}=(0,s.OZ)(l),p=(0,u.useRef)(!1);(0,u.useEffect)(()=>{var t;if(!g||(null==e?void 0:e.name))return;let n=(null==e||null==(t=e.chat_messages)?void 0:t[0])?(0,c.C)(e.chat_messages[0]):"";if(n){if(p.current)return;let e=n.slice(0,30),t=n.length>30?"...":"";p.current=!0,f({name:"".concat(e).concat(t)})}},[g,e,f]),(0,u.useEffect)(()=>{if(t||n||(null==e?void 0:e.name))return;let s=null==e?void 0:e.chat_messages;if(!s||s.length<2||0===(0,c.C)(s[1]).length)return;let r=["Message 1:",d((0,c.C)(s[0])),"Message 2:",d((0,c.C)(s[1]))].join("\n\n");i&&(a(!0),v({message_content:r,recent_titles:[]}))},[t,n,e,i,v,r])}(j,Q),function(e){let{conversationUUID:t,isStreaming:n}=e,[a,s]=(0,u.useState)(n),{mcpClients:i}=(0,h.gt)(),r=i.dolphin,l=(0,_.V)(),o=!!r&&l;(0,u.useEffect)(()=>{o&&(!n&&a?(s(!1),r.notification({method:"notifications/progress",params:{progress:1,total:1,progressToken:"streaming"}})):!a&&n&&(r.notification({method:"notifications/progress",params:{progress:0,total:1,progressToken:"streaming"}}),s(!0)))},[t,o,n,a,r])}({conversationUUID:r,isStreaming:Q});let W=(0,u.useCallback)(async(e,t)=>{var n,a;await V({prompt:t,attachments:e.attachments,files:null!=(a=e.files_v2)?a:e.files,syncSources:e.sync_sources,parent_message_uuid:e.parent_message_uuid,personalized_style:R,compass_mode:null==(n=e.metadata)?void 0:n.compass_mode})},[V,R]),H=(0,u.useCallback)((e,t)=>{b(r,e,t,e=>K({current_leaf_message_uuid:e}))},[b,r,K]);return j||C||N||(0,p.notFound)(),(0,a.jsxs)(g.N,{settings:(null==j?void 0:j.settings)||{},children:[(0,a.jsx)(k.v,{isStreaming:Q,chatInputDefaultMessage:x,conversationTitle:i?"".concat(i.name," - Claude"):"Claude",conversationUUID:r,isLoading:C||!!l,messages:y,name:null!=(n=null!=(t=null==j?void 0:j.name)?t:null==i?void 0:i.name)?n:"Untitled Chat",onSend:q.runStream,onRetry:Y.runStream,projectUuid:null==j?void 0:j.project_uuid,changeDisplayedConversationPath:H,editMessage:W,setPersonalizedStyleCallback:B,onToolAllow:F}),(0,a.jsx)(z,{isModalOpen:M,currentTool:I,currentToolInput:O,currentServer:T,handleDeny:D,handleAllow:F,handleAlwaysAllow:U})]})}function U(e){let{data:t}=(0,s.Bq)(e.conversationUUID,{suppressError:!0}),n=(null==t?void 0:t.project_uuid)||"",{userHasHarmony:i,projectHasHarmony:r}=(0,y.r)(n),[l,o]=(0,u.useState)(!!(i&&r)),c=(0,u.useCallback)(()=>o(!1),[]);return(0,a.jsx)(j.A,{projectUuid:n,onLoad:c,children:(0,a.jsx)(x.w,{children:(0,a.jsx)(D,{...e,isLoadingHarmony:l})})})}var P=n(55947);function R(e){var t;let{uuid:n,q:o}=e,{data:c}=(0,s.Bq)(n);return(0,i.K7)(null!=(t=null==c?void 0:c.name)?t:""),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(l.u,{conversationUUID:n,children:(0,a.jsx)(r._,{conversationUUID:n,children:(0,a.jsx)(U,{conversation:c,conversationUUID:n,chatInputDefaultMessage:o})})}),(0,a.jsx)(P.T,{})]})}}},e=>{var t=t=>e(e.s=t);e.O(0,[1658,3602,7401,3473,7598,4676,2971,2846,7261,5006,1036,9474,5015,7773,6625,7463,3638,5647,1404,6631,5273,7754,5210,1773,8864,4767,6569,7122,8222,9413,7997,4478,1070,6507,45,1922,7693,966,346,6648,5164,1761,8958,1772,28,11,7383,9994,8715,2947,9946,2588,4521,953,1103,1653,1128,498,3090,8847,7050,8885,5,587,842,3383,7358],()=>t(68708)),_N_E=e.O()}]);