(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5,9741],{2019:(e,t,s)=>{"use strict";s.d(t,{F:()=>i});var a=s(86190);let n={sm:"(min-width: 640px)",md:"(min-width: 768px)",lg:"(min-width: 1024px)",xl:"(min-width: 1280px)","2xl":"(min-width: 1536px)"};function i(e){return(0,a.U)(n[e])}},5610:(e,t,s)=>{"use strict";s.d(t,{c:()=>tg,d:()=>tp});var a=s(42977),n=s(54568),i=s(7620),l=s(50787),r=s(57322);r.A.blockRegex;let o=r.A.defaultRules,c=r.A.parserFor;r.A.defaultBlockParse;let d=r.A.outputFor,u=e=>{if(!e||"object"!=typeof e)return e;if(Array.isArray(e))return e.map(u);if(i.isValidElement(e)){if(e.props&&"object"==typeof e.props&&"children"in e.props){let t=e.props.children,s=u(t);if(s!==t)return i.cloneElement(e,void 0,s)}return e}if((e=>"object"==typeof e&&null!==e&&"$$typeof"in e&&"type"in e&&"props"in e)(e)){let{type:t,props:s,key:a}=e,n={};return s&&"object"==typeof s&&(Object.assign(n,s),"children"in s&&(n.children=u(s.children))),null!=a&&(n.key=a),i.createElement(t,n)}return e},m=(e,t,s)=>{let a=d(e,t,s),n=(e,t)=>u(a(e,t));return n.displayName="OutputFor_".concat(String(t)),n},f=e=>m(e,"react");var x=s(56340);let h={...{fence:{...o.fence,parse:(e,t,s)=>({lang:e[2]||void 0,content:e[3]}),react:e=>(0,n.jsx)(x.I.pre,{flagShowCodeHeader:!1,children:e.content})},blockQuote:{...o.blockQuote,react:(e,t,s)=>(0,n.jsx)(x.I.blockQuote,{children:t(e.content,s)})},list:{...o.list,react:(e,t,s)=>{let a=e.ordered?x.I.ol:x.I.ul;return(0,n.jsx)(a,{children:e.items.map((e,a)=>(0,n.jsx)(x.I.li,{children:t(e,s)},a))},s.key)}},newline:o.newline,paragraph:{...o.paragraph,react:(e,t,s)=>(0,n.jsx)(x.I.p,{children:t(e.content,s)},s.key)},u:o.u,del:o.del,inlineCode:{...o.inlineCode,react:e=>{let t=e.content;if(t&&l.yT.test(t)){var s;if((null==(s=t.match(l.yT))?void 0:s[0])===t)return(0,n.jsxs)(x.I.code,{children:[(0,n.jsx)("span",{style:{display:"inline-block",verticalAlign:"middle",position:"relative",top:"-0.15em"},children:(0,n.jsx)(l.qU,{color:t})}),t]})}return(0,n.jsx)(x.I.code,{children:t})}},text:{...o.text,react:e=>(0,l.fz)(e.content)}},url:o.url,link:{...o.link,match:(e,t)=>null,react:e=>{let t=e.target;return(0,n.jsx)("a",{href:t,target:"_blank",className:"underline",children:t})}},em:o.em,strong:o.strong},g=(e,t)=>c(t)(e,{inline:!1}),p=(0,i.memo)(e=>{let{text:t}=e,s=g(t,h);return f(h)(s)});p.displayName="AnthropicMarkDown";var v=s(7409),j=s(33200),b=s(90510),y=s(41417),w=s(27062),_=s(4705),C=s(82015),N=s(38583),k=s(46760),M=s(62971),A=s(5081);function S(){let e=(0,a._)(["\n  flex flex-row gap-1 rounded-md p-2 text-xs select-none -mx-1 mb-1 mt-4 outline outline-1 text-text-100\n"]);return S=function(){return e},e}function E(){let e=(0,a._)(["\n  bg-bg-300/80 text-text-300 outline-bg-400/80\n"]);return E=function(){return e},e}function z(){let e=(0,a._)(["\n  bg-accent-secondary-200/20 outline-accent-secondary-200/30\n"]);return z=function(){return e},e}function I(){let e=(0,a._)(["\n  cursor-pointer items-center bg-danger-900/50 hover:bg-danger-900/75 transition group/banner outline-danger-000/25 hover:outline-danger-000/50\n"]);return I=function(){return e},e}let R=b.J.div(S()),F=(0,b.J)(R)(E()),T=(0,b.J)(R)(z()),U=(0,b.J)(R)(I()),L=(0,i.memo)(function(e){let{message:t,messageWarningPropsFromParent:s,hasLink:a,hasCode:l,hasDriveDocWithImages:r,onRetry:o,onSendContinue:c,conversationSettings:d,isLastMessage:u}=e,m=(0,k.A)(),{value:f}=(0,j.N)(null!=d?d:{}),x=null==d?void 0:d.enabled_web_search,{value:h}=(0,w.fS)("claudeai_web_search"),g=(0,i.useMemo)(()=>({a:e=>{let{node:t,...s}=e;return(0,n.jsx)("a",{...s,className:"underline"})}}),[]);if((null==s?void 0:s.style)==="prominent")return(0,n.jsxs)(T,{"data-testid":"message-warning",children:[(0,n.jsx)(_.N,{className:"shrink-0",size:16}),(0,n.jsx)(A.o,{components:g,children:s.contentMarkdown})]});let p="human"===t.sender;if(!p&&"error"===t.stop_reason&&o)return(0,n.jsxs)(U,{"data-testid":"message-warning",onClick:()=>o(t.parent_message_uuid),children:[(0,n.jsxs)("div",{className:"relative h-4 w-4 shrink-0 text-danger-000",children:[(0,n.jsx)(_.N,{className:"absolute inset-0 group-hover/banner:opacity-0 group-hover/banner:scale-75  opacity-50 transition",size:16}),(0,n.jsx)(C.o,{className:"absolute inset-0 group-hover/banner:opacity-75 group-hover/banner:rotate-0 rotate-[20deg] opacity-0 transition",size:16})]}),(0,n.jsx)("div",{className:"flex flex-grow text-danger-000",children:(0,n.jsx)(M.A,{defaultMessage:"This response didn’t load. Try again by chatting to Claude.",id:"g0FIIo0clM"})})]});if(!p&&u&&"max_tokens"===t.stop_reason&&c)return(0,n.jsx)(F,{"data-testid":"message-warning",children:(0,n.jsxs)("div",{className:"flex max-sm:flex-col gap-2 w-full",children:[(0,n.jsxs)("div",{className:"flex items-start gap-2",children:[(0,n.jsx)(N.R,{className:"shrink-0",size:16}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(M.A,{defaultMessage:"This response paused because Claude reached its max length for a message. Hit continue to nudge Claude along.",id:"oje9UAHUmL"})})]}),(0,n.jsx)("div",{className:"ml-6",children:(0,n.jsx)(y.$,{variant:"secondary",size:"sm",className:"block flex-shrink-0",onClick:()=>null==c?void 0:c(),"aria-label":m.formatMessage({defaultMessage:"Continue",id:"acrOozm08x"}),children:(0,n.jsx)(M.A,{defaultMessage:"Continue",id:"acrOozm08x"})})})]})});let v=[];return(p?(a&&!x&&(h?v.push(m.formatMessage({defaultMessage:"Claude does not have internet access enabled. Enable web search to get up to date info from web links.",id:"fPI2JySdII"})):v.push(m.formatMessage({defaultMessage:"Claude does not have internet access and cannot get up to date info from web links.",id:"SXpasVsDUZ"}))),r&&v.push(m.formatMessage({defaultMessage:"Claude cannot yet access images from Google Docs.",id:"8Wb1yCJBBv"}))):(a&&!x&&(h?v.push(m.formatMessage({defaultMessage:"Claude does not have internet access enabled. Enable web search for up to date and accurate links.",id:"sN35Yf2Rzl"})):v.push(m.formatMessage({defaultMessage:"Claude does not have internet access. Links provided may not be accurate or up to date.",id:"c8NyKXBwfo"}))),l&&!f&&v.push(m.formatMessage({defaultMessage:"Claude does not have the ability to run the code it generates yet.",id:"dSVZQBKb/U"})),t.stop_reason,"conversation_length_limit"===t.stop_reason&&v.push(m.formatMessage({defaultMessage:"Claude hit the maximum length for this conversation. Please start a new conversation to continue chatting with Claude.",id:"jujWu4WTLz"})),s&&v.push(s.contentMarkdown)),0===v.length)?null:(0,n.jsxs)(F,{"data-testid":"message-warning",children:[(0,n.jsx)(N.R,{className:"shrink-0",size:16}),(0,n.jsx)(A.o,{components:g,children:v.reverse().join(" ")})]})});var D=s(9946),O=s(74610),P=s(1761),B=s(93877),W=s(9537),G=s(54890),J=s(92007),H=s(77101),V=s(65721),Y=s(21036),K=s(32987),Z=s(37463),q=s(85717),X=s(47546),Q=s(85644),$=s(2341),ee=s(9786),et=s(53248),es=s(7196),ea=s(69307),en=s(62094),ei=s(49645),el=s(75006),er=s(92075),eo=s(45078),ec=s(57383),ed=s(77186);let eu=(e,t)=>{let{activeOrganization:s}=(0,P.YL)(),a=null==s?void 0:s.uuid;return(0,ed.L2)("/api/organizations/".concat(a,"/chat_conversations/").concat(e,"/chat_messages/").concat(t,"/debug"),"POST")};var em=s(89697),ef=s(70011),ex=s(56370),eh=s(18179),eg=s(37076),ep=s(96377),ev=s(92479),ej=s(22126);function eb(e){let{isOpen:t,onClose:s,conversationUUID:a,messageUUID:i,text:l}=e;return(0,n.jsx)(eg.aF,{isOpen:t,onClose:s,modalSize:"xl",hasCloseButton:!0,children:(0,n.jsx)(ey,{conversationUUID:a,messageUUID:i,text:l})})}function ey(e){let{conversationUUID:t,messageUUID:s,text:a}=e,{data:l,isPending:r,mutateAsync:o}=eu(t,s),{model:c}=(0,ec.o)(),d=(0,eo.vP)("paprika_mode"),u=(0,$.B)(),m=(0,ej.n)(u||{}),{codeStyle:f}=(0,em.V)(),x=l?JSON.stringify(function(e){for(let[t,s]of Object.entries(e.logs.api_usage))if("string"==typeof s)try{let a=JSON.parse(s);e.logs.api_usage[t]=a}catch(e){}return e}(l),null,2):"",h=(0,ef.Z3)(t);(0,i.useEffect)(()=>{(async()=>{await o({prompt:"",model:c||h,tools:m(),personalized_styles:[],paprika_mode:d})})()},[o,c,m,d,h]);let{didCopy:g,copyToClipboard:p}=(0,ee.C)();return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(eg.vW,{layout:"left",children:[(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsxs)("h2",{className:"font-ui tracking-tight text-accent-pro-000 text-xl font-medium",children:[(0,n.jsx)(M.A,{defaultMessage:"Debug information",id:"NqgO+Si31g"}),"\xa0",(0,n.jsx)("span",{className:"ml-1 text-sm font-medium text-danger-000",children:(0,n.jsx)(M.A,{defaultMessage:"FOR INTERNAL USE ONLY",id:"ISVSjyq5f9"})})]})}),(0,n.jsxs)(y.$,{variant:"ghost",onClick:()=>{p(x)},disabled:r,children:[(0,n.jsx)(ee.u,{didCopy:g,size:16,className:"mr-2"}),(0,n.jsx)(M.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})]}),(0,n.jsx)(ew,{text:a})]}),r?(0,n.jsx)("div",{className:"my-2 flex h-full w-full items-center justify-center",children:(0,n.jsx)(eh.Loading,{})}):(0,n.jsx)(ev.A,{customStyle:{maxHeight:"32rem",fontSize:".875rem"},language:"json",PreTag:"div",style:f,children:x})]})}let ew=e=>{let{text:t}=e,{copyToClipboard:s}=(0,ee.C)(),a=(0,k.A)();return(0,n.jsx)(ex.ms,{onCloseAutoFocus:e=>{e.preventDefault()},trigger:(0,n.jsx)(y.$,{variant:"ghost",size:"icon","aria-label":a.formatMessage({defaultMessage:"More options",id:"IzCVhGdYVc"}),children:(0,n.jsx)(ep.H,{size:20})}),children:(0,n.jsx)(ex.tJ,{className:"text-md",onSelect:()=>{s(t)},children:(0,n.jsx)("div",{className:"flex items-center justify-between gap-1",children:(0,n.jsx)("div",{className:"flex grow items-center",children:(0,n.jsx)(M.A,{defaultMessage:"Copy unmodified message",id:"+yNntDpG9W"})})})})})};var e_=s(18527),eC=s(61344),eN=s(18395);function ek(e){var t,s;let{conversationUuid:a,message:l}=e,[r,o]=(0,i.useState)(void 0),[c,d]=(0,i.useState)(!1),u=e=>{"flag"===e?(null==r?void 0:r.startsWith("flag"))||o("flag"):"upvote"!==r&&o("upvote"),d(!0)};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(X.k,{tooltipContent:(0,n.jsx)(M.A,{defaultMessage:"Give positive feedback",id:"FGCv00cdfW"}),onClick:()=>u("upvote"),children:(0,n.jsx)(e_.t,{size:16,weight:(null==(t=l.chat_feedback)?void 0:t.type.includes("upvote"))?"fill":"regular"})}),(0,n.jsx)(X.k,{tooltipContent:(0,n.jsx)(M.A,{defaultMessage:"Give negative feedback",id:"ngzzQUJCXB"}),onClick:()=>u("flag"),children:(0,n.jsx)(eC.S,{size:16,weight:(null==(s=l.chat_feedback)?void 0:s.type.includes("flag"))?"fill":"regular"})}),(0,n.jsx)(eN.B,{conversationUuid:a,message:l,requestedFeedbackType:r,setRequestedFeedbackType:o,isOpen:c,onClose:()=>d(!1)})]})}var eM=s(22529),eA=s(35368),eS=s(99272);function eE(e){let{paprikaMode:t,supportedPaprikaModes:s,onRetry:a,parentMessageUUID:l,setPaprikaModeState:r}=e,[o,c]=(0,i.useState)(!1),d=(0,eA.Wi)().filter(e=>e.paprika_mode_value&&e.paprika_mode_value!==t&&s.includes(e.paprika_mode_value)),u=(0,i.useCallback)((e,t)=>{a(e,t),r(t)},[a,r]);return(0,n.jsxs)(ex.ms,{align:"start",unstyledTrigger:!0,onCloseAutoFocus:e=>e.preventDefault(),open:o,onOpenChange:c,trigger:(0,n.jsxs)(y.$,{variant:"unstyled",size:"unset",className:"flex flex-row items-center gap-1 rounded-md p-2 py-1.5 text-sm transition-opacity delay-100 hover:bg-bg-300 select-none",children:[(0,n.jsx)(M.A,{defaultMessage:"Retry",id:"62nsdyMyIO"}),(0,n.jsx)(eS.a,{size:12,className:"text-text-500 shrink-0"})]}),children:[(0,n.jsx)(ex.tJ,{className:"text-sm",onClick:()=>a(l),children:(0,n.jsx)(M.A,{defaultMessage:"With no changes",id:"h3WdKJh51e"})}),d.map(e=>(0,n.jsx)(ex.tJ,{className:"text-sm",onClick:()=>u(l,e.paprika_mode_value),children:(0,n.jsxs)("div",{children:[(0,n.jsx)("div",{className:"flex flex-col",children:"extended"===e.id?(0,n.jsx)(M.A,{defaultMessage:"With extended thinking",id:"/zFAxhC9JS",description:"Lets the user try again using a different thinking mode"}):"With ".concat(e.title.toLowerCase()," thinking")}),(0,n.jsx)("div",{className:"text-text-500 text-xs",children:e.description_key?(0,n.jsx)(eM.X5,{id:e.description_key}):e.description})]})},e.id))]})}var ez=s(65755);let eI={default:{allowed:"never"}},eR=el.z.record(el.z.object({allowed:el.z.enum(["never","first_turn","always"])}));function eF(e){var t,s,a,l,r,o,c,d;let{message:u,conversationUUID:m,isStreaming:f,onRetry:x,isLastMessage:h,isLastHumanMessage:g=!1,isInteractive:p=!0,changeDisplayedConversationPath:v,editMessage:j,isFirstAssistantMessage:b,isResearchPending:y}=e,[_,C]=(0,i.useState)(!1),N=null!=(r=null==(t=(0,$.B)())?void 0:t.preview_feature_uses_artifacts)&&r,k="human"===u.sender,A="assistant"===u.sender,S=f&&h,{value:E}=(0,w.fS)("anthropic_internal_only_expose_chat_debug"),z=!f&&(null!=(o=u.nOptions)?o:0)>1&&v,I=!f&&!y&&j&&u.parent_message_uuid&&p,R=null==u||null==(s=u.content)?void 0:s.some(e=>"tool_use"===e.type&&"end_conversation"===e.name),F=!f&&!y&&p&&!R,T=(0,et.C)(u),{didCopy:U,copyToClipboard:L}=(0,ee.C)(),D=async()=>{let e=(N?(0,G.it)(T):T).trim();try{let t=(0,ez.u)(e);await L({text:e,html:t})}catch(t){await L(e)}},O=(0,er.QY)(),{toggleConversationSetting:P}=(0,eo.rX)(),B=(0,eo.vP)("paprika_mode"),{model:W}=(0,ec.o)(),{allModelOptions:J}=(0,Q.A9)(),H=(0,w.iW)("claude_ai_paprika_retry",eI,eR),V=null!=(d=null!=(c=W&&(null==(a=H[W])?void 0:a.allowed))?c:null==(l=H.default)?void 0:l.allowed)?d:"never";if(k&&!I&&!z)return null;let Y=J.find(e=>e.model===W),K=null==Y?void 0:Y.paprika_modes,Z=K&&K.length>0&&!B&&("always"===V||"first_turn"===V&&b);return(0,n.jsx)(eT,{isStreaming:S,isLastMessage:h||g,isInteractive:p,isAssistant:A,children:(0,n.jsxs)("div",{className:"text-text-300 flex items-stretch justify-between",children:[A&&E&&(0,n.jsx)(X.k,{Icon:es.I,tooltipContent:(0,n.jsxs)("div",{className:"flex items-center gap-1.5",children:[(0,n.jsx)(M.A,{defaultMessage:"Debug",id:"z3UjXRZwzQ"}),(0,n.jsx)("div",{className:"px-1 py-px -mr-0.5 text-xs bg-always-white/20 rounded",children:(0,n.jsx)(M.A,{defaultMessage:"Internal",id:"2KtWqT5Nl+"})})]}),onClick:()=>C(!0),isAssistant:A}),A&&E&&(0,n.jsx)(eb,{isOpen:_,onClose:()=>C(!1),messageUUID:u.uuid,text:T,conversationUUID:m}),k&&I&&(0,n.jsx)(X.k,{onClick:()=>j(u,"test edit message"),isAssistant:A,children:(0,n.jsx)(M.A,{defaultMessage:"Edit",id:"wEQDC6Wv3/"})}),A&&(0,n.jsx)(X.k,{tooltipContent:(0,n.jsx)(M.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"}),onClick:D,isAssistant:A,children:(0,n.jsx)("div",{children:(0,n.jsx)(ee.u,{size:16,"data-testid":"action-bar-copy",didCopy:U})})}),A&&!S&&!y&&p&&"error"!==u.stop_reason&&O&&(0,n.jsx)(ek,{conversationUuid:m,message:u}),(0,n.jsxs)("div",{className:"flex items-center gap-0.5",children:[z&&(0,n.jsx)(eU,{message:u,changeDisplayedConversationPath:v,isAssistant:A}),A&&F&&(Z?(0,n.jsx)(eE,{paprikaMode:B,supportedPaprikaModes:K,onRetry:x,parentMessageUUID:u.parent_message_uuid,setPaprikaModeState:e=>{P("paprika_mode",null!=e?e:null)}}):(0,n.jsx)(X.k,{onClick:()=>x(u.parent_message_uuid),isAssistant:A,children:(0,n.jsx)(M.A,{defaultMessage:"Retry",id:"62nsdyMyIO"})}))]})]})})}let eT=e=>{let{isStreaming:t,isLastMessage:s,isInteractive:a,isAssistant:i,children:l}=e;return(0,n.jsx)(ei.N,{children:!t&&(0,n.jsx)(Z.P.div,{className:"absolute bottom-0 right-2 pointer-events-none",initial:{scale:.95},animate:{scale:1},transition:{type:"spring",damping:30,stiffness:400},children:(0,n.jsx)("div",{className:(0,K.A)("rounded-lg transition min-w-max pointer-events-auto",!i&&"translate-y-4 bg-bg-300/90 backdrop-blur-sm translate-x-1 group-hover:translate-x-0.5 border-0.5 border-border-300 p-0.5 shadow-sm",i&&"translate-x-2",s?"translate-y-full pt-2":"opacity-0 group-hover:opacity-100"),children:l})})})};function eU(e){var t;let{message:s,changeDisplayedConversationPath:a,isAssistant:i}=e,l=(null!=(t=s.selectedOption)?t:0)+1,r=l===s.nOptions;return(0,n.jsxs)("div",{className:"flex text-xs",children:[(0,n.jsx)(X.k,{className:(0,K.A)("px-0.5 mr-1",1===l&&"opacity-50 pointer-events-none"),onClick:()=>a(s,-1),isAssistant:i,children:(0,n.jsx)(ea.Z,{})}),(0,n.jsx)("span",{className:"self-center shrink-0 select-none",children:(0,n.jsx)(M.A,{defaultMessage:"{selectedOption} / {totalOptions}",id:"0zCqdBEnn7",values:{selectedOption:l,totalOptions:s.nOptions}})}),(0,n.jsx)(X.k,{className:(0,K.A)("px-0.5 ml-1",r&&"opacity-50 pointer-events-none"),onClick:()=>a(s,1),isAssistant:i,children:(0,n.jsx)(en.K,{})})]})}var eL=s(98518),eD=s(34059),eO=s(83848);let eP=()=>{let e=(0,eL.st)(),{initDriveAuth:t}=(0,q.cI)({});return(0,n.jsx)(eB,{title:(0,n.jsx)(M.A,{defaultMessage:"Add context from all your docs more easily",id:"gHPka72Ai9"}),icon:(0,n.jsx)(eO.g,{size:18}),cta:(0,n.jsxs)(y.$,{className:"bg-bg-100 border-border-300",size:"sm",variant:"outline",onClick:()=>{e.track({event_key:"claudeai.in_chat_upsell.connect_gdrive.start"}),t()},children:[(0,n.jsx)(eD.ft,{size:16,className:"mr-1"}),(0,n.jsx)(M.A,{defaultMessage:"Connect Drive",id:"XzTB2bvNw1"})]})})},eB=e=>{let{title:t,icon:s,cta:a}=e;return(0,n.jsx)(Z.P.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},exit:{opacity:0,y:-10},transition:{duration:.3},className:"mt-3",children:(0,n.jsx)("div",{className:"overflow-hidden rounded-lg border-0.5 border-border-300 bg-bg-100 shadow-sm",children:(0,n.jsx)("div",{className:"px-2.5 py-2.5",children:(0,n.jsxs)("div",{className:"flex items-center justify-between gap-3",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1",children:[(0,n.jsx)("div",{className:"rounded-lg bg-primary-100 p-1",children:s}),(0,n.jsx)("h3",{className:"text-sm text-text-100",children:t})]}),a]})})})})},eW=e=>{let{previousMessage:t}=e,s=(0,q.LP)(),{isDriveAuthenticated:a}=(0,q.cI)({}),l=(0,i.useMemo)(()=>!!t&&t.attachments.some(e=>"docx"===e.file_type),[t]),{value:r}=(0,w.fS)("pumpernickel_enabled");return r&&s&&!a&&l?(0,n.jsx)(eP,{}):null},eG=e=>{let{title:t,text:s}=e,a=(0,k.A)();t=t||a.formatMessage({defaultMessage:"Untitled note",id:"fkEfiUjl/t"}),s=s||"";let{didCopy:i,copyToClipboard:l}=(0,ee.C)(),r=async()=>{let e=t+"\n"+s;try{let t=(0,ez.u)(e);await l({text:e,html:t})}catch(t){await l(e)}};return(0,n.jsxs)("div",{className:"group relative mt-4 mb-1 rounded-2xl border-border-300/25 border font-claude-message",children:[(0,n.jsxs)("div",{className:"pt-1 pb-1 px-3 border-b-0.5 border-border-300/25 font-semibold flex justify-between items-center",children:[(0,n.jsx)("span",{className:"flex-1",children:t}),(0,n.jsx)(y.$,{variant:"ghost",size:"icon_sm",onClick:r,children:(0,n.jsx)(ee.u,{didCopy:i,size:16})})]}),(0,n.jsx)(A.o,{className:"px-4 pt-2 pb-4",children:s})]})};var eJ=s(38715),eH=s(57067),eV=s(25243);let eY=e=>{let{size:t=32,className:s}=e;return(0,n.jsxs)("svg",{width:t,height:t,viewBox:"0 0 32 32",fill:"none",xmlns:"http://www.w3.org/2000/svg",className:s,children:[(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M14.0121 5.17898C14.6561 5.0615 15.3204 5 16 5C22.0751 5 27 9.92487 27 16C27 22.0751 22.0751 27 16 27C15.8588 27 15.7183 26.9973 15.5785 26.9921C15.0266 26.9713 14.5624 27.4019 14.5416 27.9538C14.5209 28.5057 14.9514 28.9699 15.5033 28.9907C15.6681 28.9969 15.8337 29 16 29C23.1797 29 29 23.1797 29 16C29 8.8203 23.1797 3 16 3C15.1995 3 14.4151 3.07246 13.6532 3.21144C13.1099 3.31055 12.7498 3.83134 12.8489 4.37466C12.948 4.91798 13.4688 5.27808 14.0121 5.17898ZM10.6328 5.5356C10.556 5.24904 10.396 4.99168 10.1729 4.79607C9.94988 4.60046 9.67384 4.47539 9.3797 4.43667C9.08557 4.39794 8.78656 4.44731 8.52048 4.57852C8.25441 4.70974 8.03321 4.91691 7.88488 5.17383C7.73654 5.43076 7.66772 5.7259 7.68713 6.02194C7.70653 6.31797 7.81328 6.60161 7.99389 6.83697C8.17449 7.07234 8.42083 7.24886 8.70176 7.34423C8.98268 7.43959 9.28558 7.4495 9.57214 7.37272C9.95641 7.26976 10.284 7.01836 10.483 6.67383C10.6819 6.3293 10.7358 5.91987 10.6328 5.5356ZM6.60273 8.85853C6.82578 9.05414 6.98581 9.3115 7.0626 9.59807C7.16556 9.98234 7.11166 10.3918 6.91274 10.7363C6.71383 11.0808 6.3862 11.3322 6.00194 11.4352C5.71537 11.512 5.41248 11.5021 5.13155 11.4067C4.85062 11.3113 4.60428 11.1348 4.42368 10.8994C4.24307 10.6641 4.13632 10.3804 4.11692 10.0844C4.09752 9.78836 4.16633 9.49322 4.31467 9.2363C4.46301 8.97937 4.6842 8.7722 4.95027 8.64099C5.21635 8.50977 5.51536 8.4604 5.8095 8.49913C6.10363 8.53785 6.37968 8.66293 6.60273 8.85853ZM4.86963 13.9817C5.09268 14.1773 5.25272 14.4346 5.3295 14.7212C5.43247 15.1055 5.37857 15.5149 5.17965 15.8594C4.98074 16.2039 4.65311 16.4553 4.26884 16.5583C3.98228 16.6351 3.67938 16.6252 3.39846 16.5298C3.11753 16.4344 2.87119 16.2579 2.69059 16.0226C2.50998 15.7872 2.40323 15.5036 2.38383 15.2075C2.36442 14.9115 2.43324 14.6163 2.58158 14.3594C2.72991 14.1025 2.95111 13.8953 3.21718 13.7641C3.48326 13.6329 3.78227 13.5835 4.07641 13.6223C4.37054 13.661 4.64658 13.786 4.86963 13.9817Z",fill:"currentColor"}),(0,n.jsx)("path",{d:"M15 9.00012V16.0001C15 16.2653 15.1054 16.5197 15.2929 16.7072C15.4804 16.8948 15.7348 17.0001 16 17.0001H23C23.2652 17.0001 23.5196 16.8948 23.7071 16.7072C23.8946 16.5197 24 16.2653 24 16.0001C24 15.7349 23.8946 15.4806 23.7071 15.293C23.5196 15.1055 23.2652 15.0001 23 15.0001H17V9.00012C17 8.73491 16.8946 8.48055 16.7071 8.29302C16.5196 8.10548 16.2652 8.00012 16 8.00012C15.7348 8.00012 15.4804 8.10548 15.2929 8.29302C15.1054 8.48055 15 8.73491 15 9.00012Z",fill:"currentColor"}),(0,n.jsx)("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M8 21C8 20.4477 7.55228 20 7 20C6.44772 20 6 20.4477 6 21V24H3C2.44772 24 2 24.4477 2 25C2 25.5523 2.44772 26 3 26H6V29C6 29.5523 6.44772 30 7 30C7.55228 30 8 29.5523 8 29V26H11C11.5523 26 12 25.5523 12 25C12 24.4477 11.5523 24 11 24H8V21Z",fill:"currentColor"})]})};var eK=s(60045);let eZ=["year","month","day","hour","minute","second","millisecond"],eq=e=>{let{value:t,...s}=e;return function(e,t){let{listStyle:s,...a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},n=eK.dw.fromDurationLike(t);return e.formatList(eZ.filter(e=>0!==n["".concat(e,"s")]).map(t=>e.formatNumber(n["".concat(t,"s")],{...a,style:"unit",unit:t})),{...a,style:s})}((0,k.A)(),t,s)};var eX=s(64039),eQ=s(68864),e$=s(27261),e0=s.n(e$),e1=s(33792),e2=s(94748),e5=s(67532);function e3(){let e=(0,a._)(["\nbg-bg-100 text-text-300 border-0.5 border-border-300 flex flex-row gap-1.5 rounded-md p-2 mx-4 mb-4 font-small"]);return e3=function(){return e},e}function e4(e,t){if(!e)return;let s=(t?eQ.c9.fromISO(t):eQ.c9.now()).diff(eQ.c9.fromISO(e),["hours","minutes","seconds"]);return 0>s.toMillis()?eQ.dw.fromMillis(0):s}let e6=b.J.div(e3()),e7=()=>(0,n.jsxs)(e6,{"data-testid":"message-warning",children:[(0,n.jsx)(eX.R,{className:"shrink-0",size:16}),(0,n.jsx)(M.A,{defaultMessage:"The rest of the <link>thought process</link> is not available for this response.",id:"G/67Pe5XhQ",values:{link:e=>(0,n.jsx)(e0(),{href:"https://support.anthropic.com/en/articles/10574485-using-extended-thinking-on-claude-3-7-sonnet",className:"underline",target:"_blank",children:e})}})]}),e9=e=>{let{text:t,cutOff:s}=e,{value:a}=(0,w.fS)("use_in_house_latex_transformer");return(0,n.jsxs)("div",{className:"text-text-300 text-sm font-normal leading-[21px] gap-0.5 relative font-claude-response",children:[(0,n.jsx)(D.fP,{className:"p-3 pt-0 pr-8",text:t,useInHouseLatexPlugin:a}),!0!==s?null:(0,n.jsx)(e7,{})]})},e8=e=>{let t,{index:s,text:a,cutOff:l=!1,startTimestamp:r,stopTimestamp:o,isStreaming:c,mostRecentSummary:d,onToggle:u,messageUuid:m,isFirstBlockOfMessage:f,isLastBlockOfMessage:x,renderMode:h=e1.l.Standard,isFirstItemInGroup:g,isLastItemInGroup:p}=e,v=(0,Y.useDynamicConfig)("claudeai_isp_thinking_ux"),j=v.get("enabled",!1),b=(0,k.A)(),y=b.formatMessage({defaultMessage:"Thinking",id:"AHQWDTo4+e"}),w=b.formatMessage({defaultMessage:"Thinking...",id:"QrZMdiKa7h"}),_=b.formatMessage({defaultMessage:"Thought process",id:"zl6fNbo7RW"}),{isExpanded:C,setIsExpanded:N,snappyTransition:M}=(0,e5.a)(!j&&c,String(s)),A=(0,eL.st)(),[S,E]=(0,i.useState)(()=>e4(r,o)),z=(0,i.useRef)(void 0),I=(0,i.useRef)(!1),[R,F]=(0,i.useState)(null),T=(0,i.useRef)([]);(0,i.useEffect)(()=>{(0,eH.GN)(m)&&T.current.length>0&&(T.current.forEach(e=>{A.track({event_key:"claudeai.thinking_cell.clicked",is_opening:e.isOpening,is_streaming:e.wasStreamingWhenClicked,chat_message_uuid:m,timestamp:e.timestamp})}),T.current=[])},[m,A]),(0,i.useEffect)(()=>{c&&(I.current=!0)},[c]);let U=c||I.current?v.get("fallback_summary_debounce_ms",2e3):0;(0,eV.W)(()=>{!c&&a.length>0&&F(te(a,v))},[a,c],U),(0,i.useEffect)(()=>{let e=()=>{let e=e4(r,void 0);z.current=e,E(e)};if(c){e();let t=setInterval(e,1e3);return()=>clearInterval(t)}!z.current&&o&&E(e4(r,o))},[r,o,c]);let L=null==d?void 0:d.summary;if(j)if(c)t=null!=L?L:w;else{var D;t=null!=(D=null!=L?L:R)?D:w}else t=null!=L?L:c?y:_;return(0,n.jsx)(e2.sH,{isStreaming:c,isExpanded:C,setIsExpanded:()=>{let e=new Date().toISOString();(0,eH.GN)(m)?A.track({event_key:"claudeai.thinking_cell.clicked",is_opening:!C,is_streaming:c,chat_message_uuid:m,timestamp:e}):T.current.push({isOpening:!C,wasStreamingWhenClicked:c,timestamp:e}),N(!C)},isFirstBlockOfMessage:f,isLastBlockOfMessage:x,text:C?_:c||z.current?(0,n.jsx)(ei.N,{mode:"wait",children:(0,n.jsx)(Z.P.span,{initial:{opacity:0,y:4},animate:{opacity:1,y:0},exit:{opacity:0,y:-4},transition:{duration:.3,ease:"easeIn"},className:j?"text-text-300":"text-left relative text-sm font-claude-response leading-6 whitespace-nowrap text-text-300 text-ellipsis overflow-hidden basis-0 grow min-w-0",children:t},t)}):(0,n.jsx)("span",{className:j?"text-text-300":"text-left relative text-sm font-claude-response leading-6 whitespace-nowrap text-text-300 text-ellipsis overflow-hidden basis-0 grow min-w-0",children:t}),secondaryText:S?(0,n.jsxs)("span",{className:"flex items-center gap-1 transition-opacity",children:[(0,n.jsx)(eY,{className:(0,K.A)("text-text-300 transition-all duration-300 ease-in-out opacity-50",c?"!opacity-0 scale-50":"scale-100 opacity-100"),size:14}),(0,n.jsx)("span",{className:"tabular-nums",children:(0,n.jsx)(eq,{value:S,listStyle:"narrow",unitDisplay:"narrow",maximumFractionDigits:0})})]}):void 0,renderMode:h,isFirstItemInGroup:g,isLastItemInGroup:p,children:(0,n.jsx)(e2.NG,{isExpanded:C,snappyTransition:M,onTransitionEnd:u,isScrollable:!0,children:(0,n.jsx)(e9,{text:a,cutOff:l})})})},te=(e,t)=>{let s=t.get("fallback_summary_min_len",50),a=t.get("fallback_summary_max_len",100),n=new RegExp(t.get("fallback_summary_regex",".*(\\n|\\.(\\s|$)|。)")),i=e.substring(0,a),l=n.exec(i);if(l)return l[0];for(let e=i.length-1;e>=s;e--)if(/\s/.test(i[e]))return i.substring(0,e+1);return i};var tt=s(56326),ts=s(11480);function ta(){let e=(0,a._)(["\n  group\n  relative\n  inline-flex\n  gap-2\n  bg-bg-300\n  rounded-xl\n  pl-2.5\n  py-2.5\n  break-words\n  text-text-100\n  transition-all\n  max-w-[75ch]\n  flex-col\n"]);return ta=function(){return e},e}function tn(){let e=(0,a._)(["\n  group\n  relative\n  -tracking-[0.015em]\n"]);return tn=function(){return e},e}function ti(){let e=(0,a._)(["\n  font-claude-message\n  relative\n  leading-[1.65rem]\n  [&_pre>div]:bg-bg-000/50\n  [&_pre>div]:border-0.5\n  [&_pre>div]:border-border-400\n  [&_.ignore-pre-bg>div]:bg-transparent\n  [&>div>div>:is(p,blockquote,h1,h2,h3,h4,h5,h6)]:pl-2\n  [&>div>div>:is(p,blockquote,ul,ol,h1,h2,h3,h4,h5,h6)]:pr-8\n"]);return ti=function(){return e},e}let tl={initial:!1,animate:{y:0,opacity:1}},tr={initial:{y:10,opacity:0},animate:{y:0,opacity:1},transition:{type:"spring",damping:10,stiffness:100}},to={initial:{scale:1.02,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.3,ease:"easeOut"}},tc={initial:{height:"0px",opacity:0},animate:{height:"auto",opacity:1},transition:{ease:"linear",duration:.1}},td=[],tu=e=>{let t=e.match(/"id"\s*:\s*"([^"]*)"/);return t?t[1]:void 0},tm=(e,t,s)=>{var a,n,i,l;let r,o,c,d=(null==t?void 0:t.type)==="tool_use"&&(null==t?void 0:t.name)==="artifacts",u=(null==e?void 0:e.type)==="tool_use"&&(null==e?void 0:e.name)==="artifacts";s.partial_json?s.partial_json.includes('"command":"create"')&&(r=tu(s.partial_json)):r=null==(n=s.input)?void 0:n.id,u&&(o=null==e||null==(i=e.input)?void 0:i.id),!d||(null==t?void 0:t.partial_json)||(c=null==t||null==(l=t.input)?void 0:l.id);let m=r===o,f=r===c,x="individual_cell_create",h=null==(a=s.input)?void 0:a.command;if(h&&(x=({create:"individual_cell_create",update:"individual_cell_update",rewrite:"individual_cell_rewrite"})[h]),!d&&!u)return x;if(d&&u)if(!m&&!f)return x;else if(m&&!f)return"multi_edit_last";else return"multi_edit_not_last";if(d&&!u)if(!f)return x;else return"multi_edit_not_last";if(!d&&u&&m)return"multi_edit_last";return x},tf=(e,t)=>{let s=(0,J.n)(),a=(0,i.useCallback)(e=>{if("text"!==e.type)return e;let a=e.text;return s&&e.citations&&e.citations.length>0&&(a=(0,O.k0)(e.citations,a)),a=t?(0,G.Tm)(a):(0,G.it)(a),{...e,text:a}},[t,s]);return(0,i.useMemo)(()=>{var t;let s=e.content,n=null==(t=e.content)?void 0:t[0];(null==n?void 0:n.type)==="text"&&""===n.text.trim()&&(s=null==s?void 0:s.slice(1));let i=(null==s?void 0:s.map(e=>a(e)))||[];return{...e,content:i}},[e,a])},tx=e=>{var t,s,a;let{block:l,message:r,updatedMessage:o,index:c,isShared:d,isStreaming:u,isLastMessage:m,publishedArtifacts:f,isFirstBlockOfMessage:x,isLastBlockOfMessage:h,renderMode:g,isFirstItemInGroup:p,isLastItemInGroup:v}=e,{renderToolUseCell:j}=(0,tt.Q)(),b=(0,V.Y)(l),y=l.name,w=l.id,_=l.context,C=null==(t=o.content)?void 0:t[c+1],N=(null==C?void 0:C.type)==="tool_result"?C:void 0,k={integrationName:l.integration_name,integrationIcon:l.integration_icon_url,message:(null==N?void 0:N.message)||l.message,input:l.display_content,result:null==N?void 0:N.display_content},M=!!o.content&&o.content.length<=c+1&&u,A=tm(null==(s=o.content)?void 0:s[c-2],null==(a=o.content)?void 0:a[c+2],l);if(!j)throw Error("renderToolUseCell() is not provided, missing ChatMessageContext?");let S=j({toolUseId:w,input:b,isLastMessage:m,message:r,publishedArtifacts:f,isStreaming:M,toolName:y,toolResult:N,displayData:k,artifactCellType:A,isFirstBlockOfMessage:x,isLastBlockOfMessage:h,isShared:d,context:_,renderMode:g,groupItemKey:String(c),isFirstItemInGroup:p,isLastItemInGroup:v});return(0,n.jsx)(i.Fragment,{children:S})},th=e=>{var t,s,a;let{isStreaming:l,currentEdit:r,setCurrentEdit:o,textAreaRef:c,finishEdit:d,cancelEdit:u,author:m,loggedInAccount:f,message:x,selectAttachment:h,showSharedImageMissing:g=!1,showSharedFileMissing:p=!1}=e;(0,i.useEffect)(()=>{let e=e=>{if("Enter"!==e.key||e.shiftKey||(e.preventDefault(),d()),"Escape"===e.key&&(e.preventDefault(),u()),"a"===e.key&&(e.metaKey||e.ctrlKey)&&document.activeElement===c.current){var t;null==(t=c.current)||t.select()}};return document.addEventListener("keydown",e),()=>document.removeEventListener("keydown",e)},[d,u,c]);let j=null!=(a=x.files_v2)?a:x.files,b=g||p||x.attachments.length+j.length+((null==x||null==(t=x.sync_sources)?void 0:t.length)||0)>0;return(0,n.jsxs)("form",{onSubmit:e=>{e.preventDefault(),d()},children:[b&&(0,n.jsxs)("div",{className:"mx-0.5 mb-3 flex flex-wrap gap-0.5",children:[j.map((e,t)=>(0,n.jsx)(v.NM,{size:"lg",file:e},t)),x.attachments.map((e,t)=>(0,n.jsx)(v.NM,{size:"lg",file:e,onClick:()=>null==h?void 0:h(e)},t)),null==x||null==(s=x.sync_sources)?void 0:s.map(e=>(0,n.jsx)(eJ.V,{uuid:e.uuid,syncSource:e},e.uuid)),g&&(0,n.jsx)(v.sv,{}),p&&!g&&(0,n.jsx)(v.lD,{})]}),(0,n.jsx)(tv,{...l?to:tl,className:"w-full",children:(0,n.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,n.jsx)("div",{className:"flex shrink-0 items-center",children:(0,n.jsx)(B.e,{name:m||(null==f?void 0:f.full_name)||"",size:"sm"})}),(0,n.jsxs)("div",{className:"font-user-message mr-3 grid w-full grid-cols-1 gap-2 py-0.5 text-[0.9375rem] leading-6",children:[(0,n.jsx)(W.fs,{value:r,onChange:e=>o(e.target.value),autoFocus:!0,className:"w-full",ref:c}),(0,n.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,n.jsxs)("div",{className:"text-text-300 flex flex-row items-center gap-2 text-xs",children:[(0,n.jsx)(N.R,{"aria-hidden":"true",className:"shrink-0"}),(0,n.jsx)("div",{children:(0,n.jsx)(M.A,{defaultMessage:"Editing this message will create a new conversation branch. You can switch between branches using the arrow navigation buttons.",id:"zqkUZeVH+L"})})]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(y.$,{onClick:u,variant:"secondary",children:(0,n.jsx)(M.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,n.jsx)(y.$,{type:"submit",disabled:0===r.length,children:(0,n.jsx)(M.A,{defaultMessage:"Save",id:"jvo0vs3nF0"})})]})]})]})]})})]})},tg=(0,i.memo)(function(e){var t,s,a,l,r,o,c;let{lastHumanMessageRef:d,lastAssistantMessageRef:u,isLastMessage:m,isLastHumanMessage:f,selectAttachment:x,author:h,isInteractive:g=!0,onOpenArtifact:j,onResize:b,editable:y,conversationSettings:_,publishedArtifacts:C=td,messageWarningProps:N,showSharedImageMissing:k=!1,showSharedFileMissing:M=!1,isFirstAssistantMessage:A,isShared:S,actionEmitter:E,onSendContinue:z,isResearchPending:I=!1,...R}=e,{previousMessage:F,message:T,isStreaming:U,conversationUUID:O}=R,[W,G]=(0,i.useState)(!1),[J,V]=(0,i.useState)(""),X=(0,i.useRef)(null),Q=(0,i.useRef)(1);(0,i.useEffect)(()=>{m||(Q.current+=1)});let $=null!=(c=T.files_v2)?c:T.files,ee=tf(T,j),et="",es=null==(t=ee.content)?void 0:t.find(e=>"text"===e.type);es&&"text"in es&&(et=es.text);let ea=(0,i.useRef)(!1),en=(0,i.useRef)(!1),{account:ei,activeOrganization:el}=(0,P.YL)(),{value:er}=(0,w.fS)("use_in_house_latex_transformer"),eo=(0,i.useCallback)((e,t)=>{null==E||E.emit("retry",{parent_message_uuid:e,paprika_mode:t})},[E]),ec=y?()=>{V(et),G(!0)}:void 0,ed=(0,i.useCallback)(()=>{0!==J.length&&E&&(E.emit("edit",{message:ee,text:J}),G(!1),V(""))},[J,E,ee]),eu=(0,i.useCallback)(e=>null==j?void 0:j(e,ee.uuid),[j,ee.uuid]),em="human"===ee.sender,ef="assistant"===ee.sender,ex=null==(s=ee.content)?void 0:s.some(e=>"text"===e.type&&""!==e.text),eh=m&&U,eg=k||M||ee.attachments.length+$.length+((null==ee||null==(a=ee.sync_sources)?void 0:a.length)||0)>0,ep=(0,i.useMemo)(()=>{var e,t;return null!=(t=null==(e=T.sync_sources)?void 0:e.filter(e=>e.type===H.v8.GDRIVE).map(e=>e.config.uri))?t:[]},[T.sync_sources]),ev=(0,q.qL)(ep),ej=(0,i.useMemo)(()=>ev.some(e=>{let{data:t}=e;return t&&/\[image\d*\]/.test(t.text)}),[ev]),eb="voice"===ee.input_mode||"speech_input"===ee.input_mode,ey=(0,Y.useDynamicConfig)("claudeai_isp_thinking_ux");if(W)return(0,n.jsx)(th,{isStreaming:U,currentEdit:J,setCurrentEdit:V,textAreaRef:X,finishEdit:ed,cancelEdit:()=>{G(!1),V("")},author:h,loggedInAccount:ei,message:ee,selectAttachment:x,showSharedImageMissing:k,showSharedFileMissing:M});let ew=function(e,t,s){let a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e1.l.Standard,l=arguments.length>4&&void 0!==arguments[4]&&arguments[4],r=arguments.length>5&&void 0!==arguments[5]&&arguments[5],o=s[t+1],c=(null==o?void 0:o.type)==="tool_result",d=0===t,u=!!s.length&&t===s.length-1-!!c;if("thinking"===e.type){var f;return(0,n.jsx)(e8,{index:t,text:e.thinking,cutOff:e.cut_off,startTimestamp:e.start_timestamp,stopTimestamp:e.stop_timestamp,isStreaming:eh&&!e.stop_timestamp,mostRecentSummary:null==(f=e.summaries)?void 0:f.at(-1),messageUuid:ee.uuid,onToggle:()=>{b&&b()},isFirstBlockOfMessage:d,isLastBlockOfMessage:u,renderMode:a,isFirstItemInGroup:l,isLastItemInGroup:r},t)}if("tool_use"===e.type)return(0,n.jsx)(tx,{block:e,message:T,updatedMessage:ee,index:t,isShared:S,isStreaming:U,isLastMessage:m,publishedArtifacts:C,isFirstBlockOfMessage:d,isLastBlockOfMessage:u,renderMode:a,isFirstItemInGroup:l,isLastItemInGroup:r},t);if("text"===e.type){if(0===t&&""===e.text)return;return(0,n.jsxs)(i.Fragment,{children:[(0,n.jsx)(D.fP,{text:e.text,blockCitations:e.citations,hasLinkRef:ea,hasCodeRef:en,isStreaming:U,onOpenArtifact:eu,isLastMessage:m,publishedArtifacts:eh?void 0:C,useInHouseLatexPlugin:er,onLinkClick:void 0}),""]},"".concat(t,"-").concat(eh?"streaming":"static"))}};return(0,n.jsxs)("div",{ref:f?d:m?u:null,"data-test-render-count":Q.current,children:[em&&(0,n.jsxs)("div",{className:"mb-1 mt-1",children:[eg&&(0,n.jsxs)("div",{className:"gap-2 mx-0.5 mb-3 flex flex-wrap",children:[$.map((e,t)=>(0,n.jsx)(v.NM,{size:"lg",file:e},t)),ee.attachments.map((e,t)=>(0,n.jsx)(v.NM,{size:"lg",file:e,onClick:()=>null==x?void 0:x(e)},t)),null==ee||null==(l=ee.sync_sources)?void 0:l.map(e=>(0,n.jsx)(eJ.V,{uuid:e.uuid,syncSource:e},e.uuid)),k&&(0,n.jsx)(v.sv,{}),M&&!k&&(0,n.jsx)(v.lD,{})]}),(0,n.jsxs)(tv,{className:ex?"pr-6":"pr-[2.5px]",...U?to:tl,children:[(0,n.jsxs)("div",{className:"flex flex-row gap-2",children:[(0,n.jsx)("div",{className:"shrink-0",children:(0,n.jsx)(B.e,{name:h||(null==ei?void 0:ei.full_name)||"",size:"sm"})}),(0,n.jsx)("div",{"data-testid":"user-message",className:(0,K.A)("font-user-message grid grid-cols-1 gap-2 py-0.5 text-[0.9375rem] leading-6 tracking-tight",{italic:eb}),children:null==(r=ee.content)?void 0:r.map((e,t)=>"text"!==e.type?null:(0,n.jsx)(p,{text:e.text},t))})]}),(0,n.jsx)(L,{message:T,isLastMessage:m,hasLink:ea.current,hasDriveDocWithImages:ej,conversationSettings:_,messageWarningPropsFromParent:N}),(0,n.jsx)(eF,{isLastMessage:m,isInteractive:g,editMessage:ec,onRetry:eo,isResearchPending:I,...R})]})]}),ef&&(0,n.jsx)(n.Fragment,{children:ee.content&&ee.content[0]&&(0,n.jsx)(Z.P.div,{style:{height:"auto"},...U?tc:tl,children:(0,n.jsxs)(tj,{"data-is-streaming":eh,...U?tr:tl,className:m?"pb-3":"pb-8",children:[(0,n.jsx)(tb,{children:(()=>{let e=ee.content,t=[],s=Array(e.length).fill(!1);for(let a=0;a<e.length;a++){let i,l=e[a],r=[],o=!1;if(ey.get("timeline_enabled",!1)&&(0,ts.Ih)(l,ey)){if(r.push([l,a,(0,ts.h4)(l)]),s[a])continue;for(let t=a+1;t<e.length;t++){let s=e[t];if(!(0,ts.Ih)(s,ey))break;r.push([s,t,(0,ts.h4)(s)]),t===e.length-1&&(o=!0)}}if(ey.get("timeline_artifacts_enabled",!1)){let e=r.findLastIndex(e=>{let[t]=e;return"tool_use"===t.type&&"artifacts"===t.name});if(e>=0){r=r.slice(0,e);for(let e=0;e<r.length;e++){let t=r[e],s=t[0];"tool_use"===s.type&&"artifacts"===s.name&&(t[2]=!1)}}}let c=0;for(let[,,e]of r)e&&c++;c>1?(r.forEach(e=>{let[,t]=e;s[t]=!0}),i=(0,n.jsx)(ts.DT,{isFirstBlockOfMessage:0===a,isLastBlockOfMessage:o,isStreaming:U,children:r.map((t,s)=>{let[a,n,i]=t;if(i)return ew(a,n,e,e1.l.TimelineGroup,0===s,s===r.length-1)})},"group-".concat(a))):i=ew(l,a,e),t.push(i)}return t})()}),null==(o=ee.content)?void 0:o.map((e,t)=>{if("bell"===e.type||"voice_note"===e.type)return(0,n.jsx)(eG,{text:e.text,title:e.title},t)}),!U&&m&&(0,n.jsx)(eW,{previousMessage:F}),(0,n.jsx)(eF,{isLastMessage:m,isInteractive:g,isFirstAssistantMessage:A,onRetry:eo,isResearchPending:I,...R}),(0,n.jsx)(L,{message:T,isLastMessage:m,messageWarningPropsFromParent:N,conversationSettings:_,hasLink:ea.current,hasCode:en.current,onRetry:eo,onSendContinue:z})]})})})]})}),tp=()=>(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"animate-pulse flex flex-col gap-8 fade-out-bottom",children:[(0,n.jsx)(tv,{children:(0,n.jsx)("div",{className:(0,K.A)("rounded-full h-7 w-7 bg-text-200 opacity-40")})}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 px-2",children:[(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-10/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-4/12"})]}),(0,n.jsxs)("div",{className:"flex flex-col gap-2 px-2",children:[(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-10/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-9/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-11/12"}),(0,n.jsx)("div",{className:"h-4 rounded-sm bg-bg-300 w-4/12"})]})]})}),tv=(0,b.J)(Z.P.div)(ta()),tj=(0,b.J)(Z.P.div)(tn()),tb=b.J.div(ti())},8681:(e,t,s)=>{"use strict";s.d(t,{K:()=>j,r:()=>y});var a=s(54568),n=s(8027),i=s(11515),l=s(33395),r=s(34059),o=s(59815),c=s(45893);let d=e=>(0,a.jsx)(c.z,{...e,children:(0,a.jsxs)("g",{transform:"scale(1.25) translate(-2, -2)",children:[(0,a.jsx)("path",{d:"M12.9609 9.37334C13.0586 9.14501 13.3232 9.03857 13.5515 9.13603C13.7799 9.23376 13.8863 9.49828 13.7888 9.72666C13.4654 10.4824 12.8479 11.125 12.0249 11.125C11.4734 11.125 11.0151 10.836 10.6749 10.4184C10.3347 10.836 9.87636 11.125 9.32488 11.125C8.77339 11.125 8.31509 10.836 7.97488 10.4184C7.63467 10.836 7.17636 11.125 6.62488 11.125C6.37635 11.125 6.17488 10.9235 6.17488 10.675C6.17488 10.4265 6.37635 10.225 6.62488 10.225C6.92876 10.225 7.30391 9.9735 7.56091 9.37334L7.59168 9.31357C7.67276 9.18209 7.81729 9.1 7.97488 9.1C8.15497 9.1 8.31798 9.20778 8.38884 9.37334L8.48992 9.58164C8.73812 10.0323 9.05886 10.225 9.32488 10.225C9.62876 10.225 10.0039 9.9735 10.2609 9.37334L10.2917 9.31357C10.3728 9.18209 10.5173 9.1 10.6749 9.1C10.855 9.1 11.018 9.20778 11.0888 9.37334L11.1899 9.58164C11.4381 10.0323 11.7589 10.225 12.0249 10.225C12.3288 10.225 12.7039 9.9735 12.9609 9.37334Z",fill:"currentColor"}),(0,a.jsx)("path",{d:"M16.7499 10C16.7499 6.27208 13.7278 3.25 9.99988 3.25C6.4232 3.25 3.49625 6.03184 3.26465 9.54991C3.24832 9.7979 3.45135 10 3.69988 10C3.94841 10 4.14808 9.79782 4.16693 9.55001C4.39671 6.5294 6.92042 4.15 9.99988 4.15C13.2307 4.15 15.8499 6.76913 15.8499 10C15.8499 13.2309 13.2307 15.85 9.99988 15.85H4.78621C4.85565 15.7806 5.24756 15.3856 5.53165 15.0992C5.70048 14.9289 5.70517 14.6559 5.54229 14.48C5.36948 14.2933 5.07604 14.288 4.89662 14.4683L3.47793 15.894C3.24868 16.1244 3.24862 16.4967 3.4778 16.7272L4.86559 18.1227C5.04896 18.3071 5.34863 18.3029 5.52673 18.1134C5.6975 17.9318 5.69238 17.6471 5.51519 17.4717L4.78621 16.75H9.99988C13.7278 16.75 16.7499 13.7279 16.7499 10Z",fill:"currentColor"})]})});var u=s(77101),m=s(83910),f=s(32987),x=s(37463),h=s(46760),g=s(55563),p=s(94748),v=s(67532);function j(e){var t,s,n;let i,{integrationName:l,icon:r,integrationIcon:o,message:c,result:d,isStreaming:u,isError:m,isExpandingDisabled:f,isFirstBlockOfMessage:x,isLastBlockOfMessage:g,wrapperClassName:j,contentClassName:b,defaultExpanded:N=!1,toolName:k,renderMode:M,groupItemKey:A,isFirstItemInGroup:S,isLastItemInGroup:E}=e,z=(0,h.A)(),{isExpanded:I,setIsExpanded:R}=(0,v.a)(N,A),F=!!d&&!f&&!u&&("rich_content"!==d.type||(null==(t=d.content)?void 0:t.length)>0);return i=d?"rich_content"===d.type?z.formatMessage({defaultMessage:"{count, plural, one {# result} other {# results}}",id:"s88ium+h8p"},{count:null!=(n=null==(s=d.content)?void 0:s.length)?n:0}):"JSON":void 0,(0,a.jsx)(p.sH,{isError:m,isExpandingDisabled:!F,isExpanded:I,setIsExpanded:R,isStreaming:!!u,text:null!=c?c:u?z.formatMessage({defaultMessage:"Searching",id:"IfE0if3ytt"}):z.formatMessage({defaultMessage:"Searched",id:"0ZuuhwjU4n"}),secondaryText:u?void 0:i,icon:r||(0,a.jsx)(y,{integrationName:l,iconUrl:o,canShowLetterIcon:!0}),isFirstBlockOfMessage:x,isLastBlockOfMessage:g,wrapperClassName:j,renderMode:M,isFirstItemInGroup:S,isLastItemInGroup:E,children:(0,a.jsxs)(p.NG,{isExpanded:I,snappyTransition:!0,isScrollable:!0,className:b,children:[F&&(null==d?void 0:d.type)==="rich_content"&&(0,a.jsx)(w,{disabled:!I||u,result:d,integrationName:l,toolName:k}),F&&(null==d?void 0:d.type)==="table"&&(0,a.jsx)(_,{result:d}),F&&(null==d?void 0:d.type)==="json_block"&&(0,a.jsx)(C,{result:d})]})})}let b=["Google Calendar","Gmail","Google Drive","Search Project Knowledge","Search Past Conversations"],y=e=>{let{canShowLetterIcon:t,integrationName:s,toolName:l,iconUrl:c,size:f=16}=e;switch(s){case"Google Drive":return(0,a.jsx)(r.A9,{type:u.v8.GDRIVE,size:f});case"Google Calendar":return(0,a.jsx)(r.A9,{type:u.v8.GCAL,size:f});case"Gmail":return(0,a.jsx)(r.A9,{type:u.v8.GMAIL,size:f});case"Search Project Knowledge":return(0,a.jsx)(o.J,{vectorSizeOverride:f});case"Search Past Conversations":return(0,a.jsx)(d,{vectorSizeOverride:f})}return(0,a.jsx)(i.d,{fadeInOnLoad:!0,url:c,size:f,fallbackSvg:(s||l)&&t?(0,a.jsx)(n.B,{size:f,letter:s||l}):(0,a.jsx)(m.q,{size:f,className:"text-text-500"})})},w=e=>{let{disabled:t,integrationName:s,result:n,toolName:i}=e,r=i?i.split("").reduce((e,t)=>e+t.charCodeAt(0),0):0,o=!!s&&b.includes(s)&&2039!==r&&2010!==r;return(0,a.jsx)(x.P.div,{variants:{initial:{opacity:0},animate:{opacity:1,transition:{staggerChildren:.05}}},initial:"initial",animate:"animate",className:"flex flex-col flex-nowrap p-2 pt-0",children:n.content.map((e,n)=>{let{title:i,subtitles:r,url:c,resource_type:d,icon_url:u}=e;return(0,a.jsx)(l.$,{disabled:t,icon:o?void 0:(0,a.jsx)(y,{integrationName:s,iconUrl:u}),title:i,subtitles:r,url:c,tag:d},n)})})},_=e=>{let{result:t}=e;return(0,a.jsx)(N,{table:t.table})},C=e=>{let{result:t}=e,s=(0,h.A)();return(0,a.jsx)("div",{className:"flex flex-col gap-3 p-3 pt-1",children:(0,a.jsx)(g.z,{title:s.formatMessage({defaultMessage:"Response",id:"MgdnPiJHcj"}),code:t.json_block})})},N=e=>{let{table:t}=e;return(0,a.jsx)("div",{className:"grid p-2 pt-0",style:{gridTemplateColumns:"1fr 2fr"},children:t.map((e,s)=>{let[n,i]=e;return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{className:(0,f.A)("flex items-center p-2",s<t.length-1&&"border-b-0.5 border-border-300"),children:(0,a.jsx)("p",{className:"font-medium text-text-300 text-xs",children:n})}),(0,a.jsx)("div",{className:(0,f.A)("flex items-center p-2",s<t.length-1&&"border-b-0.5 border-border-300"),children:(0,a.jsx)("p",{className:"text-text-500 text-xs",children:i})})]})})})}},8759:()=>{},9447:(e,t,s)=>{"use strict";s.d(t,{z:()=>m});var a=s(42977),n=s(54568),i=s(90510),l=s(64786),r=s(90119),o=s(32987),c=s(53600);function d(){let e=(0,a._)(["\n  from-bg-100\n  via-bg-100\n  via-65%\n  to-bg-100/0\n  pointer-events-none\n  absolute\n  inset-0\n  -bottom-5\n  z-[-1]\n  bg-gradient-to-b\n  blur-sm\n"]);return d=function(){return e},e}let u=i.J.div(d());function m(e){let{children:t,className:s,contentClassName:a,sticky:i,fixed:d,mdTitle:m,large:f,narrow:x}=e,{isMobile:h,isExpanded:g}=(0,c.V)(),p=(0,r.V)(l.E_),v=!t&&!m,j=f&&!p;return(0,n.jsxs)("header",{className:(0,o.A)("flex w-full bg-bg-100",i&&"sticky top-0 z-header",d&&"fixed top-0 z-header",p?l.X_:"h-12",p&&[!g&&"pl-[133px]",!v&&l.zo],j&&["mx-auto md:h-24 md:items-end",x?"max-w-4xl":"max-w-7xl"],s),"aria-hidden":v,children:[!p&&(i||d)&&(0,n.jsx)(u,{}),(0,n.jsx)("div",{className:(0,o.A)("flex w-full items-center justify-between gap-4",p?"pt-0.5":"",p&&!g?"pl-3":"pl-11 lg:pl-8",p&&!(h&&g)&&"draggable",a,j?"px-4 md:pl-8":"pr-3"),children:m?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h1",{className:(0,o.A)("text-text-200 flex items-center gap-2 text-center max-md:hidden min-w-0",p?"font-medium leading-tight tracking-tight":"font-heading",!p&&(j?"text-2xl":"text-lg")),children:(0,n.jsx)("span",{className:"truncate",children:m})}),(0,n.jsx)("div",{}),t]}):t})]})}},10340:(e,t,s)=>{"use strict";s.d(t,{A:()=>$});var a=s(54568),n=s(27062),i=s(77101),l=s(7620),r=s(85717),o=s(43156),c=s(64039),d=s(62971);let u=()=>(0,a.jsxs)("div",{className:"items-top flex w-full bg-bg-200 mt-5 p-3 rounded-xl items-center text-text-300",children:[(0,a.jsx)(c.R,{size:24}),(0,a.jsx)("p",{className:"font-base ml-3",children:(0,a.jsx)(d.A,{defaultMessage:"Claude has ended this chat.",id:"xJ+abA4nue"})})]});var m=s(94649),f=s(11515),x=s(91961),h=s(85544),g=s(58911),p=s(75006),v=s(94748);let j=p.z.object({url:p.z.string()}),b=e=>{let t,{input:s,toolResult:n,isStreaming:i}=e,r=null==n?void 0:n.is_error,[o,c]=(0,l.useState)(!1),u=(0,l.useMemo)(()=>{if(r)return;let e=function(e){if(!e||!e.content)return null;if(e.content.some(e=>"knowledge"===e.type)){let t=[];for(let s of e.content)"knowledge"===s.type&&t.push(s);return t}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text);return Array.isArray(s)?s.map(e=>{let t=h.ey.safeParse(e);return t.success?t.data:null}).filter(e=>null!==e):[]}catch(e){return[]}}(n);return null==e?void 0:e[0]},[r,n]),p=(0,l.useMemo)(()=>{if(!r)return;let e=function(e){if(!e||!e.content)return null;if(e.content.some(e=>"text"===e.type)){let t=[];for(let s of e.content)if("text"===s.type){let e=h.kS.safeParse(JSON.parse(s.text));e.success&&t.push(e.data)}return t}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text);return Array.isArray(s)?s.map(e=>{let t=h.tD.safeParse(e);if(!t.success)return null;{let e=h.kS.safeParse(JSON.parse(t.data.text));return e.success?e.data:null}}).filter(e=>null!==e):[]}catch(e){return[]}}(n);return null==e?void 0:e[0]},[r,n]),b=function(e){switch(e){case"INVALID_URL":return(0,a.jsx)(d.A,{defaultMessage:"The URL provided is invalid",id:"EXjAXf5Pbi"});case"URL_NOT_FOUND":return(0,a.jsx)(d.A,{defaultMessage:"Could not find this URL",id:"stDgCXJO7F"});case"RATE_LIMIT_EXCEEDED":return(0,a.jsx)(d.A,{defaultMessage:"Access to this website has been restricted due to rate limits",id:"VhUxwIo+O2"});case"ROBOTS_DISALLOWED":return(0,a.jsx)(d.A,{defaultMessage:"This website has blocked Claude via robots.txt rules",id:"dHtmXRJ647"});case"URL_TOO_LONG":return(0,a.jsx)(d.A,{defaultMessage:"The URL provided is too long",id:"K2DBYJqbtF"});case"SITE_BLOCKED":return(0,a.jsx)(d.A,{defaultMessage:"Access to this website is blocked",id:"WI6DZStAoi"});case"PERMISSIONS_ERROR":return(0,a.jsx)(d.A,{defaultMessage:"The URL was not provided by the user nor was it contained in any web search/fetch results",id:"aXYLYDjU6L"});case"UNKNOWN_ERROR":case"SERVER_ERROR":case"CLIENT_ERROR":return(0,a.jsx)(d.A,{defaultMessage:"An unknown error occurred",id:"3VG8rbxa4v"});case void 0:return null}}(null==p?void 0:p.error_type),{data:y}=j.safeParse(s);if(!y)return;let w=y.url,_=(null==u?void 0:u.title)||w,C=(0,x.Nj)(w);return t=i?C?(0,a.jsx)(d.A,{defaultMessage:"Fetching from {hostname}",id:"5qKeNV67+8",values:{hostname:C}}):(0,a.jsx)(d.A,{defaultMessage:"Fetching from site",id:"TSZq9sKvY7"}):r?(0,a.jsx)(d.A,{defaultMessage:"Failed to fetch <b>{title}</b>",id:"8JHipUo6K+",values:{title:_,b:e=>(0,a.jsx)("span",{className:"text-text-400",children:e})}}):(0,a.jsx)(d.A,{defaultMessage:"Fetched <b>{title}</b>",id:"BWNvvK6PhH",values:{title:_,b:e=>(0,a.jsx)("span",{className:"text-text-400",children:e})}}),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(v.aX,{isError:r,errorMessage:b,text:t,secondaryText:i?void 0:C,handleClick:()=>c(!0),icon:(0,a.jsx)(f.d,{fadeInOnLoad:!0,url:w,size:16}),secondaryIcon:(0,a.jsx)(g.B,{size:16,className:"text-text-300"}),...e}),(0,a.jsx)(m.v,{isOpen:o,url:w,onClose:()=>c(!1),onConfirm:()=>{window.open(w,"_blank"),c(!1)}})]})};var y=s(33395),w=s(34059),_=s(83910),C=s(37463),N=s(45376),k=s.n(N),M=s(46760),A=s(74744),S=s(67532);function E(e){return"webpage_metadata"===e.metadata.type?e.url||"":e.metadata.doc_uuid}let z=e=>{let{isExpanded:t,toolName:s,results:n}=e;return(null==n?void 0:n.length)?(0,a.jsx)("div",{className:"flex flex-nowrap p-2 pt-0 flex-col",tabIndex:-1,children:"web_search"===s?(0,a.jsx)(R,{results:n,isExpanded:t}):(0,a.jsx)(F,{results:n,isExpanded:t})}):null},I={initial:{opacity:0,scale:.7},animate:{opacity:1,scale:1,transition:{type:"spring",stiffness:400,damping:30,mass:1}}},R=e=>{let{isExpanded:t,results:s}=e;return(0,a.jsx)(a.Fragment,{children:s.map(e=>{var s;return e.knowledge&&"webpage_metadata"===e.knowledge.metadata.type?(0,a.jsx)(C.P.div,{variants:I,children:(0,a.jsx)(y.$,{disabled:!t,icon:(0,a.jsx)(f.d,{url:e.knowledge.metadata.favicon_url,size:16}),title:e.knowledge.title,subtitles:[e.knowledge.metadata.site_domain],url:null!=(s=e.knowledge.url)?s:void 0})},e.knowledge.url):null})})},F=e=>{let{isExpanded:t,results:s}=e;return(0,a.jsx)(a.Fragment,{children:s.map(e=>(0,a.jsx)(C.P.div,{variants:I,children:(0,a.jsx)(U,{disabled:!t,knowledge:e.knowledge})},e.uuid))})},T=e=>{let{isError:t}=e,{isDriveAuthenticated:s}=(0,r.cI)();return(0,r.yy)()?s?t?i.I5.ACCESS_DENIED:i.I5.READY:i.I5.UNAUTHENTICATED:i.I5.DISABLED},U=e=>{let{disabled:t,knowledge:s}=e,n=T({isError:!s});return(0,a.jsx)(A.Tc,{syncSourceType:i.v8.GDRIVE,syncStatus:n,disabled:t,title:(null==s?void 0:s.title)||"Untitled document",subtitles:(null==s?void 0:s.metadata.type)==="google_doc_metadata"&&s.metadata.owner?[s.metadata.owner]:void 0,url:(null==s?void 0:s.url)||void 0})},L=p.z.object({query:p.z.string(),n:p.z.number().int().optional()}),D=e=>{var t;let{toolName:s,syncSourceType:n,...i}=e,{input:l,toolResult:r,isStreaming:o,groupItemKey:c}=i,{isExpanded:d,setIsExpanded:u,snappyTransition:m}=(0,S.a)(!1,c),f=(0,M.A)(),x=null==r?void 0:r.is_error,g=x?null:function(e){if(!e)return null;if(e.content.some(e=>"knowledge"===e.type||"rag_reference"===e.type)){let t=[];for(let s of e.content)if("knowledge"===s.type)t.push({uuid:E(s),knowledge:s});else if("rag_reference"===s.type){let e=s.doc_uuid;t.push({uuid:e})}return k()(t,e=>e.uuid)}try{let t=e.content[0];if((null==t?void 0:t.type)!=="text")return[];let s=JSON.parse(t.text),a=(Array.isArray(s)?s.map(e=>{let t=h.ey.safeParse(e);return t.success?t.data:null}).filter(e=>null!==e):[]).map(e=>({uuid:E(e),knowledge:e}));return k()(a,e=>e.uuid)}catch(e){return[]}}(r),{data:p}=L.safeParse(l),j="web_search"===s?f.formatMessage({defaultMessage:"Searching the web",id:"5KajyzHSXj"}):f.formatMessage({defaultMessage:"Searching Google Drive",id:"V/QOi0yNF0"});if(!p)return;let b=f.formatMessage({defaultMessage:"{count, plural, one {# result} other {# results}}",id:"s88ium+h8p"},{count:null!=(t=null==g?void 0:g.length)?t:0}),y=!g&&o?j:p.query;return(0,a.jsx)(v.sH,{isExpandingDisabled:!!o,isExpanded:d,setIsExpanded:u,isError:x,text:y,secondaryText:o?void 0:b,icon:"web_search"===s?(0,a.jsx)(_.q,{size:16}):!!n&&(0,a.jsx)(w.A9,{type:n,size:14}),...i,children:(0,a.jsx)(v.NG,{isExpanded:d,snappyTransition:m,isScrollable:!0,children:!x&&!!(null==g?void 0:g.length)&&(0,a.jsx)(z,{isExpanded:d,toolName:s,results:g})})})};var O=s(70067);s(1761),p.z.object({prompt:p.z.string()});var P=s(33792),B=s(9946),W=s(54890),G=s(32987);function J(e){var t,s,n,i;let{input:r,toolResult:o,isStreaming:c,isLastMessage:d,onOpenArtifact:u,publishedArtifacts:m,artifacts:f,message:x,artifactCellType:h,selectedArtifactId:g,selectedArtifactVersion:p,isFirstBlockOfMessage:v,isLastBlockOfMessage:j}=e,b=W.oE.parse(r),y=d&&c,{versions:w,..._}=null!=(n=f[null!=(s=b.id)?s:""])?n:{},C=(0,l.useMemo)(()=>{let e=null==w?void 0:w.findIndex(e=>e.uuid===b.version_uuid);if(-1!==e)return e},[w,b.version_uuid]),N=null==(t=null!=(i=b.content)?i:b.new_str)?void 0:t.slice(0,250),k={isClosed:void 0!==o,..._,...b},M=g===k.id&&p===b.version_uuid,A="individual_cell_create"===h||"multi_edit_not_last"!==h;return(0,a.jsx)("div",{className:(0,G.A)(A&&(v?"pt-2":"pt-3"),A&&(j?"pb-2":"pb-3"),"multi_edit_not_last"===h&&"h-0"),children:(0,a.jsx)(B.uL,{versionNum:C?C+1:void 0,preview:N,versionCount:null==w?void 0:w.length,properties:k,isStreaming:c,isEdit:"individual_cell_create"!==h,isNotLastEdit:"multi_edit_not_last"===h,isLastMessage:d,onOpenArtifact:e=>{u&&u(e,x.uuid,b.version_uuid)},publishedArtifacts:y?B.b2:m,isExpanded:M})})}var H=s(8681);s(41417);var V=s(83133),Y=s(82199),K=s(70825),Z=s(55563);let q=e=>{let t;if(!e.content||0===e.content.length||!e.content[0])return{toolResultLogs:"",toolResultErrors:"Error: Missing content data"};if("text"!==e.content[0].type)return{toolResultLogs:"",toolResultErrors:""};try{t=JSON.parse(e.content[0].text)}catch(e){return(0,K.Cp)(e,{tags:{source:"repl-tool-result"}}),{toolResultLogs:"",toolResultErrors:"Error: failed to parse Analysis tool result"}}let s=t.logs?"Result\n\n"+t.logs.join("\n"):"";return"error"===t.status?{toolResultLogs:s,toolResultErrors:"Error\n\n"+t.error}:{toolResultLogs:s,toolResultErrors:""}},X=p.z.object({code:p.z.string().nullish().transform(e=>(null==e?void 0:e.charAt(0))==="\n"?e.slice(1):null!=e?e:void 0)}),Q=e=>{var t;let{input:s,toolResult:n,isStreaming:i,groupItemKey:r}=e,o=(0,M.A)(),{isExpanded:c,setIsExpanded:d,snappyTransition:u}=(0,S.a)(i,r),m=null!=(t=X.parse(s).code)?t:"",{toolResultLogs:f,toolResultErrors:x}=(0,l.useMemo)(()=>n?q(n):{toolResultLogs:"",toolResultErrors:""},[n]);return(0,a.jsx)(v.sH,{isExpanded:c,setIsExpanded:d,icon:(0,a.jsx)(Y.N,{size:16}),text:i?o.formatMessage({defaultMessage:"Analyzing data",id:"UkajfL/9Yh"}):o.formatMessage({defaultMessage:"Analyzed data",id:"NbwDtG2acW"}),secondaryText:i?void 0:o.formatMessage({defaultMessage:"View analysis",id:"fL+Q/8QHAy"}),...e,children:(0,a.jsx)(v.NG,{isExpanded:c,snappyTransition:u,isScrollable:!0,children:(0,a.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1","data-testid":"repl-output",children:[(0,a.jsx)(Z.z,{language:"javascript",code:m}),(0,a.jsx)(Z.z,{title:o.formatMessage({defaultMessage:"Output",id:"fio5opLcOZ"}),language:"javascript",code:f}),!!x&&(0,a.jsx)(Z.z,{title:o.formatMessage({defaultMessage:"Error",id:"KN7zKn8z4F"}),code:x,codeTagProps:{className:"text-danger-000"},className:"!bg-danger-900"})]})})})};p.z.object({returncode:p.z.number().int(),stdout:p.z.string(),stderr:p.z.string()});function $(e){let{toolUseId:t,isLastMessage:s,isStreaming:l,toolName:c,input:d,message:m,onOpenArtifact:f,publishedArtifacts:x,toolResult:h,artifacts:g,onAllow:p,artifactCellType:v,isFirstBlockOfMessage:j,isLastBlockOfMessage:y,conversationUUID:w,selectedDrawerItem:_,isShared:C,displayData:N,context:k,renderMode:M=P.l.Standard,groupItemKey:A,isFirstItemInGroup:S,isLastItemInGroup:E}=e,z=(0,r.fb)(),I=(0,o.be)(),{value:R}=(0,n.fS)("prism_enabled"),F={input:d,toolResult:h,isStreaming:l,isFirstBlockOfMessage:j,isLastBlockOfMessage:y,renderMode:M,groupItemKey:A,isFirstItemInGroup:S,isLastItemInGroup:E};if("end_conversation"===c)return(0,a.jsx)(u,{});let T=(null==_?void 0:_.type)==="artifact"?_:void 0,U=!!h&&!!_&&"compass"===_.type&&_.data.toolUseId===h.tool_use_id;switch(c){case"artifacts":return(0,a.jsx)(J,{input:d,toolResult:h,isLastMessage:s,isStreaming:l,onOpenArtifact:f,publishedArtifacts:x,artifacts:g,message:m,artifactCellType:v,selectedArtifactId:null==T?void 0:T.id,selectedArtifactVersion:null==T?void 0:T.versionUUID,isFirstBlockOfMessage:j,isLastBlockOfMessage:y});case"dolphin":return(0,a.jsx)(a.Fragment,{});case"repl":return(0,a.jsx)(Q,{...F});case"drive_search":if(!z)break;return(0,a.jsx)(D,{syncSourceType:i.v8.GDRIVE,toolName:c,...F});case"web_search":if(!I)break;return(0,a.jsx)(D,{toolName:c,...F});case"web_fetch":return(0,a.jsx)(b,{...F});case"launch_extended_search_task":return(0,a.jsx)(O.wD,{toolUseId:t,isFirstBlockOfMessage:j,isLastBlockOfMessage:y,conversationUUID:w,toolResult:h,isShared:C,isExpanded:U,isStreaming:l,context:k})}let L=c.includes(":");return!L&&(null==N?void 0:N.integrationName)?(0,a.jsx)(H.K,{...N,toolName:c,isError:null==h?void 0:h.is_error,isStreaming:l,isFirstBlockOfMessage:j,isLastBlockOfMessage:y,renderMode:M,groupItemKey:A,isFirstItemInGroup:S,isLastItemInGroup:E}):(0,a.jsx)(V.d,{toolName:L?c.split(":")[1]:c,integrationName:null==N?void 0:N.integrationName,integrationIcon:null==N?void 0:N.integrationIcon,...F})}},11062:(e,t,s)=>{"use strict";s.d(t,{bl:()=>n});var a=s(61125);async function n(e,t,s,n){let i=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"quick_entry_image",n=function(e,t){let s=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"quick_entry_image",n=atob(e),i=new Uint8Array(n.length);for(let e=0;e<n.length;e++)i[e]=n.charCodeAt(e);let l=a._F[t]||"png";return new File([i],"".concat(s,".").concat(l),{type:t})}(e,t,s),i=new FormData;return i.append("file",n),i}(e,t),l=await n("/api/".concat(s,"/upload"),{method:"POST",body:i});if(l.ok)return[await l.json()];throw Error("Failed to upload image: ".concat(l.status," ").concat(l.statusText))}},11480:(e,t,s)=>{"use strict";s.d(t,{D8:()=>d,DT:()=>m,Ih:()=>r,h4:()=>o,i1:()=>f});var a=s(54568),n=s(32987),i=s(37463),l=s(7620);let r=(e,t)=>!(!["thinking","tool_use","tool_result"].includes(e.type)||"tool_use"===e.type&&["prism","end_conversation","dolphin","launch_extended_search_task"].includes(e.name))&&(!!t.get("timeline_artifacts_enabled",!1)||("tool_use"!==e.type||"artifacts"!==e.name)&&("tool_result"!==e.type||"artifacts"!==e.name))&&(!!t.get("timeline_gsuite_enabled",!1)||"tool_use"!==e.type||!e.integration_name),o=e=>"tool_result"!==e.type,c=l.createContext({}),d=()=>(0,l.useContext)(c),u=e=>{let[t,s]=(0,l.useState)(void 0),n=(0,l.useMemo)(()=>({expandedItemKey:t,setExpandedItemKey:s}),[t,s]);return(0,a.jsx)(c.Provider,{value:n,children:e.children})},m=e=>{let{children:t,isFirstBlockOfMessage:s,isLastBlockOfMessage:l,isStreaming:r}=e;return(0,a.jsx)(i.P.div,{initial:{opacity:+!r},animate:{opacity:1},transition:{duration:.5,ease:"easeIn"},className:(0,n.A)("transition-all duration-400 ease-out rounded-lg border-0.5 flex flex-col font-ui tracking-tight leading-normal my-3 border-border-300 min-h-[2.625rem] overflow-hidden",s?"mt-2":"mt-3",l?"mb-2":"mb-3"),children:(0,a.jsx)(u,{children:t})})},f=e=>{let{icon:t,isExpanded:s,isFirstItem:i,isLastItem:l,isActive:r,children:o}=e,c={minHeight:"calc((2.125rem - ".concat(t?"16px":"6px",") / 2)")};return(0,a.jsxs)("div",{className:(0,n.A)("flex flex-row min-h-[2.125rem] shrink-0",{"bg-bg-000":s},{"hover:bg-always-black hover:bg-opacity-[0.03]":!s}),children:[(0,a.jsxs)("div",{className:"flex flex-col items-center justify-center pl-3 box-border",children:[(0,a.jsx)("div",{className:(0,n.A)("transition-all w-[1px]",{"bg-border-300":!i}),style:c}),(0,a.jsx)("div",{className:(0,n.A)("transition-all flex items-center justify-center my-1 shrink-0 w-[16px]",{"h-[$16px]":!!t}),children:null!=t?t:(0,a.jsx)("div",{className:(0,n.A)("size-[6px] rounded-full",r?"bg-accent-main-200":"bg-border-300")})}),(0,a.jsx)("div",{className:(0,n.A)("transition-all grow w-[1px]",{"bg-border-300":!l}),style:c})]}),(0,a.jsx)("div",{className:"w-full flex flex-col min-w-0",children:o})]})}},18395:(e,t,s)=>{"use strict";s.d(t,{B:()=>g});var a=s(54568),n=s(7726),i=s(1761),l=s(9537),r=s(41417),o=s(37076),c=s(54890),d=s(27261),u=s.n(d),m=s(7620),f=s(46760),x=s(62971),h=s(77336);function g(e){var t,s,d,g,p,v;let{conversationUuid:j,message:b,requestedFeedbackType:y,setRequestedFeedbackType:w,isOpen:_,onClose:C,onSuccess:N,showOptions:k=!0}=e,M=(0,f.A)(),[A,S]=(0,m.useState)(""),{data:E}=(0,n.Bq)(j),z=null==E?void 0:E.chat_messages.some(e=>(0,c.Xz)(e).length>0),I=(0,h.V)(null!=(d=null==E?void 0:E.chat_messages)?d:[]).length>0,{mutate:R}=(0,n.HA)(j,b,!!z,{onSuccess:N}),F=(0,m.useId)(),T=null!=(g=null==(t=b.content)?void 0:t.some(e=>"thinking"===e.type))&&g,U="raven"===(0,i.$b)(),L=null;return(null==E||null==(s=E.settings)?void 0:s.enabled_web_search)&&(L=null!=(v=null==(p=b.content)?void 0:p.some(e=>"tool_use"===e.type&&"web_search"===e.name))&&v?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("option",{value:"flag/web-over",children:(0,a.jsx)(x.A,{defaultMessage:"Shouldn’t have searched the web",id:"T+mr27AakV"})}),(0,a.jsx)("option",{value:"flag/web-sources",children:(0,a.jsx)(x.A,{defaultMessage:"Don’t like the cited sources",id:"MBNotx/VaO"})})]}):(0,a.jsx)("option",{value:"flag/web-under",children:(0,a.jsx)(x.A,{defaultMessage:"Should have searched the web",id:"CS8kdzupd9"})})),(0,a.jsxs)(o.aF,{isOpen:_,title:M.formatMessage({defaultMessage:"Feedback",id:"Ejhdi47Jk5"}),onClose:C,children:[(0,a.jsxs)("div",{className:"mt-4 flex flex-col",children:[(null==y?void 0:y.includes("flag"))&&k&&(0,a.jsxs)(l.l6,{className:"my-2 max-w-md",label:M.formatMessage({defaultMessage:"What type of issue do you wish to report? (optional)",id:"IFWIi9rs1t"}),value:y,onChange:e=>{w(e.target.value||"flag")},children:[(0,a.jsx)("option",{value:"flag",children:(0,a.jsx)(x.A,{defaultMessage:"Select…",id:"q0+99kUbd6"})}),(0,a.jsx)("option",{value:"flag/bug",children:(0,a.jsx)(x.A,{defaultMessage:"UI bug",id:"0uIYueAyDB"})}),(0,a.jsx)("option",{value:"flag/refusal",children:(0,a.jsx)(x.A,{defaultMessage:"Overactive refusal",id:"Jl0Mn6yDBI"})}),I&&(0,a.jsx)("option",{value:"flag/file",children:(0,a.jsx)(x.A,{defaultMessage:"Poor image understanding",id:"227KYxHrx5"})}),(0,a.jsx)("option",{value:"flag/instructions",children:(0,a.jsx)(x.A,{defaultMessage:"Did not fully follow my request",id:"2uOw8LgMwG"})}),(0,a.jsx)("option",{value:"flag/facts",children:(0,a.jsx)(x.A,{defaultMessage:"Not factually correct",id:"topE9Q6MGe"})}),(0,a.jsx)("option",{value:"flag/incomplete",children:(0,a.jsx)(x.A,{defaultMessage:"Incomplete response",id:"ZNEcy7OM5r"})}),T&&(0,a.jsx)("option",{value:"flag/thoughts",children:(0,a.jsx)(x.A,{defaultMessage:"Issue with thought process",id:"zOab+24EWo"})}),L,(0,a.jsx)("option",{value:"flag/other",children:(0,a.jsx)(x.A,{defaultMessage:"Other",id:"/VnDMl81rh"})})]}),(0,a.jsx)("label",{htmlFor:F,className:"text-text-400 mb-2 text-sm",children:(0,a.jsx)(x.A,{defaultMessage:"Please provide details: (optional)",id:"og1W/bIZdx"})}),(0,a.jsx)(l.fs,{id:F,className:"text-sm",placeholder:(null==y?void 0:y.includes("flag"))?M.formatMessage({defaultMessage:"What was unsatisfying about this response?",id:"+DB/t6WTki"}):M.formatMessage({defaultMessage:"What was satisfying about this response?",id:"yJFWG3mK1I"}),value:A,onChange:e=>{S(e.target.value)}})]}),(0,a.jsx)("p",{className:"text-text-500 mt-3 italic leading-tight",children:(0,a.jsx)("small",{children:(0,a.jsx)(x.A,{defaultMessage:"Submitting this report will send the entire current conversation to Anthropic for future improvements to our models. <link>Learn More</link>",id:"laRJ009b4f",values:{link:e=>(0,a.jsx)(u(),{target:"_blank",rel:"noopener",href:U?"https://privacy.anthropic.com/en/articles/9957937-how-does-anthropic-use-submitted-feedback":"https://privacy.anthropic.com/en/articles/10023565-how-does-anthropic-use-submitted-feedback",className:"text-accent-secondary-100 font-medium hover:underline",children:e})}})})}),(0,a.jsxs)(o.vW,{children:[(0,a.jsx)(r.$,{onClick:()=>{y&&(R({type:y,reason:A||void 0}),C())},children:(0,a.jsx)(x.A,{defaultMessage:"Submit",id:"wSZR47Y5kj"})}),(0,a.jsx)(r.$,{variant:"secondary",onClick:C,children:(0,a.jsx)(x.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})})]})]})}},22126:(e,t,s)=>{"use strict";s.d(t,{n:()=>b,M:()=>j});var a=s(7726),n=s(97527),i=s(33200),l=s(69987),r=s(27062),o=s(37428),c=s(7620),d=s(92947),u=s(56147),m=s(61125),f=s(75632);async function x(e,t){let s;try{s=await t.callback(e)}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("Error executing code: ".concat(e))}return{is_error:s.isError,content:s.content.map(e=>{switch(e.type){case"text":return{type:"text",text:e.text};case"image":return h({mimeType:e.mimeType,base64Data:e.data});case"resource":{let t=e.resource;if("text"in t)return{type:"text",text:t.text};if("blob"in t){if(!t.mimeType)throw Error("Missing MIME type for embedded resource");return h({mimeType:t.mimeType,base64Data:t.blob})}}}throw Error("Unsupported content type: ".concat(e.type))})}}function h(e){let{mimeType:t,base64Data:s}=e;if(!m._F[t])throw Error("Unsupported image type: ".concat(t));let a=m._F[t];return{type:"image",file_name:"".concat((0,f.N)(),".").concat(a),source:{media_type:t,type:"base64",data:s}}}var g=s(21155);async function p(e,t){let s=g.zN.safeParse(e);if(s.success)try{let e=await t(s.data.code);return{content:[{type:"text",text:JSON.stringify(e)}]}}catch(t){let e=t instanceof Error?t.message:String(t);throw Error("Error executing code: ".concat(e))}throw Error("Error parsing input: ".concat(s.error.message))}var v=s(28871);function j(){let{mutateAsync:e}=(0,a.Pt)(),t=function(){let{executeReplCode:e}=(0,n.q)(),{mcpTools:t}=(0,d.gt)();return(0,c.useCallback)(async(s,a)=>{let n=(0,v.p)(a);if("repl"===s)return await p(n,e);{let e=s.includes(":"),a=null==t?void 0:t.find(t=>(e?"".concat(t.serverName,":").concat(t.name):t.name)===s);if(a)return await x(n,a)}},[e,t])}();return(0,c.useCallback)(async function(s,a,n,i){let{overriddenResult:r}=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};l.Y("Tools: Using tool ".concat(a," with input ").concat(i));try{let o=null!=r?r:await t(a,i);if(void 0===o)return void l.Y("Tools: Unable to find tool with name ".concat(a));l.Y("Tools: Result for tool ".concat(a,": ").concat(o)),await e({conversation_uuid:s,type:"tool_result",tool_use_id:n,...o})}catch(i){let t=i instanceof Error?i.message:String(i);l.Y("Tools: Error for tool ".concat(a,": ").concat(t)),await e({conversation_uuid:s,type:"tool_result",tool_use_id:n,content:[{type:"text",text:t}]})}},[t,e])}let b=(e,t)=>{let s=(0,o.wc)(),{servers:a}=(0,d.gt)(),{value:n}=(0,i.N)(null!=e?e:{}),{value:l}=(0,r.fS)("tool_use_artifacts_ga"),{value:m}=(0,r.fS)("namespace_mcp_tools"),f=(0,u.Pb)(t);return(0,c.useCallback)(()=>{let t=[];for(let s of a)for(let a of s.tools){var i,r;(null==e||null==(i=e.enabled_mcp_tools)?void 0:i[(0,d.Cc)(s.uuid,a.name)])!==!1&&t.push({name:a.name,description:null!=(r=a.description)?r:a.name,input_schema:a.inputSchema,...m?{integration_name:s.name}:{},...(null==s?void 0:s.type)==="remote"&&{mcp_server_uuid:s.uuid,integration_icon_url:s.url}})}let c=null==s?void 0:s[o.U3];return c&&t.push({type:(null==s?void 0:s[o.$6])||"",name:c}),(l||n)&&t.push({type:"artifacts_v0",name:"artifacts"}),n&&t.push({type:"repl_v0",name:"repl"}),f&&t.push({type:"project_knowledge_search",name:"project_knowledge_search"}),t},[a,null==e?void 0:e.enabled_mcp_tools,n,s,l,f,m])}},25243:(e,t,s)=>{"use strict";s.d(t,{W:()=>n});var a=s(7620);function n(e,t,s){let n=(0,a.useRef)(void 0),i=(0,a.useCallback)(e,t),l=(0,a.useCallback)(()=>{n.current&&window.clearTimeout(n.current),n.current=window.setTimeout(i,s)},[i,s]);return(0,a.useEffect)(()=>{l()},[...t,i,s]),l}},28871:(e,t,s)=>{"use strict";function a(e){let t;try{t=JSON.parse(e)}catch(e){}return t}s.d(t,{p:()=>a})},30453:(e,t,s)=>{"use strict";s.d(t,{f:()=>d});var a=s(54568),n=s(36906),i=s(34098),l=s(41417),r=s(43989),o=s(76761),c=s(7620);let d=e=>{let{attachment:t,goBack:s,onClose:d}=e,u=(0,c.useMemo)(()=>(0,i.E)(t),[t]);return(0,a.jsxs)("div",{className:"flex h-full flex-col pb-1 pl-5 pt-3",children:[(0,a.jsxs)("div",{className:"sticky flex items-center gap-1 pr-5",children:[s&&(0,a.jsx)(l.$,{onClick:s,variant:"ghost",size:"icon",className:"-ml-2 shrink-0",children:(0,a.jsx)(r.n,{size:20})}),(0,a.jsx)("h2",{className:"font-ui tracking-tight flex-1 truncate text-lg font-medium",children:u.title}),(0,a.jsx)(l.$,{variant:"ghost",size:"icon",className:"-mr-2",onClick:d,"data-testid":"close-file-preview",children:(0,a.jsx)(o.X,{size:20})})]}),(0,a.jsxs)("div",{className:"mb-1 flex flex-col pb-3 pr-5 min-h-0 flex-1",children:[(0,a.jsx)(n.G,{metaData:u.metaData}),(0,a.jsx)("div",{className:"-m-1 mt-0 min-h-0 flex-1 whitespace-pre-wrap break-all text-xs p-4 bg-bg-000 rounded-lg border-0.5 border-border-300  overflow-y-auto font-mono shadow-sm",children:t.extracted_content})]})]})}},31417:(e,t,s)=>{"use strict";s.d(t,{w:()=>o,y:()=>c});var a=s(77186),n=s(23661),i=s(7620);function l(e,t){let s=new Map;return t.forEach(e=>{var t;let a=null!=(t=s.get(e.file_name))?t:[];a.push(e),s.set(e.file_name,a)}),s.get(e)}function r(e,t){let s=l(e,t);if(!s||0===s.length)return null;let a=s.filter(e=>e.file_kind===n.M.Blob);return 0===a.length?null:a[a.length-1]}function o(){let e=function(){let e=(0,a.mn)();return(0,i.useCallback)(async(t,s,a,n,i)=>{let l=r(t,s);if(!l&&n){let s=await e("/api/organizations/".concat(a,"/projects/").concat(n,"/docs")),i=(await s.json()).find(e=>e.file_name===t);if(i)return new TextEncoder().encode(i.content);let o=await e("/api/organizations/".concat(a,"/projects/").concat(n,"/files"));l=r(t,await o.json())}if(!l)return null;try{let e=i?"/api/organizations/".concat(a,"/shared_artifact/").concat(i,"/files/").concat(l.file_uuid,"/contents"):"/api/organizations/".concat(a,"/files/").concat(l.file_uuid,"/contents"),t=await fetch(e);if(!t.ok)return null;let s=await t.arrayBuffer();if(s.byteLength>0x80000000-1)return null;return new Uint8Array(s)}catch(e){return null}},[e])}();return(0,i.useCallback)(async(t,s,a,n,i,r)=>{if(!n)return null;let o=function(e,t){let s=l(e,t);if(!s||0===s.length)return null;let a=s[s.length-1];if(a){let e=a.extracted_content;return new TextEncoder().encode(e)}return null}(t,s);return o||await e(t,a,n,i,r)},[e])}function c(e,t,s,a,n){let l=o();return(0,i.useCallback)(async i=>l(i,e,t,s,a,n),[e,t,s,a,l,n])}},33792:(e,t,s)=>{"use strict";s.d(t,{l:()=>a});var a=function(e){return e.Standard="Standard",e.TimelineGroup="TimelineGroup",e}({})},39741:(e,t,s)=>{"use strict";s.d(t,{NotificationListener:()=>S,hG:()=>A,Wo:()=>k});var a=s(98518),n=s(1761),i=s(89598),l=s(70825),r=s(20996),o=s(9801),c=s(7620),d=s(42071),u=s(24478),m=s(27511),f=s(65988);let x=(0,u.w)("CiRhbnRocm9waWMvY2xhdWRlL3B1c2gvZW52ZWxvcGUucHJvdG8SFWFudGhyb3BpYy5jbGF1ZGUucHVzaCJfChVQdXNoT3BlcmF0aW9uRW52ZWxvcGUSDwoHc2VydmljZRgBIAEoCRIOCgZtZXRob2QYAiABKAkSJQoHcmVxdWVzdBgDIAEoCzIULmdvb2dsZS5wcm90b2J1Zi5BbnlC4wEKGWNvbS5hbnRocm9waWMuY2xhdWRlLnB1c2hCDUVudmVsb3BlUHJvdG9QAVpBZ2l0aHViLmNvbS9hbnRocm9waWNzL21vYmlsZS1hcHBzL2dvL3Byb3Rvcy9hbnRocm9waWMvY2xhdWRlL3B1c2iiAgNBQ1CqAhVBbnRocm9waWMuQ2xhdWRlLlB1c2jKAhVBbnRocm9waWNcQ2xhdWRlXFB1c2jiAiFBbnRocm9waWNcQ2xhdWRlXFB1c2hcR1BCTWV0YWRhdGHqAhdBbnRocm9waWM6OkNsYXVkZTo6UHVzaGIGcHJvdG8z",[f.f]),h=(0,m.Z)(x,0);var g=s(48021);let p=(0,u.w)("CiZhbnRocm9waWMvY2xhdWRlL3B1c2gvb3BlcmF0aW9ucy5wcm90bxIVYW50aHJvcGljLmNsYXVkZS5wdXNoIpEBCg9PcGVuQ2hhdFJlcXVlc3QSIgoMYWNjb3VudF91dWlkGAEgASgJUgxhY2NvdW50X3V1aWQSLAoRb3JnYW5pemF0aW9uX3V1aWQYAiABKAlSEW9yZ2FuaXphdGlvbl91dWlkEiwKEWNvbnZlcnNhdGlvbl91dWlkGAMgASgJUhFjb252ZXJzYXRpb25fdXVpZDJrCh1Mb2dnZWRJblB1c2hPcGVyYXRpb25zU2VydmljZRJKCghPcGVuQ2hhdBImLmFudGhyb3BpYy5jbGF1ZGUucHVzaC5PcGVuQ2hhdFJlcXVlc3QaFi5nb29nbGUucHJvdG9idWYuRW1wdHlC5QEKGWNvbS5hbnRocm9waWMuY2xhdWRlLnB1c2hCD09wZXJhdGlvbnNQcm90b1ABWkFnaXRodWIuY29tL2FudGhyb3BpY3MvbW9iaWxlLWFwcHMvZ28vcHJvdG9zL2FudGhyb3BpYy9jbGF1ZGUvcHVzaKICA0FDUKoCFUFudGhyb3BpYy5DbGF1ZGUuUHVzaMoCFUFudGhyb3BpY1xDbGF1ZGVcUHVzaOICIUFudGhyb3BpY1xDbGF1ZGVcUHVzaFxHUEJNZXRhZGF0YeoCF0FudGhyb3BpYzo6Q2xhdWRlOjpQdXNoYgZwcm90bzM",[g.t]),v=(0,m.Z)(p,0);var j=s(95084),b=s(74045),y=s(66612);let w=(0,j.Iq)(p);var _=s(40459);let C={apiKey:"AIzaSyDu88493oN_Xq4PNVr_x8GUZPZhe-byS4U",authDomain:"proj-scandium-production-5zhm.firebaseapp.com",projectId:"proj-scandium-production-5zhm",storageBucket:_.env.NEXT_PUBLIC_FIREBASE_STORAGE_BUCKET||"",messagingSenderId:"365066964946",appId:"1:365066964946:web:920eb01ec340c52cb8420b",measurementId:_.env.NEXT_PUBLIC_FIREBASE_MEASUREMENT_ID||""},N="BBn_zDr7ckBwzQe6Tdc1k6E0tSdrG64L2ddLR36jUkdaleKmAdfgt3ao93t-nib3n3oBaAtbd9KyoxHaUGJLEzU",k=()=>{let[e,t]=(0,c.useState)(()=>"Notification"in window?Notification.permission:"default");return(0,c.useEffect)(()=>{"Notification"in window&&t(Notification.permission)},[]),(0,i.M)("focus",()=>{"Notification"in window&&t(Notification.permission)}),e},M=async(e,t)=>{if(!("Notification"in window))return!1;try{let s=await Notification.requestPermission();if(t&&t({event_key:"claudeai.notification.permission.result",permission:s}),"granted"!==s)return t&&t({event_key:"claudeai.notification.permission.result",permission:s}),!1;{let t,s;if(t=0===(0,r.Dk)().length?(0,r.Wp)(C):(0,r.Sx)(),!await (0,o.TT)())return!1;try{s=(0,o.dG)(t)}catch(e){return!1}let a=(await navigator.serviceWorker.getRegistrations()).find(e=>{var t;return null==(t=e.active)?void 0:t.scriptURL.includes("firebase-messaging-sw.js")});if(!a&&1)try{a=await navigator.serviceWorker.register("/firebase-messaging-sw.js"),await navigator.serviceWorker.ready}catch(e){(0,l.Cp)(e,{tags:{action:"registerServiceWorker"}})}try{let t=await (0,o.gf)(s,{vapidKey:N,serviceWorkerRegistration:a});if(t)e(t);else throw(0,l.Cp)(Error("FCM token is null"),{tags:{action:"getToken"}}),Error("FCM token is null")}catch(e){throw(0,l.Cp)(e,{tags:{action:"getToken"}}),e}}return"granted"===s}catch(e){return(0,l.Cp)(e,{tags:{action:"requestPermission"}}),!1}},A=()=>{let{track:e}=(0,a.st)(),{mutate:t}=(0,d.E)();return(0,c.useCallback)(async()=>(e({event_key:"claudeai.notification.permission.request_started"}),await M(e=>{t({channel_type:d.zZ.FCM,registration_token:e,client_app_name:"claude-ai-web"})},e)),[t,e])},S=()=>{let e=(0,c.useRef)(null),{account:t}=(0,n.YL)(),{mutate:s}=(0,d.E)(),a=async()=>{let t;if(t=0===(0,r.Dk)().length?(0,r.Wp)(C):(0,r.Sx)(),!await (0,o.TT)())return{app:null,messaging:null};if(e.current)return{app:t,messaging:e.current};let s=(0,o.dG)(t);return e.current=s,{app:t,messaging:s}},i=async e=>{try{return await (0,o.gf)(e,{vapidKey:N})}catch(e){return(0,l.Cp)(e,{tags:{action:"getFCMToken"}}),null}},u=(0,c.useCallback)(e=>{s({channel_type:d.zZ.FCM,registration_token:e,client_app_name:"claude-ai-web"})},[s]);return(0,c.useEffect)(()=>{var e;let t=!0,s=null;(async()=>{if("Notification"in window&&"granted"===Notification.permission)try{let{messaging:e}=await a();if(!e||!t)return;let n=await i(e);n&&t&&u(n),s=(0,o.xD)(e,e=>{var t,s;let a=(null==(t=e.data)?void 0:t.title)||"Claude",n={body:null==(s=e.data)?void 0:s.body,icon:"/favicon.svg",badge:"/favicon.svg",data:e.data},i=new Notification(a,n);i.onclick=()=>{var t;if(window.focus(),i.close(),null==(t=e.data)?void 0:t.payload){let t=function(e){if(!e)return null;try{let t=(0,b.Rf)(h,JSON.parse(e),{registry:w});if(!t.request||!t.method)return null;if("OpenChat"===t.method){let e=(0,y.rW)(t.request,v);if(null==e?void 0:e.conversationUuid)return{method:"OpenChat",targetUrl:"/chat/".concat(e.conversationUuid)}}return null}catch(e){return null}}(e.data.payload);if(t){window.location.href=t.targetUrl;return}}window.location.href="/"}})}catch(e){(0,l.Cp)(e,{tags:{action:"setupNotifications"}})}})();let n=e=>{let t=e.data;(null==t?void 0:t.type)==="NOTIFICATION_CLICK_NAVIGATE"&&(null==t?void 0:t.targetUrl)&&(window.location.href=t.targetUrl)};return null==(e=navigator.serviceWorker)||e.addEventListener("message",n),()=>{var e;t=!1,s&&s(),null==(e=navigator.serviceWorker)||e.removeEventListener("message",n)}},[t,u]),null}},42071:(e,t,s)=>{"use strict";s.d(t,{E:()=>r,zZ:()=>l});var a=s(77186),n=s(1761),i=s(87606),l=function(e){return e.FCM="FCM",e.APNS="APNS",e}({});let r=()=>{let{activeOrganization:e}=(0,n.YL)(),t=null==e?void 0:e.uuid,s=(0,i.useQueryClient)();return(0,a.L2)("/api/organizations/".concat(t,"/notification/channels"),"POST",{onSuccess:()=>{s.invalidateQueries({queryKey:["notificationChannels",{orgUUID:t}]})}})}},50824:(e,t,s)=>{"use strict";s.d(t,{b:()=>Q});var a=s(54568),n=s(9234),i=s(2019),l=s(94390),r=s(32987),o=s(7620),c=s(87050),d=s(7726),u=s(41417),m=s(64786),f=s(90119),x=s(75032),h=s(27261),g=s.n(h),p=s(62971),v=s(4191),j=s(9447),b=s(98518),y=s(29242),w=s(98715),_=s(18645),C=s(46760),N=s(79746),k=s(56273),M=s(95675),A=s(70028),S=s(1761),E=s(51121),z=s(56370),I=s(18179),R=s(37076),F=s(9786),T=s(93681),U=s(38583),L=s(17937),D=s(83755),O=s(42566),P=s(57622),B=s(83910),W=s(11134),G=s(99513),J=s(81527);function H(e){let{conversationUUID:t,snapshot:s,closeShareModal:n,showShareModal:i,disabled:l,disabledReason:r}=e,c=(0,C.A)(),m=!!s,{addError:f}=(0,E.Y)(),{account:x,activeOrganization:h}=(0,S.YL)(),g=(0,S.mV)(),v=(0,d.mz)(t),j=null==v?void 0:v.project_uuid,{data:y}=(0,J.fo)(j),w=(null==s?void 0:s.uuid)?V(s.uuid):"",{copyToClipboard:_,didCopy:N}=(0,F.C)(),{mutateAsync:k,isPending:M}=(0,d.Du)(t),{mutate:z,isPending:O}=(0,d.gG)(t,null==s?void 0:s.uuid),P=(0,o.useCallback)(async()=>{try{await k({project_uuid:null==v?void 0:v.project_uuid})}catch(e){f(c.formatMessage({defaultMessage:"Something went wrong while sharing this conversation. Please refresh the page.",id:"bMqfGRVujK"}))}},[k,f,null==v?void 0:v.project_uuid,c]),{track:B}=(0,b.st)(),W=(0,o.useCallback)(()=>{m?(B({event_key:"chat.share.modal.unshare_button.clicked",conversation_uuid:t,snapshot_uuid:null==s?void 0:s.uuid}),z()):(B({event_key:"chat.share.modal.share_button.clicked",conversation_uuid:t}),P())},[m,z,P,B,t,null==s?void 0:s.uuid]);return(0,a.jsx)(R.aF,{title:m?c.formatMessage({defaultMessage:"Chat shared",id:"svB/EMJSZy"}):c.formatMessage({defaultMessage:"Share chat",id:"bXa+lJhlYV"}),isOpen:i,onClose:n,modalSize:"lg",hasCloseButton:!0,children:x?(0,a.jsxs)("div",{className:"flex flex-col gap-3",children:[(0,a.jsx)("div",{children:(0,a.jsx)(Z,{upToDate:null==s?void 0:s.up_to_date,upsertSnapshot:P,isShared:!!m,disabled:l,disabledReason:r,isRaven:g})}),(0,a.jsx)(Y,{isShared:m,project:y,orgName:null==h?void 0:h.name,toggleShare:W,isRaven:g}),m&&(0,a.jsxs)("button",{className:"w-full flex items-center justify-between bg-inherit h-auto text-text-300 border border-border-300 rounded-md px-3 py-2 cursor-pointer hover:bg-bg-300/50",onClick:()=>{B({event_key:"chat.share.open_link.clicked",conversation_uuid:t,snapshot_uuid:null==s?void 0:s.uuid}),window.open(V((null==s?void 0:s.uuid)||""),"_blank")},children:[(0,a.jsx)("span",{className:"truncate",children:V((null==s?void 0:s.uuid)||"")}),(0,a.jsx)(T.F,{size:16})]}),!g&&(0,a.jsxs)("div",{className:"flex flex-row gap-1.5 rounded-lg bg-bg-400 p-2 text-text-300 text-xs",children:[(0,a.jsx)(U.R,{size:16,className:"shrink-0"}),(0,a.jsx)("div",{children:(0,a.jsx)(p.A,{defaultMessage:"Don’t share personal information or third-party content without permission, and see our <usagePolicyLink>Usage Policy</usagePolicyLink>.",id:"RkAGrm1doc",values:{usagePolicyLink:e=>(0,a.jsx)(A.LegalLink,{type:"aup",className:"hover:text-text-100 underline",children:e})}})})]}),(0,a.jsx)("div",{className:"mt-2 flex w-full items-center gap-2",children:m?(0,a.jsx)(u.$,{size:"lg",variant:N?"outline":"primary",onClick:()=>{B({event_key:"chat.share.copy_link.clicked",conversation_uuid:t,snapshot_uuid:null==s?void 0:s.uuid}),_(w)},prepend:N?(0,a.jsx)(L.r,{size:16}):(0,a.jsx)(D.N,{size:16}),children:N?(0,a.jsx)(p.A,{defaultMessage:"Copied",id:"p556q3uvbn"}):(0,a.jsx)(p.A,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})}):(0,a.jsx)(u.$,{size:"lg",loading:M||O,onClick:W,children:(0,a.jsx)(p.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})})})]}):(0,a.jsx)("div",{className:"mb-4 mt-8 flex h-full w-full items-center justify-center",children:(0,a.jsx)(I.Loading,{})})})}let V=e=>new URL("/share/".concat(e),window.location.origin).toString();function Y(e){let{isShared:t,orgName:s,project:n,toggleShare:i,isRaven:l}=e,o=(0,a.jsxs)("button",{className:(0,r.A)("border-border-300 relative flex flex-row items-center justify-between gap-2 w-full rounded-xl border text-left !py-2 !px-3",t?"!bg-bg-000 text-text-000 cursor-pointer":"text-text-300 cursor-default"),children:[(0,a.jsx)(K,{state:t?"shared":"private",orgName:s,project:n,isRaven:l}),t&&(0,a.jsx)(x.a,{size:14,className:"right-3.5 top-3.5 text-text-000"})]});return t?(0,a.jsxs)(z.ms,{align:"start",trigger:o,children:[(0,a.jsx)(z.tJ,{onSelect:i,className:"!gap-0",children:(0,a.jsx)(K,{state:"private",isCurrentState:!t,orgName:s,project:n,isRaven:l})}),(0,a.jsx)(z.tJ,{onSelect:i,className:"!gap-0",children:(0,a.jsx)(K,{state:"shared",isCurrentState:t,orgName:s,project:n,isRaven:l})})]}):(0,a.jsx)("div",{children:o})}function K(e){let{state:t,isCurrentState:s,orgName:n,project:i,isRaven:l}=e;return(0,a.jsx)(a.Fragment,{children:(0,a.jsxs)("span",{className:"inline-flex flex-row items-center justify-between gap-3 max-w-full overflow-hidden",children:[(0,a.jsxs)("span",{className:"inline-flex flex-row items-center gap-1.5 max-w-full",children:[(0,a.jsxs)("span",{className:"text-text-300 shrink-0",children:["private"===t&&(0,a.jsx)(O.c,{size:18}),"shared"===t&&l&&(0,a.jsx)(P.m,{size:18}),"shared"===t&&!l&&(0,a.jsx)(B.q,{size:18})]}),(0,a.jsxs)("p",{className:(0,r.A)("text-ellipsis overflow-hidden",s&&"font-medium text-text-000"),children:["private"===t&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.A,{defaultMessage:"Private (only you have access)",id:"EsW/fizDS4"}),"\xa0",s&&"private"!==t&&(0,a.jsx)("span",{className:"text-text-300 text-sm font-normal",children:(0,a.jsx)(p.A,{defaultMessage:"(Unshare this chat)",id:"EZEp1AdoRv"})})]}),"shared"===t&&l&&(0,a.jsx)(p.A,{defaultMessage:"Shared (anyone in {scope} can view)",id:"mG1NQd3Jzv",values:{scope:(null==i?void 0:i.is_private)?i.name:n}}),"shared"===t&&!l&&(0,a.jsx)(p.A,{defaultMessage:"Public (anyone on the web can view)",id:"no0TFMuRD0"})]})]}),s&&(0,a.jsx)(G.J,{size:16,weight:"bold",className:"text-accent-secondary-100 shrink-0"})]})})}function Z(e){let{upToDate:t,isShared:s,upsertSnapshot:n,disabled:i,disabledReason:l="",isRaven:r}=e;return(0,a.jsx)("div",{className:"flex flex-col gap-1.5",children:(0,a.jsx)("div",{className:"text-text-300 flex flex-row items-center gap-1 text-sm",children:s?(0,a.jsx)(a.Fragment,{children:r&&(t?(0,a.jsx)(p.A,{defaultMessage:"Future messages aren’t included",id:"YiRN6e1JBr"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(p.A,{defaultMessage:"New messages since last shared",id:"RnySEeXsUF"}),(0,a.jsx)(y.m,{tooltipContent:i?l:(0,a.jsx)(p.A,{defaultMessage:"Share the most recent chat content",id:"oAf7Y+LN9j"}),children:(0,a.jsx)(u.$,{variant:"underline",size:"unset",className:"ml-1 gap-1",onClick:n,prepend:(0,a.jsx)(W.P,{}),disabled:i,children:(0,a.jsx)(p.A,{defaultMessage:"Update",id:"BWpuKlRSA1"})})})]}))}):(0,a.jsx)(p.A,{defaultMessage:"Only messages up until now will be shared",id:"OUOkOQvr8p"})})})}function q(e){let{controlsSidebarIsOpen:t,closeControlsSidebar:s,openControlsSidebar:n,conversationUUID:i,isStreaming:l}=e,c=(0,C.A)(),x=(0,f.V)(m.E_),h=function(e){let{track:t}=(0,b.st)(),{data:s}=(0,d.O2)(e.conversationUUID),[a,n]=(0,o.useState)(!1),i=(0,o.useCallback)(()=>{t({event_key:"chat.share.button.clicked",conversation_uuid:e.conversationUUID}),n(!0)},[t,e.conversationUUID]),l=!!(null==s?void 0:s.snapshot),r=l||!!(null==s?void 0:s.shareable)||!!(null==s?void 0:s.disabled_reason),c=e.isStreaming||!l&&!(null==s?void 0:s.shareable);return{conversationUUID:e.conversationUUID,showShareModal:a,openShareModal:i,closeShareModal:()=>n(!1),isShared:l,showShareFlow:r,disabled:c,...s}}({conversationUUID:i,isStreaming:l}),{chatResourceState:{artifacts:g,selectedItem:v},dispatchChatResource:j}=(0,k.i)(),{setIsDrawerExpanded:A}=(0,M.x)(),S=!!n&&!!s&&!t;return(0,a.jsxs)("div",{className:(0,r.A)("flex items-center gap-1","transition-opacity duration-300",t?"md:opacity-0 pointer-events-none user-select-none":"md:opacity-100",!S&&"hidden"),children:[h.showShareFlow&&(0,a.jsx)(N.U,{variant:"ghost",className:"font-medium text-sm !text-text-100",onClick:h.openShareModal,disabled:h.disabled||!S,prepend:(0,a.jsx)(_.F,{size:18,weight:"light"}),disabledReason:h.disabled_reason,children:(0,a.jsx)(p.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})}),g&&Object.values(g).length>0?(0,a.jsx)(y.m,{tooltipContent:c.formatMessage({defaultMessage:"Open artifacts",id:"qsF1KKbjFR"}),delayDuration:500,side:"bottom",children:(0,a.jsx)(u.$,{variant:"ghost",size:x?"icon_sm":"icon",onClick:()=>{if(g)if(v&&(null==v?void 0:v.type)==="artifact")A(!0);else{let e=Object.values(g).reverse().sort((e,t)=>{let s=e.versions[e.versions.length-1];return new Date(t.versions[t.versions.length-1].created_at).getTime()-new Date(s.created_at).getTime()})[0],t=e.versions[e.versions.length-1].uuid;j({type:"SELECT_ARTIFACT",id:e.id,versionUUID:t}),setTimeout(()=>{A(!0)},50)}},disabled:!S,children:(0,a.jsx)(w.nkM,{size:16})})}):null,x&&(0,a.jsx)(N.U,{href:"/new",prepend:(0,a.jsx)(w.OMN,{size:16}),variant:"flat",disabled:!S,className:"ml-1",children:(0,a.jsx)(p.A,{defaultMessage:"Start new chat",id:"KcA+xo4hhh"})}),h.showShareFlow&&(0,a.jsx)(H,{...h})]})}let X=(0,o.memo)(function(e){let{conversationUUID:t,name:s,isInteractive:n=!0,sharedBy:i,project:l,controlsSidebarIsOpen:o,openControlsSidebar:c,closeControlsSidebar:h,isStreaming:b,isSharedChat:y}=e,{data:w}=(0,d.Bq)(t,{enabled:!y}),_=!!l&&!l.is_harmony_project,C=(0,f.V)(m.E_);return(0,a.jsxs)(j.z,{className:(0,r.A)("h-12",!C&&"-mb-6"),contentClassName:"gap-6 pr-2",sticky:!0,children:[(0,a.jsxs)("div",{className:"flex min-w-0 flex-1 shrink flex-col md:flex-row md:items-center",children:[_&&(0,a.jsx)(g(),{href:"/project/".concat(l.uuid),className:"text-text-300 hover:text-text-100 inline-flex min-w-0 shrink-[4] items-center max-md:pl-1 max-md:text-sm tracking-tight",children:(0,a.jsxs)("div",{className:"truncate",children:[l.name," ",(0,a.jsx)("span",{className:"opacity-50",children:"/"})]})}),(0,a.jsx)("div",{className:"flex min-w-0 shrink-1 items-center max-md:text-sm",children:n&&w?(0,a.jsx)(v.p,{conversation:w,initialName:s,trigger:(0,a.jsx)(u.$,{variant:"ghost",size:"default",className:"!text-text-000 !shrink gap-1 !px-1 !py-0 !scale-100 !h-7",append:(0,a.jsx)(x.a,{size:12,weight:"bold"}),"data-testid":"chat-menu-trigger",children:(0,a.jsx)("div",{className:"min-w-0 flex-1",children:(0,a.jsx)("div",{className:"truncate tracking-tight font-normal font-ui",children:s.length>0?s:(0,a.jsx)(p.A,{defaultMessage:"Untitled",id:"3kbIhS7KZS"})})})})}):(0,a.jsx)("div",{className:"truncate tracking-tight font-normal font-ui text-sm",children:s.length>0?s:(0,a.jsx)(p.A,{defaultMessage:"Untitled",id:"3kbIhS7KZS"})})})]}),(0,a.jsxs)("div",{className:"right-3 flex gap-2",children:[i&&(0,a.jsx)("div",{className:"bg-bg-300 text-text-300 rounded-full px-3 py-1.5 text-sm",children:(0,a.jsx)(p.A,{defaultMessage:"Shared by {sharedBy}",id:"UMLOHo6H9c",values:{sharedBy:i}})}),t&&!y&&(0,a.jsx)(q,{conversationUUID:t,controlsSidebarIsOpen:o,openControlsSidebar:c,closeControlsSidebar:h,isStreaming:b})]})]})});function Q(e){let{headerProps:t,mainElement:s,drawerElement:d,auxilaryElement:u,isDrawerOpen:m,autoscrollRef:f,autoscrollDisabled:x,rightSidebarElement:h}=e,[g,p]=(0,o.useState)(!1),v=(0,o.useRef)(null),j=(0,o.useRef)(null),b=(0,o.useRef)(null),y=(0,o.useRef)({interacted:!1}),{setIsDrawerExpanded:w}=(0,M.x)(),_=(0,i.F)("md");(0,o.useEffect)(function(){let e=!0;if(!j.current||!v.current||!C.current||!b.current)return;let t=v.current,s=j.current,a=b.current;if(_){let e=m?window.innerWidth/2-c.r:s.getBoundingClientRect().width;a.style.width="".concat(e,"px")}let n=Date.now(),i=m?0:function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,s=parseFloat(e);return isNaN(s)?t:s}(s.style.flexGrow,50);return m&&(requestAnimationFrame(function i(){if(!e)return;let l=(Date.now()-n)/220,r=50*l;if(l>=1||!_){t.style.flex=String(50),s.style.flex=String(50),a.style.width="auto";return}t.style.flex=String(100-r),s.style.flex=String(r),requestAnimationFrame(i)}),y.current.interacted=!0),!m&&y.current.interacted&&requestAnimationFrame(function l(){if(!e)return;let r=(Date.now()-n)/220,o=i-r*i;if(r>=1||!_){t.style.flex=String(100),s.style.flex=String(0),a.style.width="auto";return}t.style.flex=String(100-o),s.style.flex=String(o),requestAnimationFrame(l)}),()=>{e=!1}},[m]);let[C,N]=(0,l.w)();return(0,o.useEffect)(()=>{if(!j.current||!v.current||!C.current)return;let e=C.current.getBoundingClientRect(),t=v.current.getBoundingClientRect();if(window.innerWidth<768||t.width>420)return;let s=420/e.width*100;v.current.style.flex=String(s),j.current.style.flex=String(100-s)},[N.width,N.height,C]),(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("div",{className:(0,r.A)("flex flex-1 h-screen w-full overflow-hidden relative",g&&"select-none"),ref:C,onMouseUp:function(){p(!1),document.body.style.removeProperty("cursor")},onMouseMove:e=>{var t;if(!g||!j.current||!v.current||!C.current)return;let s=C.current.getBoundingClientRect(),a=v.current.getBoundingClientRect(),n=(t=e.clientX-a.left,Math.min(Math.max(t,420),s.width-240)/s.width*100);v.current.style.flex=String(n),j.current.style.flex=String(100-n)},children:[(0,a.jsxs)("div",{ref:v,className:"h-screen flex flex-col overflow-hidden",style:{flex:"".concat(100," 0")},children:[(0,a.jsx)(X,{...t}),(0,a.jsx)(n.Z,{ref:f,disabled:x,className:"relative h-full flex-1 flex overflow-x-hidden overflow-y-scroll pt-6",children:s})]}),(0,a.jsxs)("div",{className:(0,r.A)("max-md:hidden group w-2 relative h-full cursor-col-resize -mr-1 z-30 grid place-items-center",!m&&"hidden"),onMouseDown:function(){p(!0),document.body.style.setProperty("cursor","col-resize")},children:[(0,a.jsx)("div",{className:(0,r.A)("absolute top-0 bottom-0 right-1 w-[0.5px] bg-border-300","transition-all group-hover:delay-75 group-hover:bg-accent-secondary-100 group-hover:w-px group-hover:translate-x-[0.5px]",g&&"!bg-accent-secondary-000")}),(0,a.jsx)("div",{className:(0,r.A)("h-6 w-2 relative","rounded-full border-0.5 bg-bg-100 shadow border-border-300","transition duration-200 group-hover:delay-75 group-hover:border-accent-secondary-900 group-hover:bg-accent-secondary-900","cursor-col-resize",g&&"!bg-accent-secondary-000 !border-accent-secondary-000")})]}),(0,a.jsx)("div",{ref:j,className:(0,r.A)("max-md:absolute top-0 right-0 bottom-0 left-0 z-20","md:flex-grow-0 md:flex-shrink-0 md:basis-0","overflow-hidden h-screen",m?"max-md:flex-1":"max-md:hidden",g&&"pointer-events-none"),style:{flex:"0 0"},children:(0,a.jsxs)("div",{ref:b,className:"flex flex-col h-full overflow-hidden",children:[(0,a.jsx)("div",{className:"h-12 md:hidden bg-bg-500 bg-opacity-60",onClick:()=>{w(!1)}}),(0,a.jsx)("div",{className:"flex-1 overflow-hidden h-full bg-bg-100",children:d})]})}),h&&(0,a.jsx)("div",{className:"h-screen flex flex-col overflow-hidden w-96 border-l border-border-300 bg-bg-100",children:h})]}),null!=u?u:null]})}},52450:(e,t,s)=>{"use strict";s.d(t,{aS:()=>x,xW:()=>m});var a=s(42977),n=s(54568),i=s(7726),l=s(90510),r=s(41417),o=s(7620),c=s(62971);function d(){let e=(0,a._)(["\n  w-full\n  tabular-nums\n  text-left\n  text-base\n  disabled:pointer-events-none\n  disabled:shadow-none\n  disabled:drop-shadow-none"]);return d=function(){return e},e}let u=e=>{let[t,s]=(0,o.useState)([]),[a,n]=(0,o.useState)(null),{data:l}=(0,i.EV)({limit:i.dy,enabled:!!a}),[r,c]=(0,o.useState)([]),{data:d,error:u}=(0,i.Bq)(null!=a?a:"");return(0,o.useEffect)(()=>{if(!l)return;if(d&&d.uuid===a)t.some(e=>e.uuid===d.uuid)||s(e=>[...e,d]);else{if(!u)return;c(e=>[...e,a])}let i=l.find(e=>!t.some(t=>t.uuid===e.uuid)&&!r.includes(e.uuid));i?n(i.uuid):e(t)},[d,u,r,a,t,l,e]),{totalConversations:null==l?void 0:l.length,numExported:t.length,numFailed:r.length,startExporting:()=>{l&&l.length&&n(l[0].uuid)}}},m=(0,o.forwardRef)((e,t)=>{let[s,a]=(0,o.useState)(!1),[i,l]=(0,o.useState)(null),{totalConversations:r,numExported:d,numFailed:m,startExporting:x}=u(e=>{a(!1),l(JSON.stringify(e,null,2))});return s?(0,n.jsx)(f,{ref:t,disabled:!0,...e,children:m>0?(0,n.jsx)(c.A,{defaultMessage:"Exporting: {numExported} / {totalConversations} ({numFailed} failed)",id:"hKNwlNeKOf",values:{numExported:d,totalConversations:r,numFailed:m}}):(0,n.jsx)(c.A,{defaultMessage:"Exporting: {numExported} / {totalConversations}",id:"EAIBTT4RJD",values:{numExported:d,totalConversations:r}})}):i?(0,n.jsx)(f,{ref:t,...e,onClick:()=>{let e=new Blob([i],{type:"application/json"}),t=URL.createObjectURL(e),s=document.createElement("a");s.href=t,s.download="conversations.json",s.click()},children:(0,n.jsx)(c.A,{defaultMessage:"Download conversations",id:"BS3OuP1PiM"})}):(0,n.jsx)(f,{ref:t,...e,onClick:()=>{a(!0),x()},children:(0,n.jsx)(c.A,{defaultMessage:"Export conversations",id:"0GrSEx4ynQ"})})});m.displayName="ExportConversationsWidget";let f=l.J.button(d()),x=e=>{let{conversationUUID:t}=e,{data:s}=(0,i.$z)(t);return(0,n.jsx)(r.$,{variant:"outline",size:"sm",onClick:()=>{let e=new Blob([JSON.stringify(s,null,2)],{type:"application/json"}),t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download="conversation.json",a.click()},children:(0,n.jsx)(c.A,{defaultMessage:"Download conversation",id:"VBmA8/nsFU"})})}},55563:(e,t,s)=>{"use strict";s.d(t,{z:()=>f});var a=s(54568),n=s(56340),i=s(89697),l=s(41417),r=s(29242),o=s(9786),c=s(32987),d=s(46760),u=s(62971),m=s(92479);let f=e=>{let{className:t,code:s,codeTagProps:l,language:r,title:d}=e,{codeStyle:u}=(0,i.V)(),{didCopy:f,copyToClipboard:h}=(0,o.C)();return(0,a.jsxs)("div",{className:(0,c.A)("flex flex-col gap-3 p-3 bg-bg-100 rounded-md",t),children:[(0,a.jsx)(x,{language:r,title:d,handleCopy:()=>{h(s)},didCopy:f}),(0,a.jsx)(m.A,{className:"code-block__code !my-0 !p-0 !rounded-none !text-sm !leading-relaxed",codeTagProps:l,language:r,PreTag:"div",style:u,renderer:n.G,wrapLongLines:!0,children:s})]})},x=e=>{let{handleCopy:t,didCopy:s,language:n,title:i}=e,m=(0,d.A)();return(0,a.jsxs)("div",{className:"flex justify-between items-center h-3",children:[(0,a.jsx)("p",{className:(0,c.A)("text-text-300 text-[0.6875rem]",i?"font-ui font-medium tracking-tight":"font-mono font-[450]"),children:i||n}),(0,a.jsx)(r.m,{side:"bottom",tooltipContent:(0,a.jsx)(u.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"}),children:(0,a.jsx)(l.$,{"aria-label":m.formatMessage({defaultMessage:"Copy to clipboard",id:"aCdAsIsVv0"}),size:"icon_sm",variant:"ghost",className:"!-mr-1 !w-6 !h-6",onClick:t,children:(0,a.jsx)(o.u,{didCopy:s,size:12,className:"text-text-500"})})})]})}},56326:(e,t,s)=>{"use strict";s.d(t,{$:()=>r,Q:()=>l});var a=s(54568),n=s(7620);let i=n.createContext({renderToolUseCell:void 0}),l=()=>n.useContext(i),r=e=>{let{renderToolUseCell:t,children:s}=e,l=(0,n.useMemo)(()=>({renderToolUseCell:t}),[t]);return(0,a.jsx)(i.Provider,{value:l,children:s})}},65755:(e,t,s)=>{"use strict";s.d(t,{u:()=>l});var a=s(40169),n=s(7904),i=s(57259);function l(e){let t=e.trim();return(0,a.yt)(t,{extensions:[(0,n.x)()],htmlExtensions:[(0,i.k)()]})}},67532:(e,t,s)=>{"use strict";s.d(t,{a:()=>i});var a=s(7620),n=s(11480);let i=(e,t)=>{let s=(0,a.useRef)(!!e),[i,l]=(0,a.useState)(!!e),[r,o]=(0,a.useState)(!e),{expandedItemKey:c,setExpandedItemKey:d}=(0,n.D8)(),u=t&&d,m=(0,a.useCallback)(e=>{u&&d(e?t:void 0),l(e)},[u,d,l,t]),f=u?c===t:i;return(0,a.useEffect)(()=>{!e&&s.current&&setTimeout(()=>{l(!1),setTimeout(()=>{o(!0)},600)},2e3)},[e]),{isExpanded:f,setIsExpanded:m,snappyTransition:r}}},70067:(e,t,s)=>{"use strict";s.d(t,{wD:()=>P,z7:()=>O});var a=s(54568),n=s(94275),i=s.n(n),l=s(8027),r=s(11515),o=s(77186),c=s(1761),d=s(41417),u=s(37076),m=s(98411),f=s(37711),x=s(98769),h=s(27062),g=s(85544),p=s(4705),v=s(67902),j=s(32987),b=s(37463),y=s(49645),w=s(7620),_=s(46760),C=s(62971),N=s(75006),k=s(92947),M=s(73325),A=s(93271),S=s(73817),E=s(11091),z=s(36769),I=s(33562);function R(e){let{onCancel:t,onConfirm:s}=e,n=(0,w.useRef)(null),{menuOptions:i,getEnabledRemoteTools:l}=(0,z.$3)(),r=(0,I.Cn)({setMcpDirectoryModalIsOpen:F,setStyleModalOpenWithScreen:F,setCreateProjectModalIsOpen:F,setGithubModalIsOpen:F,setGmailAuthModalIsOpen:F,setCreatePromptArgumentModalIsOpen:F}),o=(0,E._9)({actions:r,inputMenuIsOpen:!0,setInputMenuIsOpen:()=>void 0,rootItems:i,menuType:"research"});return(0,w.useEffect)(()=>{setTimeout(()=>{n.current&&n.current.focus()})},[]),(0,a.jsx)(a.Fragment,{children:(0,a.jsx)(u.aF,{isOpen:!0,modalSize:"2lg",onClose:t,className:"!px-4 !py-6",children:(0,a.jsxs)("div",{className:"flex flex-col gap-2",children:[(0,a.jsx)("h3",{className:"text-lg font-medium",children:(0,a.jsx)(C.A,{defaultMessage:"Enable integrations for Claude to use in research",id:"OW3ZJC49V0"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)(S.s,{path:o.path,inputMenuSearchQuery:o.inputMenuSearchQuery,setInputMenuSearchQuery:o.setInputMenuSearchQuery,handleBack:o.handleBack}),o.menuView.currentItems.filter(e=>{let{menuItemHidden:t}=e;return!t}).map(e=>(0,a.jsx)(A.$,{item:e,onClick:()=>o.handleClickItem(e),isHighlighted:o.highlightedItemKey===e.key,countDisplayVariant:"verbose"},e.key))]}),(0,a.jsx)("div",{className:"bg-bg-300 border-border-400 border px-4 py-3 rounded-lg text-sm text-text-300",children:(0,a.jsx)(C.A,{defaultMessage:"Ensure you have appropriate permissions and trust third-party tools before continuing. <link>Learn more</link> about safely using research with connected apps.",id:"VU67M+9esK",values:{link:e=>(0,a.jsx)("a",{href:"https://support.anthropic.com/",className:"underline",target:"_blank",rel:"noreferrer noopener",children:e})}})}),(0,a.jsxs)("div",{className:"flex flex-row justify-end gap-2 mt-4",children:[(0,a.jsx)(d.$,{variant:"outline",onClick:t,children:(0,a.jsx)(C.A,{defaultMessage:"Cancel",id:"47FYwba+bI"})}),(0,a.jsxs)(d.$,{ref:n,onClick:function(){s({tools:l()})},children:[(0,a.jsx)(C.A,{defaultMessage:"Confirm",id:"N2IrpMDHDB"}),(0,a.jsx)("span",{className:"inline-block ml-2 p-1 bg-bg-000/20 rounded-sm",children:(0,a.jsx)(M.y,{size:12})})]})]})]})})})}function F(){}var T=s(95675),U=s(56273),L=s(84137),D=s(73347);let O=N.z.preprocess(e=>{if("string"==typeof e)try{return JSON.parse(e)}catch(e){}return e},N.z.object({task_id:N.z.string()}));function P(e){let{toolUseId:t,isFirstBlockOfMessage:s=!1,isLastBlockOfMessage:n=!1,conversationUUID:i,toolResult:l,isShared:r,isExpanded:d=!1,isStreaming:u=!1,context:m}=e,{value:f}=(0,h.fS)("papi_mcp"),{activeOrganization:x}=(0,c.YL)(),{dispatchChatResource:p}=(0,U.i)(),{setIsDrawerExpanded:v}=(0,T.x)(),{decisionState:b,approveTool:y,denyTool:C}=function(e,t,s,a){let[n,i]=(0,w.useState)("pending"),l=!!(e&&t&&a),{isPending:r}=(0,o.Sk)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval_state/").concat(s),{enabled:l}),c=(0,o.L2)("/api/organizations/".concat(e,"/chat_conversations/").concat(t,"/tool_approval"),"POST",{enabled:!!(t&&!r),onSuccess(e,t){i(t.is_approved?"approved":"denied")}}).mutate;return{decisionState:n,isStatePending:r,approveTool:(0,w.useCallback)(e=>{let{tools:t}=e;c({tool_use_id:s,is_approved:!0,params:{tools:t}})},[c,s]),denyTool:(0,w.useCallback)(()=>{c({tool_use_id:s,is_approved:!1})},[c,s])}}(null==x?void 0:x.uuid,i,t,u),N=u?"approved"===b:l&&!(null==l?void 0:l.is_error),k=f&&(null==m?void 0:m.tools.length)&&u&&"pending"===b,M=(0,w.useMemo)(()=>{if(!(null==l?void 0:l.content))return;let e=l.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:t}=O.safeParse(e);return null==t?void 0:t.task_id},[null==l?void 0:l.content]),{compassStatus:A,isLoading:S,error:E}=(0,L.CH)({organizationUUID:null==x?void 0:x.uuid,conversationUUID:i,taskId:M,isShared:r,enabled:N});(0,L.IK)(i,null==A?void 0:A.status);let z=!A,I=(0,w.useCallback)(()=>{z||(v(!0),p({type:"OPEN_COMPASS_STATUS",data:{conversationUUID:i,organizationUUID:null==x?void 0:x.uuid,isShared:r,toolUseId:null==l?void 0:l.tool_use_id,taskId:M}}))},[z,p,i,null==x?void 0:x.uuid,v,r,l,M]),F=(null==A?void 0:A.status)||g.zu.Starting,D=!!E||!!(null==l?void 0:l.is_error),P=(0,_.A)(),{title:B,subtitle:J}=(0,w.useMemo)(()=>{let e,t;if(D)return{title:P.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"})};let s=(null==A?void 0:A.total_sources)||0,a=0===s?P.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"}):P.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}} and counting...",id:"wfqjY4cYXF"},{count:s}),n=P.formatMessage({defaultMessage:"{count, plural, one {# source} other {# sources}}",id:"WrpI57Uej/"},{count:s}),i=(0,L.Ui)(A),l=i||P.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}),r=i||P.formatMessage({defaultMessage:"Research complete",id:"9Tbl1w5GjC"});switch(F){case g.zu.Starting:{let t=[P.formatMessage({defaultMessage:"Getting everything ready...",id:"5nJVpwt8gP"}),P.formatMessage({defaultMessage:"Preparing your research assistant...",id:"vxRKHhLIWM"}),P.formatMessage({defaultMessage:"Initializing research tools...",id:"Lm6wYLrJ1Q"}),P.formatMessage({defaultMessage:"Setting up my research space...",id:"EGN8CB7IRt"}),P.formatMessage({defaultMessage:"Configuring research parameters...",id:"eYoO3vRQgY"}),P.formatMessage({defaultMessage:"Loading research capabilities...",id:"GHM/w3WPnr"}),P.formatMessage({defaultMessage:"Preparing to dive in...",id:"EW22N+F8aq"}),P.formatMessage({defaultMessage:"Setting the stage for discovery...",id:"l8a+mVgI7N"}),P.formatMessage({defaultMessage:"Getting your assistant ready...",id:"GLpbkAPwDC"}),P.formatMessage({defaultMessage:"Activating research mode...",id:"SPBnT2clve"}),P.formatMessage({defaultMessage:"Warming up the engines...",id:"biUnCTBtnQ"})],s=Math.floor(Math.random()*t.length);e=t[s];break}case g.zu.Planning:e=l,t=P.formatMessage({defaultMessage:"Creating my research plan...",id:"4eRg5buC9J"});break;case g.zu.InitiatingAgents:e=l,t=P.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"});break;case g.zu.Searching:e=l,t=a;break;case g.zu.CreatingArtifact:e=l,t=P.formatMessage({defaultMessage:"Writing and citing report...",id:"2b/CKxnAiJ"});break;case g.zu.Completed:t=n,e=r;break;case g.zu.Cancelled:e=l,t=P.formatMessage({defaultMessage:"Interrupted",id:"rJQDmlVOoX"});break;case g.zu.TimedOut:case g.zu.Failed:e=P.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"}),t=n}return{title:e,subtitle:t}},[P,F,A,D]);return k&&(null==m?void 0:m.use_finegrained_approval)?(0,a.jsx)(R,{onCancel:C,onConfirm:e=>{let{tools:t}=e;y({tools:t})}}):k?(0,a.jsx)(H,{tools:m.tools,onCancel:C,onApprove:()=>{y({tools:[]})}}):(0,a.jsx)("div",{className:(0,j.A)("my-3",s?"mt-2":"mt-3",n?"mb-2":"mb-3"),children:S?(0,a.jsxs)("div",{className:"w-full p-4 text-text-000 font-ui tracking-tight rounded-xl border border-border-300 shadow-xs",children:[(0,a.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-3/4"}),(0,a.jsx)("div",{className:"flex text-text-300 text-xs items-center mt-2",children:(0,a.jsx)("div",{className:"h-5 bg-bg-300/30 rounded-md w-24"})})]}):(0,a.jsxs)("button",{className:(0,j.A)("transition-[border] duration-300 w-full p-4 !pt-0 text-text-000 font-ui tracking-tight rounded-xl border shadow-xs overflow-hidden",!z&&"cursor-pointer hover:shadow-sm hover:bg-bg-000/50 hover:border-border-200",d?"!border-accent-secondary-200":"border-border-300"),disabled:z,onClick:I,children:[(0,a.jsx)(W,{title:B,compassStatus:A,useShimmer:F===g.zu.Starting,isError:D||F===g.zu.Failed||F===g.zu.TimedOut,isExpanded:d}),(0,a.jsx)(G,{subtitle:J,compassStatus:A,isError:F===g.zu.Cancelled,useShimmer:!d&&!!A&&![g.zu.CreatingArtifact,g.zu.Completed,g.zu.Cancelled,g.zu.TimedOut,g.zu.Failed].includes(A.status)})]})})}function B(e){let{className:t,text:s,useShimmer:n}=e,[l,r]=(0,w.useState)(s),[o,c]=(0,w.useState)(!1),[d,u]=(0,w.useState)("");return(0,w.useEffect)(()=>{if(s!==l){u(l),r(s),c(!0);let e=setTimeout(()=>{c(!1)},300);return()=>clearTimeout(e)}},[s,l]),(0,a.jsxs)("div",{title:l,className:"jsx-34e91f3cef6c43c9 "+((0,j.A)("relative overflow-hidden",t)||""),children:[(0,a.jsx)(i(),{id:"34e91f3cef6c43c9",children:"@-webkit-keyframes slideUpFadeOut{0%{-webkit-transform:translatey(0);transform:translatey(0);opacity:1}100%{-webkit-transform:translatey(-100%);transform:translatey(-100%);opacity:0}}@-moz-keyframes slideUpFadeOut{0%{-moz-transform:translatey(0);transform:translatey(0);opacity:1}100%{-moz-transform:translatey(-100%);transform:translatey(-100%);opacity:0}}@-o-keyframes slideUpFadeOut{0%{-o-transform:translatey(0);transform:translatey(0);opacity:1}100%{-o-transform:translatey(-100%);transform:translatey(-100%);opacity:0}}@keyframes slideUpFadeOut{0%{-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0);opacity:1}100%{-webkit-transform:translatey(-100%);-moz-transform:translatey(-100%);-o-transform:translatey(-100%);transform:translatey(-100%);opacity:0}}@-webkit-keyframes slideUpFadeIn{0%{-webkit-transform:translatey(100%);transform:translatey(100%);opacity:0}100%{-webkit-transform:translatey(0);transform:translatey(0);opacity:1}}@-moz-keyframes slideUpFadeIn{0%{-moz-transform:translatey(100%);transform:translatey(100%);opacity:0}100%{-moz-transform:translatey(0);transform:translatey(0);opacity:1}}@-o-keyframes slideUpFadeIn{0%{-o-transform:translatey(100%);transform:translatey(100%);opacity:0}100%{-o-transform:translatey(0);transform:translatey(0);opacity:1}}@keyframes slideUpFadeIn{0%{-webkit-transform:translatey(100%);-moz-transform:translatey(100%);-o-transform:translatey(100%);transform:translatey(100%);opacity:0}100%{-webkit-transform:translatey(0);-moz-transform:translatey(0);-o-transform:translatey(0);transform:translatey(0);opacity:1}}"}),o&&(0,a.jsx)("div",{style:{animation:"slideUpFadeOut 300ms forwards"},className:"jsx-34e91f3cef6c43c9 absolute w-full text-ellipsis overflow-hidden whitespace-nowrap text-left",children:n?(0,a.jsx)(f.N,{children:d}):d}),(0,a.jsx)("div",{style:o?{animation:"slideUpFadeIn 300ms forwards"}:void 0,className:"jsx-34e91f3cef6c43c9 w-full relative text-ellipsis overflow-hidden whitespace-nowrap text-left",children:n?(0,a.jsx)(f.N,{children:l}):l})]})}function W(e){let{title:t,isError:s,compassStatus:n,useShimmer:i,isExpanded:l}=e,[r,o]=(0,w.useState)(!1),c=(0,L.Nw)(n),d=(0,w.useRef)(c);(0,w.useEffect)(()=>{c&&!d.current&&(o(!0),setTimeout(()=>{o(!1)},3.5*c.length+.5),d.current=c)},[c]);let u=!l&&r;return(0,a.jsxs)("div",{className:"flex flex-row justify-between items-center h-9 gap-4 relative",children:[(0,a.jsxs)("div",{className:"h-9 min-w-0 w-full",children:[u&&!!c&&(0,a.jsx)(b.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:(0,a.jsx)(J,{thought:c})}),(0,a.jsx)(y.N,{initial:!1,children:!(u&&c)&&(0,a.jsxs)(b.P.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.5,ease:x.A.inOutQuart},className:(0,j.A)("absolute w-[calc(100%-1.75rem)] top-0 left-0 flex items-center rounded-lg text-sm min-w-0 mt-4",s?"text-danger-000":""),children:[s&&(0,a.jsx)(p.N,{className:"text-danger-000 mr-1 flex-shrink-0",size:16}),(0,a.jsx)("p",{className:"flex-1 overflow-hidden text-left text-ellipsis break-words text-nowrap",children:(0,a.jsx)(B,{text:t,useShimmer:!!i&&!s})})]})})]}),!!n&&(0,a.jsx)(v.K,{size:12,className:"text-text-500 mt-4"})]})}function G(e){var t,s;let{subtitle:n,isError:i,compassStatus:l,useShimmer:r}=e,o=(0,w.useMemo)(()=>(null==l?void 0:l.agents)&&!(l.agents.length<1)?(0,L.mk)({agents:l.agents,n:3}):[],[null==l?void 0:l.agents]);return n?(0,a.jsxs)("div",{className:"flex text-text-300 text-xs items-center mt-2 tabular-nums h-5",children:[!!o.length&&(0,a.jsx)("div",{className:"flex-shrink-0 mr-1",children:(0,a.jsx)(L.mq,{hrefs:o})}),(null==l?void 0:l.status)===g.zu.Completed&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(C.A,{defaultMessage:"Research complete",id:"9Tbl1w5GjC"}),(0,a.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:"•"})]}),(0,a.jsx)(B,{text:n,useShimmer:r,className:i?"text-danger-000":""}),!!(null==l?void 0:l.started_at)&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("span",{className:"text-[0.4rem] mx-1 text-[#A29F95]",children:"•"}),(0,a.jsx)("div",{className:"text-text-500",children:(0,a.jsx)(L.YE,{startedAt:null!=(t=null==l?void 0:l.started_at)?t:null,completedAt:null!=(s=null==l?void 0:l.finished_at)?s:null})})]})]}):null}function J(e){let{thought:t}=e;return(0,a.jsx)("div",{className:"h-9 w-full",children:(0,a.jsx)("div",{className:"blur-[2px] h-11 px-1 -mx-1 -mb-2 w-full relative overflow-y-hidden overflow-x-visible [mask-image:linear-gradient(to_top,_hsl(var(--always-black)/0%)_0%,hsl(var(--always-black)/100%)_75%,_hsl(var(--always-black)/0%)_100%)]",children:(0,a.jsx)(b.P.div,{className:"absolute top-0 left-1 right-0 text-left",initial:{y:40},animate:{y:"calc(-100%)"},transition:{delay:.5,duration:3.5*t.length/1e3,ease:x.A.inOutBase},children:(0,a.jsx)(L.GT,{thought:t})})})})}function H(e){let{tools:t,onCancel:s,onApprove:n}=e,{servers:i}=(0,k.gt)();return(0,a.jsx)(u.aF,{modalSize:"xl",isOpen:!0,onClose:s,title:(0,a.jsx)(C.A,{defaultMessage:"Claude may use the following custom integrations while researching",id:"OKJu4YENMc"}),children:(0,a.jsxs)("div",{className:"flex flex-col gap-4 pt-4",children:[(0,a.jsxs)("div",{className:"border-0.5 border-border-300 rounded-lg my-4 relative",children:[(0,a.jsx)("div",{className:"flex flex-col gap-4 p-4 max-h-[300px] overflow-y-auto",children:i.map(e=>{let s=t.filter(t=>t.server_uuid===e.uuid).map(e=>e.tool_name),n=e.tools.filter(e=>s.includes(e.name));return n.length?n.map(t=>(0,a.jsx)(m.fI,{className:"!py-0",children:(0,a.jsxs)("div",{className:"flex gap-3 items-start",children:[(0,a.jsx)(r.d,{url:e.url,fallbackSvg:(0,a.jsx)(l.B,{letter:e.name,size:30,fontSize:11,className:"shrink-0 font-medium mt-1"}),size:30}),(0,a.jsxs)("div",{className:"flex flex-col gap-1",children:[(0,a.jsx)("div",{className:"text-sm font-mono",style:{fontWeight:700},children:t.name}),(0,a.jsx)(D.M,{text:t.description,className:"text-[0.9rem] !text-text-500"})]})]})},t.name)):null})}),(0,a.jsx)("div",{className:"absolute bottom-0 left-2 right-2 h-6 bg-gradient-to-t from-bg-200 to-bg-200/0 pointer-events-none z-10"})]}),(0,a.jsxs)("div",{className:"flex flex-col gap-1 p-4 border border-accent-secondary-900 rounded-lg bg-accent-secondary-900/30",children:[(0,a.jsxs)("div",{className:"flex gap-2 items-center",children:[(0,a.jsx)(p.N,{className:"text-accent-secondary-000",size:16,weight:"bold"}),(0,a.jsx)("h4",{className:"text-accent-secondary-000 font-medium",children:(0,a.jsx)(C.A,{defaultMessage:"You are enabling Claude to retrieve content from your connected apps.",id:"RPQTc1f34V"})})]}),(0,a.jsx)("p",{className:"text-text-300",children:(0,a.jsx)(C.A,{defaultMessage:"Please ensure you have all appropriate permissions and trust these tools before continuing. <link>Learn more</link> about safely using Research with connected apps.",id:"b86SF7HKhH",values:{link:e=>(0,a.jsx)("a",{className:"underline",href:"https://support.anthropic.com/en/articles/11175166-about-custom-integrations-using-remote-mcp",target:"_blank",rel:"noopener noreferrer",children:e})}})})]}),(0,a.jsxs)("div",{className:"flex gap-2 justify-end",children:[(0,a.jsx)(d.$,{variant:"outline",onClick:s,children:(0,a.jsx)(C.A,{defaultMessage:"Cancel Research",id:"GuxgLirKvY"})}),(0,a.jsx)(d.$,{onClick:n,children:(0,a.jsx)(C.A,{defaultMessage:"Research with {count, plural, one {# tool} other {# tools}}",id:"H0wjvrIsuM",values:{count:t.length}})})]})]})})}},70678:(e,t,s)=>{"use strict";s.d(t,{CV:()=>ej,mY:()=>ew});var a=s(42977),n=s(54568),i=s(68096),l=s(10498),r=s(57067),o=s(98518),c=s(10158),d=s(1761),u=s(51121),m=s(9537),f=s(90510),x=s(41417),h=s(56370),g=s(99272),p=s(32987),v=s(26631),j=s(7620);function b(){let e=(0,a._)(["\n  z-dropdown\n  bg-bg-100\n  border-0.5\n  border-border-300\n  backdrop-blur-xl\n  rounded-lg\n  min-w-[8rem]\n  overflow-hidden\n  p-1\n  text-text-200\n  shadow-element\n"]);return b=function(){return e},e}function y(e){var t;let{children:s,open:a,defaultButtonLabel:i,onClickDefaultButton:l,onOpenChange:r,...o}=e;return(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)(v.bL,{open:a,onOpenChange:r,children:[(0,n.jsxs)("div",{className:"flex border border-border-300 font-medium rounded-lg overflow-hidden",children:[(0,n.jsx)("button",{className:(0,p.A)("py-1 px-2 border-r border-border-300 hover:bg-bg-200",a&&"bg-bg-200"),onClick:l,children:i}),(0,n.jsx)(v.l9,{asChild:!0,children:(0,n.jsx)("button",{className:"py-1 px-1 hover:bg-bg-200",children:(0,n.jsx)(g.a,{size:16})})})]}),(0,n.jsx)(v.ZL,{children:(0,n.jsx)(w,{sideOffset:null!=(t=o.sideOffset)?t:4,...o,children:s})})]})})}let w=(0,f.J)(v.UC)(b());var _=s(18179),C=s(37076),N=s(29242),k=s(9786),M=s(54890),A=s(91961),S=s(64786),E=s(27062),z=s(90119),I=s(61670),R=s(59382),F=s(18645),T=s(60265),U=s(29035),L=s(87095),D=s(52584),O=s(76761),P=s(17937),B=s(83755),W=s(82919),G=s(21846),J=s(64039),H=s(40758),V=s(49645),Y=s(37463),K=s(20591),Z=s.n(K),q=s(61773),X=s(27261),Q=s.n(X),$=s(62971),ee=s(46760),et=s(22336),es=s(41932),ea=s(81527),en=s(56273),ei=s(65755),el=s(42153),er=s(13500),eo=s(69904);function ec(){let e=(0,a._)(["\n  border\n  border-border-400\n  bg-bg-100\n  w-96\n  rounded-xl\n  font-medium\n  text-text-300\n  text-sm\n"]);return ec=function(){return e},e}function ed(e){let t,{onClose:s,onSubmitRating:a,onSubmitNotes:i}=e,l=(0,ee.A)(),[r,o]=(0,j.useState)(!1),[c,d]=(0,j.useState)(""),u=e=>{a(e),o(!0)},f=()=>{s()};return t=r?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex justify-between mb-2",children:[(0,n.jsx)("div",{className:"ml-1",children:(0,n.jsx)($.A,{defaultMessage:"What were you trying to accomplish when this artifact was created?",id:"CrrumB/FnI"})}),(0,n.jsx)("div",{className:"pt-1",children:(0,n.jsx)("button",{onClick:f,children:(0,n.jsx)(el.X,{size:20})})})]}),(0,n.jsx)("form",{onSubmit:e=>{e.preventDefault(),i(c),f()},children:(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)("div",{className:"grow",children:(0,n.jsx)(m.ks,{className:"w-full",placeholder:l.formatMessage({defaultMessage:"e.g. make a graph",id:"g1RrFC72N+"}),value:c,onChange:e=>d(e.target.value)})}),(0,n.jsx)("div",{children:(0,n.jsx)(x.$,{variant:"primary",type:"submit",children:(0,n.jsx)($.A,{defaultMessage:"Send",id:"9WRlF4R2gm"})})})]})})]}):(0,n.jsxs)("div",{className:"flex justify-between",children:[(0,n.jsx)("div",{className:"flex items-center",children:(0,n.jsx)($.A,{defaultMessage:"Is this artifact useful?",id:"RxVIwIW9vn"})}),(0,n.jsxs)("div",{className:"flex gap-2",children:[(0,n.jsx)(x.$,{variant:"ghost",size:"icon_sm",onClick:()=>u(!0),"aria-label":l.formatMessage({defaultMessage:"Thumbs up",id:"0HnZ1ci6be"}),children:(0,n.jsx)(er.t,{size:20})}),(0,n.jsx)(x.$,{variant:"ghost",size:"icon_sm",onClick:()=>u(!1),"aria-label":l.formatMessage({defaultMessage:"Thumbs down",id:"go4L4rFJNq"}),children:(0,n.jsx)(eo.S,{size:20})}),(0,n.jsx)(x.$,{variant:"ghost",size:"icon_sm",onClick:f,"aria-label":l.formatMessage({defaultMessage:"Close",id:"rbrahOGMC3"}),children:(0,n.jsx)(el.X,{size:20})})]})]}),(0,n.jsxs)(eu,{children:[(0,n.jsx)("div",{className:"p-3",children:t}),(0,n.jsx)("div",{className:"p-3 border-t border-border-400 w-full font-normal text-xs text-text-500",children:(0,n.jsx)("a",{className:"hover:underline",href:"https://support.anthropic.com/en/articles/9957937-how-does-anthropic-use-submitted-feedback",target:"_blank",children:(0,n.jsx)($.A,{defaultMessage:"Learn more about how Anthropic uses feedback",id:"NBSES31K7c"})})})]})}let eu=f.J.div(ec());var em=s(66849),ef=s(35420);let ex=e=>{let{currentArtifact:t,hasMenuOpen:s,setHasMenuOpen:a}=e,i=(0,j.useCallback)(()=>{a(!1)},[a]),{chatResourceState:{artifacts:l},dispatchChatResource:r}=(0,en.i)(),o=Object.values(l).reverse().sort((e,t)=>{let s=e.versions[e.versions.length-1];return new Date(t.versions[t.versions.length-1].created_at).getTime()-new Date(s.created_at).getTime()}),c=(0,j.useRef)(t),d=(0,j.useRef)(!1),u=e=>{d.current=!0,i();let t=o[e];c.current=t,m(t)},m=(0,j.useCallback)(e=>{queueMicrotask(()=>{r({type:"SELECT_ARTIFACT",id:e.id,versionUUID:e.versions[e.versions.length-1].uuid})})},[r]);(0,j.useEffect)(()=>{let e=c.current;return()=>{e&&!d.current&&(null==t?void 0:t.id)!==e.id&&m(e),d.current=!1}},[]);let f=(0,em.w)(),h=(0,ee.A)();return o.length<2?null:(0,n.jsxs)(v.bL,{open:s,onOpenChange:e=>a(e),children:[(0,n.jsx)(v.l9,{asChild:!0,children:(0,n.jsx)(x.$,{variant:"ghost",size:"icon_sm",className:"-mx-1",children:(0,n.jsx)(N.m,{side:"right",className:"ml-2",tooltipContent:s?"":h.formatMessage({defaultMessage:"Switch between artifacts",id:"mYiLqlDMdl"}),delayDuration:800,children:(0,n.jsx)(ef.c,{size:20})})})}),(0,n.jsx)(v.UC,{align:"start",asChild:!0,children:(0,n.jsx)("ul",{className:"\n            relative\n            z-dropdown\n            overflow-y-auto\n            max-h-[min(var(--radix-dropdown-menu-content-available-height),var(--dropdown-max-height))]\n            flex flex-col gap-1\n            py-2 pr-3\n          ",onMouseLeave:()=>c.current&&m(c.current),children:o.map((e,t)=>{var s;let a=e.type?f[e.type]:null,i=(null==(s=c.current)?void 0:s.id)===e.id,l=h.formatMessage({defaultMessage:"versions",id:"bhuRmwJBaN"}),r=e.versions.length>1?"".concat(e.versions.length):"",o=e.versions.length>1&&a?" \xb7 ":"";return(0,n.jsx)(Y.P.li,{initial:{y:-12,opacity:0},animate:{y:0,opacity:1},exit:{opacity:0,transition:{ease:"easeOut",duration:.1,delay:0}},transition:{delay:.035*t,type:"spring",stiffness:285,damping:25,mass:1},role:"none",children:(0,n.jsxs)(v.q7,{className:(0,p.A)("bg-bg-000 border-0.5 cursor-pointer can-focus","flex flex-col py-2 pl-3 pr-4 w-full max-w-72 mb-px rounded-lg overflow-hidden","text-sm text-left transition duration-300 drop-shadow-[0_2px_8px_hsl(var(--always-black)/5%)]",i?"border-accent-secondary-100 shadow-[0_0_0_1px_hsl(var(--accent-secondary-100))]":"text-text-300 hover:text-text-100 border-border-200 hover:border-accent-secondary-100 focus-within:border-accent-secondary-100 focus-within:text-text-100"),onClick:()=>u(t),onMouseEnter:()=>{m(e)},"aria-label":"".concat(e.title).concat(a?", ".concat(a):"").concat(r?", ".concat(r," ").concat(l):""),children:[(0,n.jsx)("div",{className:"line-clamp-2",children:e.title}),(0,n.jsxs)("span",{className:"text-text-300",children:[e.versions.length>1?(0,n.jsxs)(n.Fragment,{children:[r," ",l]}):null,o?(0,n.jsx)(n.Fragment,{children:o}):null,a]})]},e.id)},e.id)})})})]})};async function eh(e){if(e.type!==M.vU.Markdown)throw Error("Only markdown artifacts can be saved as PDF");let t=document.getElementById("markdown-artifact");if(!t)throw Error("Markdown artifact element not found");return new Promise((s,a)=>{try{var n;let i=document.head.innerHTML,l=document.createElement("iframe");l.style.position="fixed",l.style.right="0",l.style.bottom="0",l.style.width="0",l.style.height="0",l.style.border="0",l.setAttribute("sandbox","allow-same-origin allow-modals"),l.setAttribute("csp",""),document.body.appendChild(l);let r=l.contentDocument||(null==(n=l.contentWindow)?void 0:n.document);if(!r){document.body.removeChild(l),a(Error("Could not access iframe document"));return}let o=(null==e?void 0:e.title)||"Artifact";r.write("\n        <!DOCTYPE html>\n        <html>\n          <head>\n            <title>".concat(o,"</title>\n            ").concat(i,"\n            <style>\n              /* Remove browser-added headers and footers */\n              @page {\n                size: auto;\n                margin: 0; /* Keep at 0 to remove datetime, page count, website, etc */\n                padding: 25px 0; /* top and bottom page padding */\n              }\n              @media print {\n                html, body, pre, code {\n                  -webkit-print-color-adjust: exact !important;\n                  color-adjust: exact !important;\n                  print-color-adjust: exact !important;\n                }\n              \n                * Smart page breaks */\n                h1, h2, h3 {\n                  page-break-after: avoid !important;\n                }\n                img, pre, table {\n                  page-break-inside: avoid !important;\n                }\n              }\n            </style>\n          </head>\n          <body>\n            ").concat(t.outerHTML,"\n          </body>\n        </html>\n      ")),r.close();let c=document.title,d=()=>{try{document.title=c,document.body.removeChild(l)}catch(e){}};l.onload=()=>{try{var t;document.title="".concat((null==e?void 0:e.title)||"Markdown Artifact"),null==(t=l.contentWindow)||t.print(),setTimeout(()=>{d(),s()},100)}catch(e){d(),a(e)}},l.onerror=e=>{d(),a(e)}}catch(e){a(e)}})}let eg=(e,t)=>{let[s,a]=(0,j.useState)(""),[n,i]=(0,j.useState)("");return(0,j.useEffect)(()=>{var s;let n=null!=(s=e.versions[t].resultState)?s:"",l=(0,M.eg)(e),r=new Blob([n],{type:"text/plain"}),o=URL.createObjectURL(r);return a(o),i("".concat(e.id,".").concat(l)),()=>{URL.revokeObjectURL(o)}},[e,t]),{downloadUrl:s,filename:n}};function ep(){let e=(0,a._)(["\n  flex\n  flex-none\n  items-center\n  justify-between\n  text-sm\n  text-text-500\n  py-2\n  px-2\n  border-t\n  border-border-400\n"]);return ep=function(){return e},e}function ev(){let e=(0,a._)(["\n  border-border-400\n  sticky\n  flex\n  items-center\n  gap-1\n  border-b\n  px-2\n  py-2\n"]);return ev=function(){return e},e}let ej=e=>{var t,s,a,c,u,m,f,x,h,g;let{onClose:v,artifact:b,isStreaming:y,selectedArtifactMessageUUID:w,selectedArtifactVersionUUID:_,setSelectedArtifactVersionUUID:C,projectUuid:N,selectDoc:k,disablePublishing:A,sendMessage:S,richSandboxCapabilities:z,isOpen:R}=e,{account:F}=(0,d.YL)(),T=(0,o.st)(),[U,L]=(0,j.useState)("normal"),D=(0,j.useRef)(null),O=(0,d.mV)(),[P,B]=(0,j.useState)(!0),{value:W}=(0,E.fS)("publish_artifacts"),{data:G}=(0,ea.fo)(N),J=!A&&W&&!O,[H,{open:K,close:Z}]=(0,I.j)(!1),q=(0,j.useCallback)(()=>{B(!1)},[]),{data:X}=(0,et.rC)({includeDeletedArtifacts:!0}),Q=y&&!(null==b||null==(t=b.versions[b.versions.length-1])?void 0:t.isClosed),$=(0,j.useMemo)(()=>{if(!b)return 0;if(!Q&&_&&w!==r.gv){let e=b.versions.findIndex(e=>e.uuid===_);if(-1!==e)return e}return!Q&&w&&w!==r.gv?b.versions.findIndex(e=>e.message===w):b.versions.length-1},[w,_,Q,b]),{value:ee}=(0,E.fS)("apps_artifacts_sh"),es=null==b||null==(s=b.versions[$])?void 0:s.uuid;(0,j.useEffect)(()=>{es&&es!==_&&C(es),L("normal")},[null==b?void 0:b.id,es,C,_]);let ei=ee&&O,[el,{open:er,close:eo}]=(0,I.j)(!1),ec=b&&(null==X||null==(a=X.find(e=>{let{artifact_identifier:t,message_uuid:s}=e;return t===b.id&&s===b.versions[$].message}))?void 0:a.published_artifact_uuid),eu=null!=(f=null==X?void 0:X.some(e=>{let{published_artifact_uuid:t,deleted:s}=e;return t===ec&&s}))&&f,em=null==b||null==(c=b.versions[$])?void 0:c.message,[ef,ex]=(0,j.useState)(!1);(0,j.useEffect)(()=>ex(ef||y),[ef,y]);let[eh,eg]=(0,j.useState)(!1);(0,j.useEffect)(()=>eg(!1),[w,em]);let[ep,ev]=(0,j.useState)(!1),{data:ej}=(0,et.SN)(),{mutate:ey}=(0,i.Jy)(),{track:ew}=(0,o.st)(),eN=null!=(x=(0,en.i)().chatResourceState.conversationUUID)?x:"",{mutateAsync:ek}=(0,et._2)(eN),eM=(0,j.useCallback)(async()=>{if(!_)try{var e;let{artifactVersionUUID:t}=await ek({version_index:$,artifact_identifier:null!=(e=null==b?void 0:b.id)?e:""});C(t)}catch(e){console.error("Error getting artifact UUID: ".concat(e));return}ew({event_key:"artifact.share_button_clicked",message_uuid:em,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),er()},[_,er,ek,$,null==b?void 0:b.id,C,ew,em,null==b?void 0:b.type,null==b?void 0:b.language]),eA=(0,j.useCallback)(()=>{ew({event_key:"artifact.publish_button_clicked",message_uuid:em,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),K()},[K,ew,em,null==b?void 0:b.type,null==b?void 0:b.language]),eS=(null==b?void 0:b.type)===M.vU.Text,eE=(null==b?void 0:b.type)===M.vU.Markdown||(null==b?void 0:b.type)===M.vU.Code,ez=(null==b?void 0:b.type)===M.vU.Html||(null==b?void 0:b.type)===M.vU.React,eI=(null==b?void 0:b.type)!==M.vU.Text&&!(Q&&((null==b?void 0:b.type)===M.vU.Svg||(null==b?void 0:b.type)===M.vU.Mermaid||(null==b?void 0:b.type)===M.vU.React||(null==b?void 0:b.type)===M.vU.Html)),eR=!eI||"raw"===U,eF=eh||ef&&!y&&!ep&&!(null==F?void 0:F.settings.dismissed_artifact_feedback_form)&&ej,eT=null!=(h=null==b?void 0:b.versions.length)?h:0,[eU,eL]=(0,j.useState)(!1),eD=N&&b?{show:!Q&&!(null==G?void 0:G.is_starter_project),artifact:b,projectUuid:N,selectedVersion:$,selectDoc:k}:void 0;return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:(0,p.A)(b?"bg-bg-000 flex h-full flex-col relative":"absolute opacity-0 w-0 h-0 overflow-hidden pointer-events-none"),onClick:()=>eU&&eL(!1),children:[(0,n.jsx)(eb,{versionCount:eT,selectedVersion:$,artifact:b,canRenderNormal:eI,canOnlyRenderRaw:eS,canOnlyRenderNormal:eE,viewing:U,setViewing:L,showRaw:eR,canRefresh:ez,isSandboxLoading:P,handleRefresh:()=>{B(!0),D.current&&D.current.refresh()},canShare:ei,handleOpenShareModal:eM,isStreaming:y,onClose:v,hasMenuOpen:eU,setHasMenuOpen:eL,canPublish:J,wasUnpublished:eu,publishedArtifactUuid:ec,openPublishModal:eA,projectParams:eD,richSandboxRef:D,handleVersionSelect:e=>{let t=null==b?void 0:b.versions[e].uuid;t&&C(t)}}),(0,n.jsx)(l.k,{isOpen:R,content:null!=(g=null==b||null==(u=b.versions[$])?void 0:u.resultState)?g:"",type:null==b?void 0:b.type,citations:null==b||null==(m=b.versions[$])?void 0:m.citations,language:void 0===b?void 0:b.language||M.K5[b.type].syntaxName,showRaw:eR,richSandboxRef:D,isCurrentStreaming:Q,isChatStreaming:y,onSandboxConfirmation:q,sendMessage:S,richSandboxCapabilities:z,isLatestVersion:!!b&&$===b.versions.length-1,artifactId:null==b?void 0:b.id,artifactVersion:$,onArtifactRuntimeError:e=>{T.track({event_key:"claudeai.artifacts.execution.error",artifact_version_uuid:null==_?void 0:_.toString(),error_type:e.type,source:null==b?void 0:b.versions[$].source})},artifact:b,hasMenuOpen:eU}),(0,n.jsx)(V.N,{children:eF&&(0,n.jsx)(Y.P.div,{initial:{opacity:0,y:20,x:"-50%"},animate:{opacity:1,y:0,x:"-50%"},transition:{duration:.3,delay:.8,ease:"easeOut"},exit:{opacity:0,y:20,x:"-50%",transition:{duration:.3,ease:"easeOut"}},className:"absolute bottom-20 left-1/2",children:(0,n.jsx)("div",{children:(0,n.jsx)(ed,{onSubmitNotes:e=>{ew({event_key:"artifact.feedback.note",note:e,message_uuid:em,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),eg(!1)},onSubmitRating:e=>{ew({event_key:"artifact.feedback.sentiment",type:e?"thumbs_up":"thumbs_down",message_uuid:em,artifact_type:null==b?void 0:b.type,artifact_language:null==b?void 0:b.language}),ey({...null==F?void 0:F.settings,dismissed_artifact_feedback_form:!0}),eg(!0)},onClose:()=>{ev(!0),ey({...null==F?void 0:F.settings,dismissed_artifact_feedback_form:!0}),eg(!1)}})})})})]}),(null==b?void 0:b.versions[$])&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(eC,{messageUuid:b.versions[$].message,isOpen:H&&!eu,onClose:Z,artifact:b,selectedVersion:$,publishedArtifactUuid:ec,richSandboxRef:D}),ei&&_&&(0,n.jsx)(e_,{isOpen:el,onClose:eo,artifactVersionUuid:_,artifact:b,messageUuid:b.versions[$].message,isProjectArtifact:!!(null==G?void 0:G.is_private)})]})]})};function eb(e){var t;let{versionCount:s,selectedVersion:a,artifact:i,canRenderNormal:l,canOnlyRenderRaw:r,canOnlyRenderNormal:o,viewing:c,setViewing:d,showRaw:f,canRefresh:v,isSandboxLoading:b,handleRefresh:w,canShare:C,handleOpenShareModal:A,isStreaming:E,canPublish:I,wasUnpublished:P,publishedArtifactUuid:B,projectParams:W,onClose:G,openPublishModal:J,handleVersionSelect:H,hasMenuOpen:V,setHasMenuOpen:Y,richSandboxRef:K}=e,q=(0,ee.A)(),X=(0,z.V)(S.E_),{copyToClipboard:Q,didCopy:et}=(0,k.C)(),{copyToProject:ea,isCopiedToProject:en}=function(e){let{projectUuid:t,artifact:s,selectedVersion:a}=e,[i,l]=(0,j.useState)(!1),{mutateAsync:r,data:o}=(0,es.fh)(null!=t?t:""),{addError:c}=(0,u.Y)();return(0,j.useEffect)(()=>{if(null==o?void 0:o.uuid){l(!0);let e=setTimeout(()=>{l(!1)},12e3);return()=>clearTimeout(e)}},[o]),{copyToProject:async()=>{if(s)try{var e;await r({file_name:"".concat(s.title,".").concat(M.K5[s.type].extension()),content:null!=(e=s.versions[a].resultState)?e:""})}catch(e){c((0,n.jsx)($.A,{defaultMessage:"Error adding artifact to project: {error}",id:"sSg3OiDDja",values:{error:e}}))}},isCopiedToProject:i}}({artifact:i,projectUuid:null!=(t=null==W?void 0:W.projectUuid)?t:"",selectedVersion:a});async function el(){var e,t;if(!i)return;let s=i.type===M.vU.Markdown,n=i.type===M.vU.React,l=null!=(e=i.versions[a].resultState)?e:"";if(n&&K.current){let e=await (null==(t=K.current)?void 0:t.copyHtmlContent());e?await Q({text:e,html:e}):await Q(l)}else if(s)try{let e=(0,ei.u)(l);await Q({text:l,html:e})}catch(e){await Q(l)}else await Q(l)}let{ref:er,width:eo}=function(){let e=(0,j.useRef)(null),[t,s]=(0,j.useState)(()=>{var t,s;return null!=(s=null==(t=e.current)?void 0:t.offsetWidth)?s:null});return(0,j.useEffect)(()=>{let t=Z()(()=>{e.current&&s(e.current.offsetWidth)},20,{leading:!0,trailing:!0}),a=new ResizeObserver(t);if(e.current){let s=e.current;return t(),a.observe(s),()=>a.disconnect()}},[]),{ref:e,width:t}}(),ec=eo&&eo<480,ed=!f&&v,{addError:eu}=(0,u.Y)(),em=(null==i?void 0:i.type)===M.vU.Markdown&&"raw"!==c?(0,n.jsx)(h.tJ,{onSelect:async()=>{try{await eh(i)}catch(e){eu((0,n.jsx)($.A,{defaultMessage:"Error saving as PDF",id:"kemaiSh7+2"}))}},children:(0,n.jsx)($.A,{defaultMessage:"Save as PDF",id:"rv9NrWszM1"})},"saveAsPdf"):null,ef=i?(0,n.jsx)(h.tJ,{asChild:!0,"data-testid":"export-download",children:(0,n.jsx)(ey,{artifact:i,selectedVersion:a})},"download"):null;return(0,n.jsxs)("div",{ref:er,className:(0,p.A)("pr-2 pl-3 flex items-center justify-between gap-2 select-none",X?[S.X_,S.zo,"draggable"]:"py-2"),children:[i&&(0,n.jsx)(ex,{currentArtifact:i,hasMenuOpen:V,setHasMenuOpen:Y}),V?(0,n.jsxs)("div",{className:"flex justify-between items-center flex-1 text-sm text-text-300 pl-1",children:[(0,n.jsx)($.A,{defaultMessage:"Switch between artifacts",id:"mYiLqlDMdl"}),!f&&ed&&b?(0,n.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,n.jsx)(_.Loading,{size:"sm"})}):null]}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"flex items-center flex-1 gap-2",children:[!(!l||r||o)&&(0,n.jsx)(m.Iz,{options:[{key:"normal",label:(0,n.jsx)(L.k,{size:16}),ariaLabel:q.formatMessage({defaultMessage:"Preview",id:"TJo5E6JuIN"})},{key:"code",label:(0,n.jsx)(D.C,{size:16}),ariaLabel:q.formatMessage({defaultMessage:"Code",id:"h2vipunVVd"})}],initialKey:"normal"===c?"normal":"code",onSelect:e=>{d("normal"===e?"normal":"raw")},itemClassName:"!px-1"},"normal"===c?"normal":"code"),s>1?(0,n.jsx)(h.ms,{align:"start",trigger:(0,n.jsxs)(x.$,{variant:"ghost",size:"sm",className:"group !text-text-000 gap-1 justify-between !pl-1.5 !pr-1 !text-sm","data-testid":"artifact-version-trigger",children:["v",a+1,ec||a!==s-1?null:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("span",{children:"∙"}),(0,n.jsx)($.A,{defaultMessage:"Latest",id:"adThp5MDl0"})]}),(0,n.jsx)(g.a,{size:12,className:"opacity-0 group-hover:opacity-100 group-[&[data-state=open]]:opacity-100"})]}),children:Array.from({length:s}).map((e,t)=>s-t).map(e=>(0,n.jsxs)(h.tJ,{"data-testid":"version-dropdown",className:"flex justify-between",onSelect:()=>H(e-1),children:[(0,n.jsx)($.A,{defaultMessage:"Version {versionNum}",id:"iMMX+ZCJ/I",values:{versionNum:e}}),e===s?(0,n.jsxs)(n.Fragment,{children:[" - ",(0,n.jsx)($.A,{defaultMessage:"Latest",id:"adThp5MDl0"})]}):null,e-1===a?(0,n.jsx)(T.J,{className:"text-accent-secondary-100",size:16}):null]},e))}):null]}),(0,n.jsxs)("div",{className:(0,p.A)("flex gap-2 items-center text-sm"),children:[ec?(0,n.jsxs)(h.ms,{align:"end",trigger:(0,n.jsx)(x.$,{variant:"ghost",size:"unset",className:"!text-text-000 !shrink gap-1 !px-1 !py-0.5 text-sm","data-testid":"artifact-menu-trigger","aria-label":q.formatMessage({defaultMessage:"More options for artifact",id:"O91Ji7GVP2"}),children:(0,n.jsx)(U.L,{size:18,weight:"bold"})}),children:[ed&&(0,n.jsx)(h.tJ,{disabled:b,onSelect:w,children:(0,n.jsx)($.A,{defaultMessage:"Refresh",id:"rELDbByu8U"})},"refresh"),(0,n.jsx)(h.tJ,{onSelect:el,children:(0,n.jsx)($.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})},"copy"),C?(0,n.jsx)(h.tJ,{onSelect:A,children:(0,n.jsx)($.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})},"share"):null,P?(0,n.jsx)(h.tJ,{disabled:!0,onSelect:J,children:(0,n.jsx)($.A,{defaultMessage:"Unpublished",id:"wbU4tD+0G+"})},"unpublished"):I?(0,n.jsx)(h.tJ,{onSelect:J,children:(0,n.jsx)($.A,{defaultMessage:"Publish",id:"syEQFEKfku"})},"publish"):null,ef,em]}):(()=>{let e=!f&&ed&&(b?(0,n.jsx)("div",{className:"flex h-8 w-8 items-center justify-center",children:(0,n.jsx)(_.Loading,{size:"sm"})}):(0,n.jsx)(x.$,{variant:"ghost",size:"icon_sm",onClick:w,children:(0,n.jsx)(R.S,{size:18})})),t=C&&(0,n.jsx)(x.$,{onClick:A,variant:"primary",size:"sm",disabled:E,prepend:(0,n.jsx)(F.F,{size:18,weight:"light"}),className:"font-medium !text-sm",children:(0,n.jsx)($.A,{defaultMessage:"Share",id:"OKhRC6eWRw"})}),s=I&&(0,n.jsx)(N.m,{open:!!P&&void 0,tooltipContent:(0,n.jsx)($.A,{defaultMessage:"This artifact was previously unpublished. Create a new artifact to publish again.",id:"173M62fqu+"}),children:(0,n.jsx)(x.$,{onClick:J,variant:"primary",size:"sm",disabled:P||E,prepend:(0,n.jsx)(F.F,{size:16}),className:(0,p.A)("font-medium !text-sm",P&&"!pointer-events-auto"),children:void 0===B||P?(0,n.jsx)($.A,{defaultMessage:"Publish",id:"syEQFEKfku"}):(0,n.jsx)($.A,{defaultMessage:"Published",id:"w7tf2zwi6+"})})}),a=(0,n.jsxs)(y,{align:"end",defaultButtonLabel:(0,n.jsxs)("div",{className:"relative",children:[(0,n.jsx)("div",{className:(0,p.A)(et?"invisible":""),children:(0,n.jsx)($.A,{defaultMessage:"Copy",id:"4l6vz1/eZ5"})}),et?(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center",children:(0,n.jsx)(T.J,{size:18})}):null]}),onClickDefaultButton:el,children:[(null==W?void 0:W.show)?en?(0,n.jsx)(h.tJ,{disabled:!0,children:(0,n.jsx)($.A,{defaultMessage:"Copied to project",id:"KYVs6Ta+VU"})},"added-to-project"):(0,n.jsx)(h.tJ,{onSelect:ea,children:(0,n.jsx)($.A,{defaultMessage:"Copy to project",id:"Xmf/Sp7n9T"})},"add-to-project"):null,ef,em]});return(0,n.jsxs)(n.Fragment,{children:[e,a,t,s]})})(),(0,n.jsx)(x.$,{variant:"ghost",size:"icon_sm",onClick:G,children:(0,n.jsx)(O.X,{size:18})})]})]})]})}function ey(e){let{artifact:t,selectedVersion:s}=e,{downloadUrl:a,filename:i}=eg(t,s),l=function(e){switch(e.type){case M.vU.Markdown:return"Markdown";case M.vU.Html:return"HTML";case M.vU.React:return"TSX";case M.vU.Svg:return"SVG";case M.vU.Text:return"TXT";case M.vU.Mermaid:return"Mermaid";case M.vU.Code:var t;return null!=(t=M.K5[e.type].extension(e))?t:null;default:return null}}(t);return(0,n.jsx)("a",{href:a,download:i,className:"py-1 px-2 rounded-md cursor-pointer whitespace-nowrap overflow-hidden grid grid-cols-[minmax(0,_1fr)_auto] gap-2 hover:bg-bg-200 hover:text-text-000",children:l?(0,n.jsx)($.A,{defaultMessage:"Download as {fileType}",values:{fileType:l},id:"PJh4v0uaV6"}):(0,n.jsx)($.A,{defaultMessage:"Download file",id:"k9qHCCLPA5"})})}let ew=f.J.div(ep());f.J.div(ev());let e_=e=>{let{onClose:t,isOpen:s,artifactVersionUuid:a,artifact:i,messageUuid:l,isProjectArtifact:r}=e,c=(0,ee.A)(),{track:d}=(0,o.st)(),{mutateAsync:u,isPending:m}=(0,et.yE)(a),{data:f,isLoading:h}=(0,et.EC)(a),g=(null==f?void 0:f.visibility)==="shared",p=m||h,[v,b]=(0,j.useState)("");(0,j.useEffect)(()=>{if(""===v)return;let e=setTimeout(()=>b(""),5e3);return()=>clearTimeout(e)},[v]);let y="".concat(window.location.origin,"/artifacts/").concat(a),{copyToClipboard:w,didCopy:_}=(0,k.C)(),N=p?"loading":g?"shared":"private",M=(0,j.useRef)(N);M.current!==N&&("loading"!==M.current&&"private"===N&&b(c.formatMessage({defaultMessage:"Artifact no longer shared",id:"5AFOwOoFPe"})),M.current=N);let A=e=>{"private"===e&&g&&u({visibility:"private"}).then(()=>t()),"shared"!==e||g||u({visibility:"shared"}).then(()=>w(y))};return(0,n.jsx)(C.aF,{title:(0,n.jsx)("span",{className:"text-text-200 font-claude-response text-xl font-medium",children:g?(0,n.jsx)($.A,{defaultMessage:"Artifact shared",id:"0TqmonlxQo"}):(0,n.jsx)($.A,{defaultMessage:"Share artifact",id:"FeSSOL+/49"})}),isOpen:s,onClose:t,modalSize:"lg",hasCloseButton:!0,children:(0,n.jsxs)("div",{className:"mt-1 flex flex-col gap-2.5",children:[g&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col rounded-xl",children:[(0,n.jsxs)("div",{className:"border-b-0.5 border-border-300 flex gap-3 py-3 pl-3 pr-5",children:[(0,n.jsx)("div",{children:(0,n.jsx)(G.q,{className:"mt-1",size:18})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"font-medium",children:(0,n.jsx)($.A,{defaultMessage:"Shared",id:"kWI6zXRaHY"})}),(0,n.jsx)("p",{className:"text-text-300 tracking-tight",children:r?(0,n.jsx)($.A,{defaultMessage:"Anyone who has access to this project can view this artifact and its associated attachments and files.",id:"fxjJJNetIb"}):(0,n.jsx)($.A,{defaultMessage:"Anyone in your organization can view this artifact and its associated attachments and files.",id:"P+skcC6AMa"})})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3 py-3 pl-3 pr-5",children:[(0,n.jsx)(Q(),{className:"text-text-300 truncate text-sm",href:y,children:y}),(0,n.jsx)(x.$,{variant:"ghost",className:"!text-accent-secondary-000 hover:bg-accent-secondary-900 font-medium",onClick:()=>{w(y)},prepend:_?(0,n.jsx)(P.r,{size:16}):(0,n.jsx)(B.N,{size:16}),children:_?(0,n.jsx)($.A,{defaultMessage:"Link copied",id:"zU/q1NoIdN"}):(0,n.jsx)($.A,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})})]})]}),(0,n.jsx)("div",{className:"flex items-center gap-4",children:(0,n.jsx)(x.$,{size:"lg",variant:"secondary",loading:p,onClick:()=>A("private"),children:(0,n.jsx)($.A,{defaultMessage:"Unshare",id:"bEq+NWNIXF"})})})]}),!g&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-text-400 flex flex-col gap-3 py-3",children:r?(0,n.jsxs)("p",{className:"bg-bg-300 text-text-300 flex gap-2 rounded-xl p-3 text-sm",children:[(0,n.jsx)(J.R,{size:18,className:"mt-0.5 shrink-0"}),(0,n.jsx)($.A,{defaultMessage:"This artifact was created in a private project. Anyone in your organization who has access to this project will be able to view this artifact.",id:"g6r4HATHuW"})]}):(0,n.jsx)("p",{children:(0,n.jsx)($.A,{defaultMessage:"Anyone in your organization can view this artifact. It also has access to attachments and files in the conversation.",id:"AnqiBApCMX"})})}),(0,n.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex gap-3 rounded-xl py-3 pl-3 pr-5",children:[(0,n.jsx)(H.c,{className:"mt-0.5",size:18}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"font-medium",children:(0,n.jsx)($.A,{defaultMessage:"Unshared",id:"0r/9ANkloS"})}),(0,n.jsx)("p",{className:"text-text tracking-tight-300",children:(0,n.jsx)($.A,{defaultMessage:"Only you have access",id:"U+7IIlpC6m"})})]})]}),(0,n.jsx)("div",{className:"mt-3 flex w-full items-center justify-end gap-2",children:(0,n.jsx)(x.$,{size:"lg",loading:p,onClick:()=>{A("shared"),d({event_key:"artifact.share.modal.share_button_clicked",message_uuid:l,artifact_type:i.type,artifact_language:i.language})},children:(0,n.jsx)($.A,{defaultMessage:"Share & copy link",id:"E7GQdF/HSA"})})})]})]})})},eC=e=>{var t;let{onClose:s,isOpen:a,artifact:i,selectedVersion:l,messageUuid:r,publishedArtifactUuid:d,richSandboxRef:u}=e,m=(0,ee.A)(),{track:f}=(0,o.st)(),{mutateAsync:h,isPending:g}=(0,et.yx)(),{publishedArtifactsBaseUrl:p}=(0,c._r)(),[v,b]=(0,j.useState)(),y=!!d,{mutateAsync:w,isPending:_}=(0,et.lT)(d),N=g||_,[M,A]=(0,j.useState)("");(0,j.useEffect)(()=>{if(""===M)return;let e=setTimeout(()=>A(""),5e3);return()=>clearTimeout(e)},[M]);let S="".concat(p,"/public/artifacts/").concat(d),{copyToClipboard:E,didCopy:z}=(0,k.C)(),I=N?"loading":y?"shared":"private",R=(0,j.useRef)(I),F=(0,j.useCallback)(async()=>{var e;let t=await (null==(e=u.current)?void 0:e.getScreenshot());t&&b(t)},[u]);(0,j.useEffect)(()=>{a&&u.current&&F()},[u,a,F]),R.current!==I&&("loading"!==R.current&&"private"===I&&A(m.formatMessage({defaultMessage:"Artifact no longer published",id:"2ERgiFTuIj"})),R.current=I);let T=e=>{if("private"===e&&y&&w({}).then(()=>s()),"shared"===e&&!y){var t;h({title:i.title,artifact_type:i.type,code_language:i.language,message_uuid:r,artifact_identifier:i.id,content:null!=(t=i.versions[l].resultState)?t:"",screenshot:v,artifact_version_uuid:i.versions[l].uuid}).then(e=>{let{published_artifact_uuid:t}=e;return E("".concat(p,"/public/artifacts/").concat(t))})}};return(0,n.jsx)(C.aF,{title:(0,n.jsx)("span",{className:"text-text-200 font-claude-response text-xl font-medium",children:y?(0,n.jsx)($.A,{defaultMessage:"Artifact published",id:"ykyvCB8a6W"}):(0,n.jsx)($.A,{defaultMessage:"Publish artifact",id:"D1fyBhklj/"})}),isOpen:a,onClose:s,modalSize:"lg",hasCloseButton:!0,children:(0,n.jsxs)("div",{className:"mt-1 flex flex-col gap-2.5",children:[y&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col rounded-xl",children:[(0,n.jsxs)("div",{className:"border-b-0.5 border-border-300 flex gap-3 py-3 pl-3 pr-5",children:[(0,n.jsx)("div",{children:(0,n.jsx)(G.q,{className:"mt-1",size:18})}),(0,n.jsxs)("div",{children:[(0,n.jsx)("h6",{className:"font-medium",children:(0,n.jsx)($.A,{defaultMessage:"Published (Public)",id:"7G+T0FbG5h"})}),(0,n.jsx)("p",{className:"text-text-300 tracking-tight",children:(0,n.jsx)($.A,{defaultMessage:"Anyone on the web with the link can view the Artifact only. Your chat will remain private.",id:"lJBHtZSUCz"})})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-3 py-3 pl-3 pr-5",children:[(0,n.jsx)(Q(),{className:"text-text-300 truncate text-sm",href:S,children:S}),(0,n.jsx)(x.$,{variant:"ghost",className:"!text-accent-secondary-000 hover:bg-accent-secondary-900 font-medium",onClick:()=>{E(S)},prepend:z?(0,n.jsx)(P.r,{size:16}):(0,n.jsx)(B.N,{size:16}),children:z?(0,n.jsx)($.A,{defaultMessage:"Link copied",id:"zU/q1NoIdN"}):(0,n.jsx)($.A,{defaultMessage:"Copy link",id:"lbr3Lq2Lnm"})})]})]}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)(x.$,{size:"lg",variant:"secondary",loading:N,onClick:()=>T("private"),children:(0,n.jsx)($.A,{defaultMessage:"Unpublish",id:"VjZ6FKc+ZZ"})}),(0,n.jsxs)("p",{className:"text-text-400 text-xs tracking-tight",children:[(0,n.jsx)($.A,{defaultMessage:"Once Artifact is unpublished, it cannot be republished.",id:"HKGP87Xpbb"}),(0,n.jsx)("br",{}),(0,n.jsx)($.A,{defaultMessage:"A new Artifact must be created.",id:"vWfM4LMkFW"})]})]})]}),!y&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{className:"text-text-400 flex flex-col gap-3 py-3",children:(0,n.jsx)("p",{children:(0,n.jsx)($.A,{defaultMessage:"Publishing this Artifact will make it accessible to anyone on the internet. Your chat will remain private.",id:"OMUnb5GMFX"})})}),(0,n.jsxs)("div",{className:"border-0.5 border-border-300 text-text-100 flex flex-col sm:flex-row gap-4 rounded-xl py-3 pl-3 pr-5 items-center",children:[(0,n.jsxs)("div",{className:"relative group w-[160px] h-[84px]",children:[(0,n.jsxs)("div",{className:"rounded-lg overflow-hidden shrink-0 relative w-full h-full",children:[v?(0,n.jsx)("img",{src:v,alt:i.title,className:"w-full h-auto bg-always-white"}):(0,n.jsx)(q.default,{src:"/images/claude_ogimage.png",alt:i.title,className:"w-full h-auto",width:1138,height:640}),!v&&(0,n.jsx)(ek,{handleCapture:()=>void F()})]}),v&&(0,n.jsx)("div",{className:"absolute top-0 right-0 translate-x-1/4 -translate-y-1/4 hidden group-hover:block",children:(0,n.jsx)(eN,{handleRemove:()=>b(void 0)})})]}),(0,n.jsx)("div",{children:null!=(t=i.title)?t:(0,n.jsx)($.A,{defaultMessage:"Claude Artifact",id:"l6aMQuX1m4"})})]}),(0,n.jsxs)("div",{className:"bg-bg-300 text-text-300 mt-3 flex gap-3 rounded-xl px-4 py-3 text-sm leading-normal",children:[(0,n.jsx)(J.R,{size:18,className:"mt-0.5 shrink-0"}),(0,n.jsx)("span",{children:(0,n.jsx)($.A,{defaultMessage:"Anthropic’s <link>Usage Policy</link> prohibits use of Claude for harmful use cases like producing violent, abusive, or deceptive content. Don’t share personal information or third-party content without permission.",id:"3BDMxIIlWR",values:{link:e=>(0,n.jsx)(Q(),{href:"https://www.anthropic.com/legal/aup",target:"_blank",className:"underline",children:e})}})})]}),(0,n.jsx)("div",{className:"mt-3 flex w-full items-center justify-end gap-2",children:(0,n.jsx)(x.$,{size:"lg",loading:N,onClick:()=>{T("shared"),f({event_key:"artifact.publish.modal.publish_button_clicked",message_uuid:r,artifact_type:null==i?void 0:i.type,artifact_language:null==i?void 0:i.language})},children:(0,n.jsx)($.A,{defaultMessage:"Publish & copy link",id:"q8Svey6avC"})})})]})]})})},eN=e=>{let{handleRemove:t}=e;return(0,n.jsx)(N.m,{tooltipContent:(0,n.jsx)($.A,{defaultMessage:"Remove",id:"G/yZLul6P1"}),side:"bottom",children:(0,n.jsx)("button",{className:(0,p.A)("transition-all hover:bg-bg-000/50 text-text-500 hover:text-text-200 w-5 h-5 rounded-full border-0.5 border-border-300/25 bg-bg-000/90 backdrop-blur-sm flex items-center justify-center",(0,A.Fr)()&&"!opacity-100 !bg-bg-000/50"),onClick:e=>{e.stopPropagation(),e.preventDefault(),t()},children:(0,n.jsx)(O.X,{size:12,weight:"bold"})})})},ek=e=>{let{handleCapture:t}=e;return(0,n.jsx)("div",{className:"absolute inset-0 flex items-center justify-center bg-accent-main-900/20 hidden group-hover:flex",children:(0,n.jsx)(N.m,{tooltipContent:(0,n.jsx)($.A,{defaultMessage:"Capture screenshot",id:"4aPgLNzYUy"}),side:"right",children:(0,n.jsx)(x.$,{variant:"secondary",size:"icon",onClick:t,className:"!bg-bg-100",children:(0,n.jsx)(W.i,{size:20})})})})}},77336:(e,t,s)=>{"use strict";s.d(t,{E:()=>n,V:()=>i});var a=s(7620);function n(e){let t=[];for(let a of e){var s;for(let e of null!=(s=a.files_v2)?s:a.files)"file_kind"in e&&t.push(e)}return t}let i=e=>(0,a.useMemo)(()=>n(e),[e])},79746:(e,t,s)=>{"use strict";s.d(t,{U:()=>c});var a=s(54568),n=s(41417),i=s(29242),l=s(64786),r=s(90119),o=s(46760);function c(e){let{children:t,disabledReason:s,...c}=e,d=(0,r.V)(l.E_),u=(0,o.A)(),m={defaultMessage:t.props.defaultMessage,id:t.props.id};if(!d)return(0,a.jsx)(i.m,{tooltipContent:s,side:"bottom",children:(0,a.jsx)("div",{children:(0,a.jsx)(n.$,{...c,children:t})})});let f=u.formatMessage(m);return(0,a.jsx)(i.m,{tooltipContent:null!=s?s:f,side:"bottom",children:(0,a.jsx)("div",{children:(0,a.jsx)(n.$,{...c,size:"icon_sm"})})})}},80005:(e,t,s)=>{"use strict";s.d(t,{g:()=>sT,v:()=>sF});var a=s(42977),n=s(54568),i=s(7726),l=s(97527),r=s(57067),o=s(70011),c=s(85644),d=s(45483),u=s(96784),m=s(1761),f=s(2341),x=s(55554),h=s(90510),g=s(61547),p=s(29242),v=s(54890),j=s(27062),b=s(85544),y=s(32987),w=s(37463),_=s(70272),C=s.n(_),N=s(68864),k=s(64155),M=s(27261),A=s.n(M),S=s(62942),E=s(7620),z=s(46760),I=s(62971),R=s(75006),F=s(22336),T=s(41932),U=s(81527),L=s(56147),D=s(80731),O=s(452),P=s(5610),B=s(84137),W=s(39741);s(33703),s(91266);var G=s(89116),J=s(90330),H=s(56273),V=s(737),Y=s(6648),K=s(69987),Z=s(14454),q=s(83542);let X=e=>q.cg[e](),Q={js:"javascript",jsx:"jsx",ts:"typescript",tsx:"tsx",py:"python",rb:"ruby",java:"java",cpp:"cpp",cs:"csharp",php:"php",go:"go",rs:"rust",html:"html",css:"css",md:"markdown",json:"json",xml:"xml",yaml:"yaml",yml:"yaml",sh:"shell",sql:"sql"};var $=s(57190);let ee=e=>{if((0,$.hh)(e)){let{pathComponents:t}=(0,$.Q3)(e);if(!t.length)throw Error("Invalid file uri");return t[t.length-1]}return e},et=new Z.xx,es=new Z.xx,ea=[et.of([]),es.of([])],en=(e,t,s)=>{let a=(0,V.ex)({original:t,gutter:!1});if(e.dispatch({effects:et.reconfigure(a)}),s){let s=(0,V.ex)({original:t,collapseUnchanged:{margin:3,minSize:4},gutter:!1});requestAnimationFrame(()=>{e.dispatch({effects:et.reconfigure(s)})})}},ei=e=>{var t,s;let{fetchFileContent:a,isStreaming:i,selectedContentId:l,readOnly:r,theme:o,onUpdate:c,onCreateEditor:d,collapseUnchanged:u=!0}=e,m=(0,E.useRef)(null),{registerEditor:f,unregisterEditor:x,getInstance:h,setMergeState:g}=(0,G.e)(),[p,v]=(0,E.useState)(void 0),[j,b]=(0,E.useState)(!1);(0,E.useEffect)(()=>()=>{j&&x(l)},[l,x,j]),(0,E.useEffect)(()=>{a(l).then(e=>{v(e)})},[l,p,a]);let y=null!=(s=null==(t=h(l))?void 0:t.mergeState)?s:{isActive:!1};(0,E.useEffect)(()=>{var e;let t=null==(e=m.current)?void 0:e.view;t&&(y.isActive&&"diffSource"in y?en(t,y.diffSource,u):t.dispatch({effects:et.reconfigure([])}))},[y.isActive,u,i]);let w=(0,E.useCallback)(e=>{if(null==c||c(e),y.isActive){let t=(0,V.JE)(e.state),s=!t||0===t.chunks.length;e.transactions.some(e=>e.effects.some(e=>e.is(V.h9)))&&s&&y.isActive&&(K.Y("All changes accepted, deactivating merge view"),g(l,{isActive:!1}))}},[y.isActive,c,l,g]),_=function(e){let t=(0,E.useMemo)(()=>{var t;return Q[(null==(t=e.split(".").pop())?void 0:t.toLowerCase())||""]||"javascript"},[e]);return(0,E.useMemo)(()=>X(t),[t])}(ee(l)||"Unnamed File"),C=(0,E.useCallback)(e=>{f(l,e),b(!0),e.dispatch({effects:es.reconfigure(_||[])}),null==d||d(e)},[_,d,f,l]);return(0,n.jsx)(Y.Ay,{ref:m,value:p,theme:o,readOnly:r,extensions:ea,onUpdate:w,onCreateEditor:C,basicSetup:{foldGutter:!1,autocompletion:!1,lineNumbers:!1}})};function el(e,t){switch(t.type){case"create":case"update":if(t.newText!==e.state.doc.toString()){e.dispatch({changes:{from:0,to:e.state.doc.length,insert:t.newText},annotations:[Y.ZX.addToHistory.of(!1)]});try{en(e,(0,V.cg)(e.state).toString(),"update"===t.type)}catch(e){}}break;case"delete":e.dispatch({changes:{from:0,to:e.state.doc.length,insert:""},annotations:[Y.ZX.addToHistory.of(!1)]})}}var er=s(91507),eo=s(26553);let ec=R.z.object({path:R.z.string().optional(),new_str:R.z.string().optional(),old_str:R.z.string().optional(),original_hash:R.z.string().optional(),file_text:R.z.string().optional()}),ed="antDocumentUpdate";RegExp("".concat("<".concat(ed),"(?:\\s+([^>]*)>|(?!>)\\S*)([\\s\\S]*?)(?:").concat("</".concat(ed,">"),"|$)"),"g");var eu=s(2188),em=s(43245),ef=s(70067);function ex(e){var t;return!!eh(e)&&!!(null==(t=e.content)?void 0:t.some(e=>"tool_result"===e.type&&"artifacts"===e.name))}function eh(e){var t;return null==(t=e.content)?void 0:t.find(e=>"tool_result"===e.type&&"launch_extended_search_task"===e.name)}var eg=s(1524);s(25328);var ep=s(31417),ev=s(85330),ej=s(70678),eb=s(11515),ey=s(41417),ew=s(37711),e_=s(9786),eC=s(98769),eN=s(69307),ek=s(61437),eM=s(76761),eA=s(96377),eS=s(99272),eE=s(58911),ez=s(49645),eI=s(89256),eR=s.n(eI),eF=s(94748),eT=s(8681);let eU=e=>{let t=new Map,s=new Map;for(let a of e)for(let e of a.annotated_snippets)for(let a of e.tool_calls)if("web_search"===a.tool_name||"web_fetch"===a.tool_name){let e=[];if("web_search"===a.tool_name){if(!a.output||"rich_content"!==a.output.type||!a.output.content)continue;e=a.output.content.map(e=>{let{url:t}=e;return t}).filter(Boolean)}if("web_fetch"===a.tool_name){if(!a.output||"rich_link"!==a.output.type||!a.output.link.url)continue;e=[a.output.link.url]}for(let t of e)if("string"==typeof t)try{let e=new URL(t),a="https://".concat(e.hostname),i=e.hostname.replace(/^www\./,""),l=s.get(i);s.set(i,{count:((null==l?void 0:l.count)||0)+1,icon:(null==l?void 0:l.icon)||(0,n.jsx)(eb.d,{url:a,size:14})})}catch(e){}}else if(a.output){let e=a.integration_name||a.tool_name,s="rich_content"===a.output.type?a.output.content.length:1,i=t.get(e);t.set(e,{count:((null==i?void 0:i.count)||0)+s,icon:(null==i?void 0:i.icon)||(0,n.jsx)(eT.r,{canShowLetterIcon:!0,size:14,iconUrl:a.server_icon_url||void 0,integrationName:a.integration_name||void 0,toolName:a.tool_name})})}let a=Array.from(t.entries()).sort((e,t)=>t[1].count-e[1].count).slice(0,4),i=Array.from(s.entries()).sort((e,t)=>t[1].count-e[1].count).slice(0,4);return a.concat(i).slice(0,4-a.length)},eL=e=>{let{onClose:t,onBack:s,onDebug:a,title:i,isHidden:l,className:r}=e;return(0,n.jsxs)("div",{className:"shrink-0 flex items-center justify-between gap-4 w-full min-w-0 px-5 h-[3.25rem]",children:[(0,n.jsxs)("div",{className:"flex items-center gap-1 min-w-0",children:[!!s&&(0,n.jsx)(ey.$,{variant:"ghost",size:"icon_sm",onClick:s,className:"-ml-1",disabled:l,children:(0,n.jsx)(eN.Z,{size:16})}),(0,n.jsx)("h2",{className:(0,y.A)("text-text-200 truncate text-sm min-w-0 text-ellipsis break-words text-nowrap",r),children:i}),!!a&&(0,n.jsx)(ey.$,{variant:"ghost",size:"icon_sm",onClick:a,disabled:l,children:(0,n.jsx)(ek.z,{size:16})})]}),(0,n.jsx)(ey.$,{variant:"ghost",size:"icon_sm",onClick:t,className:"-mr-1",disabled:l,children:(0,n.jsx)(eM.X,{size:16})})]})};function eD(e){let{compassStatus:t,onOpenSources:s}=e;if(!t.total_sources)return null;let a=eU(t.agents),i=a.length>0?a[0][1].count:0,l=t.total_sources-a.reduce((e,t)=>t[1].count+e,0);return 0===a.length?null:(0,n.jsx)("button",{className:"transition-all w-full flex flex-col gap-3 px-4 py-3.5 border-0.5 border-border-300 rounded-xl hover:border-border-100  max-w-[456px]",onClick:s,children:(0,n.jsxs)("div",{className:"flex flex-col gap-2.5 my-1 w-full",children:[a.map((e,t)=>{let[s,{count:a,icon:l}]=e;return(0,n.jsxs)("div",{className:"flex items-center text-xs",children:[(0,n.jsx)("div",{className:"h-4 w-4 flex items-center justify-center mr-2",children:l}),(0,n.jsx)("p",{className:"text-left font-medium w-32 truncate text-text-100 pr-2",title:s,children:s}),(0,n.jsx)("p",{className:"w-24 text-right text-xs text-text-300 pr-2",children:(0,n.jsx)(I.A,{id:"WrpI57Uej/",defaultMessage:"{count, plural, one {# source} other {# sources}}",values:{count:a}})}),(0,n.jsx)("div",{className:"flex-1",children:(0,n.jsx)(w.P.div,{className:"h-2 rounded-full bg-bg-400",initial:{width:0},animate:{width:"".concat(a/i*100,"%")},transition:{delay:.1*t,duration:.5}})})]},s)}),l>0&&(0,n.jsxs)("div",{className:"flex items-center text-xs text-text-300",children:[(0,n.jsx)(eA.H,{size:16,className:"text-text-300 mr-2"}),(0,n.jsx)("p",{children:(0,n.jsx)(I.A,{id:"QX3cxMJ9Tc",defaultMessage:"{totalSources, plural, one {# other source} other {# other sources}}",values:{totalSources:l}})})]})]})})}let eO=e=>{let{title:t,complete:s,className:a}=e;return(0,n.jsx)(w.P.h3,{className:(0,y.A)("text-base text-text-100 font-claude-response",a),initial:{opacity:0},animate:{opacity:1},transition:{duration:.5},children:s?t:(0,n.jsx)(ew.N,{children:t})},t)};function eP(e){let{title:t,description:s,numSources:a,onClick:i,complete:l}=e;return(0,n.jsxs)(w.P.button,{variants:{initial:{opacity:0},animate:{opacity:1}},className:"text-left flex flex-col gap-1.5 transition-all duration-500 group/snippet cursor-pointer",onClick:i,children:[(0,n.jsx)(eO,{title:null!=s?s:t,complete:l}),(0,n.jsx)("div",{className:"transition-all flex flex-row items-center gap-1 text-xs text-text-500 group-hover/snippet:text-text-200",children:0===a?(0,n.jsx)(I.A,{id:"NmCRHK7Fm4",defaultMessage:"No sources yet"}):(0,n.jsx)(I.A,{id:"8NMeuJNj8z",defaultMessage:"{totalSources, plural, one {# source} other {# sources}}",values:{totalSources:a}})})]})}function eB(e){let{status:t,allSnippets:s,onOpenSources:a}=e,[i,l]=(0,E.useState)([]);return(0,E.useEffect)(()=>{!(t.agents.length<1)&&(i.length>=3||l((0,B.mk)({agents:t.agents,n:3})))},[null==t?void 0:t.agents,i.length,l]),(0,n.jsxs)("div",{className:"flex flex-col pt-4 pb-6 gap-4 w-full h-full text-sm text-text-200",children:[(0,n.jsx)(eD,{compassStatus:t,onOpenSources:()=>a(!0)}),s&&s.length>0&&(0,n.jsx)("div",{className:"flex flex-col gap-3",children:(0,n.jsx)(w.P.div,{variants:{initial:{},animate:{transition:{staggerChildren:.08,delayChildren:.05}}},initial:"initial",animate:"animate",className:"flex flex-col gap-4 w-full",children:s.map((e,t)=>(0,n.jsx)(eP,{...e,onClick:()=>a(!0,e.globalAgentIndex)},t))})})]})}function eW(e){let{data:t,onClose:s}=e,[a,i]=(0,E.useState)(!1),[l,r]=(0,E.useState)({sourcesOpen:!1}),{conversationUUID:o,organizationUUID:c,isShared:d,taskId:u}=t,{compassStatus:m}=(0,B.CH)({organizationUUID:c,conversationUUID:o,taskId:u,isShared:d});if(!m)return null;let f=(e,t)=>{r({sourcesOpen:e,index:t})},x=void 0,h=l.sourcesOpen||a;return(0,n.jsxs)("div",{className:"relative h-full w-full bg-bg-000",children:[(0,n.jsx)(w.P.div,{className:"w-full h-full",animate:h?"minimized":"full",variants:{minimized:{scale:.95},full:{scale:1}},children:(0,n.jsx)(eG,{compassStatus:m,onClose:s,onDebug:x,handleOpenSources:f})}),(0,n.jsx)("div",{className:(0,y.A)("absolute top-0 left-0 right-0 bottom-0 h-full w-full pointer-events-none bg-always-black/[5%]",h?"opacity-100":"opacity-0")}),(0,n.jsx)(w.P.div,{animate:h?"visible":"hidden",variants:{visible:{opacity:1,translateX:0},hidden:{opacity:0,translateX:"100%"}},transition:{ease:eC.A.snappyOut},className:(0,y.A)("absolute top-0 left-0 right-0 bottom-0"),children:(0,n.jsx)(eV,{isHidden:!h,compassStatus:m,onBack:a?()=>i(!1):()=>f(!1),onClose:s,onDebug:x,isDebug:a,agentIndex:l.index})})]})}function eG(e){let{compassStatus:t,onClose:s,onDebug:a,handleOpenSources:i}=e,l=(0,z.A)(),r=(0,B.OQ)(t),o=t.status,c=(0,B.Nw)(t),d=t.total_sources||0,u=t.agents.slice(1).flatMap((e,t)=>e.annotated_snippets.flat().filter(e=>e.tool_calls.length>0).map(s=>({...s,total_sources:e.total_sources,description:e.description||e.name,complete:!!(s.complete||e.completed_at),globalAgentIndex:t+1,numSources:e.total_sources}))),m=b.P5.indexOf(o),f=[{title:o===b.zu.Starting||o===b.zu.Planning?l.formatMessage({defaultMessage:"Creating my research plan...",id:"4eRg5buC9J"}):l.formatMessage({defaultMessage:"Research plan created",id:"MIzjwRDSc0"}),children:c?(0,n.jsx)(B.GT,{thought:c,className:"pt-4 pb-6"}):void 0,shown:!0,expandable:!!c},{title:o===b.zu.InitiatingAgents||o===b.zu.Searching?0===d?l.formatMessage({defaultMessage:"Searching for sources...",id:"+4r/aaeR9v"}):l.formatMessage({defaultMessage:"Gathering {count, plural, one {# source} other {# sources}} and counting...",id:"kQHn/iXQmy"},{count:d}):l.formatMessage({defaultMessage:"Gathered {count, plural, one {# source} other {# sources}}",id:"DU/dbPu5mV"},{count:d}),titleIcons:(0,n.jsx)(B.mq,{hrefs:(0,B.mk)({agents:t.agents,n:3})}),children:(0,n.jsx)(eB,{allSnippets:u,status:t,onOpenSources:i}),shown:m>=2||t.agents.length>1,expandable:u.length>0},{title:o===b.zu.Completed?l.formatMessage({defaultMessage:"Boom! Research report is ready",id:"8CCPGtuLnt"}):l.formatMessage({defaultMessage:"Writing and citing report...",id:"2b/CKxnAiJ"}),shown:m>=4,expandable:!1}],x=f.filter(e=>e.expandable).length,h=f.findLastIndex(e=>!!e.expandable),g=(0,E.useRef)(h),[p,v]=(0,E.useState)(h),[j,y]=(0,E.useState)(!0),w=(0,E.useCallback)((e,t,s)=>{y(s),t?v(e):v(+(0===e))},[y,v]);(0,E.useEffect)(()=>{h!==g.current&&w(h,!0,!1)},[w,h]);let _=[b.zu.Cancelled,b.zu.Failed,b.zu.TimedOut].includes(t.status),C=f.filter(e=>e.shown).length;return(0,n.jsxs)("div",{className:"flex flex-col h-full bg-bg-000 overflow-hidden",children:[(0,n.jsx)(eL,{onClose:s,onDebug:a,title:r,className:"font-medium"}),(0,n.jsxs)("div",{className:"flex flex-col overflow-y-auto px-5 pb-5 pt-1 -mt-1",children:[f.map((e,s)=>{let{expandable:a,shown:i,title:l,titleIcons:r,children:o}=e,c=_||s<C-1||t.status===b.zu.Completed;return(0,n.jsx)(eJ,{title:l,titleIcons:r,noShimmer:c||_,complete:c,isExpanded:a&&p===s,snappyTransition:j,showLine:s<C-1||_||p===s,handleExpand:e=>w(s,e,!0),expandable:a,collapsible:x>1,shown:i,children:o},s)}),_&&(0,n.jsx)(eJ,{title:t.status===b.zu.Cancelled?l.formatMessage({defaultMessage:"Interrupted",id:"rJQDmlVOoX"}):l.formatMessage({defaultMessage:"Something went wrong",id:"JqiqNj0Ooi"}),snappyTransition:!0,noShimmer:!0,isError:!0,handleExpand:eR(),shown:_})]})]})}function eJ(e){let{title:t,titleIcons:s,complete:a,expandable:i,collapsible:l,shown:r,isExpanded:o,handleExpand:c,snappyTransition:d,noShimmer:u,isError:m,showLine:f,children:x}=e;return!!r&&(0,n.jsxs)("div",{className:"flex flex-row gap-3 min-h-[2.125rem] shrink-0",children:[(0,n.jsxs)("div",{className:"flex flex-col items-center mt-[5px]",children:[(0,n.jsx)("div",{className:(0,y.A)("transition-all w-2.5 h-2.5 rounded-full shrink-0",m?"bg-danger-200":a?"bg-text-500":"bg-accent-main-200")}),f&&(0,n.jsx)("div",{className:(0,y.A)("transition-all h-full -mb-1 w-[1px]",a?"bg-border-300":"bg-gradient-to-b from-accent-main-200/50 to-accent-main-200/0")})]}),(0,n.jsxs)("div",{className:"w-full flex flex-col",children:[(0,n.jsx)("button",{className:"inline-flex items-center gap-1",onClick:()=>c(!o),disabled:!i||o&&!l,children:(0,n.jsxs)("h4",{className:(0,y.A)("flex flex-row items-center gap-2 transition-colors text-start text-text-100 hover:text-text-000 text-sm h-5 user-select-none",m&&"!text-danger-200"),children:[u?t:(0,n.jsx)(ew.N,{children:t}),(0,n.jsx)(ez.N,{children:!!s&&!o&&(0,n.jsx)(w.P.div,{initial:{opacity:0,width:0},animate:{opacity:1,width:"auto"},exit:{opacity:0,width:0},children:s})}),!!i&&l&&(0,n.jsx)(eS.a,{className:(0,y.A)("bottom-[0.5px] transform transition-transform duration-400 ease-snappy-out text-text-300",o?"rotate-0":"-rotate-90"),size:12})]})}),(0,n.jsx)(eF.NG,{isExpanded:!!i&&!!o,isScrollable:!1,snappyTransition:d,className:"!max-h-none w-full",setIsExpanded:c,children:x})]})]})}function eH(e){var t,s;let{toolCall:a,isHidden:i}=e;if("web_fetch"===a.tool_name&&(null==(t=a.output)?void 0:t.type)==="rich_link"&&a.output.link.url){let{url:e,icon_url:t,title:s,subtitles:l}=a.output.link;return(0,n.jsx)(eF.aX,{isDisabled:i,isStreaming:!1,icon:(0,n.jsx)(eb.d,{fadeInOnLoad:!0,url:t,size:16}),text:(0,n.jsx)(I.A,{defaultMessage:"Fetched <b>{title}</b>",id:"BWNvvK6PhH",values:{title:s,b:e=>(0,n.jsx)("span",{className:"text-text-400",children:e})}}),handleClick:()=>{window.open(e,"_blank")},secondaryText:null==l?void 0:l[0],secondaryIcon:(0,n.jsx)(eE.B,{size:16,className:"text-text-300"}),isFirstBlockOfMessage:!1,isLastBlockOfMessage:!1,wrapperClassName:"!my-0"})}return a.output?(0,n.jsx)(eT.K,{integrationName:a.integration_name||void 0,integrationIcon:a.server_icon_url||void 0,message:a.message,isExpandingDisabled:i,result:a.output,isStreaming:!1,isError:a.is_error,isFirstBlockOfMessage:!1,isLastBlockOfMessage:!1,wrapperClassName:"!my-0",contentClassName:(null==(s=a.output)?void 0:s.type)==="json_block"?"":"!max-h-none",defaultExpanded:!0}):null}function eV(e){var t;let{isHidden:s,compassStatus:a,onClose:i,onDebug:l,onBack:r,isDebug:o,agentIndex:c}=e,d=(0,E.useRef)(null),u=(0,z.A)(),m=c?!!(null==(t=a.agents[c])?void 0:t.completed_at):a.status===b.zu.Completed,f=void 0===c?null:a.agents[c].description||a.agents[c].name,x=function(e,t){let s=[];for(let a of t?[e.agents[t]]:e.agents)for(let e of a.annotated_snippets)for(let t of e.tool_calls)t.output&&s.push({toolCall:t,timestamp:e.complete&&a.completed_at||a.started_at});return s.sort((e,t)=>new Date(e.timestamp).getTime()-new Date(t.timestamp).getTime()),s.map(e=>{let{toolCall:t}=e;return t})}(a,c),h=void 0===c?a.total_sources:a.agents[c].total_sources;return(0,n.jsxs)("div",{className:(0,y.A)("text-sm bg-bg-000 h-full overflow-hidden flex flex-col",s&&"pointer-events-none user-select-none"),children:[(0,n.jsx)(eL,{onDebug:o?void 0:l,isHidden:s,title:o?"Ant only debug panel":u.formatMessage({defaultMessage:"{totalSources, plural, one {# source} other {# sources}} {status}",id:"8cAP0ZJRie"},{totalSources:h,status:m?"":(0,n.jsx)(I.A,{id:"um9oac7M9y",defaultMessage:"and counting..."})}),onClose:i,onBack:()=>{setTimeout(()=>{d.current&&(d.current.scrollTop=0)},500),r()}}),(0,n.jsxs)("div",{ref:d,className:"relative flex-1 overflow-auto px-5 pt-1 pb-5",children:[!!f&&(0,n.jsx)(eO,{title:f,complete:m,className:"pt-1 pb-5"}),x.length>0?(0,n.jsx)("div",{className:"flex flex-col gap-4",children:x.map((e,t)=>(0,n.jsx)(eH,{toolCall:e,isHidden:s},t))}):(0,n.jsx)("div",{className:"text-text-500 text-center px-8 py-16",children:(0,n.jsx)(I.A,{id:"yWSiuEkfbY",defaultMessage:"No sources found"})})]})]})}var eY=s(59401);s(75710),s(61125),s(61527);var eK=s(98518),eZ=s(51121);s(8759);var eq=s(9537),eX=s(56370),eQ=s(37076),e$=s(60265),e0=s(21036),e1=s(9473),e2=s.n(e1),e5=s(74027),e3=s(61670),e4=s(87556),e6=s(8884),e7=s(57001),e9=s(95675),e8=s(62094);let te=e=>{let{contentId:t,showFullPath:s=!0}=e;if(!(0,$.hh)(t))return null;let{pathComponents:a}=(0,$.Q3)(t);return s?(0,n.jsx)("span",{className:"flex gap-0.5 items-center",children:a.map((e,t)=>(0,n.jsxs)(E.Fragment,{children:[0!==t&&(0,n.jsx)(e8.K,{size:"10",className:"mt-0.5 text-text-500"}),(0,n.jsx)("span",{className:(0,y.A)(t<a.length-1&&"opacity-70"),children:e})]},"".concat(e,"-").concat(t)))}):(0,n.jsx)(p.m,{tooltipContent:a.join("/"),children:(0,n.jsx)("span",{children:a[a.length-1]})})};var tt=s(18179),ts=s(92012),ta=s.n(ts),tn=s(73114),ti=s(13488);function tl(e,t){let s=0;if(!e.children&&(0,tn.R4)(t,e.path))return 1;if(e.children)for(let a of e.children.values())s+=tl(a,t);return s}let tr=e=>{let{directoryName:t,listFiles:s,openedFiles:a,onSubmit:i}=e,[l,r]=(0,E.useState)(),[o,c]=(0,E.useState)("/"),d=(0,E.useMemo)(()=>{let e={};for(let t of a)if("string"==typeof t){let{pathComponents:s}=(0,$.Q3)(t);e["/"+s.join("/")]="include"}return e},[a]),[u,m]=(0,E.useState)(d),f=(0,E.useMemo)(()=>!ta()(d,u),[d,u]);(0,E.useEffect)(()=>{s().then(e=>{r(function(e){let t={name:"",path:"/",size:0,children:new Map};for(let s of e){let{pathComponents:e}=(0,$.Q3)(s);if(0===e.length||1===e.length&&s.endsWith("/"))continue;let a=t;for(let t=0;t<e.length;t++){let n=e[t];if(!n)continue;let i=t===e.length-1,l="/"+e.slice(0,t+1).join("/");i?s.endsWith("/")||a.children.set(n,{name:n,path:l,size:0}):(a.children.has(n)||a.children.set(n,{name:n,path:l.endsWith("/")?l:l+"/",size:0,children:new Map}),a=a.children.get(n))}}return t}(e))})},[s]);let x=(0,E.useCallback)(()=>{if(!l)return;let e=function e(t,s){let a=[];if(!t.children&&(0,tn.R4)(s,t.path)&&a.push(t.path),t.children)for(let n of t.children.values())a.push(...e(n,s));return a}(l,u),t=a[0],{projectUuid:s,directoryUuid:n,directoryName:r}=(0,$.Q3)(t);i(e.map(e=>"file://".concat(s,"/").concat(n,"/").concat(r).concat(e)))},[l,u,a,i]);return l?(0,n.jsx)(n.Fragment,{children:(0,n.jsxs)("div",{className:"rounded-xl border-0.5 border-border-300 bg-bg-000 shadow-sm h-[600px] flex flex-col",children:[(0,n.jsxs)("div",{className:"flex justify-between items-center py-2 px-4 border-b-0.5 border-border-300 h-16",children:[(0,n.jsx)("p",{className:"text-sm text-text-400",children:"Select which files to include..."}),(0,n.jsx)(ez.N,{children:f&&(0,n.jsx)(w.P.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{type:"spring",damping:20,stiffness:400},children:(0,n.jsx)(ey.$,{size:"sm",onClick:x,children:"Update"})})})]}),(0,n.jsx)(ti.y,{repo:t,rootNode:l,filters:u,setFilters:m,currentDirectory:o,setCurrentDirectory:c}),(0,n.jsx)("div",{className:"flex text-xs items-center justify-between border-border-300 border-t-0.5 py-2 px-4 text-text-300",children:l&&u&&Object.keys(u).length>0?(0,n.jsxs)("p",{children:[tl(l,u)," ",(0,n.jsx)(I.A,{defaultMessage:"{count, plural, one {file} other {files}}",id:"pGWzhe74G/",values:{count:tl(l,u)}})," ","selected"]}):(0,n.jsx)("p",{children:"Select files to add to chat context"})})]})}):(0,n.jsx)(to,{})},to=()=>(0,n.jsxs)("div",{className:"flex items-center justify-center gap-3 h-full bg-bg-000 shadow-sm text-sm text-text-300",children:[(0,n.jsx)("div",{children:(0,n.jsx)(tt.Loading,{size:"sm"})}),"Fetching directory contents..."]});var tc=s(16054);let td=e=>{let{contentId:t,fetchFileContent:s,latestHash:a,className:i}=e,{getInstance:l}=(0,G.e)(),[r,o]=(0,E.useState)(),[c,d]=(0,E.useState)(!0),u=l(t);return((0,E.useEffect)(()=>{let e=!0,a=async()=>{d(!0);let a=await s(t);e&&o(a),e&&d(!1)};return u&&(0,er.s5)(u)?a():d(!1),()=>{e=!1}},[t,s,u,a]),!u||c)?null:(0,er.s5)(u)?r!==u.baseContent?(0,n.jsx)(p.m,{tooltipContent:"File has changed",children:(0,n.jsx)("span",{className:(0,y.A)("text-danger-000 cursor-default flex items-center justify-center h-2 w-2 overflow-visible",i),children:(0,n.jsx)(tc.c,{size:32,weight:"duotone"})})}):(0,n.jsx)(p.m,{tooltipContent:"Unsaved changes",children:(0,n.jsx)("div",{className:(0,y.A)("text-accent-secondary-000 cursor-default flex items-center justify-center h-2 w-2 overflow-visible",i),children:(0,n.jsx)(tc.c,{size:32,weight:"duotone"})})}):null},tu=e=>{let{directoryName:t,isStreaming:s,changesMode:a,selectedContentId:i,fetchFileContent:l,saveContent:r,onCreateEditor:o,canEdit:c,latestHash:d,onOpen:u,onClose:m,onCreateNewFile:f,openedFiles:x,listFiles:h}=e,{mode:g}=(0,e5.D)(),p=(0,z.A)(),{getInstance:v,setBaseContent:j}=(0,G.e)(),b=v(i),w=!!b&&(0,er.s5)(b),[_,C]=(0,E.useState)(!1),N=(0,E.useCallback)(()=>{C(!!b&&(0,er.s5)(b))},[b]);(0,E.useEffect)(()=>{N()},[N,w]);let k=(0,E.useCallback)(e=>{b&&e.docChanged&&N()},[N,b]),{dispatchChatResource:M}=(0,H.i)(),A=(0,E.useRef)(""),S=(0,E.useCallback)(async()=>{let e=await l(i);if(!_){let t=null==b?void 0:b.view;t&&e!==(0,er.t_)(b)&&t.dispatch({changes:{from:0,to:t.state.doc.length,insert:e}})}e&&j(i,e)},[l,b,i,j,_]),I=(0,E.useCallback)(()=>{C(!1),r(i).then(e=>{e||C(!0)})},[r,i]),R=(0,E.useCallback)(()=>{b&&b.view.dispatch({changes:{from:0,to:b.view.state.doc.length,insert:b.baseContent}})},[b]),[F,{toggle:T}]=(0,e3.j)(!1),U=(0,E.useCallback)(T,[T]),{setIsDrawerExpanded:L}=(0,e9.x)(),D=(0,E.useCallback)(e=>{let t=x.filter(t=>!e.includes(t)),s=e.filter(e=>!x.includes(e));Promise.all([...t.map(e=>m(e)),...s.map(e=>u(e))]).then(()=>{T()})},[u,m,x,T]);return(0,E.useEffect)(()=>{if(!c)return;let e=new AbortController;return(async()=>{if("string"!=typeof d)return K.z("latestHash is not a string",d);A.current||(A.current=""),A.current===d&&d||_||(await S(),e.signal.aborted||(A.current=d))})(),()=>{e.abort()}},[c,S,b,d,i,_]),(0,n.jsxs)("div",{className:"flex flex-col min-h-0 min-w-0 bg-bg-300 w-full",children:[(0,n.jsxs)("div",{className:(0,y.$)("flex-none w-full flex items-center justify-between pl-3 pr-2 py-2 border-b-0.5 border-border-300 text-sm font-mono",{"h-12":!a}),children:[(0,n.jsxs)("div",{className:"flex gap-2 items-center",children:[a?(0,n.jsx)(n.Fragment,{}):(0,n.jsxs)(eX.ms,{align:"start",trigger:(0,n.jsxs)(ey.$,{size:"icon_sm",variant:"ghost",className:"overflow-visible",children:[(0,n.jsx)(e4.B,{}),(0,n.jsx)("div",{className:"border-0.5 border-border-300 bg-bg-100 text-text-400 absolute -right-0.5 -top-0.5 flex h-[1.15rem] min-w-[1.15rem] items-center justify-center rounded-full px-[0.15rem] text-center text-[0.5rem] font-medium",children:x.length})]}),children:[x.map(e=>(0,n.jsxs)(eX.tJ,{onSelect:()=>{if((0,$.hh)(e))return M({type:"SELECT_SYNCED_DIRECTORY",id:e})},children:[(0,n.jsxs)("div",{className:"flex gap-1.5 items-center text-sm font-mono w-full",children:[(0,n.jsx)("div",{className:"w-4 h-4",children:e===i&&(0,n.jsx)(e$.J,{})}),(0,n.jsx)("div",{className:"flex-1 flex items-center justify-between gap-2 text-xs h-6",children:(0,n.jsx)(te,{contentId:e})})]}),(0,n.jsx)("div",{className:"flex items-center justify-center h-6",children:(0,n.jsx)(td,{className:"m-2",contentId:e,fetchFileContent:l})})]},e)),(0,n.jsx)(eX.DG,{}),(0,n.jsx)(eX.tJ,{className:"text-sm",onSelect:()=>f(),children:(0,n.jsxs)("div",{className:"flex gap-1.5 items-center",children:[(0,n.jsx)(e6.f,{}),"Create new file..."]})}),(0,n.jsx)(eX.tJ,{className:"text-sm",onSelect:U,children:(0,n.jsxs)("div",{className:"flex gap-1.5 items-center",children:[(0,n.jsx)(e6.f,{}),"Add existing file..."]})})]}),(0,n.jsxs)("div",{className:"flex items-center",children:[(0,n.jsx)("div",{className:"font-mono text-xs",children:(0,n.jsx)(te,{contentId:i})}),(0,n.jsx)(td,{className:"ml-2",fetchFileContent:l,contentId:i,latestHash:d})]})]}),(0,n.jsx)("div",{className:"flex gap-1 items-center",children:a?(0,n.jsx)(n.Fragment,{}):(0,n.jsxs)(n.Fragment,{children:[_&&(0,n.jsx)(ey.$,{variant:"primary",size:"sm",className:"text-xs rounded-md px-2 py-1",onClick:I,disabled:!c,children:"Save"}),(0,n.jsxs)(eX.ms,{align:"end",trigger:(0,n.jsx)(ey.$,{size:"icon_sm",variant:"ghost","aria-label":p.formatMessage({defaultMessage:"More options for {label}",id:"rKQPgfPvWS"},{label:i.split("/").pop()||i}),children:(0,n.jsx)(e7.H,{})}),children:[(0,n.jsx)(eX.tJ,{className:"text-sm",onClick:R,disabled:!_||!c,children:"Discard unsaved changes"}),(0,n.jsx)(eX.tJ,{className:"text-sm",onClick:()=>m(i),disabled:!c,children:"Remove this file"})]}),(0,n.jsx)(ey.$,{size:"icon_sm",variant:"ghost",onClick:()=>L(!1),children:(0,n.jsx)(eM.X,{})})]})})]}),(0,n.jsx)("div",{className:"flex flex-1 min-h-0 min-w-0 relative font-mono",children:(0,n.jsx)(ei,{fetchFileContent:l,isStreaming:s,selectedContentId:i,readOnly:!c,theme:"auto"===g?"dark":g,onUpdate:k,onCreateEditor:e=>null==o?void 0:o(i,e)})}),(0,n.jsx)(eQ.aF,{isOpen:F,onClose:T,hasCloseButton:!0,autoCloseOnFocusOut:!1,closeOnEscapeKeydown:!1,title:"Add a file from ".concat(t),subtitle:"Selected files will be included in the conversation",modalSize:"xl",children:(0,n.jsx)("div",{className:"mt-2",children:(0,n.jsx)(tr,{listFiles:h,openedFiles:x,directoryName:t,onSubmit:D})})})]})};var tm=s(70358);let tf=e=>{let{openContentIds:t,fetchFileContent:s}=e,{syncedDirectories:a,projectDocs:n}=(0,eu.w)(),[i,l]=(0,E.useState)(new Map),[r,o]=(0,E.useState)(!0);return(0,E.useEffect)(()=>{r&&(async()=>{o(!1);let e=new Map;for(let a of t){let t=await s(a);if(void 0===t)continue;let n=await (0,tm.h)(t||"");e.set(a,n)}l(e)})()},[t,r,a,n,s]),(0,E.useEffect)(()=>{let e=()=>{o(!0)};return window.addEventListener("focus",e),()=>{window.removeEventListener("focus",e)}},[]),{latestHashes:i,refreshHashes:()=>o(!0)}},tx=e=>{let{directoryName:t,isStreaming:s,selectedContentId:a,openedFiles:i,onOpen:l,onSaveAllContents:r,onSaveContent:o,onCloseFile:c,fetchFileContent:d,listFiles:u,children:m}=e,f=(0,e0.useDynamicConfig)("harmony_product_strings"),{getInstance:x,setBaseContent:h,unregisterEditor:g,changesMode:p,activeEditors:v,acceptAllChanges:j,rejectAllChanges:b,deactivateChangesMode:w}=(0,G.e)(),[_,C]=(0,E.useState)(new Map),[N,k]=(0,E.useState)(!1),[M,A]=(0,E.useState)(""),{dispatchChatResource:S}=(0,H.i)();(0,E.useEffect)(()=>{C(e=>{let t=new Map(e);for(let e of i)t.delete(e);return t})},[i]);let z=(0,E.useMemo)(()=>e2()([...i,...Array.from(_.keys())]),[i,_]),[I,R]=(0,E.useState)(!1),{latestHashes:F,refreshHashes:T}=tf({fetchFileContent:d,openContentIds:new Set(z)}),U=(0,E.useMemo)(()=>a&&F.get(a)||"",[F,a]),L=(0,E.useMemo)(()=>!!a&&z.includes(a),[z,a]),D=async e=>{if(!z.includes(e)){R(!0);try{await l(e)}finally{R(!1)}}},O=async e=>{let t=x(e);if(!t)throw Error("Instance not found for file: ".concat(e));if(_.has(e)){window.confirm(f.get("editor_unsaved",""))&&(g(e),C(t=>{let s=new Map(t);return s.delete(e),s}));return}if(!(0,er.s5)(t)||window.confirm(f.get("editor_unsaved",""))){R(!0);try{g(e),await c(e)}finally{R(!1)}}},{saveContent:P,saveAllContents:B}=function(e){let{setLoading:t,refreshHashes:s,getInstance:a,setBaseContent:n}=e,i=(0,E.useRef)({pendingOperation:null,contentToUpdate:new Map}),l=(0,E.useCallback)(async(e,a)=>{let{pendingOperation:l}=i.current;l&&(l.abort(),K.Y("Aborting previous save operation"));let r=new AbortController;i.current={pendingOperation:r,contentToUpdate:a},t(!0);let o=await Promise.race([e(),new Promise((e,t)=>{r.signal.addEventListener("abort",()=>t(Error("Save aborted")))})]);for(let[e,t]of(K.Y("Save operation completed",{filesProcessed:a.size,results:o}),o))if(t){let t=a.get(e);t&&n(e,t)}return!r.signal.aborted&&s&&setTimeout(s,1),t(!1),i.current.pendingOperation===r&&(i.current.pendingOperation=null),o},[t,n,s]);return{saveContent:(0,E.useCallback)(async(e,t)=>{let s=a(e);return s?l(async()=>new Map([[e,await t()]]),new Map([[e,(0,er.t_)(s)]])):new Map([[e,!1]])},[l,a]),saveAllContents:(0,E.useCallback)(async(e,t)=>{if(!e||0===e.size)return K.z("No save options provided"),new Map;let s=new Map,n=new Map;for(let[t,i]of e.entries()){if(!a(t)||!i.content){K.z("No instance or content found for contentId ".concat(t,". Skipping."));continue}s.set(t,i.content),n.set(t,i)}if(0===s.size)return K.z("No valid files to save"),new Map;let i=await l(()=>t(n),s);return K.Y("Save all operation completed",{success:i,filesProcessed:s.size,totalFiles:e.size}),i},[l,a])}}({setLoading:R,refreshHashes:T,getInstance:x,setBaseContent:h}),W=(0,E.useCallback)(e=>{let{projectUuid:t,directoryUuid:s,directoryName:a}=(0,$.Q3)(i[0]);if(!e)return void k(!0);if(!e)return;if(/[<>:"\\|?*\x00-\x1F]/.test(e))return void alert("Filename contains invalid characters");if(e.startsWith(".")||e.startsWith("~")||"CON"===e||"PRN"===e||"AUX"===e||"NUL"===e)return void alert("Invalid filename");if(e.length>255)return void alert("Filename is too long");let n="file://".concat(t,"/").concat(s,"/").concat(a,"/").concat(e);if(i.includes(n))return void alert("A file with this name already exists");C(e=>{let t=new Map(e);return t.set(n,""),t}),S({type:"SELECT_SYNCED_DIRECTORY",id:n})},[S,i]),J=async(e,t)=>{void 0===await d(e)&&_.has(e)&&t.dispatch({changes:{from:0,to:t.state.doc.length,insert:_.get(e)},annotations:[Y.ZX.addToHistory.of(!1)]})},V=async e=>{let t,s=new Map;if(e.forEach(e=>{let t=x(e);if(t&&(0,er.s5)(t))s.set(e,{content:(0,er.t_)(t),baseContent:t.baseContent,isDeletedFile:t.filePendingDeletion});else if(!t)throw Error("Instance not found for file: ".concat(e))}),0===s.size)return new Map;if(1===e.length){let a=e[0];t=await P(a,()=>o(a,s.get(a)))}else t=await B(s,r);return await Promise.all(t.entries().map(async e=>{let[t,a]=e;a||void 0===await d(t)&&C(e=>{var a,n;let i=new Map(e);return i.set(t,null!=(n=null==(a=s.get(t))?void 0:a.content)?n:""),i})})),t},Z=async()=>{if(!a)throw Error("No content selected to save");return(await V([a])).get(a)},q=async()=>{for(let e of(j(),v)){let t=x(e);t&&void 0===await d(e)&&C(s=>{let a=new Map(s);return a.set(e,(0,er.t_)(t)),a})}w()};th(async()=>await V(z),V,a);let X=(0,n.jsxs)(ey.$,{variant:"primary",size:"sm",disabled:s,children:["Review changes ",(0,n.jsx)(eS.a,{})]}),Q=e=>{let{Icon:t,title:s,description:a}=e;return(0,n.jsxs)("div",{className:"flex flex-col gap-0.5 w-64 p-0.5 pb-1",children:[(0,n.jsxs)("div",{className:"flex gap-1.5 items-center",children:[t&&(0,n.jsx)(t,{size:16}),(0,n.jsx)("div",{className:"text-sm font-light",children:s})]}),(0,n.jsxs)("div",{className:"flex gap-1.5 items-start",children:[(0,n.jsx)("div",{className:"h-1 w-4 flex-shrink-0",children:"\xa0"}),(0,n.jsx)("div",{className:"text-xs text-text-500 whitespace-normal",children:a})]})]})},ee=E.Children.toArray(m).find(e=>(0,E.isValidElement)(e)&&e.type===tx.Footer);return(0,n.jsxs)("div",{className:(0,y.A)("flex flex-col w-full h-full max-h-full bg-bg-200",{hidden:!p&&!L}),children:[(0,n.jsxs)("div",{className:"relative flex-1 flex flex-col overflow-hidden",children:[p&&(0,n.jsxs)("div",{className:"flex-none flex items-center border-b-0.5 border-border-300 sticky top-0 z-10",children:[(0,n.jsx)("div",{className:"flex items-center flex-1 pl-1.5 gap-1.5",children:f.get("editor_changes_title","")}),(0,n.jsx)("div",{className:"flex gap-2 items-center p-2",children:(0,n.jsxs)(eX.ms,{unstyledTrigger:!0,trigger:X,align:"end",children:[(0,n.jsx)(eX.tJ,{onSelect:()=>{j(),V(v).finally(w)},children:(0,n.jsx)(Q,{Icon:e$.J,title:f.get("editor_changes_save_cta",""),description:f.get("editor_changes_save_description","")})}),(0,n.jsx)(eX.tJ,{onSelect:q,children:(0,n.jsx)(Q,{Icon:e$.J,title:f.get("editor_changes_apply_cta",""),description:f.get("editor_changes_apply_description","")})}),(0,n.jsx)(eX.DG,{}),(0,n.jsx)(eX.tJ,{onSelect:()=>{b(),w()},children:(0,n.jsx)(Q,{Icon:eM.X,title:f.get("editor_changes_decline_cta",""),description:f.get("editor_changes_decline_description","")})})]})})]}),(0,n.jsx)("div",{className:(0,y.A)("flex-1 flex min-h-0 w-full flex-col",p&&"p-3 gap-3 overflow-y-scroll"),children:z.map(e=>(0,n.jsx)("div",{className:(0,y.A)("w-full",p?"flex-none overflow-hidden border-border-400 border rounded-xl":"flex h-full",{hidden:p&&!v.includes(e)||!p&&a!==e}),children:(0,n.jsx)(tu,{directoryName:t,isStreaming:s,changesMode:p,selectedContentId:e,saveContent:Z,onCreateEditor:J,canEdit:!I,latestHash:U,fetchFileContent:d,listFiles:u,onOpen:D,onClose:O,onCreateNewFile:W,openedFiles:z})},e))})]}),ee,(0,n.jsx)(eQ.aF,{isOpen:N,onClose:()=>{k(!1),A("")},title:f.get("editor_new_file_title","Create New File"),modalSize:"sm",children:(0,n.jsxs)("div",{className:"flex flex-col gap-4 mt-3",children:[(0,n.jsx)(eq.ks,{autoFocus:!0,value:M,onChange:e=>A(e.target.value),onKeyDown:e=>{"Enter"===e.key&&M&&(W(M),k(!1),A(""))},placeholder:f.get("editor_new_file_placeholder","Enter file name")}),(0,n.jsxs)(eQ.vW,{children:[(0,n.jsx)(ey.$,{variant:"secondary",onClick:()=>{k(!1),A("")},children:f.get("editor_new_file_cancel","Cancel")}),(0,n.jsx)(ey.$,{variant:"primary",disabled:!M,onClick:()=>{W(M),k(!1),A("")},children:f.get("editor_new_file_create","Create")})]})]})})]})};tx.Footer=e=>{let{children:t,className:s}=e;return(0,n.jsx)(ej.mY,{className:s,children:t})};let th=(e,t,s)=>{(0,E.useEffect)(()=>{let a=a=>{a.metaKey&&"s"===a.key&&(a.preventDefault(),a.shiftKey?e():s&&t([s]))};return document.addEventListener("keydown",a),()=>document.removeEventListener("keydown",a)},[e,t,s])};function tg(e,t){let{projectUuid:s,directoryUuid:a}=(0,$.Q3)(t);return(0,$.Cm)(e,s,a)}async function tp(e,t,s){let a=tg(e,t);return await (0,$.x3)(a,t,s),"NewFileCreated"}async function tv(e,t){try{let s=tg(e,t);return await (0,$.Ww)(s,t),"FileDeleted"}catch(e){return"NoChange"}}async function tj(e,t,s){let{isDeletedFile:a,content:n,baseContent:i}=s,{file:l}=(0,$._t)(e,t);if(l){if(a)return await tv(e,t);if(!n||!i)throw Error("Content and base content is required for existing file");let s=await (0,em.EW)(e,t);return s&&i!==s&&!confirm("The file content has changed since you’ve last edited. Do you want to overwrite it?")?"NoChange":(await (0,$._h)(l,n),"ExistingFileEdited")}if(a)throw Error("File to delete does not exist");if(void 0===n)throw Error("Content is required for new file");return await tp(e,t,n)}var tb=s(1748);let ty=e=>{let{isStreaming:t,directoryUri:s,selectUri:a,onClose:i,suggestedChanges:l}=e,{track:r}=(0,eK.st)(),{addError:o}=(0,eZ.Y)(),{openedFiles:c,projectDocs:d,projectUuid:u,syncedDirectories:m}=(0,eu.w)(),{mutateAsync:f}=(0,T.fh)(u),{mutateAsync:x}=(0,T.Om)(u),{mutateAsync:h}=(0,T.gG)(u),{directoryUuid:g,directoryName:p,pathComponents:v}=(0,E.useMemo)(()=>{if(!s)return{directoryUuid:void 0,directoryName:void 0,pathComponents:[]};try{return(0,$.Q3)(s)}catch(e){return{directoryUuid:void 0,directoryName:void 0,pathComponents:[]}}},[s]),j=(0,E.useMemo)(()=>v.length>1||1===v.length&&""!==v[0]?s:void 0,[s,v]),b=(0,E.useCallback)(async e=>{if(!(0,$.hh)(e))throw Error("Not a local file: ".concat(e));await (0,em.Q4)(m,d,f,x,e)},[m,d,f,x]),y=(0,E.useCallback)(async e=>{if(!(0,$.hh)(e))throw Error("Not a local file: ".concat(e));if(j===e){let t=c.find(t=>t!==e);if(t)a(t);else{let{projectUuid:t,directoryUuid:s,directoryName:n}=(0,$.Q3)(e);a("file://".concat(t,"/").concat(s,"/").concat(n,"/"))}}await (0,em.wZ)(d,e,h)},[j,d,h,c,a]),w=(0,E.useCallback)(async(e,t)=>{if(!(0,$.hh)(e))throw Error("Not a local file: ".concat(e));try{let s=await tj(m,e,t);if(r({event_key:"harmony.file.saved",save_result:s}),"NewFileCreated"===s){let{directoryUuid:t}=(0,$.Q3)(e),s=m.find(e=>e.uuid===t);s&&await (0,tb.tE)(s),await b(e)}else"FileDeleted"===s&&await y(e);return"NoChange"!==s}catch(t){if(t&&"object"==typeof t&&"name"in t&&(null==t?void 0:t.name)==="AbortError")throw t;return o((0,n.jsxs)(n.Fragment,{children:["Unable to save"," ",(0,n.jsx)("span",{className:"font-bold ml-2",children:ee(e)})]})),!1}},[m,r,b,y,o]),_=(0,E.useMemo)(()=>Array.from(new Set([...c,...Array.from(l.values()).flat().filter(e=>"create"===e.type).map(e=>e.contentId)])),[c,l]),C=(0,E.useCallback)(async e=>{let t=new Map;for(let s of _)try{let a=e.get(s);if(!a){K.z("No save options found for contentId ".concat(s,". Skipping save.")),t.set(s,!1);continue}let n=await w(s,a);t.set(s,n)}catch(e){K.z("Error handling file ".concat(s,":"),e),t.set(s,!1)}for(let e of m)await (0,tb.tE)(e);return t},[_,w,m]),N=(0,E.useCallback)(async e=>{if(!(0,$.hh)(e))throw Error("Not a local file: ".concat(e));try{var t;return null!=(t=await (0,em.EW)(m,e))?t:void 0}catch(e){return}},[m]),k=(0,E.useCallback)(async()=>{if(!g)throw Error("No directoryUuid");let e=await (0,tb.FL)(g);if(!e)throw Error("No syncedDirectory");return(await (0,$.vm)(e)).map(e=>e.uri)},[g]);return(0,n.jsx)(tx,{directoryName:null!=p?p:"",isStreaming:t,selectedContentId:j,onClose:i,openedFiles:_,onOpen:b,onSaveContent:w,onSaveAllContents:C,onCloseFile:y,fetchFileContent:N,listFiles:k,children:(0,n.jsx)(tx.Footer,{children:(0,n.jsx)("div",{className:"p-2",children:(0,n.jsx)(eY.H,{projectUuid:u,size:"small",tooltipContent:"Total code included in context is currently limited to Claude’s maximum context window size."})})})})};var tw=s(30453),t_=s(7386),tC=s(21777),tN=s(23661),tk=s(9122),tM=s(7582),tA=s(83910),tS=s(52584);let tE=e=>{let{type:t,size:s,className:a,isLoading:i=!1}=e;return(0,n.jsx)("div",{className:(0,y.A)("bg-bg-100 text-text-500 flex items-center justify-center rounded-l-[inherit]","default"===s&&"w-14","sm"===s&&"w-11",a),children:i?(0,n.jsx)(tt.Loading,{size:"sm"}):(0,n.jsx)(()=>{switch(t){case v.vU.Markdown:return(0,n.jsx)(tk.O,{size:24});case v.vU.Svg:return(0,n.jsx)(tM.D,{size:24});case v.vU.Html:return(0,n.jsx)(tA.q,{size:24});case v.vU.Code:case v.vU.Text:default:return(0,n.jsx)(tS.C,{size:24})}},{})})};var tz=s(66849);let tI=e=>{let{artifact:t,onClick:s,size:a="default"}=e,i=(0,tz.Q)(),l=(0,n.jsx)(I.A,{defaultMessage:"Click to open {artifactType} • {versionCount, plural, one {# version} other {# versions}}",id:"fBoEKmAB/j",values:{artifactType:i[t.type],versionCount:t.versions.length}});return(0,n.jsx)(tR,{previewContent:(0,n.jsx)(tE,{type:t.type,size:a}),title:t.title||(0,n.jsx)(I.A,{defaultMessage:"Untitled",id:"3kbIhS7KZS"}),metaContent:l,onClick:s,size:a,index:0})},tR=e=>{let{previewContent:t,title:s,metaContent:a,size:i,onClick:l,onRemove:r,index:o}=e,c=(0,z.A)(),d=l?"button":"div";return(0,n.jsxs)("div",{className:(0,y.A)("relative","sm"===i&&"max-w-[16rem]"),children:[r&&(0,n.jsx)("button",{className:"bg-bg-000 hover:bg-bg-300 shadow-element absolute right-0 top-0 z-10 -translate-y-2 translate-x-2 cursor-pointer rounded-full p-1",onClick:e=>{e.stopPropagation(),r(o)},children:(0,n.jsx)(eM.X,{size:11,weight:"bold"})}),(0,n.jsxs)(d,{className:(0,y.A)("border-0.5 border-border-300 bg-bg-000 flex flex-1 items-stretch overflow-hidden rounded-lg text-left transition-all","default"===i&&"w-full",!r&&"hover:border-border-200 hover:drop-shadow-sm",!r&&l&&"active:scale-[0.9875]"),onClick:l,disabled:!l,"aria-label":c.formatMessage({defaultMessage:"Preview contents",id:"hmKJSoIQ4a"}),children:[t,(0,n.jsxs)("div",{className:(0,y.A)("padding min-w-0 flex-1 pl-3 pr-2","default"===i&&"py-3","sm"===i&&"py-2"),children:[(0,n.jsx)("div",{className:(0,y.A)("break-words text-sm font-medium leading-tight","default"===i&&"line-clamp-2 font-medium","sm"===i&&"line-clamp-1"),children:s}),a&&(0,n.jsx)("div",{className:"text-text-400 line-clamp-1 text-xs",children:a})]})]})]})};var tF=s(49077),tT=s(74744),tU=s(52450),tL=s(29722),tD=s(89436),tO=s(18708),tP=s(14985),tB=s(35687),tW=s(73734);let tG=e=>{let{directoryUri:t,removeSyncedDirectory:s,isExpanded:a,setIsExpanded:i}=e,{directoryName:l}=(0,$.Q3)(t),{files:r}=(0,eu.w)(),o=r.filter(e=>(0,$.fo)(e)&&e.uri.startsWith(t)).length,c=e=>{e.stopPropagation(),i(e=>!e)};return(0,n.jsxs)("div",{className:(0,y.A)("group flex items-center gap-2 rounded-lg py-0.5 transition-colors ","lg:hover:bg-bg-500/10"),children:[(0,n.jsxs)("div",{className:"flex items-center gap-2 flex-1 text-left pl-2",onClick:c,children:[(0,n.jsx)(ey.$,{variant:"unstyled",size:"icon_xs",onClick:c,children:a?(0,n.jsx)(tO.Bm,{size:16}):(0,n.jsx)(tP.vd,{size:16})}),(0,n.jsxs)("div",{className:"min-w-0 flex-1 flex flex-col gap-0.5",children:[(0,n.jsx)("div",{className:"line-clamp-2 break-words text-sm",children:l}),(0,n.jsx)("p",{className:"text-xs text-text-400",children:(0,n.jsx)(I.A,{defaultMessage:"{count, plural, one {# file} other {# files}}",id:"Lf81FX5U/k",values:{count:o}})})]})]}),(0,n.jsx)("div",{className:(0,y.A)("transition-opacity group-hover:opacity-100","lg:opacity-0"),children:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(p.m,{tooltipContent:"Remove directory",children:(0,n.jsx)(ey.$,{size:"icon_sm",variant:"ghost",onClick:()=>s(t),"aria-label":"Remove directory",children:(0,n.jsx)(tB.l,{size:16})})})})})]})},tJ=e=>{let{file:t,onSelect:s,closeFile:a}=e,{pathComponents:i}=(0,$.Q3)(t);return(0,n.jsxs)("div",{className:"group flex items-center flex-1 pl-8 lg:pr-3",children:[(0,n.jsxs)(ey.$,{size:"unset",variant:"unstyled",className:"flex items-center gap-2 flex-1 w-full !justify-start",onClick:s,children:[(0,n.jsx)(tW.G,{}),(0,n.jsx)("div",{className:"text-sm text-text-200 flex items-center gap-[1px]",children:i.map((e,t)=>{let s=i.length-1===t;return(0,n.jsxs)(E.Fragment,{children:[(0,n.jsx)("span",{className:s?"":"text-text-500",children:e},e),!s&&(0,n.jsx)("span",{className:"text-text-400",children:"/"})]},"".concat(e,"-").concat(t))})})]}),(0,n.jsx)("div",{className:(0,y.A)("transition-opacity group-hover:opacity-100 flex items-center gap-2","lg:opacity-0"),children:(0,n.jsx)(p.m,{tooltipContent:"Close file",children:(0,n.jsx)(ey.$,{size:"icon_sm",variant:"ghost",onClick:a,"aria-label":"Close file",children:(0,n.jsx)(eM.X,{size:16})})})})]})},tH=e=>{let{directory:t,removeSyncedDirectory:s,closeFile:a,onSelect:i}=e,[l,r]=(0,E.useState)(!1),{projectDocs:o}=(0,eu.w)(),c=(0,E.useMemo)(()=>o.filter(e=>(0,em.Tk)(e,t)),[t,o]);return(0,n.jsxs)(w.P.li,{className:"overflow-hidden",exit:{height:0,opacity:0},animate:{height:"auto",opacity:1},children:[(0,n.jsx)(tG,{directoryUri:t.uri,removeSyncedDirectory:s,isExpanded:l,setIsExpanded:r}),(0,n.jsx)(ez.N,{children:l&&c.length>0&&(0,n.jsx)(w.P.ul,{className:"flex flex-col",initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},children:c.map((e,t)=>(0,n.jsx)(w.P.li,{className:"overflow-hidden flex items-center gap-2 py-2 rounded-lg lg:hover:bg-bg-500/10",initial:{opacity:0,y:-2},animate:{opacity:1,y:0},exit:{opacity:0,y:-2},transition:{delay:.025*t},children:(0,n.jsx)(tJ,{file:e.file_name,onSelect:()=>null==i?void 0:i(e.file_name),closeFile:()=>a(e.file_name)})},e.uuid))})})]},t.uri)},tV=e=>{let{projectUuid:t,syncedDirectories:s,removeSyncedDirectory:a,onSelect:i}=e,{projectDocs:l}=(0,eu.w)(),{mutateAsync:r}=(0,T.gG)(t),o=(0,E.useCallback)(async e=>{await (0,em.wZ)(l,e,r)},[l,r]);return(0,n.jsx)(n.Fragment,{children:s.map(e=>(0,n.jsx)(tH,{directory:e,removeSyncedDirectory:a,closeFile:o,onSelect:i},e.uri))})};function tY(e){let{dispatchChatResource:t}=e,{projectDocs:s,projectUuid:a,setFiles:i,syncedDirectories:l,setSyncedDirectories:r}=(0,eu.w)(),{mutateAsync:o}=(0,T.gG)(a);return(0,n.jsx)(tV,{projectUuid:a,syncedDirectories:l,removeSyncedDirectory:async e=>{let t=await (0,em.rU)(l,s,o,e);r(()=>t),i(await (0,em.p6)(a))},onSelect:e=>{t({type:"SELECT_SYNCED_DIRECTORY",id:e})}})}let tK=e=>{let{projectUuid:t,dispatchChatResource:s,docUpdates:a}=e,[i,{open:l,close:r}]=(0,e3.j)(!1),{syncedDirectories:o}=(0,eu.w)(),{data:c}=(0,U.fo)(t);return c?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)("div",{className:"mt-4",children:[(0,n.jsx)("h3",{className:"text-text-300 mb-2 mt-4 text-sm font-medium",children:c.is_harmony_project?(0,n.jsx)(I.A,{defaultMessage:"Local code",id:"kQFHMn6wNL"}):(0,n.jsx)(I.A,{defaultMessage:"Project content",id:"/IJPT7JRFn"})}),(0,n.jsxs)("div",{className:(0,y.$)("border-border-400 rounded-lg border",c.is_harmony_project?"px-1 pt-0.5 pb-2":"px-3 py-4"),children:[!c.is_harmony_project&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsxs)(A(),{href:"/project/".concat(t),className:"hover:text-text-000 flex items-center gap-1.5 hover:underline",children:[(0,n.jsx)(tM.D,{size:16,className:"text-text-300 shrink-0"}),(0,n.jsx)("div",{className:"font-claude-response text-text-200 leading-tight tracking-tight",children:c.name})]}),(0,n.jsx)("div",{children:(0,n.jsx)(tD.t,{project:c,className:"text-text-400 text-xs"})})]}),(0,n.jsx)("ul",{className:"mt-2 flex flex-col",children:o.length>0?(0,n.jsx)(tY,{dispatchChatResource:s}):(0,n.jsx)(tL.b,{isEditable:!1,project:c,maxItems:3,onViewAll:()=>{window.location.href="/project/".concat(t)}})})]})]}),""]}):null};function tZ(e){let{conversationUUID:t,onClose:s,projectUuid:a}=e,{allModelOptions:i}=(0,c.A9)(),{chatResourceState:{artifacts:l,attachments:r,files:d,syncSources:u,docUpdates:m},dispatchChatResource:f}=(0,H.i)(),x=(0,o.Z3)(t),h=i.find(e=>e.model===x),{modelConfig:g}=(0,c.fC)(x),p=g.image_in,{imageFiles:v,sanitizedDocumentFiles:b,blobFiles:y,wiggleVMFiles:w}=(0,E.useMemo)(()=>d.reduce((e,t)=>{switch(t.file_kind){case tN.M.Image:e.imageFiles.push(t);break;case tN.M.Blob:e.blobFiles.push(t);break;case tN.M.SanitizedDocument:e.sanitizedDocumentFiles.push(t);break;case tN.M.WiggleVM:e.wiggleVMFiles.push(t)}return e},{imageFiles:[],blobFiles:[],sanitizedDocumentFiles:[],wiggleVMFiles:[]}),[d]),_=Object.values(l),{value:C}=(0,j.fS)("conversation_export"),N=(0,n.jsxs)("div",{className:"border-border-400 rounded-lg border px-3 py-5 text-center",children:[(0,n.jsx)("div",{className:"font-claude-response mb-1",children:(0,n.jsx)(I.A,{defaultMessage:"No content added yet",id:"KWvxczfvCc"})}),(0,n.jsx)("div",{className:"text-text-300 mb-1 text-xs",children:p?(0,n.jsx)(I.A,{defaultMessage:"Add images, PDFs, docs, spreadsheets, and more to summarize, analyze, and query content with Claude.",id:"HJx5jgEsVM"}):(0,n.jsx)(I.A,{defaultMessage:"Add PDFs, docs, spreadsheets, and more to summarize, analyze, and query content with Claude.",id:"J0WpDuvvlE"})})]});return(0,n.jsx)(tC.E,{children:(0,n.jsxs)("div",{className:"px-5 pb-4 pt-2",children:[(0,n.jsxs)("div",{className:"flex items-center draggable pl-7 md:pl-1 pr-0.5",children:[(0,n.jsx)("h2",{className:"font-ui flex-1 text-lg font-medium tracking-tight",children:(0,n.jsx)(I.A,{defaultMessage:"Chat controls",id:"nBvhDBTi6q"})}),(0,n.jsx)(ey.$,{variant:"ghost",size:"icon",className:"-mr-2",onClick:s,children:(0,n.jsx)(eM.X,{size:20})})]}),h&&(0,n.jsxs)("div",{className:"my-2",children:[(0,n.jsx)("div",{className:"text-text-200 text-lg",children:(0,n.jsx)(tF.V,{model:h})}),(0,n.jsxs)("p",{className:"text-text-300 text-sm",children:[h.description,"\xa0",(0,n.jsx)("a",{className:"hover:text-text-000 underline",href:"https://www.anthropic.com/product",target:"_blank",rel:"noopener",children:(0,n.jsx)(I.A,{defaultMessage:"Learn more",id:"TdTXXf940t"})})]})]}),_.length>0&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h3",{className:"text-text-300 mb-2 mt-4 text-sm font-medium",children:(0,n.jsx)(I.A,{defaultMessage:"Artifacts",id:"eW5eoWkxy3"})}),(0,n.jsx)("ul",{className:"mt-2 flex flex-col gap-2",children:_.map((e,t)=>(0,n.jsx)("li",{children:(0,n.jsx)(tI,{artifact:e,onClick:()=>f({type:"SELECT_ARTIFACT",id:e.id})})},"artifact-".concat(t)))})]}),a&&(0,n.jsx)(tK,{projectUuid:a,dispatchChatResource:f,docUpdates:m}),(0,n.jsx)("h3",{className:"text-text-300 mb-2 mt-4 text-sm font-medium",children:(0,n.jsx)(I.A,{defaultMessage:"Content",id:"Jq3FDzj0/T"})}),v.length+y.length+b.length+w.length+r.length+u.length>0?(0,n.jsxs)("div",{className:"grid grid-cols-[repeat(auto-fill,minmax(120px,1fr))] gap-3",children:[[...v,...y,...b,...w].map((e,t)=>(0,n.jsx)(t_.NM,{size:"stretch",file:e},"".concat(e.file_kind,"-").concat(t))),r.map((e,t)=>(0,n.jsx)(t_.NM,{size:"stretch",file:e,handleClick:()=>f({type:"SELECT_ATTACHMENT",attachment:e})},"attachment-".concat(t))),u.map(e=>(0,n.jsx)(tT.br,{size:"stretch",syncSource:e,isEditable:!1,location:"chat"},e.uuid))]}):N,C&&(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("h3",{className:"text-text-300 mb-2 mt-5 text-sm font-medium",children:(0,n.jsx)(I.A,{defaultMessage:"Export conversation",id:"GZQU9SwGHT"})}),(0,n.jsx)(tU.aS,{conversationUUID:t})]})]})})}let tq=e=>{let{docUuid:t,projectUuid:s,goBack:a,onClose:i}=e,{data:l}=(0,T.Rn)({projectUuid:s,docUuid:t});if(!l)return null;let r={file_name:l.file_name,file_size:l.content.length,file_type:"text/plain",extracted_content:l.content,origin:tN.R.UserUpload};return(0,n.jsx)(tw.f,{attachment:r,goBack:a,onClose:i})},tX=(0,E.memo)(function(e){let{conversationUUID:t,onClose:s,isStreaming:a,projectUuid:i,sendMessage:l,isOpen:r}=e,{activeOrganization:o}=(0,m.YL)(),{chatResourceState:{selectedItem:c,artifacts:d,activeMessageUUID:u,docUpdates:f,attachments:x,fileEdits:h,files:g},dispatchChatResource:p}=(0,H.i)(),v=null==o?void 0:o.uuid,j=(0,E.useCallback)(e=>p({type:"SELECT_SYNCED_DIRECTORY",id:e}),[p]),b=(0,ev.f)(),y=(0,ep.y)(x,g,v,i),w=(0,E.useMemo)(()=>({claudeComplete:b,getFile:y}),[b,y]),_=(0,E.useCallback)(()=>{s()},[s]),C=(0,E.useCallback)(e=>{(null==c?void 0:c.type)==="artifact"&&p({type:"SELECT_ARTIFACT",id:c.id,versionUUID:e})},[c,p]),{changesMode:N}=(0,G.e)(),k=(0,E.useCallback)(e=>p({type:"SELECT_DOC",id:e}),[p]),M=(0,E.useCallback)(()=>p({type:"CLEAR_SELECTED"}),[p]);return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(ej.CV,{isStreaming:a,artifact:(null==c?void 0:c.type)!=="artifact"||N?void 0:d[c.id],selectedArtifactMessageUUID:u,selectedArtifactVersionUUID:(null==c?void 0:c.type)==="artifact"?c.versionUUID:void 0,setSelectedArtifactVersionUUID:C,onClose:s,projectUuid:i,selectDoc:k,sendMessage:l,richSandboxCapabilities:w,isOpen:r}),i&&(0,n.jsx)(ty,{isStreaming:a,directoryUri:c&&"id"in c?c.id:void 0,selectUri:j,onClose:_,suggestedChanges:h}),(null==c?void 0:c.type)==="artifact"&&d[c.id]||(null==c?void 0:c.type)==="syncedDirectory"||N?null:(null==c?void 0:c.type)==="attachment"?(0,n.jsx)(tw.f,{goBack:()=>p({type:"CLEAR_SELECTED"}),attachment:c.attachment,onClose:s}):(null==c?void 0:c.type)==="compass"?(0,n.jsx)(eW,{data:c.data,onClose:s,goBack:M}):i&&(null==c?void 0:c.type)==="doc"?(0,n.jsx)(tq,{docUuid:c.id,projectUuid:i,onClose:s,goBack:()=>p({type:"CLEAR_SELECTED"})}):(0,n.jsx)(tZ,{conversationUUID:t,onClose:s,projectUuid:i})]})});var tQ=s(18395);function t$(e){let{conversationUuid:t,message:s}=e,a=(0,S.useRouter)(),i=(0,eZ.Y)(),[l,r]=(0,E.useState)(!1);return(0,n.jsxs)("div",{className:" flex flex-col gap-1.5 border-0.5 border-border-300 bg-bg-100 rounded-t-xl text-text-300 font-ui tracking-tight z-10 p-6 ",children:[(0,n.jsxs)("div",{className:"flex flex-col gap-4 sm:flex-row items-center sm:justify-between font-medium",children:[(0,n.jsx)("div",{className:"text-lg",children:(0,n.jsx)(I.A,{defaultMessage:"Chat ended by Claude",id:"dHdfbAOK+j"})}),(0,n.jsxs)("div",{className:"flex items-center gap-4",children:[(0,n.jsx)(ey.$,{onClick:()=>a.push("/new"),children:(0,n.jsx)(I.A,{defaultMessage:"Start new chat",id:"KcA+xo4hhh"})}),(0,n.jsx)(ey.$,{variant:"secondary",onClick:()=>r(!0),children:(0,n.jsx)(I.A,{defaultMessage:"Give feedback",id:"bCmvTYWKoj"})})]})]}),(0,n.jsx)(tQ.B,{conversationUuid:t,message:s,requestedFeedbackType:"chat_ended",setRequestedFeedbackType:()=>{},isOpen:l,onClose:()=>{r(!1)},onSuccess:()=>i.addSuccess("Feedback submitted successfully"),showOptions:!1})]})}var t0=s(57383),t1=s(74039),t2=s(77186),t5=s(53248),t3=s(50824),t4=s(56326),t6=s(10158),t7=s(46612),t9=s(92075);function t8(){let e=(0,a._)(["\n  w-full\n  flex\n  gap-2\n  bg-warning-orange\n  px-3\n  py-2\n  ","\n"]);return t8=function(){return e},e}let se=["consumer_restricted_mode","consumer_second_warning","consumer_first_warning","recent_election_discussion"],st=e=>{let{long:t}=e;return(0,n.jsx)("a",{className:"underline",href:t7.Z1,target:"_blank",rel:"noreferrer",children:t?(0,n.jsx)(I.A,{defaultMessage:"Learn more about the types of prompts to avoid {arrow}",id:"6DZ92vAY0j",values:{arrow:"\xbb"}}):(0,n.jsx)(I.A,{defaultMessage:"Learn more {arrow}",id:"ZeACTbo6DM",values:{arrow:"\xbb"}})})},ss={consumer_restricted_mode:[{isDismissible:!1,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(I.A,{defaultMessage:"Because a large number of your prompts have violated our Acceptable Use Policy, we have temporarily applied enhanced safety filters to your chats.",id:"PzePYdPNe4"})," ",(0,n.jsx)(st,{})]})}],consumer_second_warning:[{isDismissible:!0,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(I.A,{defaultMessage:"It appears your recent prompts continue to violate our Acceptable Use Policy. If we continue seeing this pattern, we’ll apply enhanced safety filters to your chats.",id:"BjivfV2YY6"})," ",(0,n.jsx)(st,{})]})}],consumer_first_warning:[{isDismissible:!0,content:(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(I.A,{defaultMessage:"It looks like a few of your recent prompts don’t meet our Usage Policy.",id:"Aup/Kzn3Eq"})," ",(0,n.jsx)(st,{long:!0})]})}],recent_election_discussion:[{isDismissible:!0,content:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(I.A,{defaultMessage:"Claude may not be able to provide accurate, real time information on elections. Please visit <link>TurboVote</link> or check the Secretary of State site for your state to get reliable, up-to-date, non partisan guidance on how and where to vote in elections across the US.",id:"X4J/f3yO08",values:{link:e=>(0,n.jsx)("a",{className:"underline",href:"http://claude.turbovote.org",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"US"},{isDismissible:!0,content:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(I.A,{defaultMessage:"The United Kingdom’s general elections will be held on 4 July, 2024. Please visit the <link>UK Election Commission’s website</link> to get reliable, up-to-date, impartial guidance on how and where to vote in the United Kingdom’s general elections.",id:"VUvO/yD1Iw",values:{link:e=>(0,n.jsx)("a",{className:"underline",href:"https://www.electoralcommission.org.uk/",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"GB"},{isDismissible:!0,content:(0,n.jsx)(n.Fragment,{children:(0,n.jsx)(I.A,{defaultMessage:"The French legislative elections will be held in two rounds of voting on June 30 and July 7, 2024. Please consult <link>the French Public Administration website</link> for reliable and up-to-date guidance on where and how to vote in the legislative elections in France.",id:"ZzEMOJWfNz",values:{link:e=>(0,n.jsx)("a",{className:"underline",href:"https://www.service-public.fr/particuliers/vosdroits/N47",target:"_blank",rel:"noopener noreferrer",children:e})}})}),applicable_country:"FR"}]};function sa(e){let{isClaudeDot:t,content:s,isDismissible:a,handleDismiss:i}=e;return(0,n.jsx)("div",{className:t?"fixed top-8 z-10 p-4":"",children:(0,n.jsx)(si,{$isFloating:t,children:(0,n.jsxs)("div",{className:"items-top flex justify-between",children:[(0,n.jsx)("p",{className:"text-sm font-medium",children:s}),a&&i&&(0,n.jsx)("button",{className:"h-5 cursor-pointer",onClick:()=>void i(),children:(0,n.jsx)(eM.X,{size:24})})]})})})}function sn(e){let{conversationUuid:t}=e,s=(0,eK.st)(),a=(0,t6.fZ)(),{account:i,activeOrganization:l}=(0,m.YL)(),r=null==i?void 0:i.uuid,o=null==l?void 0:l.uuid,{mutateAsync:c}=(0,t9.iD)(),{data:d}=(0,t9.Nj)(null==l?void 0:l.uuid),u=(0,t6._r)().ipCountry,f=(null==d?void 0:d.active_flags)&&(null==d?void 0:d.active_flags.map(e=>e.type)),{shownFlagType:x,shownFlagDetails:h}=function(e,t){let s=se.findIndex(e=>null==t?void 0:t.includes(e)),a=se[s];if(!a)return{shownFlagType:null,shownFlagDetails:null};let n=ss[a].filter(t=>!t.applicable_country||t.applicable_country===e);return 0===n.length?{shownFlagType:null,shownFlagDetails:null}:{shownFlagType:a,shownFlagDetails:n[0]}}(u,f);if((0,E.useEffect)(()=>{r&&o&&x&&s.track({event_key:"ts.banner.shown",flag_type:x,conversation_uuid:t,account_uuid:r,organization_uuid:o,ipCountry:null!=u?u:"unknown"})},[s,x,t,r,o,u]),!x||!h)return;let{isDismissible:g,content:p}=h,v=async()=>{if(!g)return;let e=[x];"consumer_second_warning"===x&&(null==f?void 0:f.includes("consumer_first_warning"))&&e.push("consumer_first_warning"),await Promise.all(e.map(e=>c({flagType:e})))};return(0,n.jsx)(sa,{isClaudeDot:a,content:p,isDismissible:g,handleDismiss:v})}let si=h.J.div(t8(),e=>e.$isFloating&&"max-w-3xl\n    mx-auto\n    rounded-md\n    shadow-element\n    z-toast");var sl=s(68020),sr=s(47211),so=s(21599),sc=s(26237),sd=s(79900),su=s(99318);let sm=["apps_and_websites","documents_and_templates","games","productivity_tools","creative_projects","quiz_or_survey","start_from_scratch"],sf=e=>{var t;let{selectedLabel:s,disabled:a}=e,i=(0,z.A)(),{track:l}=(0,eK.st)(),r=new Map([["apps_and_websites",i.formatMessage({defaultMessage:"Apps and websites",id:"HC16Tj5QBT"})],["documents_and_templates",i.formatMessage({defaultMessage:"Documents and templates",id:"mLy6zrc3XL"})],["games",i.formatMessage({defaultMessage:"Games",id:"DUyJmj7sj9"})],["productivity_tools",i.formatMessage({defaultMessage:"Productivity tools",id:"t/RMra2cqp"})],["creative_projects",i.formatMessage({defaultMessage:"Creative projects",id:"gZSnjM59XP"})],["quiz_or_survey",i.formatMessage({defaultMessage:"Quiz or survey",id:"yyPDfhkUT7"})],["start_from_scratch",i.formatMessage({defaultMessage:"Start from scratch",id:"fGhwMpK3XG"})]]),o=new Map(Array.from(r,e=>e.reverse())),c=new Map([["apps_and_websites",sl.E],["documents_and_templates",sr.i],["games",so.H],["productivity_tools",sc.l],["creative_projects",sd.e],["quiz_or_survey",su.S],["start_from_scratch",e6.f]]),{sendTransparentMessage:d}=(0,t0.o)(),u=null!=(t=o.get(null!=s?s:""))?t:"default",m=async e=>{r.has(e)&&(l({event_key:"artifact.studio.create_mode_selected",create_mode:e}),await d(r.get(e)))};return(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("p",{className:"font-claude-message pl-2 mt-1",children:(0,n.jsx)(I.A,{defaultMessage:"Let’s get cooking! Pick an artifact category or start building your idea from scratch.",id:"HKJSK13xqN"})}),(0,n.jsx)("div",{className:"grid grid-cols-2 sm:grid-cols-4 gap-2 max-w-xl justify-center items-stretch w-full",children:sm.map(e=>{let t=c.get(e);return(0,n.jsx)("div",{className:(0,y.A)("relative w-full h-full min-h-[3.5rem] sm:h-28 p-3 sm:p-3.5 text-sm bg-bg-000 rounded-lg transition-colors group",u===e&&"border-0.5 text-text-100 bg-bg-000 shadow-sm",("default"!==u&&u!==e||"default"===u&&a)&&"text-text-500 bg-bg-000/50 border-0.5 border-border-300","default"===u&&!a&&"border-0.5 border-border-300 text-text-300 hover:border-text-200 hover:bg-bg-000 hover:text-text-100 cursor-pointer shadow-sm"),onClick:async()=>{"default"!==u||a||await m(e)},children:(0,n.jsxs)("div",{className:"flex flex-row sm:flex-col items-center sm:items-start justify-center sm:justify-start h-full w-full gap-3 sm:gap-0",children:[t&&(0,n.jsx)(t,{size:20,weight:"light",className:(0,y.A)("transition-transform duration-300 ease-out shrink-0 sm:absolute sm:bottom-4 sm:right-4","default"===u&&!a&&"group-hover:-rotate-2 sm:group-hover:rotate-2 group-hover:scale-105")}),(0,n.jsx)("span",{className:"flex-1 text-left",children:r.get(e)})]})},e)})})]})},sx=e=>{var t,s,a,i;let{scrollRefs:l,newMessageSent:r,setNewMessageSent:o,scrollContainerRef:c,invalidator:d}=e,[u,m]=(0,E.useState)(0),f=(0,E.useCallback)(()=>{var e,t,s,a;let n=(null==(e=l.lastAssistantMessage.current)?void 0:e.clientHeight)||0,i=(null==(t=l.lastHumanMessage.current)?void 0:t.clientHeight)||0,r=(null==(s=l.chatInput.current)?void 0:s.clientHeight)||0,o=(null==(a=l.extras.current)?void 0:a.clientHeight)||0,c=Math.max(window.innerHeight-i-n-o-r-110,0);c!==u&&m(c)},[l,u]);return(0,E.useLayoutEffect)(()=>{f()},[d,f,null==(t=l.lastAssistantMessage.current)?void 0:t.clientHeight,null==(s=l.lastHumanMessage.current)?void 0:s.clientHeight,null==(a=l.extras.current)?void 0:a.clientHeight,null==(i=l.chatInput.current)?void 0:i.clientHeight]),(0,E.useLayoutEffect)(()=>(window.addEventListener("resize",f),()=>window.removeEventListener("resize",f)),[f]),(0,E.useLayoutEffect)(()=>{r&&(setTimeout(()=>{var e;null==(e=c.current)||e.scrollToBottomIfPinned("smooth")},0),o(!1))},[r,o,c]),(0,E.useEffect)(()=>{var e;null==(e=c.current)||e.scrollToBottomIfPinned("instant")},[c]),(0,n.jsx)("div",{ref:l.extraSpace,style:{height:"".concat(u,"px")},"aria-hidden":"true"})};function sh(){return(0,n.jsx)(w.P.figure,{initial:{opacity:0},animate:{opacity:1},transition:{delay:.2},className:"text-text-100 absolute inset-0 grid h-full place-content-center gap-8 text-center","data-testid":"empty-chat-screen",children:(0,n.jsxs)("h2",{className:"font-title flex flex-col items-center justify-center gap-2 sm:flex-row",children:[(0,n.jsx)("div",{className:"mt-1",children:(0,n.jsx)(g.a,{state:"waiting"})}),(0,n.jsx)(I.A,{defaultMessage:"What can I help you with today?",id:"1PnN/uP0zv"})]})})}var sg=s(71710);let sp="/Spark/",sv=[19,17,16,15,14,13,12,11,1,11,12,13,14,15,16,17,19],sj="".concat(sp,"/Check.svg"),sb=R.z.object({changeTitle:R.z.boolean().optional(),titleDelayMs:R.z.number().optional(),changeFavicon:R.z.boolean().optional(),faviconDelayMs:R.z.number().optional(),playSound:R.z.boolean().optional()}),sy={},sw=()=>{let e=(0,E.useRef)(null),t=(0,E.useRef)(!1);(0,E.useEffect)(()=>{try{e.current=new Audio("/click.mp3")}catch(e){}},[]);let s=(0,E.useCallback)(()=>{if(!t.current){t.current=!0;try{e.current||(e.current=new Audio("/click.mp3"))}finally{var s;null==(s=e.current)||s.play()}}},[]),a=(0,E.useCallback)(()=>{t.current=!1},[]);return(0,E.useMemo)(()=>({playSound:s,resetSound:a}),[s,a])},s_=(e,t,s)=>{let a=(0,E.useRef)(null),n=(0,E.useCallback)(()=>{a.current&&(clearInterval(a.current),a.current=null),document.title="Working on it..."},[]),i=(0,E.useCallback)(()=>{if(a.current)return;let t=0;a.current=setInterval(()=>{document.title=e[t],t=(t+1)%e.length},s)},[s,e]),l=(0,E.useCallback)(()=>{a.current&&(clearInterval(a.current),a.current=null),document.title=t},[t]);return(0,E.useMemo)(()=>({setThinkingTitle:n,setReceivedTitle:i,resetTitle:l}),[n,i,l])},sC=e=>{let t=(0,E.useRef)(null),s=(0,E.useCallback)(e=>{let t=document.querySelector("link[rel~='icon']")||document.createElement("link");t.rel="icon",t.href=e,document.head.appendChild(t)},[]),a=(0,E.useCallback)(()=>{t.current&&clearInterval(t.current),t.current=null,s("/favicon.ico")},[s]),n=(0,E.useCallback)(()=>{if(t.current)return;let a=0;t.current=setInterval(()=>{s("".concat(sp,"/").concat(sv[a],".svg")),a=(a+1)%sv.length},e)},[e,s]),i=(0,E.useCallback)(()=>{a(),s(sj)},[s,a]);return(0,E.useMemo)(()=>({setWritingFavicon:n,setCompleteFavicon:i,resetFavicon:a}),[n,i,a])},sN=(e,t,s)=>{let a=(0,j.T9)("claude_ai_tabbed_out_notifications","features",sy,sb),n="visible"===(0,sg.f)(),{setThinkingTitle:i,setReceivedTitle:l,resetTitle:r}=s_(["Ready to chat",e],e,a.titleDelayMs||1600),{setWritingFavicon:o,setCompleteFavicon:c,resetFavicon:d}=sC(a.faviconDelayMs||100),{playSound:u,resetSound:m}=sw(),f=(0,E.useRef)(!1);(0,E.useEffect)(()=>{let e=t&&s,x=!t&&s,h=!t&&!s;e&&!f.current&&(f.current=!0);let g=h&&f.current;if(g&&(f.current=!1),n){a.changeTitle&&r(),a.changeFavicon&&d();return}a.changeTitle&&(e||x?i():g&&l()),a.changeFavicon&&(x?o():g&&(c(),f.current=!1)),a.playSound&&(e?m():g&&u())},[a,t,s,n,i,l,r,o,c,d,u,m])};var sk=s(98878),sM=s(77763),sA=s(11062);function sS(e){let{chatId:t,chatName:s,onSend:a}=e,{activeOrganization:n}=(0,m.YL)(),i=(0,t2.mn)(),l=(0,E.useRef)(!1);return(0,sk._v)(sM.A.ChatInfo,{getCurrentChatInfo:()=>Promise.resolve({chatId:t,chatName:s}),sendToChatWithPayload:e=>e.chatId===t&&!l.current&&!!n&&(l.current=!0,(async()=>{try{let t=[];if(e.imageBase64&&e.imageMimeType)try{t.push(...await (0,sA.bl)(e.imageBase64,e.imageMimeType,n.uuid,i))}catch(e){}return await a({prompt:e.text,files:t}),!0}catch(e){return!1}finally{l.current=!1}})(),!0)},[t,s,n,i,a]),null}var sE=s(10340),sz=s(77336);function sI(){let e=(0,a._)(["\n  flex-1\n  flex\n  flex-col\n  gap-3\n  px-4\n  max-w-3xl\n  mx-auto\n  w-full\n"]);return sI=function(){return e},e}let sR=()=>{let[e,t]=(0,E.useState)(""),s=(0,z.A)(),a=(0,E.useMemo)(()=>[s.formatMessage({defaultMessage:"Gathering my thoughts, be right there...",id:"C6UYRcZHCt"}),s.formatMessage({defaultMessage:"Contemplating, stand by...",id:"r6P7kLapjf"}),s.formatMessage({defaultMessage:"Pondering, stand by...",id:"l0/dX2gLlN"}),s.formatMessage({defaultMessage:"Ruminating on it, stand by...",id:"wt2OTGsj0k"}),s.formatMessage({defaultMessage:"Pondering, stand by...",id:"l0/dX2gLlN"})],[s]),i=(0,E.useMemo)(()=>s.formatMessage({defaultMessage:"Still working on it, stand by...",id:"R9hnARYgER"}),[s]),l=(0,E.useMemo)(()=>s.formatMessage({defaultMessage:"A bit longer, thanks for your patience...",id:"MCt5e8xpx8"}),[s]);return(0,E.useEffect)(()=>{let e=setTimeout(()=>{t(a[Math.floor(Math.random()*a.length)])},5e3);return()=>clearTimeout(e)},[a]),(0,E.useEffect)(()=>{let e=setTimeout(()=>{t(i)},15e3);return()=>clearTimeout(e)},[i]),(0,E.useEffect)(()=>{let e=setTimeout(()=>{t(l)},3e4);return()=>clearTimeout(e)},[l]),(0,n.jsx)(w.P.div,{initial:{opacity:0},animate:{opacity:1},transition:{duration:.1},className:"font-claude-response text-text-300 ml-2 pb-1.5 text-sm italic",children:e})};function sF(e){var t,s,a,h,w,_,M,K,Z,q,X,Q,ee,et,es,ea;let{changeDisplayedConversationPath:ei,conversationTitle:ed,conversationUUID:ep,editMessage:ev,isStreaming:ej,isLoading:eb,messages:ey,name:ew,onRetry:e_,onSend:eC,customFileUploadHandler:eN,projectUuid:ek,setPersonalizedStyleCallback:eM,onToolAllow:eA}=e,{account:eS,activeOrganization:eE}=(0,m.YL)(),{selectedTier:ez}=(0,x.t)(),eI=(0,f.B)(),eR=(0,z.A)(),{value:eF}=(0,j.fS)("new_scroll_behavior"),{value:eT}=(0,j.fS)("claudeai_beam"),eU=(0,E.useRef)(null),eL=(0,E.useRef)(null);eL.current=null==(t=ey[ey.length-1])?void 0:t.uuid;let{projectHasHarmony:eD}=(0,eo.r)(ek),{openedFiles:eO,projectDocs:eP}=(0,eu.w)(),{getInstance:eB}=(0,G.e)(),{chatResourceState:eW,dispatchChatResource:eG}=(0,H.i)(),{mutateAsync:eJ}=(0,T.fh)(ek),{mutateAsync:eH}=(0,T.Om)(ek),{serverLastChatMessageWarningProps:eV,updateServerLastChatMessageWarningPropsForNewMessage:eY}=function(e,t){let[s,a]=(0,E.useState)(null),n=function(e){let{activeOrganization:t}=(0,m.YL)(),s="/api/organizations/".concat((null==t?void 0:t.uuid)||"","/chat_conversations/").concat(e,"/chat_message_warning"),{mutateAsync:a}=(0,t2.L2)(s,"POST",{meta:{noToast:!0}});return(0,E.useCallback)(async e=>{let t=await a(e);return t.warning_props?{contentMarkdown:t.warning_props.content_markdown,style:t.warning_props.style}:null},[a])}(e),i=(0,E.useCallback)(e=>{async function t(){try{a(await n(e))}catch(e){}}a(null),t()},[n]),l=(0,E.useCallback)(e=>{let{messageText:t,parentMessageUuid:s}=e;i({message_text:t,analytics_data:{type:"message_send",prev_message_uuid:s&&s!==r.gF?s:null}})},[i]);return function(e){let{chatMessages:t,onLastMessageLoaded:s}=e,a=(0,E.useRef)(t.filter(e=>"human"===e.sender).pop());(0,E.useEffect)(()=>{if(!a.current)return;let e=(0,t5.C)(a.current);e&&s({uuid:a.current.uuid,messageText:e})},[s])}({chatMessages:t,onLastMessageLoaded:(0,E.useCallback)(e=>{let{uuid:t,messageText:s}=e;i({message_text:s,analytics_data:{type:"conversation_load",message_uuid:t}})},[i])}),{serverLastChatMessageWarningProps:s,updateServerLastChatMessageWarningPropsForNewMessage:l}}(ep,ey),{setSandboxState:eK}=(0,l.q)(),eZ=(0,S.useSearchParams)(),[eq,eX]=(0,E.useState)(!1),[eQ,e$]=(0,E.useState)(null),e0={lastAssistantMessage:(0,E.useRef)(null),lastHumanMessage:(0,E.useRef)(null),chatInput:(0,E.useRef)(null),extras:(0,E.useRef)(null),extraSpace:(0,E.useRef)(null)},e1=(0,eg.u)(),e2=null==eS||null==(s=eS.settings)?void 0:s.enabled_monkeys_in_a_barrel,e5=(0,E.useMemo)(()=>{},[e1,null==eE?void 0:eE.uuid,ep,e2]),e3=(0,E.useRef)(null),e4=(0,E.useCallback)(async e=>{let{prompt:t,attachments:s,files:a,syncSources:n,personalized_style:i,compass_mode:l}=e;if(ej)return;eG({type:"SET_ACTIVE_MESSAGE_UUID",uuid:void 0}),eY({messageText:t,parentMessageUuid:eL.current}),eK(ep,{conversationFiles:[...eW.files,...a],allAttachments:[...eW.attachments,...s],projectUuid:ek});let o={prompt:t,attachments:s,files:a,syncSources:n,rethrowErrors:!0,parent_message_uuid:eL.current||r.gF,personalized_style:i,org_type_override:null!=ez?ez:void 0,compass_mode:l};eX(!0),await eC(o)},[ej,eG,eY,eK,ep,eW.files,eW.attachments,eC,ek,ez]),e6=(0,E.useCallback)(async()=>{eD&&ek&&await (0,em.Jo)(eO,ek,eP,eJ,eH,eB)},[eD,eO,ek,eP,eJ,eH,eB]),e7=(0,E.useCallback)(async(e,t)=>{eG({type:"SET_ACTIVE_MESSAGE_UUID",uuid:void 0}),await e6(),eK(ep,{conversationFiles:eW.files,allAttachments:eW.attachments,projectUuid:ek}),e_(e,t)},[eG,e6,eK,ep,eW.files,eW.attachments,e_,ek]),e8=(0,E.useCallback)(async()=>{if(ej)return;let e=eR.formatMessage({defaultMessage:"Continue",id:"acrOozm08x"});await eC({prompt:e,attachments:[],files:[],syncSources:[],rethrowErrors:!0,parent_message_uuid:eL.current||r.gF})},[eR,ej,eL,eC]),te=(0,E.useCallback)(async(e,t)=>{if(ev){var s;eG({type:"CLEAR_SELECTED"}),await e6(),ev(e,t),eY({messageText:t,parentMessageUuid:null!=(s=e.parent_message_uuid)?s:null})}},[e6,eG,ev,eY]),tt=(0,E.useMemo)(()=>(0,k.A)(),[]);(0,E.useEffect)(()=>(tt.on("retry",e=>{let{parent_message_uuid:t,paprika_mode:s}=e;e7(t,s)}),tt.on("edit",e=>{let{message:t,text:s}=e;te(t,s)}),()=>{tt.off("retry"),tt.off("edit")}),[tt,e7,te]);let[ts,ta]=(0,E.useState)("");(0,E.useEffect)(()=>{ej||ta(ey.map(e=>(0,i.Rs)(e)).join(" "))},[ey,ej]);let tn=(0,u.F)(ts),{files:ti,attachments:tl,artifacts:tr}=eW,{isDrawerExpanded:to,setIsDrawerExpanded:tc}=(0,e9.x)(),td=(0,E.useCallback)(()=>{eG({type:"CLEAR_SELECTED"}),tc(!0)},[eG,tc]),tu=(0,E.useCallback)(()=>{tc(!1)},[tc]),tm=(0,sz.V)(ey);(0,E.useEffect)(()=>{eG({type:"UPDATE_FILES",files:tm})},[tm,eG]),(0,E.useEffect)(()=>{eG({type:"UPDATE_ATTACHMENTS",attachments:ey.flatMap(e=>e.attachments)})},[eG,ey]),(0,E.useEffect)(()=>{eG({type:"UPDATE_SYNC_SOURCES",syncSources:ey.flatMap(e=>e.sync_sources)})},[eG,ey]);let tf=(0,E.useCallback)(e=>{td(),eG({type:"SELECT_ATTACHMENT",attachment:e})},[eG,td]),tx=(0,E.useMemo)(()=>!!((null==eI?void 0:eI.preview_feature_uses_artifacts)||ey.some(e=>ex(e))),[eI,ey]),th=(0,E.useCallback)((e,t,s)=>{td(),eG({type:"SELECT_ARTIFACT",id:e,versionUUID:s}),eG({type:"SET_ACTIVE_MESSAGE_UUID",uuid:t||""})},[eG,td]),tg=ey[ey.length-1];(0,E.useEffect)(()=>{if(!tx)return;let e={};ey.forEach(t=>{(0,v.Xz)(t).forEach(t=>{var s,a,n;let{id:i,currentVersion:l,type:r,title:o,language:c}=t,d=(0,v.zI)(l,null==(n=e[i])||null==(a=n.versions)||null==(s=a.slice(-1)[0])?void 0:s.resultState),u={...l,resultState:d};e[i]?e[i].versions.push(u):e[i]={id:i,type:r||"document",title:o||"Untitled",language:c||void 0,versions:[u]}})}),eG({type:"UPDATE_ARTIFACTS",artifacts:e})},[ey,tx,tg,eG]);let tp=tg?(0,v.Xz)(tg):[],tv=null!=(et=C()(tp))?et:null,tj=null!=(es=null==tv?void 0:tv.id)?es:null,tb=(0,E.useRef)({lastOpenedArtifactId:null});(0,E.useEffect)(()=>{let e=tb.current.lastOpenedArtifactId===tj;ej&&tj&&!e&&(tb.current.lastOpenedArtifactId=tj,th(tj))},[ej,tj,th]),(0,E.useEffect)(()=>{let e=eZ.get("artifactId");e&&(td(),eG({type:"SELECT_ARTIFACT",id:e}))},[]),!function(e){let{lastMessage:t,projectUuid:s}=e,{getInstance:a,setMergeState:n,rejectAllChanges:i}=(0,G.e)(),{projectHasHarmony:l}=(0,eo.r)(s),{dispatchChatResource:o}=(0,H.i)(),c=(0,E.useRef)(""),d=(0,E.useRef)(0),u=(0,E.useRef)(!1),m=(0,E.useMemo)(()=>{var e;return(null==t||null==(e=t.content)?void 0:e.filter(e=>"tool_use"===e.type&&["str_replace","update_file","create_file","delete_file"].includes(e.name)))||[]},[null==t?void 0:t.content]),f=(0,E.useCallback)((e,t)=>{if("tool_use"!==e.type)return null;let s=e.partial_json?(0,J.d)(e.partial_json||""):e.input;if(!s||"object"!=typeof s)return null;let n=ec.safeParse(s);if(!n.success)return null;let i=n.data.path;if(!(0,$.hh)(i))return null;switch(e.name){case"str_replace":return{contentId:i,changeType:"edit",state:{currentContent:t,changes:[{type:"edit",contentId:i,originalHash:n.data.original_hash||"",oldStr:n.data.old_str||"",newStr:n.data.new_str||""}]}};case"update_file":{let e=a(i),s=null==e?void 0:e.view;if(!s)return null;let l={type:"update",contentId:i,originalHash:n.data.original_hash||"",newText:n.data.file_text||""};return el(s,l),{contentId:i,changeType:l.type,state:{currentContent:t,changes:[]}}}case"create_file":{let e={type:"create",contentId:i,newText:""},s=a(i);return(null==s?void 0:s.view)&&el(s.view,{...e,newText:n.data.file_text||""}),{contentId:i,changeType:e.type,state:{currentContent:t,changes:[]},suggestedChange:e}}case"delete_file":{let e=a(i),s=null==e?void 0:e.view,l={type:"delete",contentId:i,originalHash:n.data.original_hash||""};return s&&el(s,l),{contentId:i,changeType:l.type,state:{currentContent:t,changes:[]},suggestedChange:l}}default:return null}},[a]),x=(0,E.useCallback)((e,t)=>{let s=a(e),i=null==s?void 0:s.view;i&&(n(e,{isActive:!0,diffSource:t.currentContent}),t.changes.length>0&&function(e,t,s){let a=s;if(t.forEach(e=>{let{oldStr:t,newStr:s}=e;a=a.replace(t,s)}),a!==e.state.doc.toString()){e.dispatch({changes:{from:0,to:e.state.doc.length,insert:a},annotations:[Y.ZX.addToHistory.of(!1)]});try{en(e,(0,V.cg)(e.state).toString(),!0)}catch(e){}}}(i,t.changes,t.currentContent))},[a,n]);(0,E.useEffect)(()=>{if(!l||!(null==t?void 0:t.content)||(null==t?void 0:t.uuid)!==r.gv)return;m.length>0&&0===d.current&&!u.current?(i(),o({type:"UPDATE_FILE_EDITS",edits:new Map}),u.current=!0):0===m.length&&(u.current=!1),d.current=m.length;let e=m.map(e=>{if("tool_use"!==e.type)return"";let{name:t,partial_json:s,input:a}=e;return"".concat(t,":").concat(s||JSON.stringify(a))}).join("|");if(e===c.current)return;c.current=e;let s=new Map;m.reduce((e,t)=>{if("tool_use"!==t.type)return e;let n=t.partial_json?(0,J.d)(t.partial_json||""):t.input;if(!n||"object"!=typeof n)return e;let i=ec.safeParse(n);if(!i.success)return e;let l=i.data.path;if(!(0,$.hh)(l))return e;let r=a(l),o=f(t,r?(0,er.t_)(r):"");if(!o)return e;if(o.suggestedChange){let e=s.get(o.contentId)||[];s.set(o.contentId,[...e,o.suggestedChange])}let c=e.get(o.contentId);return c?e.set(o.contentId,{currentContent:c.currentContent,changes:[...c.changes,...o.state.changes]}):(e.set(o.contentId,o.state),e)},new Map).forEach((e,t)=>{x(t,e)}),s.size>0&&o({type:"UPDATE_FILE_EDITS",edits:s})},[l,m,f,x,t,i,o,a])}({lastMessage:tg,projectUuid:ek});let ty=ej&&tg&&tg.content?tg.content[tg.content.length-1]:void 0,tw=ej&&(!tg||!(null==(a=tg.content)?void 0:a[0])&&0===tg.attachments.length&&0===tg.files.length&&0===tg.files_v2.length),t_=ty&&("tool_use"===ty.type||"tool_result"===ty.type),tC=(0,E.useMemo)(()=>{if(tg){let e=eh(tg);if(!e)return;let t=e.content.map(e=>e&&"text"in e?e.text:"").join("\n"),{data:s}=ef.z7.safeParse(t);return null==s?void 0:s.task_id}},[tg]),tN=!ej&&void 0!==tC,{compassStatus:tk}=(0,B.CH)({organizationUUID:null==eE?void 0:eE.uuid,conversationUUID:ep,taskId:tC,isShared:!1,enabled:tN}),tM=(0,E.useMemo)(()=>{if(!tg)return!1;let e=eh(tg);return!!(e&&!e.is_error&&(0,b.i3)(null==tk?void 0:tk.status)&&!ex(tg))},[tg,tk]),tA=(0,W.Wo)(),tS=(0,W.hG)(),{value:tE}=(0,j.fS)("compass_enable_notifications_web"),tz=(0,E.useMemo)(()=>tw?"thinking":t_||tM?"shimmer":ej?"writing":"static",[tw,t_,ej,tM]);sN(ed,tw,ej);let{getCreateParamsForConvo:tI}=(0,d.I)();(0,E.useEffect)(()=>{if(eb)return;let e=tI(ep);e&&void 0!==e.prompt&&(e.prompt.length>0||e.files.length>0||e.attachments.length>0||e.syncSources.length>0)&&e4(e)},[ep,e4,tI,eb]);let{data:tR}=(0,U.fo)(ek),tF=(0,D.K)(),tT=(0,L.ED)(ek),{publishedArtifactsByMessageUuid:tU}=(0,F.rC)({includeDeletedArtifacts:!0}),{mutate:tL,isPending:tD}=(0,i.aC)(ep),tO=(0,d.E)(),tP=(0,E.useCallback)((e,t)=>{eG({type:"CLEAR_SELECTED"}),null==ei||ei(e,t)},[ei,eG]),tB=(0,o.Z3)(ep);(0,t1.h)(ep);let tW=null==tg||null==(h=tg.content)?void 0:h.some(e=>"tool_use"===e.type&&"end_conversation"===e.name),{activeModelOptions:tG}=(0,c.A9)(),tJ=R.z.array(R.z.string()),tH=(0,j.T9)("invite_contest_name","model_prefixes",[],tJ),{data:tV}=(0,i.Fn)();(0,E.useEffect)(()=>{var e,t;if(!ej&&2===ey.length&&(null==(e=ey[0])?void 0:e.sender)==="human"&&(null==(t=ey[1])?void 0:t.sender)==="assistant"&&tH.some(e=>null==tB?void 0:tB.startsWith(e))&&tV&&tV.count>=2){let e=new CustomEvent("firstClaudeMessage",{detail:{conversationUUID:ep,model:tB}});window.dispatchEvent(e)}},[ej,ey,tB,ep,tH,tV]);let tY=(0,E.useMemo)(()=>{let e=eR.formatMessage({defaultMessage:"Learn about Claude’s responses ↗",id:"dD0oo8Rjtz"}),t=tG.find(e=>e.model===tB);if(!t||!t.knowledgeCutoff)return e;let s=N.c9.fromFormat(t.knowledgeCutoff,"LLLL yyyy",{locale:"en-US"});if(!s.isValid)return eR.formatMessage({defaultMessage:"Knowledge limited past {cutoff}. Learn more ↗",id:"fozOi7zOey"},{cutoff:t.knowledgeCutoff});{let e=s.toLocaleString({year:"numeric",month:"long"},{locale:eR.locale});return eR.formatMessage({defaultMessage:"Knowledge limited past {cutoff}. Learn more ↗",id:"fozOi7zOey"},{cutoff:e})}},[tB,tG,eR]),tK=(0,E.useMemo)(()=>tr,[!ej&&tr]),tZ=to&&eW.selectedItem?eW.selectedItem:void 0,tq=(0,E.useCallback)(e=>(0,n.jsx)(sE.A,{...e,conversationUUID:ep,artifacts:tK,onOpenArtifact:tx?th:void 0,onAllow:e.isLastMessage&&!e.toolResult?eA:void 0,selectedDrawerItem:tZ}),[ep,tK,tx,th,eA,tZ]),tQ=(0,E.useCallback)(()=>{e$({})},[]),t6=(0,E.useMemo)(()=>({id:ep,messagesSoFar:ey.length,tokensSoFar:tn,files:ti,attachmentsSoFar:tl.length,isSampling:ej,isStoppingSampling:tD,model:tB,projectKnowledgebaseTokens:null!=tT?tT:0,conversationSettings:eI}),[tl.length,eI,tn,ep,ti,tD,ej,ey.length,tB,tT]),t7=(0,E.useMemo)(()=>tg&&"assistant"===tg.sender&&tg.content&&tg.content.some(e=>"tool_result"===e.type&&"web_search"===e.name),[tg]),t9=(0,E.useCallback)(()=>{tL()},[tL]),t8=(0,E.useCallback)(async e=>{await e4({prompt:e.prompt,attachments:[],files:e.files,syncSources:[]})},[e4]);return eS?(0,n.jsx)(t3.b,{autoscrollDisabled:eF||0===ey.length,autoscrollRef:eU,rightSidebarElement:void 0,mainElement:(0,n.jsxs)(t0._,{conversation:t6,projectUuid:ek,onSend:e4,onCreate:tO,onStopSampling:t9,setPersonalizedStyleCallback:eM,customFileUploadHandler:e5||eN,children:[(0,n.jsx)(sS,{chatId:ep,chatName:ew,onSend:t8}),(0,n.jsxs)("div",{className:"relative mx-auto flex h-full w-full max-w-3xl flex-1 flex-col md:px-2",children:[(0,n.jsx)(sn,{conversationUuid:ep}),eb?(0,n.jsx)(sT,{className:"pt-2",children:(0,n.jsx)(P.d,{})}):0===ey.length?(0,n.jsx)(n.Fragment,{children:(null==t6||null==(w=t6.conversationSettings)?void 0:w.create_mode)?(0,n.jsx)(sT,{className:"pt-1",children:(0,n.jsx)(sf,{})}):(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)(sh,{}),(0,n.jsx)(sT,{})]})}):(0,n.jsxs)(sT,{className:"pt-1",children:[(null==t6||null==(_=t6.conversationSettings)?void 0:_.create_mode)&&(0,n.jsx)(sf,{selectedLabel:(null==ey||null==(Z=ey[0])||null==(K=Z.content)||null==(M=K[0])?void 0:M.type)==="text"?null==ey||null==(Q=ey[0])||null==(X=Q.content)||null==(q=X[0])?void 0:q.text:void 0,disabled:ey.length>0}),(0,n.jsx)(t4.$,{renderToolUseCell:tq,children:ey.map((e,t)=>(0,n.jsx)(P.c,{lastHumanMessageRef:e0.lastHumanMessage,lastAssistantMessageRef:e0.lastAssistantMessage,previousMessage:t>0?ey[t-1]:void 0,message:e,conversationUUID:ep,conversationSettings:eI,isStreaming:ej,isLastMessage:t===ey.length-1,isLastHumanMessage:t===ey.length-2,isFirstAssistantMessage:1===t&&"assistant"===e.sender,messageWarningProps:t===ey.length-1&&eV||void 0,onOpenArtifact:tx?th:void 0,selectAttachment:tf,changeDisplayedConversationPath:tP,editable:!0,publishedArtifacts:null==tU?void 0:tU[e.uuid],onResize:tQ,actionEmitter:tt,onSendContinue:e8,isResearchPending:tM},t))}),(0,n.jsx)("div",{ref:e0.extras,children:(0,n.jsxs)("div",{className:(0,y.A)("ml-1 mt-0.5 flex items-center transition-transform duration-300 ease-out",ej&&"-translate-y-2.5"),children:[(0,n.jsx)("div",{className:"p-1 -translate-x-px",children:(0,n.jsx)(g.a,{state:tz})}),2===ey.length&&ej&&(null==(ee=ey[1])?void 0:ee.content)&&0===ey[1].content.length?(0,n.jsx)(sR,{}):null,(0,n.jsx)("div",{className:(0,y.A)("text-text-400 pt-5 flex-1 text-right text-[0.65rem] leading-[0.85rem] tracking-tighter sm:text-[0.75rem]",ej&&"pointer-events-none"),children:tM&&tE?(0,n.jsx)("div",{className:"inline-block select-none",children:"default"===tA?(0,n.jsxs)(n.Fragment,{children:[(0,n.jsx)("div",{children:(0,n.jsx)(I.A,{defaultMessage:"Research takes time. Claude can let you know when it’s done.",id:"sPgKzf0LZ9"})}),(0,n.jsx)("button",{onClick:tS,className:"text-text-300 hover:text-text-200 underline",children:(0,n.jsx)(I.A,{defaultMessage:"Enable notifications",id:"AIUVfaT9og"})})]}):(0,n.jsx)(I.A,{defaultMessage:"Claude is off doing its research. Check back in later or start a new chat while you wait.",id:"Q/VRaHS8PD"})}):(0,n.jsx)(p.m,{tooltipContent:tY,side:"bottom",disableHoverableContent:!0,className:"max-w-96",children:(0,n.jsx)(A(),{href:"https://support.anthropic.com/en/articles/8525154-claude-is-providing-incorrect-or-misleading-responses-what-s-going-on",target:"_blank",className:(0,y.A)("inline-block underline-offset-2 transition-opacity hover:underline select-none",!ej&&"opacity-100 duration-700",ej&&"opacity-0 duration-0"),children:t7?(0,n.jsx)(I.A,{defaultMessage:"Claude can make mistakes. {lineBreak}Please double-check cited sources.",id:"Al7GtlU74g",values:{lineBreak:(0,n.jsx)("br",{className:"block sm:hidden"})}}):(0,n.jsx)(I.A,{defaultMessage:"Claude can make mistakes. {lineBreak}Please double-check responses.",id:"EY1nHGV6e9",values:{lineBreak:(0,n.jsx)("br",{className:"block sm:hidden"})}})})})})]})}),eF&&(0,n.jsx)(sx,{newMessageSent:eq,setNewMessageSent:eX,scrollRefs:e0,scrollContainerRef:eU,invalidator:eQ})]}),(null==t6||null==(ea=t6.conversationSettings)?void 0:ea.create_mode)&&0===ey.length?null:tW?(0,n.jsx)("div",{ref:e0.chatInput,className:"sticky bottom-0 mx-auto w-full pt-6 z-[5]",children:(0,n.jsx)(t$,{conversationUuid:ep,message:tg})}):(0,n.jsx)("div",{ref:e0.chatInput,className:"sticky bottom-0 mx-auto w-full pt-6 z-[5]",children:(0,n.jsx)(O.V,{ref:e3,placement:"bottom",disabled:eb})})]})]}),drawerElement:(0,n.jsx)(tX,{conversationUUID:ep,isOpen:to,onClose:tu,isStreaming:ej,projectUuid:ek,sendMessage:e4}),isDrawerOpen:to,headerProps:{conversationUUID:ep,name:ew,project:tF?tR:void 0,controlsSidebarIsOpen:to,closeControlsSidebar:tu,openControlsSidebar:td,isStreaming:ej}}):null}let sT=h.J.div(sI())},83133:(e,t,s)=>{"use strict";s.d(t,{L:()=>u,d:()=>m});var a=s(54568),n=s(8027),i=s(11515),l=s(1761),r=s(46760),o=s(55563),c=s(94748),d=s(67532);let u=e=>{let{input:t,toolResult:s}=e,n=(0,r.A)(),{activeOrganization:i}=(0,l.YL)(),c=null==i?void 0:i.uuid,d="";if(void 0!==t){try{d=JSON.stringify(t,null,2)}catch(e){d=String(t)}d=(d=d.replace(/\\n/g,"\n").replace(/\\t/g,"	")).replace(RegExp('(?<!\\\\)"',"g"),"`")}return(0,a.jsxs)("div",{className:"flex flex-col gap-3 p-3 pt-1",children:[(0,a.jsx)(o.z,{title:n.formatMessage({defaultMessage:"Request",id:"p1P+hQq6tY"}),language:"javascript",code:d}),null==s?void 0:s.content.map((e,t)=>"text"===e.type?(0,a.jsx)(o.z,{title:n.formatMessage({defaultMessage:"Response",id:"MgdnPiJHcj"}),language:"json",code:e.text},t):"image"===e.type?(0,a.jsx)("img",{src:"/api/".concat(c,"/files/").concat(e.file_uuid,"/preview"),alt:n.formatMessage({defaultMessage:"Tool result",id:"OJmR+3dTK6"}),className:"max-w-md max-h-md h-auto rounded-md"},t):void 0)]})},m=e=>{let{toolName:t,integrationName:s,integrationIcon:l,...r}=e,{input:o,toolResult:m,isStreaming:f,groupItemKey:x}=r,{isExpanded:h,setIsExpanded:g,snappyTransition:p}=(0,d.a)(f,x);return(0,a.jsx)(c.sH,{isExpanded:h,setIsExpanded:g,text:t,icon:(0,a.jsx)(i.d,{url:l,fallbackSvg:(0,a.jsx)(n.B,{letter:s||t,size:18}),size:18}),...r,children:(0,a.jsx)(c.NG,{isExpanded:h,snappyTransition:p,isScrollable:!0,children:(0,a.jsx)(u,{input:o,toolResult:m})})})}},84137:(e,t,s)=>{"use strict";s.d(t,{CH:()=>b,GT:()=>M,IK:()=>j,Nw:()=>C,OQ:()=>w,Ui:()=>y,YE:()=>k,mk:()=>v,mq:()=>p});var a=s(54568),n=s(7726),i=s(11515),l=s(9946),r=s(77186),o=s(85544),c=s(21036),d=s(32987),u=s(37463),m=s(68864),f=s(7620),x=s(46760),h=s(75006),g=s(57383);function p(e){let{hrefs:t}=e,s=t.map((e,t)=>(0,a.jsx)(u.P.div,{className:(0,d.A)("shadow-xs h-5 w-5 rounded-full overflow-hidden border-0.5 border-border-300 bg-bg-100 flex items-stretch justify-stretch","z-".concat(t+1)),initial:{opacity:0,scale:.8},animate:{opacity:1,scale:1},transition:{delay:.1+.05*t,duration:.3},children:(0,a.jsx)(i.d,{url:e,shouldFillBackground:!0,size:14})},t));return(0,a.jsx)("div",{className:"flex items-center -space-x-2",children:s})}function v(e){let{agents:t,n:s=5}=e,a=new Set;for(let e of t)for(let t of e.annotated_snippets)for(let e of t.tool_calls){var n;if("web_search"===e.tool_name&&(null==(n=e.output)?void 0:n.type)==="rich_content"&&e.output.content.length){for(let t of e.output.content.map(e=>{let{url:t}=e;return t}).filter(Boolean))if("string"==typeof t)try{let e=new URL(t);if(a.add(e.origin),a.size>=s)return Array.from(a).slice(0,s)}catch(e){}}}return Array.from(a)}function j(e,t){let s=!t||t===o.zu.Completed,a=(0,f.useRef)(s),{mutate:i}=(0,n.HF)(e,{refetchOnSettled:!0});(0,f.useEffect)(()=>{s&&!a.current&&i({settings:{compass_mode:null}}),a.current=s},[i,s,e])}function b(e){var t,s;let{organizationUUID:a,conversationUUID:i,taskId:l,isShared:d,enabled:u}=e,[x,h]=(0,f.useState)(!0),[,p]=(0,f.useState)(0),v=(0,c.useDynamicConfig)("use_confused_carousel_sounds").get("polling",[{intervalSeconds:30}]),j=null!=(s=null==(t=v[0])?void 0:t.intervalSeconds)?s:30,[b,y]=(0,f.useState)(j),w=(0,n._W)(i),{setCurrentCompassTask:_}=(0,g.o)(),C=d?"/api/organizations/".concat(a,"/chat_snapshots/").concat(i,"/task/").concat(l,"/status"):"/api/organizations/".concat(a,"/chat_conversations/").concat(i,"/task/").concat(l,"/status"),{data:N,isLoading:k,error:M}=(0,r.Sk)(C,{refetchInterval:!!x&&1e3*b,enabled:!!(u&&i&&a&&l),meta:{noToast:!0}}),A=(null==N?void 0:N.status)!==void 0&&!(0,o.i3)(null==N?void 0:N.status);return(0,f.useEffect)(()=>{if(u&&i&&a&&l)if(A)h(!1),_(void 0),w(),p(0);else if(M){if(!(null==N?void 0:N.started_at))return void h(!1);p(e=>{let t=e+1,s=m.c9.fromISO(N.started_at).plus({hours:3}),a=m.c9.now();return h(t<3&&a<s),t})}else N&&!A&&(p(0),_(l))},[u,l,A,M,w,a,i,N,_]),(0,f.useEffect)(()=>{if(!(null==N?void 0:N.started_at)||!x)return;let e=setInterval(()=>{let e=function(e,t){let s=m.c9.fromISO(e),a=m.c9.now().diff(s,"seconds").seconds;for(let e of t)if(!e.durationSeconds||a<e.durationSeconds)return e.intervalSeconds;return 30}(N.started_at,v);e!==b&&y(e)},1e3*b);return()=>clearInterval(e)},[null==N?void 0:N.started_at,x,v,b]),{compassStatus:N,isLoading:k,error:M,completed:A}}let y=e=>{var t;return null==e||null==(t=e.agents[0])?void 0:t.name};function w(e){let t=(0,x.A)(),s=y(e);return s||(e.status!==o.zu.Completed?t.formatMessage({defaultMessage:"Researching...",id:"eD084+/kcH"}):t.formatMessage({defaultMessage:"Done researching",id:"/ONMTL4lXm"}))}let _=h.z.object({thought:h.z.string()});function C(e){let t=null==e?void 0:e.agents[0];return(0,f.useMemo)(()=>{var e,s,a;let n=null==t||null==(e=t.annotated_snippets[0])?void 0:e.thinking_blocks,i=n&&n.length>0?n[0]:void 0;if(i)return i.thinking;let l=null==t||null==(a=t.annotated_snippets[0])||null==(s=a.tool_calls)?void 0:s.find(e=>"think"===e.tool_name);if(null==l?void 0:l.tool_input)try{let e=JSON.parse(l.tool_input),{data:t}=_.safeParse(e);return null==t?void 0:t.thought}catch(e){return}},[null==t?void 0:t.annotated_snippets])}function N(e){let t=Math.floor(e/1e3),s=Math.floor(t/60),a=Math.floor(s/60);return a>0?"".concat(a,"h ").concat(s%60,"m"):s>0?"".concat(s,"m ").concat(t%60,"s"):t>0?"".concat(t,"s"):"0s"}function k(e){let{startedAt:t,completedAt:s}=e,[n,i]=(0,f.useState)(()=>m.c9.now());if((0,f.useEffect)(()=>{if(!t||s)return;let e=setInterval(()=>{i(m.c9.now())},1e3);return()=>clearInterval(e)},[t,s,i]),!t)return"Starting";let l=m.c9.fromISO(t);if(s){let e=m.c9.fromISO(s).diff(l,"milliseconds").milliseconds;return e<=0?"Starting":(0,a.jsx)(a.Fragment,{children:N(e)})}let r=n.diff(l,"milliseconds").milliseconds;return r<=1e3?"Starting":(0,a.jsx)(a.Fragment,{children:N(r)})}function M(e){let{thought:t,className:s}=e;return t?(0,a.jsx)("div",{className:(0,d.A)("text-text-100 font-claude-response-body",s),children:(0,a.jsx)(l.fP,{text:t})}):null}},89436:(e,t,s)=>{"use strict";s.d(t,{t:()=>i});var a=s(54568),n=s(62971);function i(e){let t,{project:s,className:i}=e;if(s.is_starter_project)t=(0,a.jsx)(n.A,{defaultMessage:"Created by Anthropic",id:"qWDgsCW3nw"});else{var l;t=(null==(l=s.creator)?void 0:l.full_name)?(0,a.jsx)(n.A,{defaultMessage:"Created by {author}",id:"7POMfMfi+y",values:{author:s.creator.full_name}}):(0,a.jsx)(n.A,{defaultMessage:"Created by unknown",id:"QEI1plMxfE"})}return(0,a.jsx)("span",{className:i,children:t})}},94748:(e,t,s)=>{"use strict";s.d(t,{NG:()=>h,aX:()=>g,sH:()=>p});var a=s(54568),n=s(64359),i=s(37711),l=s(29242),r=s(98769),o=s(4705),c=s(99272),d=s(32987),u=s(37463),m=s(7620),f=s(33792),x=s(11480);let h=e=>{let{isExpanded:t,isScrollable:s,snappyTransition:i,children:l,className:o,onTransitionEnd:c,collapsesHalfway:f,setIsExpanded:x}=e,h=(0,m.useRef)(t),g=!!(f&&!t&&x),p=f&&!t;return(0,a.jsx)(u.P.div,{className:(0,d.A)("overflow-hidden shrink-0",!t&&g&&"cursor-pointer"),tabIndex:-1,initial:{opacity:0,height:h.current?"auto":0},animate:t?"expanded":"collapsed",variants:{expanded:{opacity:1,height:"auto"},collapsed:{opacity:.6*!!f,height:72*!!f}},whileHover:{opacity:1},transition:i?{ease:r.A.snappyOut,duration:.4}:{ease:"easeInOut",duration:.4},onTransitionEnd:c,onClick:g?()=>x(!0):void 0,children:(0,a.jsx)(n.r,{gradientHeight:16,tabIndex:-1,style:{scrollbarGutter:"stable"},className:(0,d.A)("h-full",s&&"!max-h-[238px]",o,p&&"[mask-image:linear-gradient(to_bottom,_hsl(var(--always-black)/100%)_0%,_hsl(var(--always-black)/0%)_100%)]",!t&&"pointer-events-none"),children:l})})},g=e=>{let{handleClick:t,isDisabled:s,isExpanded:n,isStreaming:r,isError:c,errorMessage:m,icon:h,text:g,secondaryIcon:p,secondaryText:v,isFirstBlockOfMessage:j,isLastBlockOfMessage:b,className:y,wrapperClassName:w,children:_,renderMode:C=f.l.Standard,isFirstItemInGroup:N,isLastItemInGroup:k}=e,M=s||!t,A=(0,a.jsxs)(a.Fragment,{children:[(0,a.jsxs)("button",{onClick:t,className:(0,d.A)("group/row flex flex-row items-center justify-between gap-4 transition-colors duration-200 rounded-lg text-text-300 hover:text-text-200 h-[2.625rem] py-2 px-3",M?"cursor-default":"cursor-pointer hover:text-text-000",y),disabled:M,children:[(0,a.jsxs)("div",{className:"flex flex-row items-center gap-2 min-w-0",children:[h&&C!==f.l.TimelineGroup&&(0,a.jsx)("div",{className:"w-5 h-5 flex items-center justify-center text-text-100",children:h}),(0,a.jsx)("div",{className:"relative bottom-[0.5px] font-base text-left leading-tight overflow-hidden overflow-ellipsis whitespace-nowrap flex-grow text-text-300",children:r?(0,a.jsx)(i.N,{children:g}):g})]}),(0,a.jsx)("div",{className:"flex flex-row items-center gap-1.5 min-w-0 shrink-0",children:c?(0,a.jsx)(l.m,{tooltipContent:m,align:"center",children:(0,a.jsx)(o.N,{size:16,className:"text-danger-000"})}):(0,a.jsxs)(a.Fragment,{children:[!!v&&(0,a.jsx)("p",{className:"relative bottom-[0.5px] pl-1 text-text-500 font-small leading-tight shrink-0 whitespace-nowrap",children:v}),p]})})]},r?"streaming":"non-streaming"),_]});return C===f.l.TimelineGroup?(0,a.jsx)(x.i1,{icon:h,isExpanded:n,isFirstItem:!!N,isLastItem:!!k,isActive:r&&b&&k,children:A}):(0,a.jsx)(u.P.div,{initial:{opacity:+!r},animate:{opacity:1},transition:{duration:.5,ease:"easeIn"},className:(0,d.A)("transition-all duration-400 ease-out rounded-lg border-0.5 flex flex-col font-ui tracking-tight leading-normal my-3 border-border-300 min-h-[2.625rem]",!s&&!n&&"hover:bg-bg-000 hover:shadow-sm",j?"mt-2":"mt-3",b?"mb-2":"mb-3",n&&"bg-bg-000 shadow-sm",w),children:A})},p=e=>{let{isExpandingDisabled:t,setIsExpanded:s,...n}=e,{isExpanded:i,isError:l}=n,r=t||l;return(0,a.jsx)(g,{...n,isDisabled:r,handleClick:()=>s(!i),secondaryIcon:r?void 0:(0,a.jsx)(c.a,{className:(0,d.A)("relative bottom-[0.5px] transform transition-transform duration-400 ease-snappy-out text-text-300",i?"-rotate-180":"rotate-0",r&&"opacity-15"),size:12})})}},97527:(e,t,s)=>{"use strict";s.d(t,{I:()=>n,q:()=>i});var a=s(7620);let n=(0,a.createContext)(null),i=()=>{let e=(0,a.useContext)(n);if(!e)throw Error("useReplExecutionSandbox must be used within a ReplExecutionSandboxContextProvider");return e}}}]);